sudo yum install pcre-devel zlib-devel openssl-devel gcc -y

echo "export MAVEN_ROOT=~/maven
export PYTHONPATH=$MAVEN_ROOT" >> .bashrc
source ~/.bashrc

cd
#for python3
wget http://www.python.org/ftp/python/3.3.2/Python-3.3.2.tar.bz2
bzip2 -d Python-3.3.2.tar.bz2
tar -xvf Python-3.3.2.tar
cd Python-3.3.2
./configure
make -j 4
sudo make altinstall


cd
# python db connectivity
sudo yum install python-psycopg2 -y

cat deploy-key >> .ssh/authorized_keys
cat github >> .ssh/known_hosts
chmod 600 .ssh/*
git clone git@github.com:MavenMedical/maven.git

cd maven
git checkout DEV
cp scripts_testing_benchmarking/gitHooks/cloudBoxes/* .git/hooks/
chmod +x .git/hooks/*

cd
# for nginx
wget http://nginx.org/packages/rhel/6/x86_64/RPMS/nginx-1.6.0-2.el6.ngx.x86_64.rpm
sudo rpm -i nginx-*.el6.ngx.x86_64.rpm
sudo chkconfig nginx off

#openssl genrsa -des3 -out server.key 2048
#openssl req -new -key server.key -out server.csr
#cp server.key server.key.org
#openssl rsa -in server.key.org -out server.key
#openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
sudo cp server.crt server.key /etc/nginx/conf.d/
sudo rm /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/example_ssl.conf
sudo cp maven/scripts_testing_benchmarking/cloud_setup/nginx_dev.conf /etc/nginx/conf.d/
chmod g+rx `pwd`

sudo usermod -G `whoami` -a nginx

sudo yum install rabbitmq-server -y
sudo service rabbitmq-server start
sudo chkconfig rabbitmq-server on


echo "/etc/limited/restartnginx
su devel -c '(cd ~/maven && source ~/.bashrc && nohup ~/maven/run_maven.sh)'" | sudo tee -a /etc/rc.local

sudo echo '#!/bin/bash
service nginx restart' | sudo tee  /etc/limited/restartnginx
sudo chmod a+rx /etc/limited/*

cd ~/maven/scripts_testing_benchmarking/cloud_setup/google/
for x in `ls etc_*`
do
	sudo cp $x /etc/mavenmedical/${x#*_mavenmedical_}
done
sudo chmod 644 /etc/mavenmedical/*

echo MUST SETUP /etc/mavenmedical/maven.config