#!/bin/bash
SYSNAME=$1
DISKNAME=$2
if gcloud compute instances list | grep "^..${SYSNAME} "; then
    echo instance $SYSNAME already exists
    exit 1
fi

gcloud compute instances create $SYSNAME --zone us-central1-f --machine-type g1-small --image centos-7  --tags dev ssh --boot-disk-device-name $DISKNAME --boot-disk-size 100 --boot-disk-type pd-standard

if [ $? -eq 0 ]; then
    sleep 60
else
    echo gcloud compute instances create $SYSNAME failed
    exit 1
fi

if ! (gcloud compute instances list | grep $SYSNAME) then
    echo gcloud compute instances list does not show instance $SYSNAME
    exit 1
fi

#gcloud compute disks create $DISKNAME --size 100 --type pd-standard
#gcloud compute instances attach-disk $SYSNAME --zone="us-central1-f" --disk=$DISKNAME

gcloud compute copy-files setup_scripts/common.sh setup_scripts/database_only.sh $SYSNAME:~/ --zone us-central1-f

#echo "bash common" | gcutil ssh $SYSNAME 
#echo "bash database_only" | gcutil ssh $SYSNAME