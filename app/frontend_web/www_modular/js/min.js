define("globalmodels/contextModel",["jquery","underscore","backbone"],function(e,t,n){function i(e){var t,n;for(t=0;n=document.getElementsByTagName("link")[t];t++)-1!=n.getAttribute("rel").indexOf("style")&&n.getAttribute("title")&&(n.disabled=!0,n.getAttribute("title")==e&&(n.disabled=!1))}function a(e){var t=readCookie("valid-through");if(t){var n=t-new Date+e;n>0?setTimeout(function(){a(e)},n):(eraseCookie("valid-through"),location.href="#logout")}}var o,s=function(t){console.log("login call back",o);var s=new Date-readCookie("now");a(s),o.set({loginTemplate:null}),i("demo");var l=t.get("widgets"),r=[],d=[];for(var c in l){var h=l[c];r.push("widgets/"+h.widget),d.push("text!/templates/"+h.template),console.log("adding view "+h.widget+" to element #"+h.element+" with template "+h.template)}require(r.concat(d),function(){for(var t=0;t<r.length;t++){var i;"contentRow"==l[t].element?(e("#dynamic-content").append("<div class='row content-row'></div>"),i=e(".row",e("#dynamic-content")).last()):"floating-right"==l[t].element?(e("#floating-right").append("<div class='row content-row'></div>"),i=e(".row",e("#floating-right")).last()):"floating-left"==l[t].element?(e("#floating-left").append("<div class='row content-row'></div>"),i=e(".row",e("#floating-left")).last()):"fixed-topB"==l[t].element?(e("#fixed-topB").append("<div class='col-xs-12'></div>"),i=e(".col-xs-12",e("#fixed-topB")).last()):i=e("#"+l[t].element);try{new arguments[t]({template:arguments[t+r.length],el:i})}catch(a){console.log("failed to start widget ",l[t],a)}}e("#content").show(),n.history.loadUrl(n.history.fragment)})},l=n.Model.extend({urlRoot:"/login",defaults:{page:null,user:null,customer:null,userAuth:"",patients:"",patientAuth:"",patientName:"",pathid:0,canonical:null,provider:null,encounter:null,department:null,searchPatient:null,searchDiagnosis:null,loginTemplate:"login.html",settingsTemplate:"settings.html"},toParams:function(){var e=t.pick(this.attributes,["startdate","enddate","encounter","patients","department","pathid"]);e.id=e.pathid;for(var n in e)(null===e[n]||"provider"!=n&&""===e[n])&&delete e[n];return e},setUser:function(e,t,n,i,a){if(this.user!=e||!this.userAuth){this.set({user:e,customer:i,"login-message":null});var o,l=this;o=t?{user:e,password:t,customer_id:i}:{user:e,oauth:n,customer_id:i},a&&(o.newpassword=a),this.fetch({success:s,error:function(e,t){l.set(t.responseJSON)},data:JSON.stringify(o),type:"POST"})}},autoSetUser:function(e,t,n,i){var a=this;this.set({user:e,customer:t,userAuth:null}),n?this.fetch({success:s,error:function(e,t){a.set(t.responseJSON),new i({el:"#login-modal"})},data:JSON.stringify({user:e,customer_id:t,userAuth:n}),type:"POST"}):!document.cookie||e&&readCookie("user")!=e?new i({el:"#login-modal"}):this.fetch({url:"/refresh_login",success:s,error:function(){new i({el:"#login-modal"})}})}});return o=new l,o.on("change:page",function(){window.scrollTo(0,0)}),o}),define("globalmodels/layoutModel",["jquery","underscore","backbone"],function(e,t,n){var i,a=n.Model.extend({defaults:{fluidContent:!1,contentHeight:"400px"},applicationFunctions:new n.Model({fluidContent:function(t){t?(e("#contentContainer").addClass("container-fluid"),e("#contentContainer").removeClass("container")):(e("#contentContainer").removeClass("container-fluid"),e("#contentContainer").addClass("container"))},contentHeight:function(t){e("#contentContainer").css({height:t})}}),initialize:function(){this.on("change",function(){this.apply()},this)},apply:function(e){if(e)for(var n in e){var i=e[n];this.applicationFunctions.get(i)(this.get(i))}else for(var n in t.keys(this.attributes)){var i=t.keys(this.attributes)[n];this.applicationFunctions.get(i)(this.get(i))}}});return i=new a}),define("widgets/evidence",["jquery","underscore","backbone"],function(e,t,n){var i=n.View.extend({el:"#modal-target",initialize:function(e){this.evi=e.evi,t.bindAll(this,"render"),this.render()},render:function(){var n=this;return require(["text!../evidence/"+n.evi+".html"],function(i){var a=t.template(i),o=a({alert:n.evi});n.$el.append(o),e("#evidence-"+n.evi).modal()}),n}});return i}),define("text",["module"],function(e){var t,n,i,a,o,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,r=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,c=d&&location.protocol&&location.protocol.replace(/\:/,""),h=d&&location.hostname,u=d&&(location.port||void 0),p={},m=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(l,"");var t=e.match(r);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(i){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,i,a=!1,o=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),n=e.substring(o+1,e.length)):t=e,i=n||t,o=i.indexOf("!"),-1!==o&&(a="strip"===i.substring(o+1),i=i.substring(0,o),n?n=i:t=i),{moduleName:t,ext:n,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,a){var o,s,l,r=t.xdRegExp.exec(e);return r?(o=r[2],s=r[3],s=s.split(":"),l=s[1],s=s[0],!(o&&o!==n||s&&s.toLowerCase()!==i.toLowerCase()||(l||s)&&l!==a)):!0},finishLoad:function(e,n,i,a){i=n?t.strip(i):i,m.isBuild&&(p[e]=i),a(i)},load:function(e,n,i,a){if(a.isBuild&&!a.inlineText)return void i();m.isBuild=a.isBuild;var o=t.parseName(e),s=o.moduleName+(o.ext?"."+o.ext:""),l=n.toUrl(s),r=m.useXhr||t.useXhr;return 0===l.indexOf("empty:")?void i():void(!d||r(l,c,h,u)?t.get(l,function(n){t.finishLoad(e,o.strip,n,i)},function(e){i.error&&i.error(e)}):n([s],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)}))},write:function(e,n,i){if(p.hasOwnProperty(n)){var a=t.jsEscape(p[n]);i.asModule(e+"!"+n,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,n,i,a,o){var s=t.parseName(n),l=s.ext?"."+s.ext:"",r=s.moduleName+l,d=i.toUrl(s.moduleName+l)+".js";t.load(r,i,function(){var n=function(e){return a(d,e)};n.asModule=function(e,t){return a.asModule(e,d,t)},t.write(e,r,n,o)},o)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var a=n.readFileSync(e,"utf8");0===a.indexOf("﻿")&&(a=a.substring(1)),t(a)}catch(o){i(o)}}):"xhr"===m.env||!m.env&&t.createXhr()?t.get=function(e,n,i,a){var o,s=t.createXhr();if(s.open("GET",e,!0),a)for(o in a)a.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),a[o]);m.onXhr&&m.onXhr(s,e),s.onreadystatechange=function(){var t,a;4===s.readyState&&(t=s.status,t>399&&600>t?(a=new Error(e+" HTTP status: "+t),a.xhr=s,i(a)):n(s.responseText),m.onXhrComplete&&m.onXhrComplete(s,e))},s.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,a="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),l=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),a)),r="";try{for(n=new java.lang.StringBuffer,i=l.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=l.readLine());)n.append(s),n.append(i);r=String(n.toString())}finally{l.close()}t(r)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,a=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,s,l,r={};o&&(e=e.replace(/\//g,"\\")),l=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(a.nsIFileInputStream),n.init(l,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(a.nsIConverterInputStream),s.init(n,"utf-8",n.available(),a.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),r),s.close(),n.close(),t(r.value)}catch(d){throw new Error((l&&l.path||"")+": "+d)}}),t}),define("text!templates/resetPassword.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="modal-dialog modal-lg login">\n  <div class="modal-content">\n    <div class="modal-body">\n      <h3><span class="glyphicon glyphicon-repeat"></span>EMR password reset</h3>\n      <p><input id="ehr-user" type="text" name="user" placeholder="EMR user name"> </p>\n      <p><input id="reset-customer" type="text" name="customer" placeholder="Customer ID"></p>\n      <div id=\'recaptcha-div\'></div>\n      <div>\n        <button id="send-reset-password">Send</button> reset password link to EMR account\n      </div>\n    </div>\n  </div>\n</div>\n</div>\n'}),define("widgets/login",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(){i.on("change:loginTemplate change:login-message",this.render,this),e("#login-modal").modal({show:"true",backdrop:"static",keyboard:!1}),this.user="",this.customer="",this.render();var t=this,n=location.hostname.split(".");3==n.length&&e.ajax({type:"GET",dataType:"json",url:"/customer_id?abbr="+n[0],success:function(n){t.fixed_customer=n;var i=e("#login-customer");i.val(n),i.hide()}})},events:{"click #login-button":"dologin","click #update-password":"dologin","keyup #login-user":"doenterlogin","keyup #login-password":"doenterlogin","keyup #login-new-password":"doenterchange","click #reset-password":"resetpassword"},resetpassword:function(){var n=this,i="text!/services/recaptcha";require(["text!../templates/resetPassword.html",i,"//www.google.com/recaptcha/api/js/recaptcha_ajax.js"],function(i,a){var o=t.template(i);n.$el.html(o()),Recaptcha.create(a,"recaptcha-div",{callback:Recaptcha.focus_response_field}),e("#send-reset-password").click(function(){var t=e("#ehr-user").val(),n=e("#reset-customer").val(),i=e("#recaptcha_response_field").val(),a=e("#recaptcha_challenge_field").val();e.ajax({url:"/send_reset_password",data:{user:t,customer_id:n,recaptcha_challenge_field:a,recaptcha_response_field:i},success:function(){alert("A reset password message has been sent to this account.")},error:function(){alert("We could not verify your recaptcha response.  Try again, or contact IT about directly resetting your password."),Recaptcha.reload()}})})})},render:function(){if(i.get("loginTemplate")){var n=this;require(["text!../templates/"+i.get("loginTemplate")],function(a){if(n.template=t.template(a),n.$el.html(n.template(i.attributes)),n.fixed_customer){var o=e("#login-customer");o.val(n.fixed_customer),o.hide()}var s=i.get("login-message");s&&setTimeout(function(){e("#login-message").text(s)},500),n.newPasswordChange()})}else e("#login-modal").modal("hide");return this},doenterlogin:function(e){13==e.keyCode&&this.dologin(e)},doenterchange:function(e){13==e.keyCode?this.dologin(e):this.newPasswordChange()},dologin:function(){var t=e("#login-user").val(),n=e("#login-customer").val();this.user=t,this.customer=n;var a=e("#login-password").val(),o=e("#login-oauth").val();if(t&&(a||o)){var s=e("#login-new-password");e("#login-message").text("Trying to log in"),s.is(":visible")?this.newPasswordChange()&&i.setUser(t,a,o,n,s.val()):i.setUser(t,a,o,n,null)}},newPasswordChange:function(){var t=e("#login-new-password").val();if(!t)return!1;var n="<big><big><font color='#00b000'>&#x2714</font></big></big>",i="<big><font color='#ff0000'>&#x2718</font></big>",a=t.length<8,o=t.search(".*[a-z]")<0,s=t.search(".*[A-Z]")<0,l=t.search(".*[0-9]")<0,r=t==e("#login-password").val();return e("#pw-len-cb").html(a?i:n),e("#pw-low-cb").html(o?i:n),e("#pw-up-cb").html(s?i:n),e("#pw-num-cb").html(l?i:n),e("#pw-diff-cb").html(r?i:n),a||o||s||l||r?!1:!0}});return a}),define("widgets/settings",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(){this.render()},events:{"click #save-settings":"dosave","click #update-password":"dologin","click #cancel-settings":"docancel","keyup #official-name-input":"doentersave","keyup #display-name-input":"doentersave","keyup #login-password":"doenterlogin","keyup #login-new-password":"doenterchange"},render:function(){if(i.get("settingsTemplate")){var n=this;require(["text!../templates/"+i.get("settingsTemplate")],function(e){n.template=t.template(e),n.$el.html(n.template(i.attributes)),n.newPasswordChange()})}else e("#settings-modal").modal("hide");return this},dohide:function(){e("#settings-modal").modal("hide")},docancel:function(){this.dohide()},doentersave:function(e){13==e.keyCode&&this.dosave(e)},doenterchange:function(e){13==e.keyCode?this.dologin(e):this.newPasswordChange()},dosave:function(){var t=e("#official-name-input").val(),n=e("#display-name-input").val();e.ajax({url:"/save_user_settings",data:e.param(i.toParams())+"&official_name="+t+"&display_name="+n,success:function(){console.log("Settings saved")},error:function(){console.log("Settings failed to save")}}),e("#settings-modal").modal("hide")},newPasswordChange:function(){var t=e("#login-new-password").val(),n="<big><big><font color='#00b000'>&#x2714</font></big></big>",i="<big><font color='#ff0000'>&#x2718</font></big>",a=t.length<8,o=t.search(".*[a-z]")<0,s=t.search(".*[A-Z]")<0,l=t.search(".*[0-9]")<0,r=t==e("#login-password").val();return e("#pw-len-cb").html(a?i:n),e("#pw-low-cb").html(o?i:n),e("#pw-up-cb").html(s?i:n),e("#pw-num-cb").html(l?i:n),e("#pw-diff-cb").html(r?i:n),a||o||s||l||r?(e("#login-button").attr("disabled","disabled"),!1):(e("#login-button").removeAttr("disabled"),!0)}});return a}),define("router",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/layoutModel","widgets/evidence","widgets/login","widgets/settings"],function(e,t,n,i,a,o,s){var l=function(){return i.get("user")&&i.get("userAuth")?!0:(new s({el:"#login-modal"}),!1)},r=["#floating-left","#dynamic-content","#floating-right"],d={home:[0,12,0],patient:[0,9,3],episode:[0,9,3],pathway:[0,12,0],pathEditor:[0,12,0],triggerEditor:[0,12,0]};changePageLayout=function(t){t in d&&e.each(r,function(n,i){0==d[t][n]?e(i).hide():(e(i).show(),e(i).removeClass(),e(i).addClass("content col-md-"+d[t][n]))})};var c=function(e,t,n){if(document.cookie&&!i.get("userAuth")||e&&!i.get("user"))i.autoSetUser(e,t,n,s);else{if(l())return console.log("showing page "+i.get("page")),changePageLayout(i.get("page")),!0;console.log("trying to log in")}return!1},h=n.Router.extend({routes:{logout:"logout",settings:"settings","auditlist(login/:user/:customer/)(:userAuth)":"showAudit","profile(login/:user/:customer/)(:userAuth)":"showProfile","customers(login/:user/:customer/)(:userAuth)":"showCustomers","(login/:user/:customer/)(:userAuth)":"showHome","patient/:id(/login/:user/:customer/)(:userAuth)":"showPatient","episode/:id/patient/:id/:date(/login/:user/:customer/)(:userAuth)":"showEpisode","evidence/:id/patient/:id/evi/:id(/login/:user/:customer/)(:userAuth)":"showEvidence","pathway/:id/node/:id(/patient/:id/:date)(/login/:user/:customer/)(:userAuth)":"showPathway","pathwayeditor/:id/node/:id(/login/:user/:customer/)(:userAuth)":"EditPathway","triggereditor/:id/node/:id(/login/:user/:customer/)(:userAuth)":"EditTriggers","password/:type/:user/:customer/:oauth":"password","*action":"defaultAction"},password:function(e,t,n,a){i.get("userAuth")?window.location="#":(i.set({loginTemplate:e+".html",user:t,customer_id:n,oauth:a}),new s({el:"#login-modal"}))},showHome:function(e,t,n){i.set({page:"home",patients:null,encounter:null,patientName:null}),"Heathcliff Huxtable"==i.get("official_name")&&i.set({page:"pathway",patients:null,encounter:null,patientName:null}),c(e,t,n)},showPatient:function(e,t,n,a){i.set({page:"patient",encounter:null,patients:e}),c(t,n,a)},showEpisode:function(e,t,n,a,o,s){i.set({page:"episode",encounter:e,patients:t,enc_date:n,startdate:null,enddate:null}),c(a,o,s)},showPathway:function(e,t,n,o,s,l,r){a.set({fluidContent:!1}),i.set({page:"pathway",code:t,pathid:e,patients:n,enc_date:o,startdate:null,enddate:null}),c(s,l,r)},showEvidence:function(e,t,n,a,s,l){if(i.set({page:"episode",encounter:e,patients:t}),c(a,s,l)){new o({evi:n})}},EditPathway:function(e,t,n,o,s){a.set("fluidContent",!0),i.set({page:"pathEditor",pathid:e,code:t}),c(n,o,s)},EditTriggers:function(e,t,n,o,s){a.set("fluidContent",!1),i.set({page:"triggerEditor",pathid:e,code:t}),c(n,o,s)},showPathwayHistory:function(e,t,n,a,o){i.set({page:"pathHistory",pathid:e,code:t}),c(n,a,o)},showCustomers:function(e,t,n){i.set({page:"customers"}),c(e,t,n)},showProfile:function(e,t,n){i.set({page:"profile"}),c(e,t,n)},showAudit:function(e,t,n){i.set({page:"auditlist"}),c(e,t,n)},logout:function(){eraseCookie("valid-through"),eraseCookie("roles"),eraseCookie("username");for(var t=10;document.cookie&&t>0;)t-=1,eraseCookie(document.cookie.split("=")[0]);i.clear({silent:!0}),e.ajax({type:"POST",dataType:"json",url:"/logout"}),location.href="/index.html"},defaultAction:function(e){console.log("No route:",e)},initialize:function(){e.ajaxPrefilter(function(e){e.url="services"+e.url}),n.history.start()}});return h}),define("globalmodels/sidebarModel",["backbone"],function(e){var t={Profile:["fa-user","profile"],Customers:["fa-user","customers"],Pathways:["fa-user","pathways"],"Pathway Mgmt":["fa-cloud","pathway",[{"Pathway Viewer":["icon","pathway"]},{"Pathway Editor":["icon","pathwayEditor"]}]],Dashboard:["fa-tachometer","home"]},n=e.Model.extend({addOption:function(e){this.get(e)||this.set(e,t[e])}});return new n}),define("widgets/pageOption",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=function(t,n,i){return e("<li>",{}).append(e("<a>",{href:t,"class":"dropdown-toggle"}).append(e("<i>",{"class":"menu-icon fa "+n})).append(e("<span>",{"class":"menu-text",text:i})).append(e("<b>",{"class":"arrow"})))},l=function(t,n){n="undefined"!=typeof n?n:"#sidebar-list";for(o in t){var i=a(t[o][1],t[o][0],o);if(3==t[o].length){e(i.children()[0]).append(e("<b>",{"class":"arrow fa fa-angle-down"}));var r=e("<ul>",{"class":"submenu"}),d=t[o][2];for(s in d)l(d[s],r);i.append(r)}i.appendTo(n)}},r=n.View.extend({el:"#sidebar-list",initialize:function(e,t){t="undefined"!=typeof t?t:"#sidebar-list",l(e,t),this.$el.off("click")},events:{"click a":"setPage"},setPage:function(t){t.preventDefault();var a=e(t.currentTarget).attr("href");"pathway"==a?n.history.navigate("pathway/"+i.get("pathid")+"/node/"+i.get("code"),{trigger:!0}):"pathwayEditor"==a?n.history.navigate("pathwayeditor/"+i.get("pathid")+"/node/"+i.get("code"),!0):n.history.navigate(a,!0),console.log("page option",i.get("page"))}});return r}),define("text!templates/sidebar.html",[],function(){return'<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse" data-target="#sidebar">\n    <i class="ace-icon fa fa-angle-double-right" data-icon1="ace-icon fa fa-angle-double-left"\n       data-icon2="ace-icon fa fa-angle-double-right"></i>\n</div>\n<ul class="nav nav-list" id="sidebar-list">\n\n</ul>\n\n\n'}),define("widgets/sidebar",["jquery","underscore","backbone","ace","globalmodels/contextModel","globalmodels/sidebarModel","widgets/pageOption","text!../templates/sidebar.html"],function(e,t,n,i,a,o,s,l){var r=n.View.extend({initialize:function(){this.template=t.template(l),this.render(),o.on("change",this.change,this),o.addOption("Dashboard")},change:function(){t.each(o.changed,function(e,t){var n={};n[t]=e,new s(n)})},el:"#sidebar",render:function(){this.$el.html(this.template())}});return r}),define("app",["jquery","underscore","backbone","bootstrap","router","widgets/sidebar"],function(e,t,n,i,a,o){var s=function(){new a,new o};return{initialize:s}}),!function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,a=i._mouseInit,o=i._mouseDestroy;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),a.call(t)},i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),o.call(t)}}}(jQuery),define("touch",["jquery_ui"],function(){}),require.config({paths:{jquery:["jquery-stub"],jquery_ui:["//code.jquery.com/ui/1.10.1/jquery-ui.min","libs/jquery/jquery-ui.min"],jquery_autocomplete:"libs/jquery/jquery.ui.autocomplete.html",touch:"libs/jquery/jquery.ui.touch-punch.min",underscore:"libs/underscore/underscore-min",backbone:["libs/backbone/backbone","//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"],jsplumb:["libs/jsplumb2/js/jquery.jsPlumb-1.6.2-min","libs/jsplumb2/js/jsplumb"],bootstrap:"../css/bootstrap/js/bootstrap.min",bootstrapswitch:"libs/bootstrap-switch/bootstrap-switch",nestedSortable:"libs/nestedSortable/nestedSortable",nestable:"../ace/assets/js/jquery.nestable",fullcalendar:"libs/fullCalendar/fullcalendar.min",moment:"libs/fullCalendar/moment.min",ckeditor2:"libs/ckeditor/ckeditor",ckeditor:"ckeditor-customize",templates:"../templates",amchartspie:"libs/amcharts/pie",amchartslight:"libs/amcharts/themes/light",amchartsserial:"libs/amcharts/serial",amcharts:"libs/amcharts/amcharts",ace:"libs/ace/ace.min",aceelements:"libs/ace/ace-elements.min",aceextra:"libs/ace/ace-extra.min"},shim:{touch:{deps:["jquery_ui"]},ace:{deps:["jquery","jquery_ui","bootstrap","aceelements"]},aceextra:{deps:["bootstrap","jquery","jquery_ui"]},aceelements:{deps:["aceextra","bootstrap","jquery_ui","jquery"]},bootstrap:{deps:["jquery","jquery_ui"]},bootstrapswitch:{deps:["jquery","jquery_ui","bootstrap"]},nestable:{deps:["jquery","jquery_ui","bootstrap"]},jsplumb:{deps:["jquery","jquery_ui"]},fullCalendar:{deps:["jquery","moment","jquery_ui"]},jquery_ui:{deps:["jquery"]},amchartspie:{deps:["amcharts"],exports:"AmCharts",init:function(){AmCharts.isReady=!0}},amchartsserial:{deps:["amcharts"],exports:"AmCharts",init:function(){AmCharts.isReady=!0}},amchartslight:{deps:["amcharts"],exports:"AmCharts",init:function(){AmCharts.isReady=!0}}}}),require(["app","jquery","touch","underscore","backbone","bootstrap","bootstrapswitch","ace","text"],function(e){e.initialize()}),define("main",function(){}),define("pathway/models/treeContext",["backbone"],function(e){var t=e.Model.extend({});return new t}),define("pathway/models/nodeModel",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeContext"],function(e,t,n,i,a){var o,s=n.Collection.extend({populate:function(e,t,i){if(e)for(var a in e){var s,l=e[a];l.children?(s=new o(l,t,i),s.set("hasLeft",0!=a),s.set("hasRight",a<e.length-1)):(s=new n.Model(l),s.set("isProtocol",!0)),this.add(s,{silent:!0})}},toJSON:function(e){var n=[];return t.each(this.models,function(t){n.push(t.toJSON(e))},this),n}});return o=n.Model.extend({getNodeType:function(){return"treeNode"},initialize:function(e,i,a){e.nodeID?this.set("nodeID",e.nodeID,{silent:!0}):this.set("nodeID",i.get("pathid")+":"+i.getNextNodeID(),{silent:!0}),e.children||(e.children=[]);var o=new s;o.populate(e.children,i,a),this.set({children:o,name:e.name,tooltip:e.tooltip,sidePanelText:e.sidePanelText},{silent:!0}),this.hideChildren(),t.each(this.get("children").models,function(e){e.showChildren&&e.showChildren()}),e.protocol&&(e.protocol.nodeID||(e.protocol.nodeID=i.getNextNodeID()),this.get("children").add(new n.Model(e.protocol)))},toJSON:function(e){var n=t.omit(this.attributes,["children","hasLeft","hasRight"]);return e.toExport&&(n=t.omit(n,["nodeID"])),n.children=this.get("children").toJSON(e),n},populateChildren:function(e,t){var n=new s;e&&n.populate(e,this,t),this.set({children:n},{silent:!0})},showChildren:function(){a.unset(this.get("nodeID"))},hideChildren:function(){a.set(this.get("nodeID"),"hideChildren")},childrenHidden:function(){return a.get(this.get("nodeID"))}})}),define("pathway/models/pathwayCollection",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.Collection.extend({model:n.Model.extend({idAttribute:"canonical"}),url:function(){return"/list"},initialize:function(){this.fetch()},addNewPath:function(){this.fetch({add:!0})},makeSortable:function(){jQuery(function(e){e(".dd").nestable(),e(".dd-handle a").on("mousedown",function(e){e.stopPropagation()}),e('[data-rel="tooltip"]').tooltip()})},getParents:function(t){var n=[];e(t).hasClass("sub-folder")&&n.push(e(t).children().first().attr("name"));for(var i=e(t).parent().closest(".sub-folder");i.length;){var a=i.children(".pathway-folder-title").attr("name");if(""==a)break;n.push(a),i=e(i).parent().closest(".sub-folder")}return n.reverse(),n},handleMovedPath:function(t,n){var a={canonical:t,customer_id:i.get("customer_id"),userid:i.get("userid")};e.extend(a,i.toParams(),a),e.ajax({type:"POST",dataType:"json",url:"/update_pathway_location?"+e.param(a),data:JSON.stringify(n),success:function(){console.log("pathway location updated")}})},handleMovedFolder:function(t,n,i,a){var o=0;e(t).children("ol").children().each(function(){if(e(this).hasClass("pathrow-item")){o++;var t={location:n,position:o},s=e(".path-row",e(this)).attr("id");i.handleMovedPath(s,t)}else a&&(new_path=n+"/"+e(".pathway-folder-title",e(this)).first().attr("name"),i.handleMovedFolder(this,new_path,i))})}});return a=new a}),define("pathway/models/triggerGroupCollection",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n){var i=n.Collection.extend({populate:function(e,t){var n=this;if("version1"==t)for(var i in e){var s=e[i],l=new a;l.populate({JSON:s}),l.on("cascade",function(){n.trigger("cascade")}),this.add(l,{silent:!0})}else if("preversion"==t){var l=new a;l.populate({relationship:"and"}),l.on("cascade",function(){n.trigger("cascade")});var r=new o;r.populate(e),l.set("details",r,{silent:!0}),this.add(l,{silent:!0})}this.on("add",function(){n.trigger("cascade")}),this.on("remove",function(){n.trigger("cascade")}),0==n.models.length&&n.addGroup("and")},addGroup:function(e){var t=new a,n=this;return t.populate({relationship:e}),t.on("cascade",function(){n.trigger("cascade")}),this.add(t),t}}),a=n.Model.extend({populate:function(e){var t=this;if(e.JSON){this.set("relationship",e.JSON.relationship);var n=new o;n.populate(e.JSON.details),n.on("cascade",function(){t.trigger("cascade")}),this.set("details",n,{silent:!0})}else if(e.relationship){this.set("relationship",e.relationship,{silent:!0});var n=new o;n.populate(),n.on("cascade",function(){t.trigger("cascade")}),this.set("details",n,{silent:!0})}this.on("change",function(){this.trigger("cascade")})},addDetail:function(e,t){var n=this,i=new l;i.populate(e.attributes),i.on("cascade",function(){n.trigger("cascade")});var a=this.get("details");if(a.get(t))a.get(t).add(i);else{var o=new s;o.on("cascade",function(){n.trigger("cascade")}),o.add(i),a.set(t,o)}},toJSON:function(){var e={};return e.relationship=this.get("relationship"),e.details=this.get("details").toJSON(),e}}),o=n.Model.extend({populate:function(e){var t=this;for(var n in e){var i=e[n],a=new s;a.populate(i),a.on("cascade",function(){t.trigger("cascade")}),this.set(n,a,{silent:!0})}this.on("change",function(){t.trigger("cascade")})},toJSON:function(){var e={};for(var t in this.attributes){var n=this.attributes[t];e[t]=n.toJSON()}return e}}),s=n.Collection.extend({populate:function(e){var t=this;for(var n in e){var i=e[n],a=new l;a.on("cascade",function(){t.trigger("cascade")}),a.populate(i),this.add(a,{silent:!0})}this.on("add",function(){t.trigger("cascade")}),this.on("remove",function(){t.trigger("cascade")})}}),l=n.Model.extend({populate:function(e){for(var t in e){var n=e[t];this.set(t,n,{silent:!0})}}});return i}),define("pathway/models/treeModel",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/nodeModel","pathway/models/pathwayCollection","pathway/models/treeContext","pathway/models/triggerGroupCollection"],function(e,t,n,i,a,o,s,l){var r,d="version1",c=function(e,t,n){if(!e.get("isProtocol"))for(var i in e.get("children").models){var a=e.get("children").models[i];if(a==t){var o=e.get("children").indexOf(a);if(n){var s=a.get("children").models;for(var i in s){var l=s[i];1!=e.get("children").length&&l.get("isProtocol")||(e.get("children").add(l,{at:o,silent:!0}),o+=1)}}e.get("children").remove(t,{silent:!0})}else c(a,t,n)}},h=function(e,t,n){if(e.get("nodeID")==t)for(var i in n){var a=n[i];a.showChildren&&a.showChildren()}else{if(!e.get("isProtocol"))for(var i in e.get("children").models){var a=e.get("children").models[i],o=n.slice(0);o.push(a);{h(a,t,o)}}}},u=function(e,t,n,i){var a=!1,o=[];if(!e.get("isProtocol")){for(var s in e.get("children").models){var l=e.get("children").models[s];o[o.length]=l,0==a&&l!=t?u(l,t,n,i):a=!0}var r;if(a){for(var d in o){d=parseInt(d);var c=o[d];if(c==t){if(-1==n){o[d]=r,o[d-1]=c,o[d].set("hasRight",d<o.length-1,{silent:!0}),o[d-1].set("hasLeft",d-1!=0,{silent:!0}),o[d-1].set("hasRight",!0,{silent:!0}),o[d].set("hasLeft",!0,{silent:!0});break}if(1==n){o[d]=o[d+1],o[d+1]=c,o[d+1].set("hasRight",d+1<o.length-1,{silent:!0}),o[d].set("hasLeft",0!=d,{silent:!0}),o[d].set("hasRight",!0,{silent:!0}),o[d+1].set("hasLeft",!0,{silent:!0});break}}r=c}i.parent=e,i.child=o}}},p=function(e){if(e.get("isProtocol"))return[e.get("nodeID")];var t=[];for(var n in e.get("children").models){var i=e.get("children").models[n];i.childrenHidden&&!i.childrenHidden()&&t.push(i)}var a=[];0==t.length&&a.push(e.get("nodeID"));for(n in t){var i=t[n];a=a.concat(p(i))}return a},m=function(e,n){if(!e.get("isProtocol")){var i=t.indexOf(e.get("children").models,n);for(var a in e.get("children").models)-1!=i?a!=i&&g(e.get("children").models[a]):m(e.get("children").models[a],n)}},g=function(e){e.get("isProtocol")||(e.hideChildren(),t.each(e.attributes.children.models,function(e){g(e)}))},f=function(e){e.get("isProtocol")||(e.showChildren(),t.each(e.attributes.children.models,function(e){g(e)}))},v=a.extend({elPairs:[],idAttribute:"pathid",urlRoot:"/tree",changeNodePosition:function(e,t){var i={},a=(u(this,e,t,i),i.parent),o=i.child;a.set("children",new n.Collection(o),{silent:!0}),this.trigger("propagate")},expandAll:function(){f(this)},getShareCode:function(){var e=p(this),t="";for(var a in e){var o=e[a];t+="-"+o}n.history.navigate("pathEditor"==i.get("page")?"pathwayeditor/"+i.get("pathid")+"/node/"+t:"pathway/"+i.get("pathid")+"/node/"+t),i.set("code",t)},getPathToIDS:function(e){this.collapse(this),e||(e=i.get("code").split("-"));for(var t in e){var n=e[t];n&&h(this,n,[this])}},initialize:function(){this.set({triggers:new n.Collection,tooltip:"triggers tooltip",sidePanelText:"",name:"Triggers"}),this.populateChildren();var e=this;i.on("change:page",function(){s.trigger("propagate")}),i.on("change:pathid",function(){var t=i.get("pathid");if(t&&"0"!=t){s.clear(),e.getPathToIDS();var a=e.get("pathid");e.set({pathid:t},{silent:!0}),t!=a&&e.fetch()}if("pathEditor"==i.get("page"))require(["ckeditor"],function(){}),n.history.navigate("pathwayeditor/"+t+"/node/"+i.get("code"));else{var o=i.get("code");
n.history.navigate("pathway/"+t+"/node/"+o)}}),i.on("change:code",function(){i.get("code")&&(e.getPathToIDS(),s.trigger("propagate"))}),this.on("propagate",function(){this.oldContent!=JSON.stringify(this.toJSON())?this.save(null,{error:function(){alert("Auto Save failed")}}):s.trigger("propagate")},this),this.on("sync",function(t,n){this.oldContent=JSON.stringify(this.toJSON()),this.set({pathid:n.pathid},{silent:!0}),i.set({pathid:String(n.pathid)}),o.fetch(),i.get("code")?e.getPathToIDS():"pathEditor"==i.get("page")?e.expandAll():e.collapse(),s.trigger("propagate")},this),i.get("pathid")&&(e.set({pathid:i.get("pathid")},{silent:!0}),this.getPathToIDS(),this.fetch(),s.trigger("propagate")),"pathEditor"==i.get("page")&&require(["ckeditor"],function(){}),this.elPairs=[]},getNextNodeID:function(){return this.set("nodeCount",this.get("nodeCount")+1,{silent:!0}),this.get("nodeCount")},hideSiblings:function(e){m(this,e)},collapse:function(e){g(e?e:this)},deleteNode:function(e,t){c(this,e,t),this.save()},getNodeType:function(){return"treeModel"},toJSON:function(e){e||(e={});var n=t.omit(this.attributes,["children","triggers","hasLeft","hasRight"]);return e&&e.toExport&&(n=t.omit(n,["nodeID","nodeCount","id","pathid"])),n.children=this.get("children").toJSON(e),n.triggers=this.get("triggers").toJSON(),n},loadNewPathway:function(e,t){this.set({triggers:new n.Model,sidePanelText:"",tooltip:e.tooltip,name:e.name,protocol:null,nodeCount:0,nodeID:0,folder:e.folder},{silent:!0}),this.populateChildren();var a=new l;a.populate(),this.set("triggers",a,{silent:!0}),this.unset("pathid",{silent:!0});var s=this;this.save({},{success:function(a,l){o.fetch(),e.pathid=l.pathid,t&&t.toImport?(s.parse(e,t),s.save({},{success:function(){i.set({pathid:s.get("pathid")}),n.history.navigate("pathwayeditor/"+s.get("pathid")+"/node/undefined"),o.fetch()}})):(i.set({pathid:l.pathid}),n.history.navigate("pathwayeditor/"+s.get("pathid")+"/node/undefined"),o.fetch())}})},parse:function(e,n){e.protocolVersion?this.set("protocolVersion",e.protocolVersion,{silent:!0}):this.set("protocolVersion","preversion",{silent:!0});var i=this,a={preversion:function(e,n){n&&n.toImport&&(e=t.omit(e,["nodeID","nodeCount"])),e.nodeCount?i.set("nodeCount",e.nodeCount,{silent:!0}):i.set({nodeCount:0},{silent:!0}),e.nodeID?i.set("nodeID",e.nodeID,{silent:!0}):i.set("nodeID",i.getNextNodeID(),{silent:!0}),i.set({tooltip:e.tooltip,sidePanelText:e.sidePanelText,pathid:e.pathid,protocol:e.protocol,name:e.name},{silent:!0}),i.populateChildren(e.children,n);var a=new l;a.populate(e.triggers,i.get("protocolVersion")),i.set("triggers",a,{silent:!0})},version1:function(e,n){n&&n.toImport&&(e=t.omit(e,["nodeID","nodeCount"])),e.nodeCount?i.set("nodeCount",e.nodeCount,{silent:!0}):i.set({nodeCount:0},{silent:!0}),e.nodeID?i.set("nodeID",e.nodeID,{silent:!0}):i.set("nodeID",i.getNextNodeID(),{silent:!0}),i.set({tooltip:e.tooltip,sidePanelText:e.sidePanelText,pathid:e.pathid,protocol:e.protocol,name:e.name},{silent:!0}),i.populateChildren(e.children,n);var a=new l;a.populate(e.triggers,i.get("protocolVersion")),a.on("cascade",function(){i.save(null,{error:function(){alert("Autosave Failed")}})}),i.set("triggers",a,{silent:!0})}};a[this.get("protocolVersion")](e,n),this.set("protocolVersion",d)}});return r=new v}),define("text!templates/pathway/detailSearch.html",[],function(){return'<div class = "widget-column col-sm-12">\n\n<div style="clear: both; text-align: center">\n<div>\n       <div class="input-group">\n                    <input class = "form-control" id = "Detail-Search-Box" type="text" style="min-width: 200px">\n                      <span class="input-group-btn">\n                        <button class="btn btn-default" id="searchButton">Search</button>\n                       </span>\n                       <select id = "search_results" name = \'code\' style ="text-align: center; min-width:200px" class="form-control entries hasTerm drop-down detail-input">\n\n                        <option class="\'default"></option>\n                       </select>\n       </div>\n       <button style= "float: right" class = "btn btn-default" id = "zoom-in-button">Zoom in on Concept</button>\n       <button style= "float: right" class = "btn btn-default" id = "zoom-out-button">Zoom out on Concept</button>\n\n\n</div>\n\n</div></div>\n'}),define("text!templates/pathway/resultRow.html",[],function(){return"<option value=<%=id%> term = '<%=term%>'><%=term%> (snomed: <%=id%>)</option>\n"}),define("pathway/internalViews/detailSearchBox",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/pathway/detailSearch.html","text!templates/pathway/resultRow.html"],function(e,t,n,i,a,o){var s=n.View.extend({doSearch:function(t){var n=i.toParams();e.extend(n,{search_param:e("#Detail-Search-Box").val()});var a=t.type.split("_");"dx"==a[a.length-1]?e.extend(n,{type:"snomed_diagnosis"}):"NDC"==t.type.split("_")[1]||"med"==t.type.split("_")[1]?e.extend(n,{type:"snomed_drug"}):"proc"==t.type.split("_")[1]&&e.extend(n,{type:"CPT"}),this.collection.fetch({data:e.param(n),success:function(){t.collection.length>0&&"none"!=t.collection.models[0].get("type")&&(t.ready=!0)}})},initialize:function(n){this.template=t.template(a),this.$el.html(this.template()),this.collection=n.collection,this.ready=0==this.collection.length?!1:!0,this.collection.on("add",function(){this.ready=!0},this),this.el=n.el,this.type=n.type,this.collection.on("sync",this.render,this);var o=this;e("#searchButton",this.$el)[0].onclick=function(){o.doSearch(o)},e("#zoom-in-button",this.$el)[0].on=function(){var t=i.toParams();e.extend(t,{search_param:e("#search_results").val()}),e.extend(t,{type:"snomed_zoom_in"}),o.collection.fetch({data:e.param(t)})},e("#zoom-out-button",this.$el)[0].onclick=function(){var t=i.toParams();e.extend(t,{search_param:e("#search_results").val()}),e.extend(t,{type:"snomed_zoom_out"}),o.collection.fetch({data:e.param(t)})},e("#Detail-Search-Box",this.$el)[0].onkeydown=function(e){13==e.keyCode&&o.doSearch(o)}},render:function(){e(".entries",this.$el).html("");var i=n.View.extend({template:t.template(o),render:function(){return this.model.get("route")||this.model.set("route",""),this.model.set("id",this.model.get("code")+this.model.get("route")),this.$el.html(this.template(this.model.toJSON())),this}});return t.each(this.collection.models,function(t){var n=new i({model:t});e(".entries",this.$el).append(n.render().el.innerHTML)},this),this}});return s}),define("text!templates/pathway/ListBox.html",[],function(){return'<div class = "widget-column col-sm-12">\n<select  class = "form-control" style ="text-align: center; height:100%" multiple class="selection-list">\n    <%=listEntries%>\n</select></div>\n'}),define("text!templates/pathway/groupResultRow.html",[],function(){return"<option value=<%=id%> term = '<%=term%>'><%=term%> (groupID: <%=id%>)</option>\n"}),define("pathway/internalViews/detailListBox",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/pathway/ListBox.html","text!templates/pathway/resultRow.html","text!templates/pathway/groupResultRow.html"],function(e,t,n,i,a,o,s){var l=n.View.extend({template:t.template(a),initialize:function(e){var n=this;this.collection=e.items,this.type=e.type,this.$el=e.el,"snomed_diagnosis"==this.type?n.lineTemplate=t.template(o):(this.type="groups")&&(n.lineTemplate=t.template(s)),n.collection.on("add",n.render,n),n.collection.on("remove",n.render,n),n.render()},render:function(){var e="",i=this;return t.each(this.collection.models,function(t){var a=n.View.extend({render:function(){return this.$el.html(i.lineTemplate(this.model.toJSON())),this}}),o=new a({model:t});e+=o.render().el.innerHTML},this),this.$el.html(this.template({listEntries:e})),this}});return l}),define("text!templates/pathway/multiSelectSearchPanel.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div id = "parentbox" style ="clear: both">\n    <div id="availselectorbox" style=" float:left; height: 100%; width: 40%">\n            <h3 style="clear:both; text-align:center">Select from This List</h3>\n                    <div class="col-lg-6" style = "width:100%">\n                    <div class="input-group">\n                        <input  class = "form-control search-input" >\n                      <span class="input-group-btn">\n                        <button class="btn btn-default search-button">Search</button>\n                      </span>\n                    </div>\n                    </div>\n            <div style = "clear:both; width:100%" class="available-items search-list loinc-list-box">The Available Items go Here</div>\n\n         </div>\n                <div style="float:left; width:3%"></div>\n\n        <div id ="buttonsbox" style = "text-align:center; float:left; width:15%">\n            <div style="height:100px; clear:both"></div>\n            <button class="btn btn-default add-item-button" style = "vertical-align: middle; width:70px">Add</button>\n            <button  class="btn btn-default remove-item-button" style = "vertical-align: middle;">Remove</button>\n\n        </div>\n                    <div style="float:left; width:3%"></div>\n\n        <div id = "selecteditemsbox" style = "float:left; width:40%; height:100%">\n             <h3 style="clear:both; text-align:center">Selected Items</h3>\n            <br>\n             <div style ="float: left; width:100%"class="selected-items search-list loinc-list-box">Currently Loaded Items go here</div>\n        </div>\n\n</div></div>\n'}),define("pathway/internalViews/multiSelectSearch",["jquery","underscore","backbone","globalmodels/contextModel","pathway/internalViews/detailListBox","text!templates/pathway/multiSelectSearchPanel.html"],function(e,t,n,i,a,o){var s=n.View.extend({template:t.template(o),removeSelected:function(){var n=e(".selected-items option:selected");t.each(n,function(e){e.value;t.each(this.selectedBox.collection.models,function(t){e.value==t.get("id")&&this.selected_items.remove(t)},this)},this)},addSelected:function(){var n=e(".available-items option:selected");t.each(n,function(e){e.value;t.each(this.availableBox.collection.models,function(t){e.value==t.get("id")&&this.selected_items.add(t)},this)},this)},initialize:function(t){this.$el.html(this.template());var n=this;this.type=t.type,this.avail=t.avail,this.selected_items=t.selected,this.el=t.el,this.avail.on("sync",this.render,this),"snomed_diagnosis"==this.type?(e(".search-button",this.$el)[0].onclick=function(){var t=i.toParams();e.extend(t,{search_param:e(".search-input",n.$el).val()}),e.extend(t,{type:n.type}),n.avail.fetch({data:e.param(t)})},e(".search-input",this.$el)[0].onkeypress=function(t){if(13==t.keyCode){var a=i.toParams();e.extend(a,{search_param:e(".search-input",n.$el).val()}),e.extend(a,{type:n.type}),n.avail.fetch({data:e.param(a)})}}):(e(".search-input").hide(),e(".search-button").hide()),this.render()},render:function(){return this.availableBox=new a({items:this.avail,type:this.type,el:e(".available-items",this.$el)}),this.selectedBox=new a({items:this.selected_items,type:this.type,el:e(".selected-items",this.$el)}),this},events:{"click .add-item-button":"addSelected","click .remove-item-button":"removeSelected"}});return s}),define("pathway/modalViews/detailEditor",["jquery","underscore","backbone","pathway/models/treeModel","pathway/internalViews/detailSearchBox","pathway/internalViews/multiSelectSearch"],function(e,t,n,i,a,o){var s=n.View.extend({initialize:function(s){this.group=s.group,this.model=s.model,this.newDetail=s.newDetail,this.$el=s.el,this.template=s.template,this.type=s.type,this.$el.html(this.template()),this.searchBoxes=[];var l=this,r=e(".search",this.$el);if(0!=r.length){var d=n.Collection.extend({url:"/search"}),c=new d;l.newDetail||c.add(l.model);var h=new a({collection:c,type:this.type,el:r});h.render(),this.searchBoxes.push(h)}var u=e(".multi-select-search",this.$el);e.each(u,function(e,t){var i,a=t.getAttribute("type");"snomed_diagnosis"==a?i=n.Collection.extend({url:"/search"}):"groups"==a&&(i=n.Collection.extend({url:"/groups"}));var s=new i;"groups"==a&&s.fetch();var r=new n.Collection;if(!l.newDetail)for(e in l.model.get(t.getAttribute("name"))){var d=l.model.get(t.getAttribute("name"))[e],c=l.model.get(t.getAttribute("name")+"term")[e];r.add(new n.Model({id:d,code:d,term:c,type:t.getAttribute("type")}))}new o({avail:s,type:t.getAttribute("type"),el:t,selected:r})});var p=e(".route-list",this.$el);e.each(p,function(e,t){new routeListBox({el:t})}),this.newDetail||this.fillTemplate(),this.$el.show();var m=this;e(".confirm-detail-button",this.$el)[0].onclick=function(){if(m.searchBoxes.length>0)for(var n in m.searchBoxes)if(!m.searchBoxes[n].ready)return void alert("Constraint is not complete, make sure you have a value selected in all search boxes");for(var a=e(".detail-input",m.$el),o=0;o<a.length;o++){var n=a[o];e(n).hasClass("hasTerm")&&t.each(n,function(e){e.selected&&t.each(e.attributes,function(e){m.model.set(e.name,e.value)})}),m.model.set(n.getAttribute("name"),n.value)}var s=e(".multi-select-search",this.$el);t.each(s,function(n){var i=e(".selected-items option",n),a=[],o=[];t.each(i,function(e){a.push(e.value),o.push(e.getAttribute("term"))}),m.model.set(n.getAttribute("name"),a),m.model.set(n.getAttribute("name")+"term",o)},this),m.newDetail?l.group.addDetail(m.model,m.type):i.trigger("propagate"),e("#detail-modal").modal("hide")},e(".cancel-edit-button",this.$el)[0].onclick=function(){e("#detail-modal").modal("hide")},e("#detail-modal").modal({show:"true"})},fillTemplate:function(){for(var t=e(".detail-input"),n=0;n<t.length;n++){var i=t[n];i.value=this.model.get(i.name)}}});return s}),define("text!templates/pathway/detailSection.html",[],function(){return'<div class="items">\n</div>'}),define("pathway/internalViews/detailGroup",["jquery","underscore","backbone","pathway/models/treeModel","pathway/modalViews/detailEditor","text!templates/pathway/detailSection.html"],function(e,t,n,i,a,o){var s=n.View.extend({template:t.template(o),initialize:function(e){this.lineTemplate=e.lineTemplate,this.list=e.list,this.type=e.type,this.group=e.group,this.el=e.el},render:function(){this.$el.html("");var i=this.type,o=n.View.extend({initialize:function(n){this.el=n.el,this.$el.html(n.text),this.group=n.group,this.detail=n.detail;var o=this;e(".detail-item",this.$el).off("click"),e(".detail-item",this.$el).on("click",function(){require(["text!/templates/pathway/details/"+i+"_editor.html"],function(n){var s=new a({group:o.group,model:o.detail,el:e("#detailed-trigger-modal"),template:t.template(n),type:i});s.render()})}),e(".remove-detail",this.$el).off("click"),e(".remove-detail",this.$el).on("click",function(){o.group.get("details").get(i).remove(o.detail)})}});return this.list.each(function(t){t.off("change"),t.on("change",this.render,this),this.$el.append("<div class = 'item-holder'></div>");var n={};for(var i in t.attributes){var a=t.attributes[i];n[i]=a.models?a.models:a}new o({group:this.group,el:e(".item-holder",this.$el).last(),text:this.lineTemplate(n),detail:t})},this),this}});return s}),define("Helpers",["jquery","underscore","backbone"],function(){var e={detailHeadings:{enc_pl_dx:"Encounter or Problem List Diagnosis",pl_dx:"Problem List Diagnosis",hist_dx:"Historical Diagnosis",lab:"Lab Results",enc_dx:"Encounter Diagnosis",hist_proc:"Historic Procedure",enc_proc:"(unusued) Encounter Procedure",ml_med:"Medication List",vitals:"Vital Signs",vitals_bp:"Disjunctive Blood Pressure Detail"},detailDescriptions:{enc_pl_dx:"Specify a constraint based on a diagnosis that can be found either in the current encounter or on the patient’s problem list. This would represent a fairly comprehensive set of acute and chronic diagnoses that are likely to be currently active for the patient.",pl_dx:"Specify a constraint based on a diagnosis in the patient’s problem list. The patient problem list is a patient-level section of the medical record that catalogs the most important diagnoses for the patient",hist_dx:"Specify a constraint based on a diagnosis in the patient’s diagnostic history",lab:"Specify a constraint based on the patient's lab results",enc_dx:"Specify a constraint based on any diagnosis currently associated with the encounter such as chief complaints, differential diagnoses, or symptoms that have been discretely documented and transmitted to Maven. ",hist_proc:"Specify a constraint based on procedures that the patient has undergone in the past",enc_proc:"(unusued) Encounter Procedure",ml_med:"Specify a constraint based on medications that the patient is currently taking according to the medical record",vitals:"Specify a constraint based on the patient's vitals",vitals_bp:"Specify a constraint based on the patient's blood pressure which allows for EITHER the systolic OR diastolic to be within a given range"},notDetail:["id","evidence","genders","minAge","maxAge","name","triggers","triggerType","sources","detID","conflicts","treeInfo"]};return e}),define("text!templates/pathway/disjoinedGroups.html",[],function(){return'<div id="group-<%=groupID%>" style="padding: 8px;  >\n<div  style = " font-size: 130%; margin-bottom: 8px; ">Show Alert if\n<input class="toggles" type="checkbox">\nof these are true\n<div class="group-delete" id="delete-<%=groupID%>" style="float:right"><a>&#10006</a></div>\n</div>\n\n\n<div style="font-size: 70%" class=\'detail-sections\'></div>\n\n</div>\n'}),define("text!templates/pathway/RuleWizard.html",[],function(){return'<div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" style="z-index: 1030">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal"><span\n                        aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                <h4 class="modal-title">Pathway Triggers</h4>\n            </div>\n\n            <div class="modal-body">\n\n                <div style = "clear:both" class="detail-sections"><div style="text-align: center;">All of the Following Groups of Requirements Must be Fulfilled in Order to Show the\n    Pathway\n                </div></div>\n\n                <br>\n<div style="margin-left: 15%; margin-right:15%; max-width: 60%" id="disjoinedGroups">\n\n\n</div>\n\n\n<br>\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id=\'enc_dx\'\n         title="Specify a constraint based on any diagnosis currently associated with the encounter such as chief complaints, differential diagnoses, or symptoms that have been discretely documented and transmitted to Maven."\n            >\n        Encounter Diagnosis\n    </div>\n</div>\n\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="hist_dx"\n         title="Specify a constraint based on a diagnosis in the patient’s diagnostic history"\n            >\n        Historic Diagnosis\n    </div>\n</div>\n\n\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="pl_dx"\n         title="Specify a constraint based on a diagnosis in the patient’s problem list"\n            >\n        Problem List Diagnosis\n    </div>\n</div>\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="all_dx"\n         title="Specify a constraint based on a diagnosis in the patient’s problem list"\n            >\n        All Diagnoses\n    </div>\n</div>\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="membership"\n         title="Specify a constraint based on the receiving clinicians group memberships"\n            >\n        Clinician Groups\n    </div>\n</div>\n<button id="add-group-button" class="btn btn-default" >Add Group</button>\n\n\n\n            </div>\n            <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n                    <button id="back-to-editor" class="btn btn-primary">Confirm</button>\n                </div>\n        </div>\n    </div>\n</div>'}),define("pathway/modalViews/ruleWizard",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/layoutModel","pathway/modalViews/detailEditor","pathway/internalViews/detailGroup","pathway/models/treeModel","Helpers","text!templates/pathway/detailSection.html","text!templates/pathway/disjoinedGroups.html","text!templates/pathway/RuleWizard.html","bootstrapswitch"],function(e,t,n,i,a,o,s,l,r,d,c,h){var u=function(n,i,a){require(["text!/templates/pathway/details/"+n+"Detail.html"],function(n){return function(o){var l=i.get("details").get(n),r=t.template(o),c=t.template(d);a.append(c());var h=new s({group:i,el:e(".items").last(),lineTemplate:r,list:l,type:n});h.render()}}(n))},p=n.View.extend({el:"#modal-target",initialize:function(){this.template=t.template(h),this.$el.html(this.template()),e(".detailButton").draggable({revert:!0}),this.render()},render:function(){var i=this;l.once("sync",function(){i.render()}),e("#add-group-button").on("click",function(){l.get("triggers").addGroup("and")});var a=n.View.extend({template:t.template(c),initialize:function(a){this.group=a.group,this.$el.droppable({drop:function(a,s){console.log(this.group);var l=s.draggable[0].id;require(["text!templates/pathway/details/"+l+"_editor.html"],function(a){var s=new o({group:self.group,template:t.template(a),model:new n.Model,newDetail:!0,el:e("#detailed-trigger-modal"),triggerNode:i.triggerNode,type:l});s.render()})},activeClass:"activeDrop",hoverClass:"hoverDrop"})},render:function(){var t=this;this.$el.css({"border-style":"solid","border-width":"4px"});var n={relationship:this.group.get("relationship"),groupID:this.group.cid};this.$el.html(this.template(n)),e(".group-delete",this.$el).on("click",function(){l.get("triggers").remove(t.group)}),e(".toggles",this.$el).bootstrapSwitch(),e(".toggles",this.$el).bootstrapSwitch("onText","Any"),e(".toggles",this.$el).bootstrapSwitch("offText","All"),"and"==t.group.get("relationship")?e(".toggles",this.$el).bootstrapSwitch("state",!1,!1):e(".toggles",this.$el).bootstrapSwitch("state",!0,!1),e(".toggles",this.$el).on("switchChange.bootstrapSwitch",function(){0==e(".toggles",t.$el).bootstrapSwitch("state")?t.group.set("relationship","and"):t.group.set("relationship","or")});for(var i in this.group.get("details").attributes){var a=e(".detail-sections",this.$el);u(i,this.group,a)}return this}});for(var s in l.get("triggers").models){var r=new a({group:l.get("triggers").models[s]});e("#disjoinedGroups").append(r.$el),e("#disjoinedGroups").append("<div style='height:25px'></div>"),r.render()}e("#detail-modal").modal({show:"true"})}});return p}),define("text!templates/pathway/sendProtocol.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-body" style=\'margin-bottom: 20;\'>\n                    <div class="row">\n                    <div class="col-sm-6">\n                        <div class="row">\n                            <div class="search-box" style=\'width:10%;\'></div>\n                            <form class="search-box">\n                                <div class="input-group input-group-sm" style="max-width:360px;">\n                                      Send To:<input type="text" class="form-control" placeholder="Search Provider"\n                                         name="protocolRecipient" id="protocolRecipient" value="<%= typeof(defaultRecipient) !== \'undefined\' ? defaultRecipient : \'\' %>">\n                                    <input id="recipientUserName" type="hidden" value="<%= typeof(defaultRecipientName) !== \'undefined\' ? defaultRecipientName : \'\' %>">\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                    <div class="col-sm-6">\n                        <div class="row">\n                            Quick Note:<textarea size=10 id="sendProtocolNote" type="text" class="form-control"\n                                                 placeholder=""><%= typeof(defaultQuickNote) != \'undefined\' ? defaultQuickNote : \'\' %></textarea>\n                        </div>\n                    </div>\n                    </div>\n                </div>\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="sendProtocolButton">Send</button>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/sendProtocol",["jquery","underscore","backbone","pathway/models/nodeModel","globalmodels/contextModel","text!templates/pathway/sendProtocol.html"],function(e,t,n,i,a,o){var s=n.View.extend({template:t.template(o),el:e("#modal-target"),initialize:function(t){var n=this;this.parent=t,this.$el.html(this.template(n.attributes)),e("#detail-modal").modal({show:"true"}),e("#sendProtocolButton",this.$el).on("click",function(){e("#detail-modal").modal("hide");var t=e("#recipientUserName").val(),i=e("#sendProtocolNote").val()+"\r\n "+a.get("official_name")+" would like you to review this patient. \r\n"+window.location.protocol+"//"+window.location.host+"#/pathway/"+a.get("pathid")+"/node/"+n.parent.get("nodeID")+"/patient/"+a.get("patients")+"/"+(new Date).toISOString().substr(0,10)+"/login/"+t+"/"+a.get("customer")+"/\r\n";e.ajax({type:"POST",dataType:"json",url:"/send_message?"+e.param(a.toParams())+"&target_user="+t,data:JSON.stringify({subject:"Please review this patient - "+a.get("official_name"),message:i}),error:function(){alert("There was a problem sending the message.")}})}),e("#protocolRecipient").autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(a.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){t.preventDefault(),n.item&&(e(t.target).val(n.item.label),e("#recipientUserName").val(n.item.value))}})}});return s}),define("text!templates/pathway/NewNodeModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">\n                        <% if (name) { %>\n                        Editing : <%= name %>\n                        <% } else { %>\n                        New Node\n                        <% } %>\n                    </h4>\n                </div>\n\n                <div class="modal-body">\n                    <div class="form-group">\n                        <span class="headings">Node Name:</span>\n                        <input id="newNodeText" type="text" class="form-control" placeholder=""\n                        <% if (name) { %>\n                        value="<%= name %>"\n                        <% } %>\n                        >\n\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Node Tooltip (helping text):</span>\n                        <input id="newNodeTooltip" class="form-control" placeholder=""\n                        <% if (name) { %>\n                        value="<%= tooltip %>"\n                        <% } %>\n                        >\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Node Side Panel Text:</span>\n                        <textarea id="newNodeSideText" class="form-control" placeholder="">\n                            <% if (name) { %>\n                            <%= sidePanelText %>\n                            <% } %>\n                        </textarea>\n                    </div>\n\n                </div>\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="addNodeButton">\n                        <% if (name) { %>\n                            Save Changes\n                        <% } else { %>\n                        Confirm\n                        <% } %>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!templates/pathway/NewProtocolModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">New Protocol</h4>\n                </div>\n\n                <div class="modal-body">\n                    <div class="form-group">\n                        <span class="headings">Protocol:</span>\n                        <textarea id="ProtocolText" type="text" class="form-control" placeholder=""></textarea>\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Note to copy:</span>\n                        <textarea id="NoteToCopyText" class="form-control" placeholder=""></textarea>\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Send Defaults:</span><br/>\n                        <div class="row">\n                            <div class="col-sm-6">\n                                <div class="row">\n                                    <div class="search-box" style=\'width:10%;\'></div>\n                                    <form class="search-box">\n                                        <div class="input-group input-group-sm control-group" style="max-width:360px;">\n                                              Recipient:<input type="text" class="form-control" placeholder="Search Provider"\n                                                 name="protocolRecipient" id="defaultRecipient" >\n                                            <input id="defaultRecipientName" name="defaultRecipientName" type="hidden" value="">\n                                        </div>\n                                    </form>\n                                </div>\n                            </div>\n                            <div class="col-sm-6">\n                                <div class="row">\n                                    Quick Note:<textarea size=10 id="defaultQuickNote" type="text" class="form-control" placeholder=""></textarea>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="form-group" >\n                        <span class="glyphicon glyphicon-chevron-right show-advanced-settings"></span>\n                        <span class="headings">Advanced</span><br/>\n                    </div>\n\n                    <div class="form-group advanced-settings">\n                        <div class="row followup-header">\n                            <div class="col-sm-6">\n                                    <span class="headings">Timed Followup Plan</span>\n                            </div>\n                            <div class="col-sm-6">\n                                <div class="input-group input-group-sm" style="max-width:360px;">\n                                    Default Recipient:<input type="text" class="form-control" placeholder="Search Provider"\n                                                     name="defaultFollowupRecipient" id="defaultFollowupRecipient">\n                                                <input id="defaultFollowupRecipientName" name="defaultFollowupRecipientName" type="hidden" value="">\n                                    </div>\n                            </div>\n                        </div>\n                        <div class="row followup-header-columns" style="display:none;">\n                            <div class="col-sm-6">\n                                    <span class="headings">What</span>\n                            </div>\n                            <div class="col-sm-2">\n                                    <span class="headings">When</span>\n                            </div>\n                            <div class="col-sm-1">\n                                    <span class="headings">Who</span>\n                            </div>\n                            <div class="col-sm-1">\n                                &nbsp;\n                                <!-- <span class="headings">Repeat</span> -->\n                            </div>\n                        </div>\n                        <div id="followups">\n\n                        </div>\n                        <div class="row followup-footer">\n                            <div class="col-sm-12">\n                                <button type="button" id=\'add-new-followup\'  class="btn btn-default btn-xs">\n                                    <span class="glyphicon glyphicon-plus"></span>\n                                </button> New Followup\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="addNodeButton">Confirm</button>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>'
}),define("text!templates/reminderRow.html",[],function(){return'    <div class="row">\n        <div class="col-sm-1">\n            <span class="headings">Subject</span>\n        </div>\n        <div class="col-sm-5">\n            <input type="text" class="form-control reminderSubject" name="reminderSubject" value="<%= (typeof msg_subject !== \'undefined\') ? msg_subject : \'\' %>">\n        </div>\n        <div class="col-sm-2">\n            <div class="input-group input-group-sm" style="width:100%;">\n                <input type="text" class="form-control reminderTime datePickerTextBox" name="reminderTime" readonly="readonly"\n                       value="<%= (typeof due !== \'undefined\') ? due : \'\' %>">\n            </div>\n        </div>\n        <div class="col-sm-2">\n            <div class="input-group input-group-sm control-group" style="width:100%;">\n                <input type="text" class="form-control followupRecipient" placeholder="Search Provider"\n                       name="followupRecipient" value="<%= (typeof followupRecipient !== \'undefined\') ? followupRecipient : \'\' %>">\n                <input class="followupRecipientName" name="followupRecipientName" type="hidden"\n                       value="<%= (typeof followupRecipientName !== \'undefined\') ? followupRecipientName : \'\' %>">\n            </div>\n        </div>\n        <div class="col-sm-1">\n            <% if (typeof edit !== \'undefined\') { %>\n            <button type="button" class="btn btn-default btn-block deleteFollowup">\n                <span class="glyphicon glyphicon-remove"></span>\n            </button>\n            <% } %>\n        </div>\n    </div>\n\n    <div class="row ">\n        <div class="col-sm-1">\n            <span class="headings">Message</span>\n        </div>\n        <div class="col-sm-5">\n            <input type="text" class="form-control reminderText" name="reminderText" value="<%= (typeof msg_body !== \'undefined\') ? msg_body : \'\' %>">\n        </div>\n        <div class="col-sm-2">\n            &nbsp;\n            <!--<div class="input-group input-group-sm" style="max-width:360px;">\n                <select class="form-control reminderFrequency" name="reminderFrequency">\n                    <option value="Never">Never</option>\n                </select>\n            </div> -->\n        </div>\n        <div class="col-sm-3">\n            &nbsp;\n        </div><!--\n        <div class="col-sm-1">\n            <% if (typeof sendMode !== \'undefined\') { %>\n            <button type="button" class="btn btn-primary sendCurrentFollowup">Send</button>\n            <% } %>\n        </div> -->\n    </div>'}),define("singleRow/reminderRow",["jquery","underscore","backbone","text!templates/reminderRow.html","globalmodels/contextModel"],function(e,t,n,i,a){var o=n.View.extend({template:t.template(i),initialize:function(){this.render()},render:function(){return e(".followup-header-columns").show(),e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),that=this,e(document).ready(function(){e(".reminderTime",that.$el).datepicker(),e("#ui-datepicker-div").css("z-index","10000 !important"),e(".followupRecipient",that.$el).autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(a.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){t.preventDefault(),e(t.target).parent().removeClass("has-error"),e(".sendCurrentFollowup",this.$el).removeAttr("disabled"),n.item&&(e(t.target).val(n.item.label),e(".followupRecipientName",that.$el).val(n.item.value)),e(this).trigger("change")},change:function(t,n){e(t.target).parent().removeClass("has-error"),e(".sendCurrentFollowup",this.$el).removeAttr("disabled"),n.item||(e(".followupRecipientName",that.$el).val(""),""!==e(t.target).val()&&(e(t.target).parent().addClass("has-error"),e(".sendCurrentFollowup",this.$el).prop("disabled",!0)))},autoFocus:!0,focus:function(e){e.preventDefault()}})}),this},events:{"click .deleteFollowup":"removeFollowup","click .sendCurrentFollowup":"sendFollowup"},removeFollowup:function(){e(this.el).remove(),console.log("removing followup")},getCurrentParams:function(){var t=e(".reminderSubject",this.el).val(),n=e(".reminderText",this.el).val(),i=e(".reminderTime",this.el).val(),a=e(".followupRecipient",this.$el).val(),o=e(".followupRecipientName",this.$el).val();return""==t&&""==n&&""==i&&""==a&&""==o?{}:{msg_subject:t,msg_body:n,due:i,followupRecipient:a,followupRecipientName:o}},sendFollowup:function(){var t=e(".reminderSubject",this.$el).val(),n=e(".reminderText",this.$el).val(),i=e(".reminderTime",this.$el).val();""!=i&&(i+="T00:00:00.000Z");var o=e(".followupRecipientName",this.$el).val();""==t&&(t="Followup from "+(new Date).toISOString().substr(0,10)),""==o&&(o=e("#defaultFollowupRecipientName").val());var s="&userid="+a.get("userid");""!=o&&(s+="&target_user="+o),e.ajax({type:"POST",dataType:"json",url:"/add_task?"+e.param(a.toParams())+s,data:JSON.stringify({msg_subject:t,msg_body:n,delivery:"ehrinbox",due:i}),error:function(){alert("There was a problem sending this followup: "+t)},success:function(){}})}});return o}),define("pathway/modalViews/editNode",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeContext","pathway/models/treeModel","text!templates/pathway/NewNodeModal.html","text!templates/pathway/NewProtocolModal.html","singleRow/reminderRow"],function(e,t,n,i,a,o,s,l,r){var d,c=n.View.extend({el:e("#modal-target"),initialize:function(){that=this,a.get("selectedNode").attributes.isProtocol?(this.template=t.template(l),this.$el.html(this.template(a.get("selectedNode").attributes)),d=new Array,"undefined"!=typeof a.get("selectedNode").attributes.followups&&e(a.get("selectedNode").attributes.followups).each(function(){e("#followups",that.$el).append("<div class='followup'></div>"),el=e(".followup",e("#followups",that.$el)).last();var t=new r({model:new n.Model(this),el:el});d.push(t),t.$el.bind("remove",{followup:t},that.removeFollowup)}),e("#addNodeButton").length&&(e("#addNodeButton")[0].onclick=function(){var n=CKEDITOR.instances.ProtocolText.getData();a.get("selectedNode").set("protocol",n),a.get("selectedNode").set("noteToCopy",e("#NoteToCopyText",this.$el).val());var i=e("#defaultRecipient").val(),s=e("#defaultRecipientName").val(),l=e("#defaultQuickNote").val(),r=e("#defaultFollowupRecipient").val(),c=e("#defaultFollowupRecipientName").val(),h=[];e(d).each(function(){var e=this.getCurrentParams();t.isEmpty(e)||h.push(e)}),a.get("selectedNode").set("defaultRecipient",i),a.get("selectedNode").set("defaultRecipientName",s),a.get("selectedNode").set("defaultQuickNote",l),a.get("selectedNode").set("followups",h),a.get("selectedNode").set("defaultFollowupRecipient",r),a.get("selectedNode").set("defaultFollowupRecipientName",c),e("#detail-modal").modal("hide"),o.trigger("propagate")}),e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("ProtocolText"),CKEDITOR.instances.ProtocolText.setData(a.get("selectedNode").get("protocol"))}),e("#NoteToCopyText",this.$el).val(a.get("selectedNode").get("noteToCopy")),e(".show-advanced-settings",this.$el).off("click"),e(".show-advanced-settings",this.$el).on("click",function(t){e(".advanced-settings",that.$el).is(":visible")?(e(t.target).switchClass("glyphicon-chevron-down","glyphicon-chevron-right",0),e(".advanced-settings",that.$el).slideUp(200)):(e(t.target).switchClass("glyphicon-chevron-right","glyphicon-chevron-down",0),e(".advanced-settings").slideDown(200))}),e("#add-new-followup",this.$el).on("click",function(){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var t=new r({model:new n.Model({edit:!0}),el:el});d.push(t),t.$el.bind("remove",{followup:t},that.removeFollowup)}),e("#defaultRecipient, #defaultFollowupRecipient",this.$el).autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(i.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){if(t.preventDefault(),e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),n.item){e(t.target).val(n.item.label);var i="#"+t.target.id+"Name";e(i).val(n.item.value)}e(this).trigger("change")},change:function(t,n){if(e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),!n.item){var i="#"+t.target.id+"Name";e(i).val(""),""!==e(t.target).val()&&(e(t.target).parent().addClass("has-error"),e("#addNodeButton",this.$el).prop("disabled",!0))}},autoFocus:!0,focus:function(e){e.preventDefault()}})):(this.template=t.template(s),this.$el.html(this.template(a.get("selectedNode").attributes)),e("#addNodeButton")[0].onclick=function(){a.get("selectedNode").set("name",e("#newNodeText",this.$el).val()),a.get("selectedNode").set("tooltip",e("#newNodeTooltip",this.$el).val());var t=CKEDITOR.instances.newNodeSideText.getData();a.get("selectedNode").set("sidePanelText",t),e("#detail-modal").modal("hide"),o.trigger("propagate")},e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("newNodeSideText")}))},removeFollowup:function(e){d=t.without(d,e.data.followup)}});return c}),define("text!templates/pathway/sendFollowups.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-dialog-lg">\n            <div class="modal-content">\n                <div class="modal-body" style=\'margin-bottom: 20;\'>\n                        <div class="row followup-header">\n                            <div class="col-sm-6">\n                                    <span class="headings">Send Followups</span>\n                            </div>\n                            <div class="col-sm-6">\n                                <div class="input-group input-group-sm" style="max-width:360px;">\n                                    Default Recipient:<input type="text" class="form-control" placeholder="Search Provider" disabled\n                                                     name="defaultFollowupRecipient" id="defaultFollowupRecipient"\n                                                     value="<%= (typeof defaultFollowupRecipient !== \'undefined\') ? defaultFollowupRecipient : \'\' %>">\n                                                <input id="defaultFollowupRecipientName" name="defaultFollowupRecipientName" type="hidden"\n                                                       value="<%= (typeof defaultFollowupRecipientName !== \'undefined\') ? defaultFollowupRecipientName : \'\' %>">\n                                    </div>\n                            </div>\n                        </div>\n                        <div class="row followup-header-columns">\n                            <div class="col-sm-6">\n                                    <span class="headings">What</span>\n                            </div>\n                            <div class="col-sm-2">\n                                    <span class="headings">When</span>\n                            </div>\n                            <div class="col-sm-1">\n                                    <span class="headings">Who</span>\n                            </div>\n                            <div class="col-sm-1">\n                                &nbsp;\n                                <!-- <span class="headings">Repeat</span> -->\n                            </div>\n                        </div>\n                        <div id="followups">\n\n                        </div>\n                        <div class="row followup-footer">\n                            <div class="col-sm-12">\n                                <span id=\'add-new-followup\' class="glyphicon glyphicon-plus"></span>New Reminder\n                            </div>\n                        </div>\n                </div>\n\n                <div class="modal-footer">\n                    <div id="send-followups-message"></div>\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="sendFollowupsButton">Send All</button>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/sendFollowups",["jquery","underscore","backbone","pathway/models/nodeModel","globalmodels/contextModel","text!templates/pathway/sendFollowups.html","singleRow/reminderRow"],function(e,t,n,i,a,o,s){var l,r=n.View.extend({template:t.template(o),el:e("#modal-target"),initialize:function(t){var i=this;this.parent=t,this.$el.html(this.template(this.attributes)),e("#detail-modal").modal({show:"true"}),l=new Array;var a=!0;if("undefined"!=typeof this.attributes.followups&&e(this.attributes.followups).each(function(){a=!1,this.sendMode=!0,e("#followups",i.$el).append("<div class='followup'></div>"),el=e(".followup",e("#followups",i.$el)).last();var t=new s({model:new n.Model(this),el:el});l.push(t),t.$el.bind("remove",{followup:t},i.removeFollowup)}),a){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var o=new s({model:new n.Model({edit:!0}),el:el});l.push(o),o.$el.bind("remove",{followup:o},i.removeFollowup)}e("#add-new-followup",this.$el).on("click",function(){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var t=new s({model:new n.Model({edit:!0,sendMode:!0}),el:el});l.push(t),t.$el.bind("remove",{followup:t},i.removeFollowup)}),e("#sendFollowupsButton",this.$el).on("click",function(){e(l).each(function(){this.sendFollowup()}),alert("Followups Sent"),e("#detail-modal").modal("hide")})},removeFollowup:function(e){l=t.without(l,e.data.followup),console.log("Removing from send followups")}});return r}),define("pathway/Helpers",["jquery","underscore","backbone"],function(){var e={detailHeadings:{enc_pl_dx:"Encounter or Problem List Diagnosis",pl_dx:"Problem List Diagnosis",hist_dx:"Historical Diagnosis",all_dx:"Historical Diagnosis",lab:"Lab Results",enc_dx:"Encounter Diagnosis",hist_proc:"Historic Procedure",enc_proc:"(unusued) Encounter Procedure",ml_med:"Medication List",vitals:"Vital Signs",vitals_bp:"Disjunctive Blood Pressure Detail"},detailDescriptions:{enc_pl_dx:"Specify a constraint based on a diagnosis that can be found either in the current encounter or on the patient’s problem list. This would represent a fairly comprehensive set of acute and chronic diagnoses that are likely to be currently active for the patient.",pl_dx:"Specify a constraint based on a diagnosis in the patient’s problem list. The patient problem list is a patient-level section of the medical record that catalogs the most important diagnoses for the patient",hist_dx:"Specify a constraint based on a diagnosis in the patient’s diagnostic history",lab:"Specify a constraint based on the patient's lab results",enc_dx:"Specify a constraint based on any diagnosis currently associated with the encounter such as chief complaints, differential diagnoses, or symptoms that have been discretely documented and transmitted to Maven. ",hist_proc:"Specify a constraint based on procedures that the patient has undergone in the past",enc_proc:"(unusued) Encounter Procedure",ml_med:"Specify a constraint based on medications that the patient is currently taking according to the medical record",vitals:"Specify a constraint based on the patient's vitals",vitals_bp:"Specify a constraint based on the patient's blood pressure which allows for EITHER the systolic OR diastolic to be within a given range"},notDetail:["id","treeInfo","evidence","genders","minAge","maxAge","name","triggers","triggerType","sources","detID","conflicts"]};return e}),define("text!templates/pathway/triggerEditor.html",[],function(){return'<div id="detail-modal" class="modal fade"  role="dialog" aria-hidden="true" data-backdrop="static">\n    <div class="modal-dialog" style="width: 1000px">\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal"><span\n                        aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                <h4 class="modal-title">Protocol Triggering Diagnoses</h4>\n            </div>\n\n            <div class="modal-body">\n\n                <div class=\'detail-editor-heading\'>Create/Edit Assessment &amp; Plan Diagnosis Constraint</div>\n\n\n                <select id="existsField" class="detail-input form-control attn-text"\n                        name="exists">\n                    <option value="true" selected>Alert the clinician only if</option>\n                    <option value="false"> Do not alert the clinician if</option>\n                </select>\n\n                <p class="attn-text"> The patient\'s Assessment &amp; Plan contains any of the following diagnoses </p>\n\n                <div class="multi-select-search" type="snomed_diagnosis" name="code"></div>\n            </div>\n\n\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                <button type="button" class="btn btn-primary" id="confirmDetailButton">Confirm</button>\n            </div>\n\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/detailEditor_archaic",["jquery","underscore","backbone","pathway/Helpers","pathway/internalViews/detailSearchBox","pathway/internalViews/multiSelectSearch","text!templates/pathway/triggerEditor.html"],function(e,t,n,i,a,o,s){var l=n.View.extend({template:t.template(s),el:"#detailed-trigger-modal",initialize:function(i){this.triggerNode=i.triggerNode,this.$el.html(this.template());var a=e(".multi-select-search",this.$el),s=this;e.each(a,function(e,t){var i=n.Collection.extend({url:"/search"}),l=new n.Collection;s.searchBox=new o({avail:new i,type:t.getAttribute("type"),el:a,selected:l})}),e(".cancel-edit-button",this.$el).on("click",function(){e("#detail-modal").modal("hide")}),e("#confirmDetailButton",this.$el).on("click",function(){t.each(s.searchBox.selected_items.models,function(t){s.triggerNode.get("triggers")||s.triggerNode.set({triggers:new n.Collection},{silent:!0}),t.set("exists",e("#existsField").val()),s.triggerNode.get("triggers").get("enc_dx")||s.triggerNode.get("triggers").set("enc_dx",new n.Collection),s.triggerNode.get("triggers").get("enc_dx").add()}),e("#detail-modal").modal("hide")})},render:function(){e("#detail-modal").modal({show:"true"})}});return l}),define("pathway/modalViews/nodeEditor",["jquery","underscore","backbone","pathway/models/nodeModel","pathway/models/treeModel","pathway/models/treeContext","globalmodels/contextModel","text!templates/pathway/NewNodeModal.html"],function(e,t,n,i,a,o,s,l){var r=n.View.extend({template:t.template(l),el:e("#modal-target"),initialize:function(t,n){var s=this;this.$el.html(this.template()),e("#addNodeButton")[0].onclick=function(){t.unset("protocol",{silent:!0});var l=CKEDITOR.instances.newNodeSideText.getData(),r=new i({tooltip:e("#newNodeTooltip",s.$el).val(),name:e("#newNodeText",this.$el).val(),sidePanelText:l},a),d=t.get("children").length;n&&(d=t.get("children").indexOf(n),t.get("children").remove(n,{silent:!0}),r.get("children").add(n,{silent:!0}),r.showChildren(),a.trigger("propagate")),s.parent.get("children").models[0]&&(s.parent.get("children").models[0].get("children")||s.parent.get("children").reset()),s.parent.get("children").add(r,{at:d}),o.set("selectedNode",r,{silent:!0}),a.trigger("propagate"),e("#detail-modal").modal("hide")};var s=this;this.parent=t,e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("newNodeSideText")})}});return r}),define("text!templates/pathway/newPathway.html",[],function(){return'<div id="newpathwaymodal" class="modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div id="modal-wizard-container">\n                <div class="modal-header">\n                    <h4 class="modal-title">Enter Pathway Name:</h4>\n                </div>\n\n                <div class="modal-body">\n                    <form class="bootbox-form"><input id="newPathName"\n                                                      class="bootbox-input bootbox-input-text form-control" type="text">\n                    </form>\n\n                </div>\n            </div>\n\n            <div class="modal-footer wizard-actions">\n                <button class="btn btn-primary btn-sm" id="create-button">Create New Pathway</button>\n\n                <button class="btn btn-grey btn-sm pull-left" data-dismiss="modal">\n                    <i class="ace-icon fa fa-times"></i>\n                    Cancel\n                </button>\n            </div>\n        </div>\n    </div>\n</div><!-- PAGE CONTENT ENDS -->\n\n'}),define("pathway/modalViews/newPathway",["jquery","underscore","backbone","pathway/models/treeModel","text!templates/pathway/newPathway.html"],function(e,t,n,i,a){var o=n.View.extend({template:t.template(a),parentList:"",parentFolder:null,events:{"click #create-button":"handle_createPathway"},initialize:function(t){"undefined"!=typeof t.parentList&&(this.parentList=t.parentList.join("/")),"undefined"!=typeof t.parentFolder&&(this.parentFolder=t.parentFolder),this.$el.html(this.template()),e("#newpathwaymodal").modal({show:"true"})},handle_createPathway:function(){e("#newpathwaymodal").modal("hide"),i.loadNewPathway({name:e("#newPathName").val(),folder:this.parentList,parentFolder:this.parentFolder}),this.undelegateEvents(),delete this.$el,delete this.el}});return o}),define("text!templates/pathway/richTextEditor.html",[],function(){return'    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">New Node</h4>\n                </div>\n\n                <div class="modal-body">\n\n                    <div class="form-group">\n                        <textarea id="richText" class="form-control" placeholder=""></textarea>\n                    </div>\n\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="confirmButton">Confirm</button>\n                </div>\n            </div>\n        </div>\n    </div>\n'}),define("pathway/modalViews/sidePanelEditor",["jquery","underscore","backbone","pathway/models/nodeModel","pathway/models/treeContext","globalmodels/contextModel","text!templates/pathway/richTextEditor.html"],function(e,t,n,i,a,o,s){var l=n.View.extend({template:t.template(s),el:e("#modal-target"),initialize:function(){this.$el.html(this.template()),e("#confirmButton")[0].onclick=function(){var t=CKEDITOR.instances.richText.getData();a.get("selectedNode").set("sidePanelText",t),e("#detail-modal").modal("hide")},e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("richText")})}});return l}),define("text!templates/pathway/deleteModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">\n                        Delete Dialog\n                    </h4>\n                </div>\n\n                <div class="modal-body">\n                    Would you like to delete only this node, or this node and all of its children\n                    <br>\n                    <button class =\'btn btn-default\' id = "thisNode">The Selected Node</button>\n                    <button class = \'btn btn-default\' id = "allChildren">The Selected Node and All Children</button>\n                    <button class =\'btn btn-default\' id = "cancel">Cancel</button>\n\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/DeleteDialog",["jquery","underscore","backbone","pathway/models/treeModel","pathway/models/treeContext","text!templates/pathway/deleteModal.html"],function(e,t,n,i,a,o){var s=n.View.extend({template:t.template(o),el:"#modal-target",initialize:function(){this.$el.html(this.template()),e("#detail-modal").modal("show"),e("#thisNode").on("click",function(){i.deleteNode(a.get("selectedNode"),!0),e("#detail-modal").modal("hide")}),e("#allChildren").on("click",function(){i.deleteNode(a.get("selectedNode"),!1),e("#detail-modal").modal("hide")}),e("#cancel").on("click",function(){e("#detail-modal").modal("hide")})}});return s}),define("pathway/modalViews/protocolEditor",["jquery","underscore","backbone","pathway/models/nodeModel","pathway/models/treeModel","globalmodels/contextModel","text!templates/pathway/NewProtocolModal.html","singleRow/reminderRow"],function(e,t,n,i,a,o,s,l){var r,d=n.View.extend({template:t.template(s),el:e("#modal-target"),initialize:function(i){this.$el.html(this.template()),require(["ckeditor"],function(){CKEDITOR.replace("ProtocolText")}),r=new Array;var s=this;this.parent=i,e("#detail-modal").modal({show:"true"}),e("#addNodeButton",this.$el).on("click",function(){var i=CKEDITOR.instances.ProtocolText.getData(),o=e("#NoteToCopyText").val(),l=e("#defaultRecipient").val(),d=e("#defaultRecipientName").val(),c=e("#defaultQuickNote").val(),h=e("#defaultFollowupRecipient").val(),u=e("#defaultFollowupRecipientName").val(),p=[];e(r).each(function(){curFollowup=this.getCurrentParams(),t.isEmpty(curFollowup)||p.push(curFollowup)});var m=a.getNextNodeID();s.parent.set("children",new n.Collection([new n.Model({isProtocol:!0,protocol:i,noteToCopy:o,defaultRecipient:l,defaultRecipientName:d,defaultQuickNote:c,followups:p,defaultFollowupRecipient:h,defaultFollowupRecipientName:u,nodeID:a.get("pathid")+":"+m})])),e("#detail-modal").modal("hide"),a.trigger("propagate")}),e(".show-advanced-settings",this.$el).off("click"),e(".show-advanced-settings",this.$el).on("click",function(t){e(".advanced-settings",s.$el).is(":visible")?(e(t.target).switchClass("glyphicon-chevron-down","glyphicon-chevron-right",0),e(".advanced-settings",s.$el).slideUp(200)):(e(t.target).switchClass("glyphicon-chevron-right","glyphicon-chevron-down",0),e(".advanced-settings",s.$el).slideDown(200))}),e("#add-new-followup",this.$el).on("click",function(){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var t=new l({model:new n.Model({edit:!0}),el:el});r.push(t),t.$el.bind("remove",{followup:t},s.removeFollowup)}),e("#defaultRecipient, #defaultFollowupRecipient",this.$el).autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(o.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){if(t.preventDefault(),e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),n.item){e(t.target).val(n.item.label);var i="#"+t.target.id+"Name";e(i).val(n.item.value)}e(this).trigger("change")},change:function(t,n){if(e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),!n.item){var i="#"+t.target.id+"Name";e(i).val(""),""!==e(t.target).val()&&(e(t.target).parent().addClass("has-error"),e("#addNodeButton",this.$el).prop("disabled",!0))}},autoFocus:!0,focus:function(e){e.preventDefault()}})},removeFollowup:function(e){r=t.without(r,e.data.followup)}});return d}),define("text!templates/pathway/detailChooserEntry.html",[],function(){return'<div class = "widget-column col-sm-12">\n<option title="<%=desc%>" value="<%=type%>"><%=type%></option>\n</div>\n'}),define("pathway/internalViews/detailSelector",["jquery","underscore","backbone","globalmodels/contextModel","pathway/Helpers","text!templates/pathway/detailChooserEntry.html"],function(e,t,n,i,a,o){var s=n.View.extend({initialize:function(e){this.el=e.el;var t=n.Collection.extend({url:"/details?"});this.searchedDetails=new t,i.on("change:auth",this.other,this)},other:function(){this.search("")},search:function(t){var n=this,a=i.toParams();a=e.extend(a,{search_param:t}),this.searchedDetails.fetch({data:e.param(a),success:function(){n.render()}})},render:function(){this.$el.html("");var e=t.template(o);for(var n in this.searchedDetails.models){var i=this.searchedDetails.models[n];this.$el.append(e({id:i.get("id"),desc:a.detailDescriptions[i.get("type")],type:a.detailHeadings[i.get("type")]}))}}});return s}),define("text!templates/pathway/protocolNode.html",[],function(){return'\n\n\n<div class = "protocolNode click-tracked" clickID = "TN-<%=pathID%>-<%=protocolNode.nodeID%>">\n    <span>\n        <strong>\n            PROTOCOL\n        </strong>\n        <span style="max-width: 350px;">\n            <%= protocolText %>\n        </span>\n\n    </span>\n\n\n    <br>\n     <% if (page == \'pathEditor\') { %>\n    <div class="btn-group btn-group-xs">\n        <button id=\'sendSetup-button\' type="button" class="btn btn-default btn-sm" style="float: right">\n        <span class="glyphicon glyphicon-envelope"></span>\n        </button>\n       <button id="removeProtocolButton" type="button" class="btn btn-default btn-sm removeProtocolButton" style="float: right">\n           Remove\n       </button>\n    </div>\n\n    <%} else if (page !== \'pathHistory\') {%>\n     <div class="btn-group btn-group-xs">\n         <button id=\'send-button\' type="button" class="btn btn-default btn-sm click-tracked" style="float: right" clickid="TN-<%=pathID%>-<%=protocolNode.nodeID%>" clickaction="send">\n        <span class="glyphicon glyphicon-envelope"></span>\n        </button>\n         <button id=\'followup-button\' type="button" class="btn btn-default btn-sm click-tracked" style="float: right" clickid="TN-<%=pathID%>-<%=protocolNode.nodeID%>" clickaction="followup">\n        <span class="glyphicon glyphicon-time"></span>\n        </button>\n	<% if (typeof(protocolNode.noteToCopy) != \'undefined\' && protocolNode.noteToCopy) { %>\n	<button id=\'copybutton\' type="button" class="btn btn-default btn-sm click-tracked" style="float: right" clickid="TN-<%=pathID%>-<%=protocolNode.nodeID%>" clickaction="copy">\n        <img src="../images/copy-icon.png" style="width: 20px; height: 20px;" title="Copy">\n	<% } %>\n	</button>\n     </div>\n    <% } %>\n</div>\n'}),define("pathway/internalViews/protocolNode",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext","pathway/modalViews/sendProtocol","pathway/modalViews/sendFollowups","text!templates/pathway/protocolNode.html"],function(e,t,n,i,a,o,s,l,r){var d=function(t){if("pathway"==i.get("page")&&!o.suppressClick&&i.get("patients")){var n=e(t.target).closest(".click-tracked");if(n.length){var a=n.attr("clickid"),s=n.attr("clickaction"),l=n.attr("clickextra");s||(s=n.is(":checkbox")?n.is(":checked")?"checked":"unchecked":"click");var r={patient_id:i.get("patients"),protocol_id:i.get("pathid"),node_state:a,datetime:(new Date).toISOString().replace("T"," "),action:s,details:l};
e.ajax({type:"POST",dataType:"json",url:"/activity?"+e.param(i.toParams()),data:JSON.stringify(r),success:function(){console.log("click tracked")}})}}},c=n.View.extend({nodeType:"protocol",template:t.template(r),events:{"click button#copybutton":"copyProtocol","click button#sendSetup-button":"sendSetup","click button#send-button":"send","click button#followup-button":"followup","click div.protocolNode":"setSelectedNode"},initialize:function(e){this.model=e.model,this.hidden=e.hidden},makeExit:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Bottom"});return t},makeEntrance:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Top"});return t},setSelectedNode:function(e){o.suppressClick||(d(e),this.getMyElement().off("click"),o.set("selectedNode",this.model,{silent:!0}),o.trigger("propagate"))},render:function(){var n=this;i.get("patients")&&!this.hidden&&e.ajax({type:"GET",dataType:"json",url:"/node_activity",data:decodeURIComponent(e.param({protocol:a.get("pathid"),patient:i.get("patients"),node_id:this.model.get("nodeID")})),success:function(i){e('input[type="checkbox"]',n.$el);t.map(i,function(t,i){i=i.replace(/\s/g,"").toLowerCase();var a=e('input[clickextra="'+i+'"]',n.$el);a&&a.prop("checked","checked"==t)})}});var s=this.model.get("protocol"),l=/\[\[([\s\S]*?)\|([\s\S]*?)\]\]/g,r={};return s=s.replace(l,function(e,t,i){return key=t.replace(/\s/g,"").toLowerCase(),i=i.split("<p>").join("").split("</p>").join(""),void 0!==r[key]?r[key]+=1:r[key]=0,'<input type="checkbox" value="'+i+'" class="copy-text-button click-tracked" clickextra="'+key+"|"+r[key]+'" clickid="TN-'+a.get("pathid")+"-"+n.model.get("nodeID")+'"/> '+t}),this.$el.html(this.template({pathID:a.get("pathid"),protocolNode:this.model.attributes,page:i.get("page"),protocolText:s})),e(".click-tracked input:checkbox",this.$el).click(function(e){d(e)}),e(".copy-text-button",this.$el).click(function(e){e.stopPropagation()}),this.model==o.get("selectedNode")&&e(".protocolNode",this.$el).addClass("selected"),this},copyProtocol:function(t){t.stopPropagation(),d(t),e("#copiedText").remove();var n=this.model.get("noteToCopy");e("input:checked",this.$el).each(function(e,t){n=n+"  \n\n"+t.value}),e("<div>"+n+"</div>").attr("id","copiedText").appendTo("body"),e("#toast").empty(),e('<span class="glyphicon glyphicon-ok"></span><span>Note-ready text added to clipboard</span>').appendTo("#toast"),e("#toast").css("top",e("#copybutton").offset().top+30),e("#toast").css("left",e("#copybutton").offset().left),e("#toast").css("visibility","visible"),setTimeout(function(){e("#toast").css("visibility","hidden")},1500)},send:function(e){e.stopPropagation(),d(e);new s(this.model)},followup:function(e){e.stopPropagation(),d(e);new l(this.model)},sendSetup:function(e){e.stopPropagation()},getMyElement:function(){return e(".protocolNode",this.$el).first()},childrenHidden:function(){return!1},hideChildren:function(){},showChildren:function(){}});return c.activityTrack=d,c}),define("text!templates/pathway/treeNode.html",[],function(){return'<div class="widget-column col-sm-12">\n    <!--<div style="width:40px; float:left;"></div> <!-- spacing horizontal -->\n    <li style="float:left; width: auto">\n        <div  title="<%=node.tooltip%>" clickID = "TN-<%=pathid%>-<%=node.nodeID%>" <% if (childrenHidden){ %> style = "background-color: lightyellow" <%}%> class="treeNode click-tracked">\n            <span data-toggle="tooltip" > <%=node.name%></span>\n\n            <br>\n            <% if (page == \'pathEditor\'){ %>\n\n            <div style ="clear:both" class="btn-group btn-corner" role="toolbar">\n                    <% if (node.hasLeft ) { %>\n                        <button class = "btn btn-app btn-light btn-sm" id = "moveLeftButton">&lt;</button>\n                    <%}%>\n                    <button type="button" class="btn btn-app btn-light btn-sm" id="addChildButton"><img src="../images/temp/newChild.jpg" style="width: 25px; height: 25px"></button>\n                    <% if (node.children.length == 0){ %>\n                    <button type="button" class="btn btn-app btn-light btn-sm addProtocolButton" id="addProtocolButton"><img src="../images/temp/newProtocole.jpg" style="width: 25px; height: 25px"></button>\n                    <%}%>\n                <% if ("nodeType == standard" && (node.children.length > 0||node.protocol ))  { %>\n                    <button type="button" class="btn btn-app btn-light btn-sm collapseButton">\n                            <% if (childrenHidden){ %>\n                            <img src="../images/temp/expand.jpg" style="width: 25px; height: 25px">\n                            <%}else{ %>\n                            <img src="../images/temp/collapse.jpg" style="width: 25px; height: 25px">\n                        <%}%>\n                    </button>\n                <% } %>\n\n                <%if (node.hasRight) { %>\n                <button class = "btn btn-app btn-light btn-sm" id = "moveRightButton">&gt;</button>\n                 <%}%>\n\n\n            </div>\n             <%}%>\n             <div style = "clear: both"></div>\n        </div>\n        <!--<div style="clear: both; height:100px; width:10px;"></div> <!-- spacing, Vertical-->\n        <ul class=\'children2\'>\n                    <div style=\'padding-top: 25px; \' class=\'protocol\'></div>\n\n\n        </ul>\n\n    </li>\n</div>\n'}),define("pathway/internalViews/treeNode",["jquery","underscore","backbone","globalmodels/contextModel","pathway/internalViews/protocolNode","pathway/modalViews/nodeEditor","pathway/modalViews/protocolEditor","pathway/models/nodeModel","pathway/models/treeModel","pathway/models/treeContext","text!templates/pathway/treeNode.html"],function(e,t,n,i,a,o,s,l,r,d,c){var h=n.View.extend({nodeType:"standard",template:t.template(c),initialize:function(e){this.childEntrances=[],this.model=e.model,e.el&&(this.el=e.el),this.$el.css({"float":"left"});this.render()},makeExit:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Bottom"});return t},makeEntrance:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Top"});return t},setSelectedNode:function(){d.suppressClick||(this.getMyElement().off("click"),d.set("selectedNode",this.model,{silent:!0}),d.trigger("propagate"))},getMyElement:function(){return e(".treeNode",this.$el).first()},render:function(){this.$el.html(this.template({node:this.model.attributes,childrenHidden:this.model.childrenHidden(),page:i.get("page"),pathid:r.get("pathid")}));var n=this;return e(".collapseButton",this.$el).first().on("click",function(){d.suppressClick||"pathEditor"==i.get("page")&&(n.model.childrenHidden()?n.model.showChildren():r.collapse(n.model),r.getShareCode())}),e("#addChildButton",this.$el).first().on("click",function(){new o(n.model)}),e("#moveLeftButton",this.$el).on("click",function(){r.changeNodePosition(n.model,-1)}),e("#moveRightButton",this.$el).first().on("click",function(){d.unset("selectedNodeOffset"),r.changeNodePosition(n.model,1)}),e(".addProtocolButton",this.$el).first().on("click",function(){new s(n.model)}),this.getMyElement().on("click",function(t){if(!d.suppressClick){a.activityTrack(t);var o=e(t.currentTarget),s=o.offset();s.clickid=o.attr("clickid"),d.set({selectedNodeWidth:o.outerWidth(),selectedNodeOffset:s,selectedNode:n.model},{silent:!0}),"pathEditor"!=i.get("page")?(n.model.childrenHidden()?(r.hideSiblings(n.model),n.model.showChildren()):r.collapse(n.model),r.getShareCode()):d.trigger("propagate")}}),t.each(this.model.get("children").models,function(t){if(t.get("isProtocol"))n.addProtocol(t);else{e(".children2",this.$el).first().append("<div class='childSpot'></div>");var i=e(".childSpot",e(".children2",this.$el).first()).last();t.set("hasLeft",0!=this.model.get("children").indexOf(t)),t.set("hasRight",this.model.get("children").indexOf(t)<this.model.get("children").length-1);var a=new h({model:t,el:i}),o=!t.childrenHidden()||t==d.get("selectedNode");r.elPairs.push({source:this,target:a,bold:o})}},this),e(".children2",this.$el).first().css(this.model.childrenHidden()&&"standard"==this.nodeType?{display:"none"}:{display:"block"}),this.model==d.get("selectedNode")&&n.getMyElement().addClass("selected"),this},addProtocol:function(t){var n=this,i=new a({model:t,hidden:this.model.childrenHidden()});e(".protocol",n.$el).first().append(i.render().$el),r.elPairs.push({source:n,target:i,bold:!0}),e(".removeProtocolButton",n.$el).on("click",function(){r.deleteNode(t,!1)})}});return h}),define("text!templates/pathway/triggerNode.html",[],function(){return'<ul>\n    <li>\n        <div title="<%=node.tooltip%>" clickID = "TN-<%=node.id%>-<%=node.nodeID%>" style="text-align: center; border-style:solid;  width:auto;" class="treeNode expanded-path click-tracked">\n            <span data-toggle="tooltip" ><%=node.name%></span>\n            <br>\n            <% if (page == \'pathEditor\'){ %>\n            <div style ="clear:both" class="btn-group btn-corner" role="toolbar">\n                <button type="button" class="btn btn-app btn-light btn-sm" id="addChildButton"><img src="../images/temp/newChild.jpg" style="width: 25px; height: 25px"></button>\n                </div>\n            <%}%>\n\n        </div>\n\n        <!--<div style="clear: both; height:100px; width:10px;"></div>-->\n        <ul style="clear: both; width: 100%; text-align: center" class=\'children2\'></ul>\n\n        <div style=\'padding-top: 25px; \' class=\'protocol\'></div>\n        </div>\n    </li>\n</ul>\n'}),define("pathway/internalViews/triggerNode",["jquery","underscore","backbone","pathway/internalViews/treeNode","text!templates/pathway/triggerNode.html"],function(e,t,n,i,a){var o=i.extend({nodeType:"topLevel",template:t.template(a)});return o}),define("text!templates/pathway/treeNodeActionSet.html",[],function(){return'<li class="hover" id="editNode-button">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newPath.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Edit Selected Node\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n\n<li class="hover" id="deleteNodeButton">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newPath.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Delete Selected Node\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n\n\n<% if (page == \'pathEditor\') { %>\n\n<li class="hover" id="addChildButton">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newChild.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Add Child\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n\n\n<% if (treeNode.children && treeNode.children.length == 0){%>\n<li class="hover" id="addProtocolButton">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newProtocole.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Add Protocol\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n<%}%>\n<%}%>\n\n<% if (page == \'pathEditor\' && ((treeNode.children && treeNode.children.length > 0)||treeNode.protocol) ) {%>\n\n<li class="hover" id="collapseButton">\n    <a href="javascript:void(0)">\n        <% if (childrenHidden){%>\n        <i class="menu-icon">\n            <img src="../images/temp/expand.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Expand Node\n			 </span>\n        <%}else{%>\n        <i class="menu-icon">\n            <img src="../images/temp/collapse.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Collapse Node\n			 </span>\n        <%}%>\n    </a>\n    <b class="arrow"></b>\n</li>\n\n\n<% } %>\n\n<%= (typeof sidePanelText !== \'undefined\') ? sidePanelText : \'\' %>\n\n\n\n'}),define("pathway/internalViews/treeNodeActionSet",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext","pathway/modalViews/editNode","pathway/modalViews/newPathway","pathway/modalViews/nodeEditor","pathway/modalViews/protocolEditor","pathway/modalViews/DeleteDialog","text!templates/pathway/treeNodeActionSet.html"],function(e,t,n,i,a,o,s,l,r,d,c,h){var u=n.View.extend({template:t.template(h),render:function(){if(null!=o.get("selectedNode").attributes){var t=o.get("selectedNode");this.$el.html(this.template({treeNode:t.attributes,childrenHidden:t.childrenHidden&&t.childrenHidden(),page:i.get("page")}))}e("#deleteNodeButton",this.$el)[0].onclick=this.deleteNode,e("#setNodeTitleButton",this.$el)[0].onclick=this.editNode;var n=e("#addChildButton",this.$el);n.length&&(n[0].onclick=this.addChild);var a=e("#addProtocolButton",this.$el)[0];a&&(a.onclick=this.addProtocol);var s=e("#collapseButton",this.$el)[0];return s&&(s.onclick=this.expandCollapse),this},addChild:function(){new r(o.get("selectedNode"))},addProtocol:function(){new d(o.get("selectedNode"))},expandCollapse:function(){o.get("selectedNode").childrenHidden()?o.get("selectedNode").showChildren():a.collapse(o.get("selectedNode")),a.getShareCode(),o.trigger("propagate")},editNode:function(){new s},deleteNode:function(){new c}});return u}),define("text!templates/pathway/pathwayListEntry.html",[],function(){return'<div id="<%=canonical%>" class="path-row dd-handle dd2-handle">\n        														<!--<i class="normal-icon ace-icon fa fa-signal orange bigger-130"></i>-->\n\n        <img class=\'normal-icon\' src="../images/temp/newPath.jpg" style="width: 20px; height: 20px"/>\n\n        <i class="drag-icon ace-icon fa fa-arrows bigger-125"></i>\n    </div>\n    <div class="dd2-content">\n        <a class=\'select-button\'><%=name%></a>\n        <div class="pull-right action-buttons">\n            <a>\n                <input class="ace ace-switch ace-switch-3 pathway-enable" type="checkbox"\n                <%= (enabled == 1) ? "checked" : "" %>/>\n                <span class="lbl"></span>\n            </a>\n            <a class="red delete-button" style="vertical-align: top;">\n                <i class="ace-icon fa fa-trash-o bigger-140"></i>\n            </a>\n\n        </div>\n    </div>\n        <ol class="pathway-history-section dd-list">\n\n            </ol>'}),define("globalmodels/scrollCollection",["jquery","underscore","backbone","globalmodels/contextModel"],function e(t,n,i,a){ScrollModel=i.Model;var e=i.Collection.extend({url:null,limit:10,tried:0,offset:0,model:ScrollModel,extraData:{},lastRefresh:new Date,getLastRefresh:function(){return this.lastRefresh.toISOString().replace("T"," ").substr(0,19)},context:function(){},initialize:function(){if(this.tried=0,this.offset=0,a.get("userAuth")&&this.url){var e={};t.extend(e,a.toParams(),this.extraData),this.fetch({data:t.param(e),remove:!0})}this.context()},more:function(){if(this.tried<=this.models.length){var e={};t.extend(e,a.toParams(),this.extraData),this.offset=this.models.length,this.tried=this.models.length+this.limit,this.fetch({data:t.param(e),remove:!1})}}});return e}),define("pathway/models/historyCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){HistoryModel=n.Model;var o=a.extend({url:function(){return"/history"+this.offset+"-"+(this.offset+this.limit)},model:HistoryModel,refresh:function(){if(i.get("userAuth")){var t={};e.extend(t,i.toParams(),this.extraData),that=this,this.tried=0,this.offset=0,this.fetch({data:e.param(t),remove:!0,success:function(){that.trigger("reset")}})}}});return o}),define("text!templates/pathway/pathwayHistoryRow.html",[],function(){return'<div class="dd-handle dd2-handle" name="<%=name%>">\n    <i class="normal-icon ace-icon fa fa-book orange bigger-130"></i>\n</div>\n<div class="dd2-content" title="Author: <%=official_name%>\nDate: <%=creation_date%>">\n<span><a class=\'history-select-button\'><%=creation_date%></a></span>\n    <div class="pull-right action-buttons">\n        <a><span style="padding-right: 1px;"\n             class="glyphicon <%= (active == 1) ? \'glyphicon-check\' : \'glyphicon-unchecked\' %> history-checkbox"></span></a>\n        <a class="red delete-hist" href="#">\n		    <i class="ace-icon fa fa-trash-o bigger-130"></i>\n	    </a>\n    </div>\n</div>'}),define("pathway/singleRows/historyRow",["jquery","underscore","backbone","text!templates/pathway/pathwayHistoryRow.html","globalmodels/contextModel"],function(e,t,n,i,a){var o=n.View.extend({tagName:"li class='dd-item history-row'",template:t.template(i),events:{"click .history-checkbox":"handleCheck","click .history-select-button":"handleSelect"},render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this.model.url="/history/"+this.model.get("canonical")+"/"+this.model.get("pathid"),this},handleCheck:function(t){e(t.target).hasClass("check-disabled")||(e(this.el).parent().find(".history-checkbox").switchClass("glyphicon-check","glyphicon-unchecked"),e(".history-checkbox",this.$el).switchClass("glyphicon-unchecked","glyphicon-check"),this.model.save())},handleSelect:function(){"undefined"==a.get("code")&&a.get("canonical")!=this.model.get("canonical")&&a.set("code","undefined",{silent:!0}),a.set("pathid",String(this.model.get("pathid"))),a.set("canonical",String(this.model.get("canonical"))),e(".active-pathway").removeClass("active-pathway"),e(this.el).addClass("active-pathway")}});return o}),define("text!templates/pathway/historyScroll.html",[],function(){return'<div class="historylist history-scroll" style="clear:both; max-height: 200px; overflow-y:auto; overflow-x: hidden">\n    <div class="historyaccordion">\n    </div>\n</div>'}),define("widgets/pathway/historyList",["jquery","underscore","backbone","pathway/models/historyCollection","pathway/singleRows/historyRow","text!templates/pathway/historyScroll.html","pathway/models/treeModel","globalmodels/contextModel"],function(e,t,n,i,a,o,s){var l,r=n.View.extend({extraData:{},lastHeight:0,currentPath:0,first:!0,initialize:function(n){this.template=t.template("undefined"!=typeof n.template?n.template:o),"undefined"!=typeof n.extraData&&(this.extraData=n.extraData),"undefined"!=typeof n.currentPath&&(this.currentPath=n.currentPath),l=new(i.extend({extraData:this.extraData})),this.$el.html(this.template({height:e(window).height()-50+"px"})),l.bind("add",this.addHistory,this),l.bind("reset",this.render,this),s.bind("propagate",l.refresh,l)},events:{},render:function(){this.reset(),this.$el.html(this.template(this)),this.addAll()},addAll:function(){var t=!1;if(l.length)for(hist in l.models)this.addHistory(l.models[hist]),t=!0;if(t){var n=e(".history-scroll",this.$el);setTimeout(function(){var e=n.innerHeight();this.lastHeight!=e&&e<parseInt(n.css("max-height"))?(this.lastHeight=e,l.more()):n.scroll(function(){return n.scrollTop()+n.innerHeight()+100>=n[0].scrollHeight&&l.more(),!1})},500)}else e(".historyaccordion").html("No History")},addHistory:function(t){var n=new a({model:t});e(".historyaccordion",this.$el).append(n.render().el),e(n.el).bind("change",{activePath:n.model.get("pathid"),that:this},this.updateActivePathway)},updateActivePathway:function(t){t.data.that.currentPath=t.data.activePath,e(this.el).trigger("change")},reset:function(){e(this.$el).empty()}});return r}),define("pathway/singleRows/pathRow",["jquery","underscore","backbone","router","globalmodels/contextModel","pathway/models/pathwayCollection","text!templates/pathway/pathwayListEntry.html","../../widgets/pathway/historyList"],function(e,t,n,i,a,o,s,l){var r=n.View.extend({tagName:"li class='dd-item pathrow-item dd2-item dd-collapsed'",template:t.template(s),historyList:null,events:{"click .select-button":"handleSelect","click .show-hist":"handleHistory","click .delete-button":"handleRemove","click .pathway-checkbox":"handleCheck","click .pathway-switch-label":"handleToggle"},handleToggle:function(e){e.stopPropagation()},render:function(){e(this.el).html(this.template(this.model.toJSON())),this.model.url="/list/"+this.model.get("canonical");var t=this;return e(document).ready(function(){e(".pathway-enable",t.$el).on("switchChange.bootstrapSwitch",function(n,i){i?e(".history-checkbox",this.$el).removeClass("check-disabled",0):e(".history-checkbox",this.$el).addClass("check-disabled",0),t.model.save({active:i})})}),this},initialize:function(t){this.model=t.model,that=this,e(this.el).on("remove",function(){console.log("this pathway was removed")})},handleSelect:function(){"undefined"==a.get("code")&&a.get("canonical")!=this.model.get("canonical")&&a.set("code","undefined",{silent:!0}),a.set("canonical",String(this.model.get("canonical"))),a.set("pathid",String(this.model.get("id"))),e(".active-pathway").removeClass("active-pathway"),e(this.el).addClass("active-pathway"),a.unbind("change:pathid",this.updateCurPath),a.on("change:pathid",this.updateCurPath,{that:this})},updateCurPath:function(){a.get("canonical")==this.that.model.get("canonical")?this.that.model.set("id",a.get("pathid")):a.unbind("change:pathid",this.that.updateCurPath)},handleCheck:function(t){var n=!1;e(t.target).hasClass("glyphicon-check")?(e(t.target).switchClass("glyphicon-check","glyphicon-unchecked",0),e(".history-checkbox",this.$el.parent()).addClass("check-disabled",0)):(n=!0,e(t.target).switchClass("glyphicon-unchecked","glyphicon-check",0),e(".history-checkbox",this.$el.parent()).removeClass("check-disabled",0)),this.model.save({active:n})},handleHistory:function(){var t=e(".pathway-history-section",this.$el),n={canonical:this.model.get("canonical")};this.historyList=new l({el:t,currentPath:this.model.get("id"),extraData:n}),e(this.historyList.el).bind("change",{that:this},this.updateActivePathway)},updateActivePathway:function(e){e.data.model.set("id",e.data.that.historyList.currentPath)},handleRemove:function(){var t=confirm("Are you sure you want to delete this pathway?");t&&(this.model.destroy({success:function(){o.fetch()}}),this.undelegateEvents(),e(this.el).remove(),delete this.$el,delete this.el)}});return r}),define("globalmodels/summaryModel",["jquery","backbone","globalmodels/contextModel"],function(e,t,n){var i=Backbone.Model.extend({urlRoot:"/total_spend"}),a=new i;a.set({spending:"",savings:""},{silent:!0}),n.get("userAuth")&&a.fetch({data:e.param(n.toParams())});var o={};return n.on("change:patients change:userAuth change:encounter change:startdate change:enddate",function(t){var i=_.extend({},n.changed);_.isEqual(i,o)||(o=i,a.set({spending:"",savings:""},{silent:!0}),a.fetch({data:e.param(t.toParams())}))}),a}),define("globalmodels/patientModel",["jquery","backbone","globalmodels/contextModel"],function(e,t,n){var i=Backbone.Model.extend({url:"/patient_details"}),a=new i;return n.get("patients")&&n.get("userAuth")&&a.fetch({data:e.param(n.toParams())}),n.on("change:patients change:userAuth",function(t){t.get("patients")!=a.get("id")&&t.get("userAuth")&&(t.get("patients")?a.fetch({data:e.param(t.toParams())}):a.set({id:"",name:""}))}),a}),define("globalmodels/spendingModel",["underscore","backbone","globalmodels/contextModel"],function(e,t,n){var i=t.Model.extend({urlRoot:"/spending",clickType:function(e){this.set({typeFilter:e})},clickDate:function(e){var t=e.item.dataContext.date;t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),this.set({dateFilter:t})},getGathered:function(){var e={},t=this.get("dateFilter");for(var n in this.attributes)if(Date.parse(n)){var i=new Date(n);if(!t||i.getFullYear()==t.getFullYear()&&i.getMonth()==t.getMonth()&&i.getDate()==t.getDate()){var o=a.get(n);for(var s in o){var l=o[s];s in e&&(l+=e[s]),e[s]=l}}}return e}}),a=new i;return a.set({typeFilter:"",dateFilter:""}),n.get("userAuth")&&a.fetch({data:$.param(n.toParams())}),n.on("change:patients change:userAuth change:encounter change:startdate change:enddate",function(e){e.get("userAuth")&&a.fetch({data:$.param(e.toParams()),success:function(e,t){var n={typeFilter:a.get("typeFilter"),dateFilter:a.get("dateFilter")};a.clear({silent:!0}),a.set($.extend(n,t))}})}),a}),define("globalmodels/orderCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){return OrderModel=n.Model,orderCollection=new a,orderCollection.url=function(){return"/orders"+this.offset+"-"+(this.offset+this.limit)},orderCollection.model=OrderModel,orderCollection.limit=10,orderCollection.context=function(){i.on("change:patients change:encounter change:startdate change:enddate",function(t){t.get("userAuth")&&(t.get("patients")?(this.tried=0,this.offset=0,orderCollection.fetch({data:e.param(i.toParams()),remove:!0})):orderCollection.reset())},orderCollection)},orderCollection.initialize(),orderCollection}),define("globalmodels/customerCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){return CustomerModel=n.Model,customerCollection=new a,customerCollection.url=function(){return"/customers"+this.offset+"-"+(this.offset+this.limit)},customerCollection.model=CustomerModel,customerCollection.limit=10,customerCollection.context=function(){i.on("change:startdate change:enddate",function(t){t.get("customerAuth")&&(this.tried=0,this.offset=0,customerCollection.fetch({data:e.param(i.toParams()),remove:!0}))},customerCollection)},customerCollection.initialize(),customerCollection.refresh=function(){i.get("userAuth")&&(this.tried=0,this.offset=0,customerCollection.fetch({data:e.param(i.toParams()),remove:!0}))},customerCollection}),define("globalmodels/auditCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){AuditModel=n.Model;var o=a.extend({url:function(){return"/audits"+this.offset+"-"+(this.offset+this.limit)},model:AuditModel,limit:5,context:function(){e(".auditlist").on("show",this.refresh)},refresh:function(){if(i.get("userAuth")){var t={};e.extend(t,i.toParams(),this.extraData),this.tried=0,this.offset=0,this.fetch({data:e.param(t),remove:!0})}}});return o}),define("globalmodels/patientCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){var o=n.Model;return patientCollection=new a,patientCollection.url=function(){return"/patients"+this.offset+"-"+(this.offset+this.limit)},patientCollection.model=o,patientCollection.limit=10,patientCollection.context=function(){i.on("change:patients change:startdate change:enddate",function(t){t.get("userAuth")&&(this.tried=0,this.offset=0,patientCollection.fetch({data:e.param(i.toParams()),remove:!0}))},this)},patientCollection.initialize(),patientCollection}),define("globalmodels/userCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){UserModel=n.Model;var o=a.extend({url:function(){return"/users"+this.offset+"-"+(this.offset+this.limit)},model:UserModel,context:function(){i.on("change:startdate change:enddate",this.refresh)},refresh:function(){if(i.get("userAuth")){var t={};e.extend(t,i.toParams(),this.extraData),this.tried=0,this.offset=0,this.fetch({data:e.param(t),remove:!0})}}});return o}),define("globalmodels/histogramModel",["jquery","backbone","globalmodels/contextModel"],function(e,t,n){var i=Backbone.Model.extend({urlRoot:"/hist_spending"}),a=new i;return n.get("userAuth")&&a.fetch({data:e.param(n.toParams())}),n.on("change:patients change:userAuth",function(){a.fetch({data:e.param(n.toParams())})}),a}),define("globalmodels/alertCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){AlertModel=n.Model;var o=[];return alertCollection=new a,alertCollection.url=function(){return"/alerts"+this.offset+"-"+(this.offset+this.limit)},alertCollection.model=AlertModel,alertCollection.limit=5,alertCollection.extraData={categories:o},alertCollection.context=function(){i.on("change:patients change:encounter change:startdate change:enddate",function(t){if(t.get("userAuth")){var n={};e.extend(n,i.toParams(),alertCollection.extraData),this.tried=0,this.offset=0,alertCollection.fetch({data:e.param(n),remove:!0})}},this)},alertCollection.initialize(),alertCollection}),define("widgets/welcome",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.render(),this.showhide(),i.on("change:page",this.showhide,this),i.on("change:pathid",this.render,this)},render:function(){i.get("pathid")&&i.get("pathid")>0?this.$el.hide():(this.$el.html(this.template(i.attributes)),this.$el.show())},showhide:function(){"home"==i.get("page")?this.$el.show():this.$el.hide()}});return a}),define("jquery_autocomplete",["jquery","jquery_ui"],function(e){function t(t,n){var i=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(t){return i.test(e("<div>").html(t.label||t.value||t).text())})}var n=e.ui.autocomplete.prototype,i=n._initSource;e.extend(n,{_initSource:function(){this.options.html&&e.isArray(this.options.source)?this.source=function(e,n){n(t(this.options.source,e.term))}:i.call(this)},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>")[this.options.html?"html":"text"](n.label)).appendTo(t)}})}),define("widgets/patientSearch",["jquery","underscore","backbone","globalmodels/contextModel","jquery_autocomplete"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change:patients",this.update,this)},update:function(t){if(t.get("patients"));else{this.$el.html(this.template(i.attributes)),e("#srch-diagnosis").autocomplete({source:function(t,n){e.ajax({url:"/autocomplete_diagnosis",term:t.term,data:e.param(i.toParams())+"&diagnosis="+t.term,success:function(e){n(e)}})},minLength:4,select:function(t,n){n.item&&(e(t.target).val(n.item.value),e(t.target.form).submit())}});{new Array}e("#srch-patient").autocomplete({source:function(t,n){e.ajax({url:"/autocomplete_patient",term:t.term,patientname:e("#srch-patient").val(),data:e.param(i.toParams())+"&patientname="+t.term,success:function(e){n(e)}})},minLength:2,select:function(t,a){t.preventDefault(),a.item&&(e(t.target).val(a.item.label),i.set({patientName:a.item.label},{silent:!0}),n.history.navigate("patient/"+a.item.value,{trigger:!0}))}})}}});return a}),define("widgets/datepicker-calendar",["jquery","underscore","backbone","fullcalendar","globalmodels/contextModel","globalmodels/histogramModel"],function(e,t,n,i,a,o){var s=n.View.extend({initialize:function(n){this.template=t.template(n.template),this.$el.html(this.template({page:a.get("page")})),a.on("change:patients change:encounter change:enc_date",this.update,this),this.update(),e("#datepicker-modal").on("shown.bs.modal",function(){e("#calendar1").fullCalendar("render"),e("#calendar2").fullCalendar("render")})},events:{"click .btn":"showEncounters"},update:function(){var t=new Array,i=2,s=[];for(var l in o.attributes){var r=o.attributes[l],d=r.discharge;d||(d=(new Date).toISOString().substring(0,10)),s.push({id:r.encounterid,title:r.patientname+": "+r.diagnosis+" $"+r.spending,start:r.admission,end:d,className:"admission",allDay:!0,url:"#episode/"+r.encounterid+"/patient/"+r.patientid+"/"+r.admission})}for(var c=1;i>=c;c++){var h=new Date,u=a.get("enc_date")?new Date(a.get("enc_date")):new Date(h.getFullYear(),h.getMonth()-2,1),p=u.setMonth(u.getMonth()+c);t[c]=e("#calendar"+c).fullCalendar({header:{left:1==c?"prev,next":"",center:"title",right:2==c?"today":""},defaultDate:p,selectable:!0,selectHelper:!0,select:function(t,i){a.get("patients")&&(a.set({enc:null,enc_date:null,startdate:t.format(),enddate:i.format()}),n.history.navigate("patient/"+a.get("patients"),!0),e("#datepicker-modal").modal("hide")),e("#calendar").fullCalendar("unselect")
},eventClick:function(t){t.url&&(n.history.navigate(t.url,!0),e("#datepicker-modal").modal("hide"))},events:s})}e("#calendar1 .fc-button-prev").each(function(){e(this).click(function(){e("#calendar2").each(function(){e(this).fullCalendar("prev")})})}),e("#calendar1 .fc-button-next").each(function(){e(this).click(function(){e("#calendar2").each(function(){e(this).fullCalendar("next")})})}),e("#calendar2 .fc-button-today").each(function(){e(this).click(function(){e("#calendar1").each(function(){e(this).fullCalendar("today"),e(this).fullCalendar("prev")})})})},showEncounters:function(t){var i=t.target.id,o=new Date;o.setMonth(o.getMonth()-i),console.log(o.toLocaleDateString()),a.set({enc:null,enc_date:null,startdate:o.toLocaleDateString(),enddate:(new Date).toLocaleDateString()}),n.history.navigate("patient/"+a.get("patients"),!0),e("#datepicker-modal").modal("hide")}});return s}),define("text!templates/patientRow.html",[],function(){return"<td>\n    <a>\n        <%= name %>\n    </a>\n    </td>\n    <td>\n        <%= gender %>\n    </td>\n    <td>\n        <%= DOB %>\n    </td>\n    <td>\n        <%= diagnosis %>\n    </td>\n    <td>\n        $<%= cost %>\n    </td>"}),define("singleRow/patientRow",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/patientRow.html"],function(e,t,n,i,a){var o=n.View.extend({tagName:"tr",template:t.template(a),events:{click:"handleClick"},render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},handleClick:function(){var e=this.model.get("id");i.set({patientName:this.model.get("name")},{silent:!0}),n.history.navigate("patient/"+e,{trigger:!0})}});return o}),define("text!templates/patientList.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="row" style=\'width:90%;margin:0 auto 0 auto\'>\n        <h2 class="headings">\n          <%= display %>\'s Recent Patients\n        </h2>\n    <div class=\'patientlist\' style=" width:100%; padding:0; max-height:100px; overflow-y:auto;">\n    <table class="table table-condensed table-hover patienttable" style="width:100%; padding: 0;">\n        <col width="20%">\n        <col width="20%">\n        <col width="20%">\n        <col width="20%">\n        <col width="20%">\n        <thead>\n            <tr>\n                <th align="left" id="pat_name">Name</th>\n                <th align="left" id="pat_gender">Gender</th>\n                <th align="left" id="pat_dob">Date of Birth</th>\n                <th align="left" id="pat_diagnosis">Diagnosis</th>\n                <th align="left" id="pat_cost">Cost</th>\n            </tr>\n        </thead>\n        <tbody>\n        </tbody>\n    </table>\n    </div>\n</div>\n<div class="maven-padding"></div>\n<div class="row">\n    <hr>\n</div>\n</div>\n'}),define("widgets/patientList",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/patientCollection","singleRow/patientRow","text!templates/patientList.html"],function(e,t,n,i,a,o,s){var l=n.View.extend({template:function(){return""},initialize:function(){a.bind("add",this.addPatient,this),a.bind("reset",this.render,this),i.on("change",this.addAll,this),this.addAll();var t=e(".patientlist",this.$el);t.scrollTop(0),t.scroll(function(){t.scrollTop()+t.innerHeight()+100>=t[0].scrollHeight&&a.more()})},render:function(){return template=t.template(s,{display:i.get("display")}),this.$el.html(template),this},addPatient:function(t){var n=new o({model:t});e(".patienttable").append(n.render().el)},addAll:function(){if(i.get("patients"))this.$el[0].style.display="none";else{this.$el[0].style.display="",this.render();for(var t in a.models)this.addPatient(a.models[t])}var n=e(".patientlist",this.$el);setTimeout(function(){var e=n.innerHeight();e>0&&e<parseInt(n.css("max-height"))&&a.more()},500)}});return l}),define("widgets/customerCreation",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.render(),this.showhide(),i.on("change:page",this.showhide,this)},events:{"click .add-customer-button":"addCustomer"},showhide:function(){"customers"==i.get("page")?this.$el.show():this.$el.hide()},addCustomer:function(){var t=e("#customer-name-input").val(),n=e("#customer-abbr-input").val(),a=e("#customer-license-input").val(),o=e("#customer-config-input").val(),s=e("#customer-ituser-input").val(),l=new RegExp("^[0]*[1-9]+[0]*$");l.test(a)?""==n?e("#add-customer-message").html("Please fill out Customer Abbreviation"):""==t?e("#add-customer-message").html("Please fill out Customer Name"):""==s?e("#add-customer-message").html("Please fill out IT User"):(e("#add-customer-message").html("&nbsp;"),e.ajax({url:"/add_customer",data:e.param(i.toParams())+"&name="+t+"&abbr="+n+"&license="+a+"&ituser="+s+"&config="+o,success:function(t){e("#add-customer-message").html("Customer Added!"),e("#customer-name-input").val(""),e("#customer-abbr-input").val(""),e("#customer-license-input").val(""),e("#customer-ituser-input").val(""),e("#add-customer-message").html("Customer added.  "+t),alert(t)},error:function(){e("#add-customer-message").html("Sorry, an error occurred")}})):e("#add-customer-message").html("Please enter a valid number for # of licenses")},render:function(){return this.$el.html(this.template),this}});return a}),define("widgets/providerProfile",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/sidebarModel"],function(e,t,n,i,a){var o=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.render(),a.addOption("Profile"),this.showhide(),i.on("change:page",this.showhide,this)},events:{"keyup #official-name-input":"doentersave","keyup #display-name-input":"doentersave","keyup #new-password":"doenterchange","click #change-password":"dochangepassword","click #save-settings":"dosavesettings"},showhide:function(){"profile"==i.get("page")?this.$el.show():this.$el.hide()},render:function(){this.$el.html(this.template(i.attributes))},doentersave:function(t){e("#settings-save-status").empty(),13==t.keyCode&&this.dosavesettings(t)},dosavesettings:function(){var t=e("#official-name-input").val(),n=e("#display-name-input").val();e.ajax({url:"/save_user_settings",data:e.param(i.toParams())+"&official_name="+t+"&display_name="+n,success:function(){console.log("Settings saved"),e("#settings-save-status").html("Settings Saved!")},error:function(){console.log("Settings failed to save"),e("#settings-save-status").html("Sorry, an error occurred")}})},dochangepassword:function(){this.newPasswordChange()&&console.log("saving new password")},doenterchange:function(e){13==e.keyCode?this.dochangepassword():this.newPasswordChange()},newPasswordChange:function(){var t=e("#new-password").val(),n="<big><big><font color='#00b000'>&#x2714</font></big></big>",i="<big><font color='#ff0000'>&#x2718</font></big>",a=t.length<8,o=t.search(".*[a-z]")<0,s=t.search(".*[A-Z]")<0,l=t.search(".*[0-9]")<0,r=t==e("#current-password").val(),d=t!=e("#new-password2").val();return e("#pw-len-cb").html(a?i:n),e("#pw-low-cb").html(o?i:n),e("#pw-up-cb").html(s?i:n),e("#pw-num-cb").html(l?i:n),e("#pw-diff-cb").html(r?i:n),a||o||s||l||r||d?!1:!0}});return o}),define("text!templates/userRow.html",[],function(){return'<td>\n    <%= (ehr_state == \'active\') ? display_name : "<del>" + display_name + "</del>" %> <br/>\n    <%= profession %>\n</td>\n<td>\n    <% if (last_login) { print(last_login + \' GMT\'); } %> <br/>\n    <a class="audit-hover hover-link">\n        View Audits\n    </a>\n</td>\n<td>\n    <div width="100%">\n        <input type="checkbox" class="toggle-status" data-on-text="Active" data-off-text="InActive" data-size="small" style="width:100% !important;"\n            <%= (roles.indexOf("administrator")==-1 && ehr_state != \'active\') ? "disabled" : \'\' %>\n            <%= (state == \'active\' && ehr_state == \'active\') ? \'checked\' : \'\' %>>\n<!--\n        <button class="btn btn-xs btn-default btn-block btn-status" <%= (ehr_state != \'active\') ? "disabled" : \'\' %>\n                value="<%= (state==\'active\') ? \'deactivate\' : \'activate\' %>">\n            <span class="btn-label"><%= (state == \'active\' && ehr_state == \'active\') ? \'Active\' : \'Inactive\' %></span>\n            <span class="btn-hover"><%= (state == \'active\' && ehr_state == \'active\') ? \'De Activate\' : \'Activate\' %></span>\n        </button>-->\n    </div>\n    <% if (ehr_state == \'active\' || roles.indexOf("administrator")!=-1) { %>\n    <div width="100%">\n        <button class="btn btn-xs reset-user-password btn-default btn-block" value="">Reset Password</button>\n    </div>\n    <% } %>\n</td>\n<td>&nbsp;</td>\n<td>\n    Primary <br/>\n    Secondary\n</td>\n<td>\n    <% notifications = {\'desktop\': \'Desktop\', \'mobile\': \'Mobile\', \'ehrinbox\': \'EHR Inbox\', \'off\': \'Off\', \'\': \'Off\'} %>\n\n    <div class="btn-group" style="float:right; width:100%;">\n        <ul class="dropdown-menu dropdown-menu-right" role="menu" style=\'float:right;\'>\n          <li><a class="btn-msg-primary" value="desktop">Desktop</a></li>\n	      <li><a class="btn-msg-primary" value="mobile">Mobile</a></li>\n          <li><a class="btn-msg-primary" value="ehrinbox">EHR Inbox</a></li>\n          <li><a class="btn-msg-primary" value="off">Off</a></li>\n	    </ul>\n\n        <button type="button" class="btn btn-xs btn-default btn-block" data-toggle="dropdown">\n            <span class="msg-primary-label"><%= notifications[notify_primary.toLowerCase()] %></span>\n	        <span class="sr-only">Toggle Dropdown</span>\n        </button>\n\n    </div>\n\n    <div class="btn-group" style="float:right; width:100%;">\n        <ul class="dropdown-menu dropdown-menu-right" role="menu" style=\'float:right;\'>\n          <li><a class="btn-msg-secondary" value="desktop">Desktop</a></li>\n	      <li><a class="btn-msg-secondary" value="mobile">Mobile</a></li>\n          <li><a class="btn-msg-secondary" value="ehrinbox">EHR Inbox</a></li>\n          <li><a class="btn-msg-secondary" value="off">Off</a></li>\n	    </ul>\n\n        <button type="button" class="btn btn-xs btn-default btn-block msg-secondary-dropdown" data-toggle="dropdown">\n            <span class="msg-secondary-label"><%= notifications[notify_secondary.toLowerCase()] %></span>\n	        <span class="sr-only">Toggle Dropdown</span>\n        </button>\n\n    </div>\n\n</td>'}),define("text!templates/auditRow.html",[],function(){return'<td>\n    <%= date %> GMT\n</td>\n<td>\n    <%= (patient != "NOTVALIDYET") ? patient : ""%>\n</td>\n<td>\n    <%= action %>\n</td>\n<td>\n    <%= (target != "NOTVALIDYET") ? target: "" %>\n</td>\n<td>\n    <%= (device != "NOTVALIDYET") ? device: "" %>\n</td>\n<td>\n    <%= (details != "NOTVALIDYET") ? details: "" %>\n</td>\n\n'}),define("singleRow/auditRow",["jquery","underscore","backbone","text!templates/auditRow.html"],function(e,t,n,i){var a=n.View.extend({tagName:"tr class='audit-row'",template:t.template(i),render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this}});return a}),require(["jquery"],function(e){function t(){"undefined"==typeof this.timeout&&(this.timeout=null);var t=e(this),n=t.data("mousestop"),i=n.delay||e.mousestopDelay;t.bind("mousemove.mousestop",function(){clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.trigger("mousestop")},i)})}function n(){var t=e(this);t.unbind("mousemove.mousestop"),clearTimeout(this.timeout)}e.mousestopDelay=500,e.event.special.mousestop={setup:function(i){e(this).data("mousestop",{delay:i}).bind("mouseenter.mousestop",t).bind("mouseleave.mousestop",n)},teardown:function(){e(this).removeData("mousestop").unbind(".mousestop")}},e.fn.mousestop=function(e,t){return null==t&&(t=e,e=null),arguments.length>0?this.bind("mousestop",e,t):this.trigger("mousestop")}}),define("libs/jquery/jquery-mousestop-event",function(){}),function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(t){}var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},a=n.prototype,o=i.prototype,s=e.FileReaderSync,l=function(e){this.code=this[this.name=e]},r="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),d=r.length,c=e.URL||e.webkitURL||e,h=c.createObjectURL,u=c.revokeObjectURL,p=c,m=e.btoa,g=e.atob,f=e.ArrayBuffer,v=e.Uint8Array,w=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(i.fake=o.fake=!0;d--;)l.prototype[r[d]]=d+1;return c.createObjectURL||(p=e.URL=function(e){var t,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=e,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(t=e.match(w),n.origin=t&&t[1])),n}),p.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):m?t+";base64,"+m(e.data):t+","+encodeURIComponent(e.data)):h?h.call(c,e):void 0},p.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&u&&u.call(c,e)},a.append=function(e){var n=this.data;if(v&&(e instanceof f||e instanceof v)){for(var a="",o=new v(e),r=0,d=o.length;d>r;r++)a+=String.fromCharCode(o[r]);n.push(a)}else if("Blob"===t(e)||"File"===t(e)){if(!s)throw new l("NOT_READABLE_ERR");var c=new s;n.push(c.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&g?n.push(g(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},a.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},a.toString=function(){return"[object BlobBuilder]"},o.slice=function(e,t,n){var a=arguments.length;return 3>a&&(n=null),new i(this.data.slice(e,a>1?t:this.data.length),n,this.encoding)},o.toString=function(){return"[object Blob]"},o.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,t){var i=t?t.type||"":"",a=new n;if(e)for(var o=0,s=e.length;s>o;o++)a.append(e[o]);return a.getBlob(i)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),define("libs/jquery/Blob",function(){});var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in n,a=function(n){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},o=e.webkitRequestFileSystem,s=e.requestFileSystem||o||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},r=0,d=function(t){var n=function(){"string"==typeof t?(e.URL||e.webkitURL||e).revokeObjectURL(t):t.remove()};e.chrome?n():setTimeout(n,10)},c=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var a=e["on"+t[i]];if("function"==typeof a)try{a.call(e,n||e)}catch(o){l(o)}}},h=function(t,l){var h,u,p,m=this,g=t.type,f=!1,v=function(){c(m,["writestart","progress","write","writeend"])},w=function(){(f||!h)&&(h=(e.URL||e.webkitURL||e).createObjectURL(t)),u?u.location.href=h:void 0==e.open(h,"_blank")&&"undefined"!=typeof safari&&(e.location.href=h),m.readyState=m.DONE,v(),d(h)},b=function(e){return function(){return m.readyState!==m.DONE?e.apply(this,arguments):void 0}},y={create:!0,exclusive:!1};m.readyState=m.INIT,l||(l="download"),i?(h=(e.URL||e.webkitURL||e).createObjectURL(t),n.href=h,n.download=l,a(n),m.readyState=m.DONE,v(),d(h)):(e.chrome&&g&&"application/octet-stream"!==g&&(p=t.slice||t.webkitSlice,t=p.call(t,0,t.size,"application/octet-stream"),f=!0),o&&"download"!==l&&(l+=".download"),("application/octet-stream"===g||o)&&(u=e),s?(r+=t.size,s(e.TEMPORARY,r,b(function(e){e.root.getDirectory("saved",y,b(function(e){var n=function(){e.getFile(l,y,b(function(e){e.createWriter(b(function(n){n.onwriteend=function(t){u.location.href=e.toURL(),m.readyState=m.DONE,c(m,"writeend",t),d(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&w()},["writestart","progress","write","abort"].forEach(function(e){n["on"+e]=m["on"+e]}),n.write(t),m.abort=function(){n.abort(),m.readyState=m.DONE},m.readyState=m.WRITING}),w)}),w)};e.getFile(l,{create:!1},b(function(e){e.remove(),n()}),b(function(e){e.code===e.NOT_FOUND_ERR?n():w()}))}),w)}),w)):w())},u=h.prototype;return u.abort=function(){this.readyState=this.DONE,c(this,"abort")},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(e,t){return new h(e,t)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define("libs/jquery/FileSaver.min",[],function(){return saveAs}),define("widgets/auditList",["jquery","underscore","backbone","globalmodels/auditCollection","singleRow/auditRow","globalmodels/contextModel","libs/jquery/jquery-mousestop-event"],function(e,t,n,i,a,o){var s,l=["date","patient","action","target","device","details"],r=n.View.extend({extraData:{},lastHeight:0,first:!0,initialize:function(n){"undefined"!=typeof n.extraData&&(this.extraData=n.extraData),s=new(i.extend({extraData:this.extraData})),this.template=t.template(n.template),this.$el.html(this.template({height:e(window).height()-50+"px"})),s.bind("add",this.addAudit,this),s.bind("reset",this.reset,this),s.bind("sync",this.render,this),this.render("Loading ...");var a=e(".audit-scroll",this.$el);e(a).on("show",function(){s.reset(),s.initialize()})},events:{"scroll .audit-scroll":"handleScroll","click .download-user-audits":"downloadAudits"},showhide:function(){"auditlist"==o.get("page")?this.$el.show():this.$el.hide()},downloadAudits:function(){that=this;var n={};e.extend(n,o.toParams(),this.extraData),e.ajax({url:"/audits",data:e.param(n),success:function(e){require(["libs/jquery/Blob","libs/jquery/FileSaver.min"],function(n,i){var a=[l.join(",")];t.each(e,function(e){a.push('"'+t.map(l,function(t){return e[t].replace(/"/g,"")}).join('","')+'"')});var o=new Blob([a.join("\n")],{type:"data:text/csv;charset=utf-8"});i(o,"audits.csv")})},error:function(){}})},render:function(e){this.$el.html(this.template(this)),this.addAll(e)},addAll:function(t){t&&"string"==typeof t||(t="None available"),this.reset();var n=!1;if(s.length)for(audit in s.models)this.addAudit(s.models[audit]),n=!0;if(n){e(".audittable > thead",this.$el).show(),e(".audit-control-row",this.$el).show(),this.$el.show();var i=e(".audit-scroll",this.$el);setTimeout(function(){var e=i.innerHeight();this.lastHeight!=e&&e<parseInt(i.css("max-height"))?(this.lastHeight=e,s.more()):i.scroll(function(){return i.scrollTop()+i.innerHeight()+100>=i[0].scrollHeight&&s.more(),!1})},500)}else e(".audittable > tbody",this.$el).html('<tr><td colspan="5">'+t+"</td></tr>"),e(".audittable > thead",this.$el).hide(),e(".audit-control-row",this.$el).hide(),this.$el.show()},addAudit:function(t){var n=new a({model:t});e(".audittable",this.$el).append(n.render().el),this.$el.show()},reset:function(){e(".audittable > tbody",this.$el).empty(),this.$el.hide()}});return r}),define("text!templates/auditScroll.html",[],function(){return'\n<div class = "widget-column">\n    <div class="auditlist audit-scroll" style="clear:both;">\n        <div class="auditaccordion">\n            <table class="table table-condensed table-hover audittable">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <thead >\n                <tr>\n                    <th align="left">Date</th>\n                    <th align="left">Patient</th>\n                    <th align="left">Action</th>\n                    <th align="left">User</th>\n                    <th align="left">Device</th>\n                    <th align="left">Details</th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n            </table>\n        </div>\n    </div>\n    <div class="audit-control-row">\n        <!--[if gte IE 10]><!-->\n            <button class="btn btn-default download-user-audits">Download Audits</button>\n        <!--<![endif]-->\n    </div>\n</div>\n'}),define("singleRow/userRow",["jquery","underscore","backbone","text!templates/userRow.html","globalmodels/contextModel","widgets/auditList","text!templates/auditScroll.html","libs/jquery/jquery-mousestop-event","bootstrapswitch"],function(e,t,n,i,a,o,s){var l=n.View.extend({tagName:"tr class='user-row'",template:t.template(i),render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this},updateNotificationPreferences:function(t,n){e.ajax({url:"/update_user_pref",data:e.param(a.toParams())+"&target_user="+this.model.get("user_name")+"&target_customer="+this.model.get("customer_id")+"&notify1="+t+"&notify2="+n,success:function(){e("#save-user-message").html("User Updated!")},error:function(){alert("Could not save user information."),e("#save-user-message").html("Could not save user information.")}})},events:function(){var t=this,n=null,i=!1,l="#mouse-target",r={desktop:"Desktop",mobile:"Mobile",ehrinbox:"EHR Inbox",off:"Off"},d=this.model.get("notify_primary").toLowerCase(),c=this.model.get("notify_secondary").toLowerCase();e(document).ready(function(){e(".toggle-status",t.$el).bootstrapSwitch(),e(t.el).find(".reset-user-password").click(function(){e("#save-user-message").html("&nbsp;"),e.ajax({url:"/reset_password",data:e.param(a.toParams())+"&target_user="+t.model.get("user_name")+"&target_customer="+t.model.get("customer_id")+"&ehr_state="+t.model.get("ehr_state"),success:function(t){""!=t&&alert(t),e("#save-user-message").html("Password Reset!")}})}),e(".toggle-status",t.$el).on("switchChange.bootstrapSwitch",function(n,i){var o="disabled";i&&(o="active"),e.ajax({url:"/update_user",data:e.param(a.toParams())+"&target_user="+t.model.get("user_name")+"&target_customer="+t.model.get("customer_id")+"&state="+o,success:function(t){"TRUE"!=t&&alert(t),e("#save-user-message").html("User Updated!")},error:function(){alert("Sorry, an error occurred. Please try again later"),e(n.target).bootstrapSwitch("toggleState",!0),e("#save-user-message").html("Sorry, an error occurred. Please try again later")}})}),e(".btn-msg-primary",t.$el).click(function(n){d=e(n.target).attr("value"),e(".msg-primary-label",t.$el).html(r[d]),"off"==d?(c="off",e(".msg-secondary-label",t.$el).html("Off"),e(".msg-secondary-dropdown").prop("disabled",!0)):(e(".msg-secondary-dropdown").prop("disabled",!1),d==c&&(c="off",e(".msg-secondary-label",t.$el).html("Off"))),t.updateNotificationPreferences(d,c)}),e(".btn-msg-secondary",t.$el).click(function(n){c=e(n.target).attr("value"),e(".msg-secondary-label",t.$el).html(r[c]),t.updateNotificationPreferences(d,c)}),e(t.el).unbind("click");var h;e(t.el).find(".user-state").click(function(){e("#save-user-message").empty()}),e(t.el).find(".audit-hover").mouseover(function(){n="audit"}),e(t.el).find(".audit-hover").mousestop(500,function(){if(n){e(l).hide();var i={target_customer:t.model.get("customer_id"),target_user:t.model.get("user_name")};auditList=new o({el:e(l),template:s,extraData:i}),auditList.$el[0].style.left=h.pageX+10+"px",auditList.$el[0].style.top=h.pageY-50+"px"}}),e(t.el).find(".audit-hover").mouseleave(function(){n=null,setTimeout(maybeHide,500)}),e(t.el).find(".audit-hover").mousemove(function(e){h=e}),e(l).mouseover(function(){i=!0}),e(l).mouseleave(function(){i=!1,setTimeout(maybeHide,500)}),maybeHide=function(){null!=n||i||(e(l).hide(),i=!1)}})}});return l}),define("text!templates/userScroll.html",[],function(){return'<div class = "widget-column col-sm-12" style="clear: both;">\n\n<div class="row userlist" style="margin: auto; width: 100%; ">\n    <div class="widget-header">\n    <span class="headings title" style="float:left;">Users</span>\n      <button type="button" class="btn btn-default btn-xs refreshButton" data-dismiss="modal" style="margin-left:10px; color: #46ECBD; font-size: 10px;">\n        <span class="glyphicon glyphicon-refresh"></span>\n      </button>\n    </div>\n    <table class="table-condensed table-hover usertable-header" style="width:100%; padding: 0; table-layout: fixed;">\n        <col width="25%">\n        <col width="25%">\n        <col width="14%">\n        <col width="*">\n        <col width="12%">\n        <col width="14%">\n        <thead>\n            <tr>\n                <th align="left">Display Name</th>\n                <!--<th align="left">Profession</th> -->\n                <th align="left">Last Login</th>\n                <th align="left">Status</th>\n                <th align="left">&nbsp;</th>\n                <th align="left">Notifications</th>\n                <th align="left"></th>\n            </tr>\n        </thead>\n    </table>\n    <div class="panel-group useraccordion" style="overflow-y:auto; max-height:500px; width:100%">\n        <table class="table table-condensed table-hover usertable" style="width:100%; padding: 0; table-layout: fixed;">\n            <col width="25%">\n            <col width="25%">\n            <col width="14%">\n            <col width="*">\n            <col width="12%">\n            <col width="14%">\n            <tbody>\n            </tbody>\n        </table>\n    </div>\n    <span id="save-user-message"></span>\n</div>\n\n</div>'}),define("widgets/userList",["jquery","underscore","backbone","globalmodels/userCollection","singleRow/userRow","globalmodels/contextModel","text!templates/userScroll.html"],function(e,t,n,i,a,o,s){var l,r=n.View.extend({extraData:{},initialize:function(n){this.template=t.template("undefined"!=typeof n.template?n.template:s),"undefined"!=typeof n.extraData&&(this.extraData=n.extraData),l=new(i.extend({extraData:this.extraData})),this.$el.html(this.template({height:e(window).height()-50+"px"})),l.bind("add",this.addUser,this),l.bind("reset",this.reset,this),l.bind("sync",this.addAll,this),this.render();var a=e(".useraccordion",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&l.more()}),e(".refreshButton",this.$el).click(function(){e(".usertable > tbody",this.$el).empty(),l.refresh()}),e(".refreshButton",this.$el).hover(function(t){e(t.target).attr("title","Last Refresh: "+l.getLastRefresh())})},events:{"click #save-user-changes":"saveChanges"},saveChanges:function(){},render:function(){this.$el.html(this.template(this)),this.addAll(),e(window).resize(function(){e(".usertable-header").width(e(".usertable",this.$el).width())})},addAll:function(){this.reset();var t=!1;if(l.length)for(user in l.models)this.addUser(l.models[user]),t=!0;l.lastRefresh=new Date;var n=e(".useraccordion",this.$el),i=e(".usertable",this.$el);e(document).ready(function(){setTimeout(function(){e(".usertable-header").width(i.width())},200)}),setTimeout(function(){var e=(n.innerWidth(),n.innerHeight());e>0&&e<parseInt(n.css("max-height"))&&l.more()},500)},addUser:function(t){var n=new a({model:t});e(".usertable").append(n.render().el),this.$el.show(),n.events()},reset:function(){e(".usertable > tbody",this.$el).empty()},refresh:function(){this.reset()}});return r}),define("widgets/encounterSummary",["jquery","underscore","backbone","globalmodels/summaryModel","globalmodels/patientModel","globalmodels/contextModel"],function(e,t,n,i,a,o){var s=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change",this.update,this),o.on("change:page change:patients change:encounter change:startdate change:enddate change:enc_date",this.update,this),a.on("change:name",this.update,this)},update:function(){var t="your patients",n="Through today";o.get("encounter")?(t="encounter",n="Encounter starting "+o.get("enc_date")):(a.get("name")&&(t=a.get("name")),o.get("startdate")&&(n=o.get("enddate")?o.get("startdate")+" to "+o.get("enddate"):"Since "+o.get("startdate"))),e("#datepicker-input").val(n),this.$el.html(this.template(e.extend({},i.attributes,{title:t,encounterdate:n,page:o.get("page")})))}});return s}),define("text!templates/orderRow.html",[],function(){return'<div class = "widget-column col-sm-12">\n    <div class="panel panel-default" style="margin-bottom:4px">\n      <div>\n        <a data-toggle="collapse" data-parent=".orderaccordion" data-target="#collapse<%= viewid %>" class="orderlink" id="order<%= viewid %>">\n          <h4 class="panel-title">\n            <i class="glyphicon glyphicon-chevron-right color-<%= ordertype.toLowerCase() %>">\n          <img title="<%= ordertype %>" src="images/<%= ordertype.toLowerCase() %>-55x55px.jpg" alt="<%= ordertype %>" height="40" width="40">\n          </i>\n              <span class="headings"><%= name %></span>\n              <span class="badge">$<%= cost %></span>\n          </h4>\n        </a>\n      </div>\n      <div id="collapse<%= viewid %>" class="panel-collapse collapse">\n        <div class="panel-body">\n          <div class="row">\n            <div class="col-sm-6">\n              <span class="blue">You Ordered:</span>\n            </div>\n            <div class="col-sm-6">\n              <%= name %> ($<%= cost %>) on <span style="white-space:nowrap"><%= date.substr(0,19) %></span>\n            </div>\n          </div>\n          <div class="row orderalerts" ></div>\n        </div>\n      </div>\n    </div>\n\n</div>\n'}),define("text!templates/alertRow.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="row">\n  <div class="col-sm-12">\n    <div class="alert-type" style="display:inline-block;">\n      <img src="images/<%= alerttype.toLowerCase().replace(\' \',\'-\') %>-29x37.png"><br>\n      <span class="headings title" style="float:left;"><%= alerttype %></span>\n	  <div class="btn-group" style="float:right;">\n        <ul class="dropdown-menu dropdown-menu-right" role="menu" style=\'float:right;\'>\n          <li><a class="dislike_info" value="incorrect">Disagree</a></li>\n	      <li><a class="dislike_info" value="irrelevant">Not Applicable</a></li>\n          <li><a class="dislike_info" value="notuseful">Not Useful</a></li>\n          <li><a class="dislike_info dislike_other" value="other">Other...</a></li>\n          <li style="display:none" class="dislike_text"><textarea class=\'dislike_text_form\' rows="2" cols="25"></textarea></li>\n	    </ul>\n\n        <button type="button" class="btn btn-default btn-sm dislike" data-dismiss="modal" data-toggle="dropdown" style="font-size: 8px;">\n            <span class="glyphicon glyphicon glyphicon-thumbs-down">\n                <%= ((dislikes+likes==0) ? "N/A" : ((dislikes/(likes+dislikes))*100).toFixed(0)+"%") %></span>\n	        <span class="sr-only">Toggle Dropdown</span>\n        </button>\n\n      </div>\n\n      <button type="button" class="btn btn-default btn-sm like" data-dismiss="modal" style="font-size: 8px; float:right;">\n        <span class="glyphicon glyphicon glyphicon-thumbs-up">\n                <%= ((dislikes+likes==0) ? "N/A" : ((likes/(likes+dislikes))*100).toFixed(0)+"%") %></span>\n      </button>\n    </div>\n    <p>\n      <b><%= name %></b>\n      <%= html %> \n      <% if(ruleid) { %>\n      <span>\n	<a style=\'white-space:nowrap\' href=\'javascript:showEvidence("<%= ruleid %>")\'>\n	  Show Evidence >\n	  </a>\n      </span>\n      <% } %>\n    </p>\n    <!--<span class="headings">Impact:</span>\n    <span class="impact">$16</span>-->\n    <hr>\n  </div>\n</div>\n</div>\n'
}),define("singleRow/alertRow",["jquery","underscore","backbone","widgets/evidence","text!templates/alertRow.html","globalmodels/contextModel"],function(e,t,n,i,a,o){showEvidence=function(t){new i({evi:t});e("#evidence-"+t).modal()};var s=n.View.extend({tagName:"div",template:t.template(a),events:{"click .like":"like","click .dislike":"dislike","click .dislike_info":"critique","click .dislike_text":"clickText","keyup .dislike_text":"doentercomment"},render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},like:function(){this.rate("like")},dislike:function(){e(this.el).find(".dislike_text").hide(),this.rate("dislike")},rate:function(t){that=this,e.ajax({url:"/rate_alert",data:e.param(o.toParams())+"&alert_id="+that.model.get("id")+"&category="+that.model.get("alerttype")+"&rule_id="+that.model.get("ruleid")+"&action="+t,success:function(e){console.log(e)}})},critique:function(t){that=this;var n=e(t.target).attr("value");"other"==n?(t.stopPropagation(),e(this.el).find(".dislike_text").is(":visible")?e(this.el).find(".dislike_text").hide():e(this.el).find(".dislike_text").show()):e.ajax({url:"/critique_alert",data:e.param(o.toParams())+"&alert_id="+that.model.get("id")+"&rule_id="+that.model.get("ruleid")+"&category="+that.model.get("alerttype")+"&action_comment="+n,success:function(e){console.log(e)}})},clickText:function(e){e.stopPropagation()},doentercomment:function(e){13==e.keyCode&&(e.preventDefault(),this.addComment())},addComment:function(){var t=e(this.el).find(".dislike_text_form").val();e(this.el).find(".dislike_text_form").val(""),e(this.el).find(".dislike_text").hide(),e(this.el).find(".dropdown-menu").trigger("click"),console.log("Comment: "+t),e.ajax({url:"/critique_alert",data:e.param(o.toParams())+"&rule_id="+that.model.get("ruleid")+"&category="+that.model.get("alerttype")+"&action_comment="+t,success:function(e){console.log(e)}})},clickEvidenceSpan:function(){jQuery.noConflict(),this.evidence=new i({evi:this.model.get("ruleid")})}});return s}),define("singleRow/orderRow",["jquery","underscore","backbone","text!templates/orderRow.html","globalmodels/contextModel","singleRow/alertRow"],function(e,t,n,i,a,o){var s=n.View.extend({tagName:"div",template:t.template(i),render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this},events:function(){var t=this;e(document).ready(function(){e(t.el).unbind("click"),e(t.el).on("click",function(){e(t.el).find(".orderalerts").is(":empty")&&e.ajax({url:"/alerts",data:e.param(a.toParams())+"&order_id="+t.model.get("id"),success:function(n){for(var i=0;i<n.length;i++){var a=new o({model:n[i]});a.render=function(){return e(this.el).html(this.template(this.model)),this},e(t.el).find(".orderalerts").append(a.render().el)}}})})})}});return s}),define("widgets/orderList",["jquery","underscore","backbone","globalmodels/orderCollection","singleRow/orderRow"],function(e,t,n,i,a){var o=n.View.extend({initialize:function(n){this.typeFilter=n.typeFilter,this.template=t.template(n.template),this.$el.html(this.template({height:e(window).height()-50+"px"})),i.bind("add",this.addOrder,this),i.bind("reset",this.reset,this),i.bind("sync",this.addAll,this),this.render();var a=e(".orderaccordion",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&i.more()})},render:function(){this.$el.html(this.template(this)),this.addAll()},addAll:function(){this.reset();var t=this.typeFilter,n=!1;if(i.length)for(order in i.models)t&&i.models[order].get("ordertype")!=t||(this.addOrder(i.models[order]),n=!0);n?this.$el.show():this.$el.hide();var a=e(".orderaccordion",this.$el);setTimeout(function(){var e=a.innerHeight();e>0&&e<parseInt(a.css("max-height"))&&i.more()},500)},addOrder:function(t){var n=new a({model:t});e(".orderaccordion",this.$el).append(n.render().el),this.$el.show(),n.events()},reset:function(){e(".orderaccordion",this.$el).empty(),this.$el.hide()}});return o}),define("widgets/costtable",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/spendingModel","globalmodels/summaryModel","widgets/orderList","libs/jquery/jquery-mousestop-event"],function(e,t,n,i,a,o,s){var l=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.$el.html(this.template({page:i.get("page")})),o.on("change",this.update,this),a.on("change",this.update,this),this.update()},events:{"click .progress-bar":"handleClick"},update:function(){var t=null;if(!("title"in a.changed)){"date"in a.changed&&(t=a.changed.date);var n=[],i=[],l=a.getGathered();for(var r in l)i.push({order:r,cost:l[r],color:findColor(r)}),n.push(findColor(r));e("#order-table-1").empty(),e("#order-table-2").empty(),e(".progress").empty();var d,c=null,h=!1,u=!0;i.forEach(function(t){var n=e("<img>").attr("src","../images/"+t.order.toLowerCase()+"-55x55px.jpg"),i=e('<span class="cost-num">$'+t.cost+"</span>"),a=e("<span>"+t.order+"</span>"),s=e("<div>").attr("class","row"),l=e("<div>").attr("class","col-sm-2");s.mouseover(function(){c=t.order}),s.mouseleave(function(){c=null,setTimeout(d,500)}),e("<div>").attr("class","col-sm-3").append(n).appendTo(s),e(l).append(e("<div>").attr("class","row").append(i)).appendTo(s),e(l).append(e("<div>").attr("class","row").append(a)).appendTo(s),u?(e("#order-table-1").append(s),u=!1):(e("#order-table-2").append(s),u=!0);var r=(t.cost/o.get("spending")*100).toFixed(2);e(".progress").append(e('<div id="'+t.order+'" class="progress-bar bgcolor-'+t.order.toLowerCase()+'">').attr("style","width: "+r+"%").append(Math.round(r)+"%"))});var p,m=new s({template:'<div class="panel-group orderaccordion"> </div>',el:e("#mouse-target"),typeFilter:"doesnotexist",title:null});d=function(){null!=c||h||(m.title=null,m.$el.hide(),m.typeFilter="does not exist",h=!1)},e(m.el).mouseover(function(){h=!0}),e(m.el).mouseleave(function(){h=!1,setTimeout(d,500)}),e(this.el).mousemove(function(e){p=e}),e(this.el).mousestop(1e3,function(){c&&(m.$el[0].style.left=p.pageX+10+"px",m.$el[0].style.top=p.pageY-50+"px",c!=m.title&&(m.slice=c,m.typeFilter=c,m.addAll()))})}},handleClick:function(t){var n=e(t.currentTarget);console.log(n.attr("id"))}});return l}),define("text!templates/customerRow.html",[],function(){return'<td>\n    <%= customer_id %>\n    <input class="customer-id-row" type="hidden" value="<%= customer_id %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= name %></div>\n    <input class="customer-name-row customer-row-edit" type="text" value="<%= (name.trim && name.trim()) || name %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= abbr %></div>\n    <input class="customer-abbr-row customer-row-edit" type="text" value="<%= abbr %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= license_exp %></div>\n    <input class="customer-license-exp-row customer-row-edit" type="text" value="<%= license_exp %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= license_type %></div>\n    <input class="customer-license-num-row customer-row-edit" type="text" value="<%= license_type %>">\n</td>\n<td>\n    <a class="customer-info-click hover-link">\n        View Info\n    </a>\n</td>\n'}),define("text!templates/widgetModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="widget-modal" class="modal fade" role="dialog" aria-hidden="true">\n        <div class="modal-dialog modal-dialog-lg">\n            <div class="modal-content">\n            </div>\n        </div>\n    </div>\n</div>'}),define("widgets/widgetModal",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/widgetModal.html","widgets/userList"],function(e,t,n,i,a){var o=n.View.extend({el:e("#modal-target"),template:t.template(a),widgetList:[],extraData:{},initialize:function(e){this.widgetList=e.widgetList},events:{},render:function(t){this.$el.html(this.template()),e("#widget-modal").modal({show:"true"});for(var n=0;n<this.widgetList.length;n++){e("#widget-modal").find(".modal-content").append("<div class='row content-row'></div>");var i=e("#widget-modal").find(".row").last(),a={el:i};e.extend(a,t);{new this.widgetList[n](a)}}e(document).ready(function(){e("button",this.$el).click(function(e){e.stopPropagation()})})}});return o}),define("text!templates/adminSettings.html",[],function(){return'<div class="page-header">\n    <h1>\n        Admin Settings\n        <small>\n            <i class="ace-icon fa fa-angle-double-right"></i>\n            EHR Integration Settings\n        </small>\n    </h1>\n</div>\n\n\n<div class = "widget-column col-sm-12" style="clear: both;">\n    <span class="headings title">EHR Integration Settings</span>\n    <div class="panel-body admin-settings">\n        <div class="col-md-12">\n            <div class="row">\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Unity Server Address:</div>\n                        <div style=\'float:left\'>\n                            <% var disabled = "";\n			                   if (typeof EHRURL !== "undefined")\n                               {\n                                    disabled = "disabled";\n                                    DISP_URL = EHRURL.replace("http://","").replace("https://","");\n                               }\n                            %>\n                            <select id=\'httphttps\' class=\'form-control\' <%= disabled %>>\n                                <option class=\'form-control\'\n                                    value=\'https://\' <%= (typeof EHRURL !== \'undefined\') ? (EHRURL.indexOf("https://") > -1) ? \'selected\' : \'\' : \'\'%>>https://\n                                </option>\n                                <option class=\'form-control\'\n                                    value=\'http://\' <%= (typeof EHRURL !== \'undefined\') ? (EHRURL.indexOf("https://") == -1) ? \'selected\' : \'\' : \'\' %>>http://\n                                </option>\n                          </select>\n                        </div>\n                        <div style=\'float:left; margin-bottom:10px;\'>\n                            <input id="admin-ip-input" type="text" class=\'form-control\'  <%= disabled %>\n                            <%= (typeof DISP_URL !== \'undefined\') ? "value=\'"+DISP_URL+"\' disabled" : "value=\'192.237.182.238\'" %>\n                            title=\'This url typically ends in /UnityService.svc\'>\n                        </div>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">App Name:</div>\n                        <input id="admin-name-input" class=\'form-control\' type="text" <%= disabled %>\n                            <%= (typeof EHRAppName !== \'undefined\') ? "value=\'"+EHRAppName+"\'" : "value=\'MavenPathways.TestApp\'" %>>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Service User:</div>\n                        <input id="admin-username-input" class=\'form-control\' type="text" <%= disabled %>\n                            <%= (typeof EHRServiceUser !== \'undefined\') ? "value=\'"+EHRServiceUser+"\' disabled" : "value=\'MavenPathways\'" %>>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n		      <div class="col-sm-6">\n                <div class="span3">EHR Integration:</div>\n		      </div>\n		      <div class="col-sm-6">\n                  <div style="width:50%;">\n                    <input id="admin-ehr-disable" type="checkbox" data-on-text="On" data-off-text="Off" data-size="small" <%= disabled %>\n                        <%= (typeof EHRDisabled !== \'undefined\' && EHRDisabled) ? "" : "checked" %>>\n                  </div>\n			</div>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row" style=\'margin-bottom:10px;\'>\n                        <div class="span3">App Password:</div>\n                        <input id="admin-pw-input" class=\'form-control\' type="password" <%= disabled %>>\n                    </div>\n                </div>\n                <br/>\n            </div>\n            <div class="row">\n                <div class="col-sm-6">\n                    <div id="admin-setup-message" class="span3">&nbsp;</div>\n                </div>\n                <div class="col-sm-6">\n                    <div style=\'float:right\'>\n                        <button class="btn btn-default btn-xs unlock-admin-button">Edit EHR Settings</button>\n                        <button class="btn btn-default btn-xs lock-admin-button" style="display: none;">Lock EHR Settings</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <span class="headings title">Connection Settings</span>\n    <div class="panel-body admin-settings">\n        <div class="col-md-12">\n            <div class="row">\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Polling Interval (seconds):</div>\n                        <input id="admin-polling-input" class=\'time-input form-control\' type="text"\n                               value="<%= (typeof EHRPolling !== \'undefined\') ? EHRPolling : \'30\'%>">\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Login Inactivity Timeout (minutes):</div>\n                        <input id="admin-timeout-input" class=\'time-input form-control\' type="text"\n                               value="<%= (typeof UserTimeout !== \'undefined\') ? UserTimeout : \'120\'%>">\n                    </div>\n                </div>\n            </div>\n            <div class="save-settings-row row">\n                <div class="col-sm-6">\n                    <div id="save-admin-message" class="span3" >&nbsp;</div>\n                </div>\n                <div class="col-sm-6">\n                    <div style=\'float:right\'>\n                        <button class="btn btn-default setup-admin-button">Save Changes</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("widgets/adminSettings",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/userCollection","text!templates/adminSettings.html","bootstrapswitch"],function(e,t,n,i,a,o){var s=n.Model.extend({url:"/customer_info"}),l=n.View.extend({model:null,extraData:{},initialize:function(n){this.model=new s,this.template=t.template("undefined"!=typeof n.template?n.template:o),"undefined"!=typeof n.extraData&&(this.extraData=n.extraData);var a={};e.extend(a,i.toParams(),this.extraData),this.model.fetch({data:e.param(a)}),this.model.on("change",this.render,this)},events:{"click .setup-admin-button":"adminSetup","click .unlock-admin-button":"unlockSettings","click .lock-admin-button":"lockSettings","change #httphttps":"httphttps"},httphttps:function(){"http://"==e("#httphttps").find(":selected").text()&&alert("Http connections are inherently insecure and must not be used with operational systems.  This option is only for test, or demo systems without any ePHI only.")},activateEHR:function(){e("#admin-ehr-disable").bootstrapSwitch("state",!0,!0)},unlockSettings:function(){e("#admin-ip-input").prop("disabled",!1),e("#admin-name-input").prop("disabled",!1),e("#admin-username-input").prop("disabled",!1),e("#admin-pw-input").prop("disabled",!1),e("#httphttps").prop("disabled",!1),e("#admin-ehr-disable").bootstrapSwitch("toggleDisabled"),e("#admin-pw-input").val(""),e(".lock-admin-button").show(),e(".unlock-admin-button").hide()},lockSettings:function(){e("#admin-ip-input").prop("disabled",!0),e("#admin-name-input").prop("disabled",!0),e("#admin-username-input").prop("disabled",!0),e("#admin-pw-input").prop("disabled",!0),e("#httphttps").prop("disabled",!0),e("#admin-ehr-disable").bootstrapSwitch("toggleDisabled"),e("#admin-pw-input").val("password"),e(".lock-admin-button").hide(),e(".unlock-admin-button").show()},adminSetup:function(){var n=e("#admin-ip-input").val(),o=e("#admin-name-input").val(),s=e("#admin-pw-input").val(),l=e("#admin-polling-input").val(),r=e("#admin-timeout-input").val(),d=e("#admin-username-input").val(),c=!e("#admin-ehr-disable").is(":checked"),h=e(".lock-admin-button").is(":visible"),u=new RegExp("^[0]*[1-9]+[0]*$");if(u.test(l))if(u.test(r))if(h&&""==n)e("#save-admin-message").html("Please enter a Unity URL");else if(h&&""==s)e("#save-admin-message").html("Please enter the password");else{var p,m=e("#httphttps").find(":selected").text();h||!this.model.attributes.settings?(console.log("loading from fields"),p={EHRURL:e.trim(m)+e.trim(n),EHRAppName:o,EHRPassword:s,EHRServiceUser:d,EHRPolling:l,UserTimeout:r,EHRDisabled:c}):(console.log("loading from ",this.model.attributes.settings),p=t.clone(this.model.attributes.settings),t.extend(p,{EHRPolling:l,UserTimeout:r,locked:"locked"}));var g={};e.extend(g,i.toParams(),this.extraData),that=this,e.ajax({type:"POST",dataType:"json",url:"/setup_customer?"+e.param(g),data:JSON.stringify(p),success:function(){e("#save-admin-message").html("Settings saved!"),alert(h||!that.model.attributes.settings?"Success! Connection to EHR established.":"Connection settings saved!"),a.refresh(),setTimeout(a.refresh,7e3)},error:function(t){alert("The server could NOT successfully connect using this configuration.  "+t.responseJSON),e("#save-admin-message").html("&nbsp;")}})}else e("#save-admin-message").html("Please enter a valid number for the timeout");else e("#save-admin-message").html("Please enter a valid number for the polling interval")},render:function(){if(this.model.attributes.settings||(this.model.attributes.settings={}),"undefined"!==this.extraData.target_customer){if(0==this.extraData.target_customer)return void this.$el.hide();this.model.attributes.settings.target_customer=this.extraData.target_customer}return this.$el.html(this.template(this.model.attributes.settings)),e(document).ready(function(){e("#admin-ehr-disable",this.$el).bootstrapSwitch()}),this}});return l}),define("singleRow/customerRow",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/customerRow.html","widgets/widgetModal","widgets/userList","widgets/adminSettings"],function(e,t,n,i,a,o,s,l){var r=n.View.extend({tagName:"tr class='customer-row'",template:t.template(a),render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},events:function(){var t=this;e(document).ready(function(){e(t.el).unbind("click"),e(t.el).on("click",function(n){if(e(".customer-row > td").each(function(){e(this).find(".customer-row-val").html(e(this).find(".customer-row-edit").val())}),e(".customer-row-edit").hide(),e(".customer-row-val").show(),e(".customer-info-click",this.$el).is(n.target)||0!==e(".customer-info-click",this.$el).has(n.target).length){var i=new o({widgetList:[l,s]});i.render({extraData:{target_customer:t.model.attributes.customer_id}})}else e(t.el).find(".customer-row-val").hide(),e(t.el).find(".customer-row-edit").each(function(){e(this).width(e(this).parent().width()-5),e(this).show()})})})}});return r}),define("widgets/customerList",["jquery","underscore","backbone","globalmodels/customerCollection","singleRow/customerRow","globalmodels/contextModel","globalmodels/sidebarModel"],function(e,t,n,i,a,o,s){var l=n.View.extend({initialize:function(n){this.typeFilter=n.typeFilter,this.template=t.template(n.template),this.$el.html(this.template({height:e(window).height()-50+"px"})),i.bind("add",this.addCustomer,this),i.bind("reset",this.reset,this),i.bind("sync",this.addAll,this),this.render();var a=e(".customeraccordion",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&i.more()}),e(document).click(function(t){var n=e(this).find("tbody");n.is(t.target)||0!==n.has(t.target).length||e(".customer-row > td").each(function(){e(this).find(".customer-row-val").html(e(this).find(".customer-row-edit").val()),e(".customer-row-edit").hide(),e(".customer-row-val").show()})}),e(".refreshButton",this.$el).click(function(){e(".customertable > tbody",this.$el).empty(),i.refresh()}),e(".refreshButton",this.$el).hover(function(t){e(t.target).attr("title","Last Refresh: "+i.getLastRefresh())}),s.addOption("Customers"),this.showhide(),o.on("change:page",this.showhide,this)},events:{"click #save-customer-changes":"saveChanges","click document":"hideEdits"},showhide:function(){"customers"==o.get("page")?this.$el.show():this.$el.hide()},hideEdits:function(){},saveChanges:function(){that=this,e(".customer-row").each(function(){var t=e(this).find(".customer-id-row").val(),n=e(this).find(".customer-name-row").val(),i=e(this).find(".customer-abbr-row").val(),a=e(this).find(".customer-license-exp-row").val(),s=e(this).find(".customer-license-num-row").val();e.ajax({url:"/update_customer",data:e.param(o.toParams())+"&target_customer="+t+"&name="+n+"&abbr="+i+"&license="+s+"&license_exp="+a,success:function(){}}),e("#save-customer-message").html("Customer settings saved!")})},render:function(){this.$el.html(this.template(this)),this.addAll()},addAll:function(){this.reset();var t=(this.typeFilter,!1);if(i.length)for(customer in i.models)this.addCustomer(i.models[customer]),t=!0;t?this.$el.show():this.$el.hide(),i.lastRefresh=new Date;var n=e(".customeraccordion",this.$el);setTimeout(function(){var e=n.innerHeight();e>0&&e<parseInt(n.css("max-height"))&&i.more()},500)},addCustomer:function(t){var n=new a({model:t});e(".customertable").append(n.render().el),this.$el.show(),n.events()},reset:function(){e(".customertable > tbody",this.$el).empty(),this.$el.hide()}});return l}),define("widgets/costdonut",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/spendingModel","widgets/orderList","libs/jquery/jquery-mousestop-event"],function(e,t,n,i,a,o){var s=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.$el.html(this.template({page:i.get("page")})),a.on("change",this.update,this),this.update()},update:function(){var t=null;if(!("typeFilter"in a.changed)){"dateFilter"in a.changed?(t=a.changed.dateFilter,e("#costbd-restriction")[0].innerHTML="Only spending on <i><b>"+t.toDateString()+"</b></i>"):e("#costbd-restriction")[0].innerHTML="";var n=[],i=[],s=a.getGathered();for(var l in s)i.push({order:l,cost:s[l]}),n.push(findColor(l));var r=AmCharts.makeChart("cost-bd",{type:"pie",colors:n,dataProvider:i,titleField:"order",valueField:"cost",labelRadius:5,pullOutOnlyOne:!0,radius:"25%",innerRadius:"60%",labelText:"[[title]]: $[[value]]",balloonText:"[[title]]<br>$[[value]]<br>[[percents]]%"});r.addListener("pullOutSlice",function(e){a.clickType(e.dataItem.title)},a),r.addListener("pullInSlice",function(){a.clickType("")},a);var d,c=null,h=!1,u=new o({template:'<div class="panel-group orderaccordion"> </div>',el:e("#mouse-target"),typeFilter:"doesnotexist",slice:null}),p=function(){null!=c||h||(u.slice=null,u.$el.hide(),u.typeFilter="does not exist",h=!1)};r.addListener("rollOverSlice",function(e){c=e.dataItem}),r.addListener("rollOutSlice",function(){c=null,setTimeout(p,500)}),e(u.el).mouseover(function(){h=!0}),e(u.el).mouseleave(function(){h=!1,setTimeout(p,500)}),e(this.el).mousemove(function(e){d=e}),e(this.el).mousestop(1e3,function(){c&&(u.$el[0].style.left=d.pageX+10+"px",u.$el[0].style.top=d.pageY-50+"px",c!=u.slice&&(u.slice=c,u.typeFilter=c.title,u.addAll()))}),r.invalidateSize()}}});return s}),define("widgets/patientInfo",["jquery","underscore","backbone","globalmodels/patientModel","globalmodels/contextModel"],function(e,t,n,i,a){var o=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change",this.update,this),a.on("change:page",function(){"pathway"==a.get("page")?this.update(i):this.$el.hide()},this)},update:function(){i.get("id")&&"pathway"==a.get("page")?(this.$el.html(this.template(i.attributes)),this.$el.show()):this.$el.hide()}});return o}),define("widgets/alertList",["jquery","underscore","backbone","globalmodels/alertCollection","singleRow/alertRow"],function(e,t,n,i,a){var o=n.View.extend({initialize:function(n){this.template=t.template(n.template),this.$el.html(this.template({height:e(window).height()-50+"px"})),i.bind("add",this.addAlert,this),i.bind("reset",this.reset,this),i.bind("sync",this.addAll,this),this.addAll();var a=e(".alertlist",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&i.more()})},addAlert:function(t){var n=new a({model:t});e("#alertaccordion").append(n.render().el)},addAll:function(){this.reset();for(alert in i.models)this.addAlert(i.models[alert]);var t=e(".alertlist",this.$el);setTimeout(function(){var e=t.innerHeight();e>0&&e<parseInt(t.css("max-height"))&&i.more()},500)},reset:function(){e("#alertaccordion").empty()}});return o}),define("widgets/spend_histogram",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/histogramModel","amchartsserial"],function(e,t,n,i,a){var o=["diagnosis","admission","discharge","spending"],s=n.View.extend({initialize:function(e){this.template=t.template(e.template),a.on("change",this.update,this),i.on("change:page",this.update,this),this.update()},events:{"click #histogram-download":"downloadhist"},downloadhist:function(){var e=["data:text/csv;charset=utf-8,"+o.join(",")];t.each(a.attributes,function(n){e.push('"'+t.map(o,function(e){return n[e]}).join('","')+'"')}),window.open(encodeURI(e.join("\n")))},update:function(){if(a.get(0)&&"home"==i.get("page")){this.$el.html(this.template(i.attributes));var e=t.pluck(a.attributes,"spending"),n=t.max(e),o=t.min(e);this.binwidth||(this.binwidth=100*Math.floor((n-o)/1e3),this.binwidth||(this.binwidth=1e3));for(var s=this.binwidth,l=s*Math.floor(o/s),r=[],d=Math.floor((n-o)/s);d>=0;d--)r[d]=0;t.each(e,function(e){var t=Math.floor((e-l)/s);r[t]++}),r=t.map(r,function(e,t){var n=l+s*t;return{center:n+"-"+(n+s),value:e}});var c=AmCharts.makeChart("spend-histogram",{type:"serial",categoryField:"center",autoMarginOffset:40,marginRight:60,marginTop:60,startDuration:1,fontSize:13,theme:"light",categoryAxis:{gridPosition:"start",labelRotation:45},graphs:[{type:"column",valueField:"value",fillAlphas:1,id:"AmGraph-1",labelText:"",title:"graph 1"}],valueAxes:[{id:"ValueAxis-1",title:"Encounters",integersOnly:!0}],dataProvider:r});this.$el.show(),c.invalidateSize()}else this.$el.hide()}});return s}),define("widgets/maveninfo",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext"],function(e,t,n,i,a,o){var s=n.View.extend({initialize:function(e){this.template=t.template(e.template),o.on("propagate",this.render,this),i.on("change:page change:pathid",this.hidePopup,this)},showhide:function(){this.$el.show()},events:{"click button.close":"hidePopup"},render:function(){if(!o.get("selectedNode"))return void this.hidePopup();if(o.get("selectedNode")!=this.selectedNode)if("undefined"!=typeof o.get("selectedNode")){o.get("selectedNode").attributes.sidePanelText&&!o.get("selectedNode").attributes.isProtocol?(this.hidePopup(),this.selectedNode=o.get("selectedNode"),this.$el.html(this.template(o.get("selectedNode").attributes)),this.showPopup()):this.hidePopup()}else this.hidePopup()},hidePopup:function(){this.$el.hide(),this.selectedNode=o.get("selectedNode")},showPopup:function(){e("#side-popup").css("top","none"),e("#side-popup").css("left","none"),e("#side-popup").css("bottom",5),e("#side-popup").css("right",11),this.$el.show(1e3)}});return s}),define("widgets/pathway",["jquery","underscore","backbone","jsplumb","globalmodels/contextModel","globalmodels/sidebarModel"],function(e,t,n,i,a,o){var s=n.View.extend({initialize:function(n){t.bindAll(this,"render","drawTree","showFirstchild","expandAll","suggested"),this.template=t.template(n.template),this.$el.html(this.template()),console.log("pathway ini"),o.addOption("Pathways"),this.showhide(),a.on("change:page",this.showhide,this),setTimeout(t.bind(this.showFirstchild,this),1e3),e('span[data-toggle="tooltip"]').tooltip({animated:"fade",placement:"left",container:"body"}),i.importDefaults({container:"#pathway-container",MaxConnections:-1,Endpoint:"Blank",PaintStyle:{lineWidth:2,strokeStyle:"#ccc"},HoverPaintStyle:{lineWidth:3,strokeStyle:"#61B7CF"},DragOptions:{cursor:"crosshair"},Endpoints:[["Dot",{radius:1}],["Dot",{radius:1}]],EndpointStyles:[{fillStyle:"#ccc"},{fillStyle:"#ccc"}],Connector:["Flowchart",{cornerRadius:3}],Anchors:["Bottom","Top"]}),e("#pathway-container").draggable(),e("#pathway-container").on("wheel",function(t){t.preventDefault();var n=/scale\((.*)\)/,i=e("#pathway-container")[0].style.transform,a=n.exec(i);if(console.log(a),t.originalEvent.deltaY>0)var o=a[1]-.05;else var o=a[1]-0+.05;var s="scale("+o+")";e("#pathway-container").css({transform:s})})},events:{"click button#copybutton":"copyIndex","click .qualifier":"toggleChildren","click button#expandAll":"expandAll","click button#sugPath":"suggested"},showhide:function(){"pathways"==a.get("page")?this.$el.show():this.$el.hide()},render:function(){},copyIndex:function(){e("<div>").attr("id","copiedText").appendTo("body"),e("#copiedText").text("In summary, the patient is a 54-year-old man with symptomatic mCRPC and good performance status (ECOG 0-1) who has not received prior docetaxel therapy. \r\n   - This is evidenced by rising PSA in the setting of castrate testosterone levels.\r\n   - Prior radiographic imaging has confirmed metastasis.\r\n   - Symptoms that are attributable to the metastatic diseaseburden include:\r\n    [[[SYMPTOMS]]]\r\nManagement Plan:\r\nPer AUA guidelines*, The patient will receive\r\n   - Docetaxel therapy\r\n   - Abiraterone + prednisone\r\n   [[[OR Since the patient cannot receive the standardtretatment, he was offered ketoconazole + steroid,mitoxantrone or radionuclide therapy]]]\r\n \r\n*Index Patient 3 - http://www.auanet.org/education/guidelines/castration-resistant-prostate-cancer.cfm"),e("#toast").css("visibility","visible"),setTimeout(function(){e("#toast").fadeOut("slow",function(){})},2e3)},toggleChildren:function(t){var n=t.currentTarget.parentNode;e(".children",n).first().toggle(),this.drawTree()},drawTree:function(){i.reset();var t=e(".qualifier");if(e.each(t,function(t,n){var a=i.addEndpoint(n,{anchor:"Bottom"}),o=n.parentNode,s=e(".children",o).first();if(s[0]){var l=s[0].children;e.each(l,function(t,o){var s=e(".qualifier",o).first(),l=i.addEndpoint(s,{anchor:"Top"});e(n).is(":visible")&&e(s).is(":visible")&&i.connect({source:a,target:l})})}}),e("#gp").is(":visible")&&e("#i3").is(":visible")){var n=i.addEndpoint(e("#gp"),{anchor:"Bottom"}),a=i.addEndpoint(e("#i3"),{anchor:"Top"});i.connect({source:n,target:a})}},showFirstchild:function(){e("#n1").click()},suggested:function(){console.log("suggested"),e(".suggested").css({border:"2px solid orange"})},expandAll:function(){console.log("expandAll"),e("#n1").click(),e(".children").toggle(),this.drawTree(),e(".suggested").css({border:"2px solid #46bdec"}),e("#pathway-container").css({"-webkit-transform":"scale(0.75)","-moz-transform":"scale(0.75)","-ms-transform":"scale(0.75)","-o-transform":"scale(0.75)",transform:"scale(0.75)"})}});return s}),define("widgets/datepicker-chart",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/histogramModel"],function(e,t,n,i,a){var o=n.View.extend({initialize:function(e){this.template=t.template(e.template),a.on("change",this.update,this),i.on("change page",this.update,this),this.$el.html(this.template(this)),this.update()},update:function(){var t=[];
for(var i in a.attributes){var o=a.attributes[i];t.push(o)}var s=AmCharts.makeChart("datepicker-chart",{type:"serial",theme:"light",dataDateFormat:"YYYY-MM-DD",pathToImages:"http://cdn.amcharts.com/lib/3/images/",categoryField:"admission",startDuration:1,categoryAxis:{gridPosition:"start"},chartCursor:{},chartScrollbar:{},trendLines:[],graphs:[{fillAlphas:1,id:"AmGraph-1",title:"graph 1",type:"column",valueField:"spending",balloonText:"[[diagnosis]] <br /><b>$[[value]]</b>"}],guides:[],valueAxes:[{id:"ValueAxis-1",title:"Spending"}],allLabels:[],balloon:{},chartScrollbar:{graph:"AmGraph-1",scrollbarHeight:20},dataProvider:t,periodSelector:{position:"left",periods:[{period:"MM",selected:!0,count:1,label:"1 month"},{period:"YYYY",count:1,label:"1 year"},{period:"YTD",label:"YTD"},{period:"MAX",label:"MAX"}]}});s.addListener("clickGraphItem",function(t){var i,a=t.item.dataContext;i="episode/"+a.encounterid+"/",i+="patient/"+a.patientid+"/",i+=a.admission,n.history.navigate(i,!0),e("#datepicker-modal").modal("hide")}),e("#datepicker-modal").on("shown.bs.modal",function(){s.invalidateSize()})}});return o}),define("widgets/topBanner",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change:display change:page",this.update,this)},update:function(){this.$el.html(this.template(i.attributes))},events:{"click #settings_button":"handle_settings","click #profile_button":"handle_profile","click #pathway_button":"handel_pathway","click #pathwayEditor_button":"handel_pathwayEditor"},handel_pathway:function(){e("#pathwayName").html(""),n.history.navigate("pathway/"+i.get("pathid")+"/node/"+i.get("code"),{trigger:!0})},handel_pathwayEditor:function(){n.history.navigate("pathwayeditor/"+i.get("pathid")+"/node/"+i.get("code"),!0)},handle_profile:function(){e("#profile-modal").modal({show:"true"})},handle_settings:function(){e("#settings-modal").modal({show:"true"})}});return a}),define("text!templates/pathway/toolbar.html",[],function(){return'<ul class="nav nav-list">\n    <li class="hover" id="newpath-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  New Pathway\n			 </span>\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <li class="hover">\n\n        <a href="javascript:void(0)">\n\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n\n			 <span class="menu-text">\n			  Import Pathway\n			 </span>\n\n            <input id=\'browser\' type="file" accept=\'.pathway\'>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <li class="hover" id="exportpath-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Export Pathway\n			 </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <li class="hover" id="trigger-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Edit Triggers\n			 </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <li class="hover" id="copypath-button">\n        <a href="javascript:void(0)" class="disabled">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Copy Pathway\n			 </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <% if (treeNode) { %>\n\n    <li class="hover" id="editNode-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Edit Selected Node\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <li class="hover" id="deleteNodeButton">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Delete Selected Node\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n     <li class="hover" id="addChildButton">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newChild.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Add Child\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n        <% if (treeNode.children && treeNode.children.length == 0){%>\n             <li class="hover" id="addProtocolButton">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newProtocole.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Add Protocol\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n        </li>\n        <% } %>\n\n          <% if ((treeNode.children && treeNode.children.length > 0)||treeNode.protocol) {%>\n<li class="hover" id="collapseButton">\n        <a href="javascript:void(0)">\n            <% if (childrenHidden){%>\n            <i class="menu-icon">\n                <img src="../images/temp/expand.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Expand Node\n             </span>\n            <%}else{%>\n            <i class="menu-icon">\n                <img src="../images/temp/collapse.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Collapse Node\n             </span>\n            <%}%>\n        </a>\n        <b class="arrow"></b>\n    </li>\n        <% } %>\n\n    <% } %>\n</ul>\n\n\n\n\n\n\n\n'}),define("widgets/pathway/toolbar.js",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/pathwayCollection","pathway/models/treeModel","pathway/models/treeContext","pathway/modalViews/newPathway","pathway/modalViews/editNode","pathway/modalViews/nodeEditor","pathway/modalViews/protocolEditor","pathway/modalViews/DeleteDialog","pathway/modalViews/ruleWizard","pathway/singleRows/pathRow","pathway/internalViews/treeNodeActionSet","text!templates/pathway/pathwayListEntry.html","text!templates/pathway/toolbar.html"],function(e,t,n,i,o,s,l,r,d,c,h,u,p,m,g,f,v){var w=function(e,t,n){require(["libs/jquery/Blob","libs/jquery/FileSaver.min"],function(i,a){var o=new Blob([e],{type:n});a(o,t)})},b=n.View.extend({template:t.template(v),events:{"click #newpath-button":"handle_newPath","click #trigger-button":"addTrigger","change .btn-file :file":"importPath","click #mvn-importpath-btn":"importPath","click #exportpath-button":"exportPath","click #copypath-button":"handle_copyPath","click #editNode-button":"editNode","click #deleteNodeButton":"deleteNode","click #addChildButton":"addChild","click #addProtocolButton":"addProtocol","click #collapseButton":"expandCollapse","click #testButton":"handleTest"},handleTest:function(){s.changeNodePosition(l.get("selectedNode"),-1)},initialize:function(){if(l.get("selectedNode")){var e=l.get("selectedNode");this.$el.html(this.template({treeNode:e.attributes,childrenHidden:e.childrenHidden&&e.childrenHidden(),page:i.get("page")}))}else this.$el.html(this.template({treeNode:null,childrenHidden:null,page:i.get("page")}));i.on("change:page",this.showhide,this),this.showhide(),l.on("propagate",this.renderActions,this),this.renderActions()},showhide:function(){"pathEditor"==i.get("page")?this.$el.show():this.$el.hide()},addTrigger:function(){e("#modal-target").empty(),e("#detailed-trigger-modal").empty(),a=new p({el:"#modal-target"})},renderActions:function(){if(l.get("selectedNode")){var e=l.get("selectedNode");this.$el.html(this.template({treeNode:e.attributes,childrenHidden:e.childrenHidden&&e.childrenHidden(),page:i.get("page")}))}},renderPathList:function(){e("#avail-paths").html(""),t.each(o.models,function(t){var n=new m({model:t});e("#avail-paths").append(n.render().$el)},this)},handle_newPath:function(e){e.preventDefault(),a=new r({el:"#modal-target"})},handle_copyPath:function(){e.ajax({type:"GET",url:"/pathway_version?"+e.param(i.toParams()),dataType:"json",success:function(){o.addNewPath()}})},importPath:function(){var t=e(".btn-file :file");if(file=t.get(0).files[0]){var n=new FileReader;n.readAsText(file,"UTF-8"),n.onload=function(e){try{var t=JSON.parse(e.target.result);s.loadNewPathway(t,{toImport:!0})}catch(n){alert("The format of the file doesn't match Pathway format. Please try another file")}},n.onerror=function(){alert("error reading file")},t.wrap("<form>").closest("form").get(0).reset(),t.unwrap()}},exportPath:function(){w(JSON.stringify(s.toJSON({toExport:!0})),s.get("name")+".pathway","text/plain")},addChild:function(){new c(l.get("selectedNode"))},addProtocol:function(){new h(l.get("selectedNode"))},expandCollapse:function(){l.get("selectedNode").childrenHidden()?l.get("selectedNode").showChildren():s.collapse(l.get("selectedNode")),s.getShareCode(),l.trigger("propagate")},editNode:function(){new d},deleteNode:function(){new u}});return b}),define("text!templates/pathway/treeTemplate.html",[],function(){return'<hr/>\n<div class="col-xs-12 col-sm-12 widget-container-col">\n    <!-- #section:custom/widget-box -->\n    <div class="widget-box">\n        <div class="widget-header widget-header-large">\n            <h4 class="widget-title">Pathway Editor</h4>\n            <!-- #section:custom/widget-box.toolbar -->\n            <div class="widget-toolbar">\n                <div class="widget-menu">\n                    <a href="#" data-action="fullscreen" class="orange2">\n                        <i class="ace-icon fa fa-expand"></i>\n                    </a>\n                    <a href="#" data-action="collapse">\n                        <i class="ace-icon fa fa-chevron-up"></i>\n                    </a>\n                </div>\n            </div>\n            <!-- /section:custom/widget-box.toolbar -->\n        </div>\n        <div class="widget-body">\n            <div class="widget-toolbox">\n                <div class="btn-toolbar">\n                    <div class="btn-group">\n                        <button class="btn btn-sm btn-success btn-white btn-round" id="trigger-button">\n                            <i class="ace-icon fa fa-check bigger-110 green"></i>\n                            Edit Triggers\n                        </button>\n                        <button class="btn btn-sm btn-danger btn-white btn-round">\n                            <i class="ace-icon fa fa-times bigger-110 green"></i>\n                            Edit Node\n                        </button>\n                        <button class="btn btn-sm btn-danger btn-white btn-round">\n                            <i class="ace-icon fa fa-times bigger-110 green"></i>\n                            Delete Node\n                        </button>\n                        <button class="btn btn-sm btn-danger btn-white btn-round">\n                            <i class="ace-icon fa fa-times bigger-110 green"></i>\n                            Add Child\n                        </button>\n                        <button class="btn btn-sm btn-danger btn-white btn-round">\n                            <i class="ace-icon fa fa-times bigger-110 green"></i>\n                            Expand Children\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class="widget-main" style="overflow:hidden">\n                <div style="width:10000px; text-align:center; clear:both; height: auto; min-height:600px; transform: scale(1.0);"\n                     class="pathtree container-fluid">\n                </div>\n                <div style="width:auto; clear:both"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!templates/pathway/insertDiv.html",[],function(){return'<div id="insertButton" style="background-color: white; font-size: 200%; border-style: solid">+</div>'}),define("widgets/pathway/TreeView.js",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext","pathway/internalViews/triggerNode","pathway/modalViews/nodeEditor","pathway/Helpers","pathway/models/pathwayCollection","text!templates/pathway/treeTemplate.html","text!templates/pathway/insertDiv.html","jsplumb"],function(e,t,n,i,a,o,s,l,r,d,c){var h=n.View.extend({template:t.template(c),initialize:function(){this.$el.html(this.template()),i.on("change:page",function(){"pathEditor"==i.get("page")||"pathway"==i.get("page")?this.$el.show():this.$el.hide()},this),this.plumb=jsPlumb.getInstance({MaxConnections:-1,Connector:["Flowchart",{cornerRadius:3}],Endpoint:"Blank",PaintStyle:{lineWidth:2,strokeStyle:"#ccc"},HoverPaintStyle:{lineWidth:2,strokeStyle:"#61B7CF"}});var t=this;setTimeout(function(){t.reset=!0,t.render()},200),this.treeEl=e(".pathtree",this.$el),t.treeEl.css({opacity:0}),this.treeEl.draggable({start:function(){o.suppressClick=!0},stop:function(t){setTimeout(function(){o.suppressClick=!1},100),e(t.toElement).one("click",function(e){e.stopImmediatePropagation()})}});var t=this;this.plumb.setContainer(this.treeEl[0]),this.$el.on("wheel",function(e){var n=e.originalEvent.pageX,i=e.originalEvent.pageY,a=t.treeEl.offset().left,o=t.treeEl.offset().top;e.preventDefault();var s=/scale\((.*)\)/,l=t.treeEl[0].style.transform,r="transform";if(l||(l=t.treeEl[0].style.msTransform,r="msTransform"),l){var d=s.exec(l)[1];if(e.originalEvent.deltaY>0)var c=d-.05;else var c=d-0+.05;var h=i-(i-o)*c/d,u=n-(n-a)*c/d;if(c>5||.25>=c)return;var p="scale("+c+")";t.treeEl.css("transform"==r?{transform:p}:{msTransform:p}),t.treeEl.offset({left:u,top:h}),t.setDraggableBox(c)}});var n;window.onresize=function(){window.clearTimeout(n),n=window.setTimeout(function(){t.render()},100)},o.on("propagate sync",function(){this.render()},this),i.on("change:pathid",function(){o.set({selectedNodeOffset:null,selectedNode:null},{silent:!0}),t.treeEl.css({opacity:0}),t.reset=!0,t.treeEl.css(t.treeEl[0].style.transform?{left:"",top:"",transform:"scale(1)"}:{left:"",top:"",msTransform:"scale(1)"})}),this.render()},render:function(){var t=this;if("pathEditor"==i.get("page")||"pathway"==i.get("page")){this.$el.show(),t.treeEl.css({cursor:"wait"});var n=i.get("pathid");n&&"0"!=n?this.$el.show():this.$el.hide(),a.elPairs=[],this.plumb.deleteEveryEndpoint(),this.treeEl.html(""),e(".pathtree",t.$el).append("<div style= 'width:auto; height: auto' class='nodeEl'></div>"),e(".pathtree",t.$el).append("<div style='height:100px'></div>");{new s({el:e(".nodeEl",this.$el).last(),model:a})}e("#pathwayName").html("pathEditor"==i.get("page")?"Now Editing Pathway: "+a.attributes.name:"pathHistory"==i.get("page")?"Now Viewing History for Pathway: "+a.attributes.name:""),this.renderJSPlumb(),this.adjustWidth(),this.setDraggableBox()}},adjustWidth:function(){if(this.reset){this.reset=!1;var t=e(".nodeEl",this.$el).width(),n=(this.$el.width()-t)/2;if(n>0){var i=this.treeEl.offset();i.left=this.$el.offset().left+n,this.treeEl.offset(i)}this.treeEl.css({opacity:1})}},setDraggableBox:function(t){t||(t=1);var n=e(".nodeEl",this.$el),i=n.width(),a=n.height(),o=this.$el.offset().left,s=this.$el.offset().top,l=this.$el.width(),r=this.$el.height(),d=[o+(100-i)*t,s+(50-a)*t,o+l-100*t,s+r-100*t];this.treeEl.draggable("option","containment",d)},renderJSPlumb:function(){var t=this,s=n.View.extend({initialize:function(e){this.$el.html("<div style='float: left; background-color: white; height: 15px'>+</div>"),this.parentNode=e.source,this.childNode=e.target;var t=this;this.$el.on("click",function(){new l(t.parentNode,t.childNode)})}});for(var r in a.elPairs){var d=a.elPairs[r];if(d.source.$el.is(":visible")&&d.target.$el.is(":visible")){var c=d.source.makeExit(t.plumb),h=d.target.makeEntrance(t.plumb);t.plumb.connect(d.bold?{source:c,target:h,overlays:[["Custom",{create:function(){var t=new s({source:d.source.model,target:d.target.model});return"pathEditor"==i.get("page")?t.$el:e("<div></div>")},location:-10,id:"customOverlay"}]],paintStyle:{lineWidth:4,strokeStyle:"#46bdec"}}:{overlays:[["Custom",{create:function(){var t=new s({source:d.source.model,target:d.target.model});return"pathEditor"==i.get("page")?t.$el:e("<div></div>")},location:-10,id:"customOverlay"}]],source:c,target:h})}}var u=e(".selected.treeNode"),p=o.get("selectedNodeOffset");if(p&&u.length&&u.is(":visible")&&p.clickid==u.attr("clickid")){var m=this.treeEl.offset(),d=u.offset();this.treeEl.offset({left:m.left-d.left+p.left,top:m.top-d.top+p.top})}i.trigger("rendered"),t.treeEl.css({cursor:"default"})},showExtraInfo:function(){},drawNodes:function(){}});return h}),define("text!../templates/settings.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="modal-dialog modal-lg" id="settings" xmlns="http://www.w3.org/1999/html">\n    <div class="modal-content">\n        <div class="modal-body">\n            <h3><b>User Settings</b></h3>\n            <div class="container col-md-12">\n                <p>Official Name: <input id="official-name-input" type="text" value="<%=official_name %>" autofocus> </p>\n                <p>Display Name: <input id="display-name-input" type="text" value="<%= display %>" > </p>\n                <div>\n                        <button id="save-settings">Save</button>\n                        <button id="cancel-settings">Cancel</button>\n                </div>\n            </div>\n            <div style="clear:both; overflow: auto;">\n                <h5><b>Change Password</b></h5>\n\n                <div style="width:49%; float:left;">\n                <p><b>Old</b> Password: <input id="login-password" type="password" placeholder="password" name="password"></p>\n                <p><b>New</b> Password: <input id="login-new-password" type="password" name="password" placeholder="password"></p>\n                <p><b>Confirm New</b> Password: <input id="login-new-password2" type="password" name="password" placeholder="password"></p>\n                </div>\n\n                <div style="width:49%; float:left;">\n                    <div> New passwords must contain:</div>\n                    <ul>\n                        <li>At least 8 characters <i id=\'pw-len-cb\'></i></li>\n                        <li>A lower-case character <i id=\'pw-low-cb\'></i></li>\n                        <li>An upper-case character <i id=\'pw-up-cb\'></i></li>\n                        <li>A number<i id=\'pw-num-cb\'></i></li>\n                    </ul>\n                    <div> And it must be different from the old password <i id="pw-diff-cb"></i></div>\n                    <div>\n                        <button id="update-password">Update Password</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n</div>\n'}),define("text!../templates/auditScroll.html",[],function(){return'\n<div class = "widget-column">\n    <div class="auditlist audit-scroll" style="clear:both;">\n        <div class="auditaccordion">\n            <table class="table table-condensed table-hover audittable">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <thead >\n                <tr>\n                    <th align="left">Date</th>\n                    <th align="left">Patient</th>\n                    <th align="left">Action</th>\n                    <th align="left">User</th>\n                    <th align="left">Device</th>\n                    <th align="left">Details</th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n            </table>\n        </div>\n    </div>\n    <div class="audit-control-row">\n        <!--[if gte IE 10]><!-->\n            <button class="btn btn-default download-user-audits">Download Audits</button>\n        <!--<![endif]-->\n    </div>\n</div>\n'}),define("text!../templates/customerList.html",[],function(){return'<div class = "widget-column col-sm-12" style="clear: both;">\n\n<div class="row customerlist" style="margin: auto; width: 100%;">\n    <div class="widget-header">\n    <span class="headings title">Customers</span>\n        <button type="button" class="btn btn-default btn-xs refreshButton" data-dismiss="modal" style="margin-left:10px; color: #46ECBD; font-size: 10px;">\n            <span class="glyphicon glyphicon-refresh"></span>\n        </button>\n    </div>\n    <div class="customeraccordion" style="overflow-y:auto; max-height:500px; width:100%">\n        <table class="table table-condensed table-hover customertable" style="width:100%; padding: 0;">\n        <col width="5%">\n        <col width="43%">\n        <col width="13%">\n        <col width="17%">\n        <col width="11%">\n        <col width="*">\n        <thead>\n            <tr>\n                <th align="left" id="cus_id">ID</th>\n                <th align="left" id="cus_name">Name</th>\n                <th align="left" id="cus_abbr">Abbreviation</th>\n                <th align="left" id="cus_license_exp">License Exp</th>\n                <th align="left" id="cus_license_typ"># Licenses</th>\n                <th align="left"></th>\n            </tr>\n        </thead>\n        <tbody>\n        </tbody>\n        </table>\n    </div>\n    <div class="save-settings-row row">\n        <span id="save-customer-message" class="setting-option option-left">&nbsp;</span>\n        <div class="setting-option option-right"><button id="save-customer-changes" class="btn btn-default">Save Changes</button></div>\n    </div>\n</div>\n\n</div>'}),define("text!../templates/sidebar.html",[],function(){return'<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse" data-target="#sidebar">\n    <i class="ace-icon fa fa-angle-double-right" data-icon1="ace-icon fa fa-angle-double-left"\n       data-icon2="ace-icon fa fa-angle-double-right"></i>\n</div>\n<ul class="nav nav-list" id="sidebar-list">\n\n</ul>\n\n\n'}),require(["text!../templates/settings.html","text!../templates/auditScroll.html","text!../templates/customerList.html","text!../templates/sidebar.html"],function(){}),define("textstub",function(){});
//# sourceMappingURL=min.js.map