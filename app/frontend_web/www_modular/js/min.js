define("globalmodels/contextModel",["jquery","underscore","backbone"],function(e,t,n){function i(e){var t,n;for(t=0;n=document.getElementsByTagName("link")[t];t++)-1!=n.getAttribute("rel").indexOf("style")&&n.getAttribute("title")&&(n.disabled=!0,n.getAttribute("title")==e&&(n.disabled=!1))}function a(e){var t=readCookie("valid-through");if(t){var n=t-new Date+e;n>0?setTimeout(function(){a(e)},n):(eraseCookie("valid-through"),location.href="#logout")}}var s,o=function(t){console.log("login call back",s);var o=new Date-readCookie("now");a(o),s.set({loginTemplate:null}),i("demo");var l=t.get("widgets"),r=[],d=[];for(var c in l){var h=l[c];r.push("widgets/"+h.widget),d.push("text!/templates/"+h.template),console.log("adding view "+h.widget+" to element #"+h.element+" with template "+h.template)}require(r.concat(d),function(){for(var t=0;t<r.length;t++){var i;"contentRow"==l[t].element?(e("#dynamic-content").append("<div class='row content-row'></div>"),i=e(".row",e("#dynamic-content")).last()):"floating-right"==l[t].element?(e("#floating-right").append("<div class='row content-row'></div>"),i=e(".row",e("#floating-right")).last()):"floating-left"==l[t].element?(e("#floating-left").append("<div class='row content-row'></div>"),i=e(".row",e("#floating-left")).last()):"fixed-topB"==l[t].element?(e("#fixed-topB").append("<div class='col-xs-12'></div>"),i=e(".col-xs-12",e("#fixed-topB")).last()):i=e("#"+l[t].element);try{new arguments[t]({template:arguments[t+r.length],el:i})}catch(a){console.log("failed to start widget ",l[t],a)}}e("#content").show(),n.history.loadUrl(n.history.fragment)})},l=n.Model.extend({urlRoot:"/login",defaults:{page:null,user:null,customer:null,userAuth:"",patients:"",patientAuth:"",patientName:"",pathid:0,canonical:null,provider:null,encounter:null,department:null,searchPatient:null,searchDiagnosis:null,loginTemplate:"login.html",settingsTemplate:"settings.html"},toParams:function(){var e=t.pick(this.attributes,["startdate","enddate","encounter","patients","department","pathid"]);e.id=e.pathid;for(var n in e)(null===e[n]||"provider"!=n&&""===e[n])&&delete e[n];return e},setUser:function(e,t,n,i,a){if(this.user!=e||!this.userAuth){this.set({user:e,customer:i,"login-message":null});var s,l=this;s=t?{user:e,password:t,customer_id:i}:{user:e,oauth:n,customer_id:i},a&&(s.newpassword=a),this.fetch({success:o,error:function(e,t){l.set(t.responseJSON)},data:JSON.stringify(s),type:"POST"})}},autoSetUser:function(e,t,n,i){var a=this;this.set({user:e,customer:t,userAuth:null}),n?this.fetch({success:o,error:function(e,t){a.set(t.responseJSON),new i({el:"#login-modal"})},data:JSON.stringify({user:e,customer_id:t,userAuth:n}),type:"POST"}):!document.cookie||e&&readCookie("user")!=e?new i({el:"#login-modal"}):this.fetch({url:"/refresh_login",success:o,error:function(){new i({el:"#login-modal"})}})}});return s=new l,s.on("change:page",function(){window.scrollTo(0,0)}),s}),define("globalmodels/layoutModel",["jquery","underscore","backbone"],function(e,t,n){var i,a=n.Model.extend({defaults:{fluidContent:!1,contentHeight:"400px"},applicationFunctions:new n.Model({fluidContent:function(t){t?(e("#contentContainer").addClass("container-fluid"),e("#contentContainer").removeClass("container")):(e("#contentContainer").removeClass("container-fluid"),e("#contentContainer").addClass("container"))},contentHeight:function(t){e("#contentContainer").css({height:t})}}),initialize:function(){this.on("change",function(){this.apply()},this)},apply:function(e){if(e)for(var n in e){var i=e[n];this.applicationFunctions.get(i)(this.get(i))}else for(var n in t.keys(this.attributes)){var i=t.keys(this.attributes)[n];this.applicationFunctions.get(i)(this.get(i))}}});return i=new a}),define("widgets/evidence",["jquery","underscore","backbone"],function(e,t,n){var i=n.View.extend({el:"#modal-target",initialize:function(e){this.evi=e.evi,t.bindAll(this,"render"),this.render()},render:function(){var n=this;return require(["text!../evidence/"+n.evi+".html"],function(i){var a=t.template(i),s=a({alert:n.evi});n.$el.append(s),e("#evidence-"+n.evi).modal()}),n}});return i}),define("text",["module"],function(e){var t,n,i,a,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,r=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,c=d&&location.protocol&&location.protocol.replace(/\:/,""),h=d&&location.hostname,p=d&&(location.port||void 0),u={},m=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(l,"");var t=e.match(r);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(i){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,i,a=!1,s=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==s&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,i=n||t,s=i.indexOf("!"),-1!==s&&(a="strip"===i.substring(s+1),i=i.substring(0,s),n?n=i:t=i),{moduleName:t,ext:n,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,a){var s,o,l,r=t.xdRegExp.exec(e);return r?(s=r[2],o=r[3],o=o.split(":"),l=o[1],o=o[0],!(s&&s!==n||o&&o.toLowerCase()!==i.toLowerCase()||(l||o)&&l!==a)):!0},finishLoad:function(e,n,i,a){i=n?t.strip(i):i,m.isBuild&&(u[e]=i),a(i)},load:function(e,n,i,a){if(a.isBuild&&!a.inlineText)return void i();m.isBuild=a.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),l=n.toUrl(o),r=m.useXhr||t.useXhr;return 0===l.indexOf("empty:")?void i():void(!d||r(l,c,h,p)?t.get(l,function(n){t.finishLoad(e,s.strip,n,i)},function(e){i.error&&i.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,i)}))},write:function(e,n,i){if(u.hasOwnProperty(n)){var a=t.jsEscape(u[n]);i.asModule(e+"!"+n,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,n,i,a,s){var o=t.parseName(n),l=o.ext?"."+o.ext:"",r=o.moduleName+l,d=i.toUrl(o.moduleName+l)+".js";t.load(r,i,function(){var n=function(e){return a(d,e)};n.asModule=function(e,t){return a.asModule(e,d,t)},t.write(e,r,n,s)},s)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var a=n.readFileSync(e,"utf8");0===a.indexOf("ï»¿")&&(a=a.substring(1)),t(a)}catch(s){i(s)}}):"xhr"===m.env||!m.env&&t.createXhr()?t.get=function(e,n,i,a){var s,o=t.createXhr();if(o.open("GET",e,!0),a)for(s in a)a.hasOwnProperty(s)&&o.setRequestHeader(s.toLowerCase(),a[s]);m.onXhr&&m.onXhr(o,e),o.onreadystatechange=function(){var t,a;4===o.readyState&&(t=o.status,t>399&&600>t?(a=new Error(e+" HTTP status: "+t),a.xhr=o,i(a)):n(o.responseText),m.onXhrComplete&&m.onXhrComplete(o,e))},o.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,a="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),l=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),a)),r="";try{for(n=new java.lang.StringBuffer,i=l.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=l.readLine());)n.append(o),n.append(i);r=String(n.toString())}finally{l.close()}t(r)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,a=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,o,l,r={};s&&(e=e.replace(/\//g,"\\")),l=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(a.nsIFileInputStream),n.init(l,1,0,!1),o=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(a.nsIConverterInputStream),o.init(n,"utf-8",n.available(),a.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),r),o.close(),n.close(),t(r.value)}catch(d){throw new Error((l&&l.path||"")+": "+d)}}),t}),define("text!templates/resetPassword.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="modal-dialog modal-lg login">\n  <div class="modal-content">\n    <div class="modal-body">\n      <h3><span class="glyphicon glyphicon-repeat"></span>EMR password reset</h3>\n      <p><input id="ehr-user" type="text" name="user" placeholder="EMR user name"> </p>\n      <p><input id="reset-customer" type="text" name="customer" placeholder="Customer ID"></p>\n      <div id=\'recaptcha-div\'></div>\n      <div>\n        <button id="send-reset-password">Send</button> reset password link to EMR account\n      </div>\n    </div>\n  </div>\n</div>\n</div>\n'}),define("widgets/login",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(){i.on("change:loginTemplate change:login-message",this.render,this),e("#login-modal").modal({show:"true",backdrop:"static",keyboard:!1}),this.user="",this.customer="",this.render();var t=this,n=location.hostname.split(".");3==n.length&&e.ajax({type:"GET",dataType:"json",url:"/customer_id?abbr="+n[0],success:function(n){t.fixed_customer=n;var i=e("#login-customer");i.val(n),i.hide()}})},events:{"click #login-button":"dologin","click #update-password":"dologin","keyup #login-user":"doenterlogin","keyup #login-password":"doenterlogin","keyup #login-new-password":"doenterchange","click #reset-password":"resetpassword"},resetpassword:function(){var n=this,i="text!/services/recaptcha";require(["text!../templates/resetPassword.html",i,"//www.google.com/recaptcha/api/js/recaptcha_ajax.js"],function(i,a){var s=t.template(i);n.$el.html(s()),Recaptcha.create(a,"recaptcha-div",{callback:Recaptcha.focus_response_field}),e("#send-reset-password").click(function(){var t=e("#ehr-user").val(),n=e("#reset-customer").val(),i=e("#recaptcha_response_field").val(),a=e("#recaptcha_challenge_field").val();e.ajax({url:"/send_reset_password",data:{user:t,customer_id:n,recaptcha_challenge_field:a,recaptcha_response_field:i},success:function(){alert("A reset password message has been sent to this account.")},error:function(){alert("We could not verify your recaptcha response.  Try again, or contact IT about directly resetting your password."),Recaptcha.reload()}})})})},render:function(){if(i.get("loginTemplate")){var n=this;require(["text!../templates/"+i.get("loginTemplate")],function(a){if(n.template=t.template(a),n.$el.html(n.template(i.attributes)),n.fixed_customer){var s=e("#login-customer");s.val(n.fixed_customer),s.hide()}var o=i.get("login-message");o&&setTimeout(function(){e("#login-message").text(o)},500),n.newPasswordChange()})}else e("#login-modal").modal("hide");return this},doenterlogin:function(e){13==e.keyCode&&this.dologin(e)},doenterchange:function(e){13==e.keyCode?this.dologin(e):this.newPasswordChange()},dologin:function(){var t=e("#login-user").val(),n=e("#login-customer").val();this.user=t,this.customer=n;var a=e("#login-password").val(),s=e("#login-oauth").val();if(t&&(a||s)){var o=e("#login-new-password");e("#login-message").text("Trying to log in"),o.is(":visible")?this.newPasswordChange()&&i.setUser(t,a,s,n,o.val()):i.setUser(t,a,s,n,null)}},newPasswordChange:function(){var t=e("#login-new-password").val();if(!t)return!1;var n="<big><big><font color='#00b000'>&#x2714</font></big></big>",i="<big><font color='#ff0000'>&#x2718</font></big>",a=t.length<8,s=t.search(".*[a-z]")<0,o=t.search(".*[A-Z]")<0,l=t.search(".*[0-9]")<0,r=t==e("#login-password").val();return e("#pw-len-cb").html(a?i:n),e("#pw-low-cb").html(s?i:n),e("#pw-up-cb").html(o?i:n),e("#pw-num-cb").html(l?i:n),e("#pw-diff-cb").html(r?i:n),a||s||o||l||r?!1:!0}});return a}),define("widgets/settings",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(){this.render()},events:{"click #save-settings":"dosave","click #update-password":"dologin","click #cancel-settings":"docancel","keyup #official-name-input":"doentersave","keyup #display-name-input":"doentersave","keyup #login-password":"doenterlogin","keyup #login-new-password":"doenterchange"},render:function(){if(i.get("settingsTemplate")){var n=this;require(["text!../templates/"+i.get("settingsTemplate")],function(e){n.template=t.template(e),n.$el.html(n.template(i.attributes)),n.newPasswordChange()})}else e("#settings-modal").modal("hide");return this},dohide:function(){e("#settings-modal").modal("hide")},docancel:function(){this.dohide()},doentersave:function(e){13==e.keyCode&&this.dosave(e)},doenterchange:function(e){13==e.keyCode?this.dologin(e):this.newPasswordChange()},dosave:function(){var t=e("#official-name-input").val(),n=e("#display-name-input").val();e.ajax({url:"/save_user_settings",data:e.param(i.toParams())+"&official_name="+t+"&display_name="+n,success:function(){console.log("Settings saved")},error:function(){console.log("Settings failed to save")}}),e("#settings-modal").modal("hide")},newPasswordChange:function(){var t=e("#login-new-password").val(),n="<big><big><font color='#00b000'>&#x2714</font></big></big>",i="<big><font color='#ff0000'>&#x2718</font></big>",a=t.length<8,s=t.search(".*[a-z]")<0,o=t.search(".*[A-Z]")<0,l=t.search(".*[0-9]")<0,r=t==e("#login-password").val();return e("#pw-len-cb").html(a?i:n),e("#pw-low-cb").html(s?i:n),e("#pw-up-cb").html(o?i:n),e("#pw-num-cb").html(l?i:n),e("#pw-diff-cb").html(r?i:n),a||s||o||l||r?(e("#login-button").attr("disabled","disabled"),!1):(e("#login-button").removeAttr("disabled"),!0)}});return a}),define("router",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/layoutModel","widgets/evidence","widgets/login","widgets/settings"],function(e,t,n,i,a,s,o){var l=function(){return i.get("user")&&i.get("userAuth")?!0:(new o({el:"#login-modal"}),!1)},r=["#floating-left","#dynamic-content","#floating-right"],d={home:[0,12,0],patient:[0,9,3],episode:[0,9,3],pathway:[0,12,0],pathEditor:[0,12,0],triggerEditor:[0,12,0]};changePageLayout=function(t){t in d&&e.each(r,function(n,i){0==d[t][n]?e(i).hide():(e(i).show(),e(i).removeClass(),e(i).addClass("content col-md-"+d[t][n]))})};var c=function(e,t,n){if(document.cookie&&!i.get("userAuth")||e&&!i.get("user"))i.autoSetUser(e,t,n,o);else{if(l())return console.log("showing page "+i.get("page")),changePageLayout(i.get("page")),!0;console.log("trying to log in")}return!1},h=n.Router.extend({routes:{logout:"logout",settings:"settings","auditlist(login/:user/:customer/)(:userAuth)":"showAudit","profile(login/:user/:customer/)(:userAuth)":"showProfile","customers(login/:user/:customer/)(:userAuth)":"showCustomers","(login/:user/:customer/)(:userAuth)":"showHome","patient/:id(/login/:user/:customer/)(:userAuth)":"showPatient","episode/:id/patient/:id/:date(/login/:user/:customer/)(:userAuth)":"showEpisode","evidence/:id/patient/:id/evi/:id(/login/:user/:customer/)(:userAuth)":"showEvidence","pathway/:id/node/:id(/patient/:id/:date)(/login/:user/:customer/)(:userAuth)":"showPathway","pathwayeditor/:id/node/:id(/login/:user/:customer/)(:userAuth)":"EditPathway","triggereditor/:id/node/:id(/login/:user/:customer/)(:userAuth)":"EditTriggers","password/:type/:user/:customer/:oauth":"password","*action":"defaultAction"},password:function(e,t,n,a){i.get("userAuth")?window.location="#":(i.set({loginTemplate:e+".html",user:t,customer_id:n,oauth:a}),new o({el:"#login-modal"}))},showHome:function(e,t,n){i.set({page:"home",patients:null,encounter:null,patientName:null}),"Heathcliff Huxtable"==i.get("official_name")&&i.set({page:"pathway",patients:null,encounter:null,patientName:null}),c(e,t,n)},showPatient:function(e,t,n,a){i.set({page:"patient",encounter:null,patients:e}),c(t,n,a)},showEpisode:function(e,t,n,a,s,o){i.set({page:"episode",encounter:e,patients:t,enc_date:n,startdate:null,enddate:null}),c(a,s,o)},showPathway:function(e,t,n,s,o,l,r){a.set({fluidContent:!1}),i.set({page:"pathway",code:t,pathid:e,patients:n,enc_date:s,startdate:null,enddate:null}),c(o,l,r)},showEvidence:function(e,t,n,a,o,l){if(i.set({page:"episode",encounter:e,patients:t}),c(a,o,l)){new s({evi:n})}},EditPathway:function(e,t,n,s,o){a.set("fluidContent",!0),i.set({page:"pathEditor",pathid:e,code:t}),c(n,s,o)},EditTriggers:function(e,t,n,s,o){a.set("fluidContent",!1),i.set({page:"triggerEditor",pathid:e,code:t}),c(n,s,o)},showPathwayHistory:function(e,t,n,a,s){i.set({page:"pathHistory",pathid:e,code:t}),c(n,a,s)},showCustomers:function(e,t,n){i.set({page:"customers"}),c(e,t,n)},showProfile:function(e,t,n){i.set({page:"profile"}),c(e,t,n)},showAudit:function(e,t,n){i.set({page:"auditlist"}),c(e,t,n)},logout:function(){eraseCookie("valid-through"),eraseCookie("roles"),eraseCookie("username");for(var t=10;document.cookie&&t>0;)t-=1,eraseCookie(document.cookie.split("=")[0]);i.clear({silent:!0}),e.ajax({type:"POST",dataType:"json",url:"/logout"}),location.href="/index.html"},defaultAction:function(e){console.log("No route:",e)},initialize:function(){e.ajaxPrefilter(function(e){e.url="services"+e.url}),n.history.start()}});return h}),define("globalmodels/sidebarModel",["backbone"],function(e){var t={Profile:["fa-user","profile"],Customers:["fa-user","customers"],Pathways:["fa-user","pathways"],"Pathway Mgmt":["fa-cloud","pathway",[{"Pathway Viewer":["icon","pathway"]},{"Pathway Editor":["icon","pathwayEditor"]}]],Dashboard:["fa-tachometer","home"]},n=e.Model.extend({addOption:function(e){this.get(e)||this.set(e,t[e])}});return new n}),define("widgets/pageOption",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=function(t,n,i){return e("<li>",{}).append(e("<a>",{href:t,"class":"dropdown-toggle"}).append(e("<i>",{"class":"menu-icon fa "+n})).append(e("<span>",{"class":"menu-text",text:i})).append(e("<b>",{"class":"arrow"})))},l=function(t,n){n="undefined"!=typeof n?n:"#sidebar-list";for(o in t){var i=a(t[o][1],t[o][0],o);if(3==t[o].length){e(i.children()[0]).append(e("<b>",{"class":"arrow fa fa-angle-down"}));var r=e("<ul>",{"class":"submenu"}),d=t[o][2];for(s in d)l(d[s],r);i.append(r)}i.appendTo(n)}},r=n.View.extend({el:"#sidebar-list",initialize:function(e,t){t="undefined"!=typeof t?t:"#sidebar-list",l(e,t),this.$el.off("click")},events:{"click a":"setPage"},setPage:function(t){t.preventDefault();var a=e(t.currentTarget).attr("href");"pathway"==a?n.history.navigate("pathway/"+i.get("pathid")+"/node/"+i.get("code"),{trigger:!0}):"pathwayEditor"==a?n.history.navigate("pathwayeditor/"+i.get("pathid")+"/node/"+i.get("code"),!0):n.history.navigate(a,!0),console.log("page option",i.get("page"))}});return r}),define("text!templates/sidebar.html",[],function(){return'<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse" data-target="#sidebar">\n    <i class="ace-icon fa fa-angle-double-right" data-icon1="ace-icon fa fa-angle-double-left"\n       data-icon2="ace-icon fa fa-angle-double-right"></i>\n</div>\n<ul class="nav nav-list" id="sidebar-list">\n\n</ul>\n\n\n'}),define("widgets/sidebar",["jquery","underscore","backbone","ace","globalmodels/contextModel","globalmodels/sidebarModel","widgets/pageOption","text!../templates/sidebar.html"],function(e,t,n,i,a,s,o,l){var r=n.View.extend({initialize:function(){this.template=t.template(l),this.render(),s.on("change",this.change,this),s.addOption("Dashboard")},change:function(){t.each(s.changed,function(e,t){var n={};n[t]=e,new o(n)})},el:"#sidebar",render:function(){this.$el.html(this.template())}});return r}),define("app",["jquery","underscore","backbone","bootstrap","router","widgets/sidebar"],function(e,t,n,i,a,s){var o=function(){new a,new s};return{initialize:o}}),!function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,a=i._mouseInit,s=i._mouseDestroy;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),a.call(t)},i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),s.call(t)}}}(jQuery),define("touch",["jquery_ui"],function(){}),require.config({paths:{jquery:["jquery-stub"],jquery_ui:["//code.jquery.com/ui/1.10.1/jquery-ui.min","libs/jquery/jquery-ui.min"],jquery_autocomplete:"libs/jquery/jquery.ui.autocomplete.html",touch:"libs/jquery/jquery.ui.touch-punch.min",underscore:"libs/underscore/underscore-min",backbone:["libs/backbone/backbone","//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"],jsplumb:["libs/jsplumb2/js/jquery.jsPlumb-1.6.2-min","libs/jsplumb2/js/jsplumb"],bootstrap:"../css/bootstrap/js/bootstrap.min",bootstrapswitch:"libs/bootstrap-switch/bootstrap-switch",nestedSortable:"libs/nestedSortable/nestedSortable",nestable:"../ace/assets/js/jquery.nestable",fullcalendar:"libs/fullCalendar/fullcalendar.min",moment:"libs/fullCalendar/moment.min",ckeditor2:"libs/ckeditor/ckeditor",ckeditor:"ckeditor-customize",templates:"../templates",amchartspie:"libs/amcharts/pie",amchartslight:"libs/amcharts/themes/light",amchartsserial:"libs/amcharts/serial",amcharts:"libs/amcharts/amcharts",ace:"libs/ace/ace.min",aceelements:"libs/ace/ace-elements.min",aceextra:"libs/ace/ace-extra.min"},shim:{touch:{deps:["jquery_ui"]},ace:{deps:["jquery","jquery_ui","bootstrap","aceelements"]},aceextra:{deps:["bootstrap","jquery","jquery_ui"]},aceelements:{deps:["aceextra","bootstrap","jquery_ui","jquery"]},bootstrap:{deps:["jquery","jquery_ui"]},bootstrapswitch:{deps:["jquery","jquery_ui","bootstrap"]},nestable:{deps:["jquery","jquery_ui","bootstrap"]},jsplumb:{deps:["jquery","jquery_ui"]},fullCalendar:{deps:["jquery","moment","jquery_ui"]},jquery_ui:{deps:["jquery"]},amchartspie:{deps:["amcharts"],exports:"AmCharts",init:function(){AmCharts.isReady=!0}},amchartsserial:{deps:["amcharts"],exports:"AmCharts",init:function(){AmCharts.isReady=!0}},amchartslight:{deps:["amcharts"],exports:"AmCharts",init:function(){AmCharts.isReady=!0}}}}),require(["app","jquery","touch","underscore","backbone","bootstrap","bootstrapswitch","ace","text"],function(e){e.initialize()}),define("main",function(){}),define("pathway/models/treeContext",["backbone"],function(e){var t=e.Model.extend({});return new t}),define("pathway/models/nodeModel",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeContext"],function(e,t,n,i,a){var s,o=n.Collection.extend({populate:function(e,t,i){if(e)for(var a in e){var o,l=e[a];l.children?(o=new s(l,t,i),o.set("hasLeft",0!=a),o.set("hasRight",a<e.length-1)):(o=new n.Model(l),o.set("isProtocol",!0)),this.add(o,{silent:!0})}},toJSON:function(e){var n=[];return t.each(this.models,function(t){n.push(t.toJSON(e))},this),n}});return s=n.Model.extend({getNodeType:function(){return"treeNode"},initialize:function(e,i,a){e.nodeID?this.set("nodeID",e.nodeID,{silent:!0}):this.set("nodeID",i.get("pathid")+":"+i.getNextNodeID(),{silent:!0}),e.children||(e.children=[]);var s=new o;s.populate(e.children,i,a),this.set({children:s,name:e.name,tooltip:e.tooltip,sidePanelText:e.sidePanelText},{silent:!0}),this.hideChildren(),t.each(this.get("children").models,function(e){e.showChildren&&e.showChildren()}),e.protocol&&(e.protocol.nodeID||(e.protocol.nodeID=i.getNextNodeID()),this.get("children").add(new n.Model(e.protocol)))},toJSON:function(e){var n=t.omit(this.attributes,["children","hasLeft","hasRight"]);return e.toExport&&(n=t.omit(n,["nodeID"])),n.children=this.get("children").toJSON(e),n},populateChildren:function(e,t){var n=new o;e&&n.populate(e,this,t),this.set({children:n},{silent:!0})},showChildren:function(){a.unset(this.get("nodeID"))},hideChildren:function(){a.set(this.get("nodeID"),"hideChildren")},childrenHidden:function(){return a.get(this.get("nodeID"))}})}),define("pathway/models/pathwayCollection",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.Collection.extend({model:n.Model.extend({idAttribute:"canonical"}),url:function(){return"/list"},initialize:function(){this.fetch()},addNewPath:function(){this.fetch({add:!0})},makeSortable:function(){jQuery(function(e){e(".dd").nestable(),e(".dd-handle a").on("mousedown",function(e){e.stopPropagation()}),e('[data-rel="tooltip"]').tooltip()})},getParents:function(t){var n=[];e(t).hasClass("sub-folder")&&n.push(e(t).children().first().attr("name"));for(var i=e(t).parent().closest(".sub-folder");i.length;){var a=i.children(".pathway-folder-title").attr("name");if(""==a)break;n.push(a),i=e(i).parent().closest(".sub-folder")}return n.reverse(),n},handleMovedPath:function(t,n){var a={canonical:t,customer_id:i.get("customer_id"),userid:i.get("userid")};e.extend(a,i.toParams(),a),e.ajax({type:"POST",dataType:"json",url:"/update_pathway_location?"+e.param(a),data:JSON.stringify(n),success:function(){console.log("pathway location updated")}})},handleMovedFolder:function(t,n,i,a){var s=0;e(t).children("ol").children().each(function(){if(e(this).hasClass("pathrow-item")){s++;var t={location:n,position:s},o=e(".path-row",e(this)).attr("id");i.handleMovedPath(o,t)}else a&&(new_path=n+"/"+e(".pathway-folder-title",e(this)).first().attr("name"),i.handleMovedFolder(this,new_path,i))})}});return a=new a}),define("pathway/models/triggerGroupCollection",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n){var i=n.Collection.extend({populate:function(e,t){var n=this;if("version1"==t)for(var i in e){var o=e[i],l=new a;l.populate({JSON:o}),l.on("cascade",function(){n.trigger("cascade")}),this.add(l,{silent:!0})}else if("preversion"==t){var l=new a;l.populate({relationship:"and"}),l.on("cascade",function(){n.trigger("cascade")});var r=new s;r.populate(e),l.set("details",r,{silent:!0}),this.add(l,{silent:!0})}this.on("add",function(){n.trigger("cascade")}),this.on("remove",function(){n.trigger("cascade")}),0==n.models.length&&n.addGroup("and")},addGroup:function(e){var t=new a,n=this;return t.populate({relationship:e}),t.on("cascade",function(){n.trigger("cascade")}),this.add(t),t}}),a=n.Model.extend({populate:function(e){var t=this;if(e.JSON){this.set("relationship",e.JSON.relationship);var n=new s;n.populate(e.JSON.details),n.on("cascade",function(){t.trigger("cascade")}),this.set("details",n,{silent:!0})}else if(e.relationship){this.set("relationship",e.relationship,{silent:!0});var n=new s;n.populate(),n.on("cascade",function(){t.trigger("cascade")}),this.set("details",n,{silent:!0})}this.on("change",function(){this.trigger("cascade")})},addDetail:function(e,t){var n=this,i=new l;i.populate(e.attributes),i.on("cascade",function(){n.trigger("cascade")});var a=this.get("details");if(a.get(t))a.get(t).add(i);else{var s=new o;s.on("cascade",function(){n.trigger("cascade")}),s.add(i),a.set(t,s)}},toJSON:function(){var e={};return e.relationship=this.get("relationship"),e.details=this.get("details").toJSON(),e}}),s=n.Model.extend({populate:function(e){var t=this;for(var n in e){var i=e[n],a=new o;a.populate(i),a.on("cascade",function(){t.trigger("cascade")}),this.set(n,a,{silent:!0})}this.on("change",function(){t.trigger("cascade")})},toJSON:function(){var e={};for(var t in this.attributes){var n=this.attributes[t];e[t]=n.toJSON()}return e}}),o=n.Collection.extend({populate:function(e){var t=this;for(var n in e){var i=e[n],a=new l;a.on("cascade",function(){t.trigger("cascade")}),a.populate(i),this.add(a,{silent:!0})}this.on("add",function(){t.trigger("cascade")}),this.on("remove",function(){t.trigger("cascade")})}}),l=n.Model.extend({populate:function(e){for(var t in e){var n=e[t];this.set(t,n,{silent:!0})}}});return i}),define("pathway/models/treeModel",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/nodeModel","pathway/models/pathwayCollection","pathway/models/treeContext","pathway/models/triggerGroupCollection"],function(e,t,n,i,a,s,o,l){var r,d="version1",c=function(e,t,n){if(!e.get("isProtocol"))for(var i in e.get("children").models){var a=e.get("children").models[i];if(a==t){var s=e.get("children").indexOf(a);if(n){var o=a.get("children").models;for(var i in o){var l=o[i];1!=e.get("children").length&&l.get("isProtocol")||(e.get("children").add(l,{at:s,silent:!0}),s+=1)}}e.get("children").remove(t,{silent:!0})}else c(a,t,n)}},h=function(e,t,n){if(e.get("nodeID")==t)for(var i in n){var a=n[i];a.showChildren&&a.showChildren()}else{if(!e.get("isProtocol"))for(var i in e.get("children").models){var a=e.get("children").models[i],s=n.slice(0);s.push(a);{h(a,t,s)}}}},p=function(e,t,n,i){var a=!1,s=[];if(!e.get("isProtocol")){for(var o in e.get("children").models){var l=e.get("children").models[o];s[s.length]=l,0==a&&l!=t?p(l,t,n,i):a=!0}var r;if(a){for(var d in s){d=parseInt(d);var c=s[d];if(c==t){if(-1==n){s[d]=r,s[d-1]=c,s[d].set("hasRight",d<s.length-1,{silent:!0}),s[d-1].set("hasLeft",d-1!=0,{silent:!0}),s[d-1].set("hasRight",!0,{silent:!0}),s[d].set("hasLeft",!0,{silent:!0});break}if(1==n){s[d]=s[d+1],s[d+1]=c,s[d+1].set("hasRight",d+1<s.length-1,{silent:!0}),s[d].set("hasLeft",0!=d,{silent:!0}),s[d].set("hasRight",!0,{silent:!0}),s[d+1].set("hasLeft",!0,{silent:!0});break}}r=c}i.parent=e,i.child=s}}},u=function(e){if(e.get("isProtocol"))return[e.get("nodeID")];var t=[];for(var n in e.get("children").models){var i=e.get("children").models[n];i.childrenHidden&&!i.childrenHidden()&&t.push(i)}var a=[];0==t.length&&a.push(e.get("nodeID"));for(n in t){var i=t[n];a=a.concat(u(i))}return a},m=function(e,n){if(!e.get("isProtocol")){var i=t.indexOf(e.get("children").models,n);for(var a in e.get("children").models)-1!=i?a!=i&&g(e.get("children").models[a]):m(e.get("children").models[a],n)}},g=function(e){e.get("isProtocol")||(e.hideChildren(),t.each(e.attributes.children.models,function(e){g(e)}))},f=function(e){e.get("isProtocol")||(e.showChildren(),t.each(e.attributes.children.models,function(e){g(e)}))},v=a.extend({elPairs:[],idAttribute:"pathid",urlRoot:"/tree",changeNodePosition:function(e,t){var i={},a=(p(this,e,t,i),i.parent),s=i.child;a.set("children",new n.Collection(s),{silent:!0}),this.trigger("propagate")},expandAll:function(){f(this)},getShareCode:function(){var e=u(this),t="";for(var a in e){var s=e[a];t+="-"+s}n.history.navigate("pathEditor"==i.get("page")?"pathwayeditor/"+i.get("pathid")+"/node/"+t:"pathway/"+i.get("pathid")+"/node/"+t),i.set("code",t)},getPathToIDS:function(e){this.collapse(this),!e&&i.get("code")&&(e=i.get("code").split("-"));for(var t in e){var n=e[t];n&&h(this,n,[this])}},initialize:function(){this.set({triggers:new n.Collection,tooltip:"triggers tooltip",sidePanelText:"",name:"Triggers"}),this.populateChildren();var e=this;i.on("change:page",function(){o.trigger("propagate")}),i.on("change:pathid",function(){var t=i.get("pathid");if(t&&"0"!=t){o.clear(),e.getPathToIDS();var a=e.get("pathid");e.set({pathid:t},{silent:!0}),t!=a&&e.fetch()}if("pathEditor"==i.get("page"))require(["ckeditor"],function(){}),n.history.navigate("pathwayeditor/"+t+"/node/"+i.get("code"));
else{var s=i.get("code");n.history.navigate("pathway/"+t+"/node/"+s)}}),i.on("change:code",function(){i.get("code")&&(e.getPathToIDS(),o.trigger("propagate"))}),this.on("propagate",function(){this.oldContent!=JSON.stringify(this.toJSON())?this.save(null,{error:function(){alert("Auto Save failed")}}):o.trigger("propagate")},this),this.on("sync",function(t,n){this.oldContent=JSON.stringify(this.toJSON()),this.set({pathid:n.pathid},{silent:!0}),i.set({pathid:String(n.pathid)}),s.fetch(),i.get("code")?e.getPathToIDS():"pathEditor"==i.get("page")?e.expandAll():e.collapse(),o.trigger("propagate")},this),i.get("pathid")&&(e.set({pathid:i.get("pathid")},{silent:!0}),this.getPathToIDS(),this.fetch(),o.trigger("propagate")),"pathEditor"==i.get("page")&&require(["ckeditor"],function(){}),this.elPairs=[]},getNextNodeID:function(){return this.set("nodeCount",this.get("nodeCount")+1,{silent:!0}),this.get("nodeCount")},hideSiblings:function(e){m(this,e)},collapse:function(e){g(e?e:this)},deleteNode:function(e,t){c(this,e,t),this.save()},getNodeType:function(){return"treeModel"},toJSON:function(e){e||(e={});var n=t.omit(this.attributes,["children","triggers","hasLeft","hasRight"]);return e&&e.toExport&&(n=t.omit(n,["nodeID","nodeCount","id","pathid"])),n.children=this.get("children").toJSON(e),n.triggers=this.get("triggers").toJSON(),n},loadNewPathway:function(e,t){this.set({triggers:new n.Model,sidePanelText:"",tooltip:e.tooltip,name:e.name,protocol:null,nodeCount:0,nodeID:0,folder:e.folder},{silent:!0}),this.populateChildren();var a=new l;a.populate(),this.set("triggers",a,{silent:!0}),this.unset("pathid",{silent:!0});var o=this;this.save({},{success:function(a,l){s.fetch(),e.pathid=l.pathid,t&&t.toImport?(o.parse(e,t),o.save({},{success:function(){i.set({pathid:o.get("pathid")}),n.history.navigate("pathwayeditor/"+o.get("pathid")+"/node/undefined"),s.fetch()}})):(i.set({pathid:l.pathid}),n.history.navigate("pathwayeditor/"+o.get("pathid")+"/node/undefined"),s.fetch())}})},parse:function(e,n){e.protocolVersion?this.set("protocolVersion",e.protocolVersion,{silent:!0}):this.set("protocolVersion","preversion",{silent:!0});var i=this,a={preversion:function(e,n){n&&n.toImport&&(e=t.omit(e,["nodeID","nodeCount"])),e.nodeCount?i.set("nodeCount",e.nodeCount,{silent:!0}):i.set({nodeCount:0},{silent:!0}),e.nodeID?i.set("nodeID",e.nodeID,{silent:!0}):i.set("nodeID",i.getNextNodeID(),{silent:!0}),i.set({tooltip:e.tooltip,sidePanelText:e.sidePanelText,pathid:e.pathid,protocol:e.protocol,name:e.name},{silent:!0}),i.populateChildren(e.children,n);var a=new l;a.populate(e.triggers,i.get("protocolVersion")),i.set("triggers",a,{silent:!0})},version1:function(e,n){n&&n.toImport&&(e=t.omit(e,["nodeID","nodeCount"])),e.nodeCount?i.set("nodeCount",e.nodeCount,{silent:!0}):i.set({nodeCount:0},{silent:!0}),e.nodeID?i.set("nodeID",e.nodeID,{silent:!0}):i.set("nodeID",i.getNextNodeID(),{silent:!0}),i.set({tooltip:e.tooltip,sidePanelText:e.sidePanelText,pathid:e.pathid,protocol:e.protocol,name:e.name},{silent:!0}),i.populateChildren(e.children,n);var a=new l;a.populate(e.triggers,i.get("protocolVersion")),a.on("cascade",function(){i.save(null,{error:function(){alert("Autosave Failed")}})}),i.set("triggers",a,{silent:!0})}};a[this.get("protocolVersion")](e,n),this.set("protocolVersion",d)}});return r=new v}),define("text!templates/pathway/detailSearch.html",[],function(){return'<div class = "widget-column col-sm-12">\n\n<div style="clear: both; text-align: center">\n<div>\n       <div class="input-group">\n                    <input class = "form-control" id = "Detail-Search-Box" type="text" style="min-width: 200px">\n                      <span class="input-group-btn">\n                        <button class="btn btn-default" id="searchButton">Search</button>\n                       </span>\n                       <select id = "search_results" name = \'code\' style ="text-align: center; min-width:200px" class="form-control entries hasTerm drop-down detail-input">\n\n                        <option class="\'default"></option>\n                       </select>\n       </div>\n       <button style= "float: right" class = "btn btn-default" id = "zoom-in-button">Zoom in on Concept</button>\n       <button style= "float: right" class = "btn btn-default" id = "zoom-out-button">Zoom out on Concept</button>\n\n\n</div>\n\n</div></div>\n'}),define("text!templates/pathway/resultRow.html",[],function(){return"<option value=<%=id%> term = '<%=term%>'><%=term%> (snomed: <%=id%>)</option>\n"}),define("pathway/internalViews/detailSearchBox",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/pathway/detailSearch.html","text!templates/pathway/resultRow.html"],function(e,t,n,i,a,s){var o=n.View.extend({doSearch:function(t){var n=i.toParams();e.extend(n,{search_param:e("#Detail-Search-Box").val()});var a=t.type.split("_");"dx"==a[a.length-1]?e.extend(n,{type:"snomed_diagnosis"}):"NDC"==t.type.split("_")[1]||"med"==t.type.split("_")[1]?e.extend(n,{type:"snomed_drug"}):"proc"==t.type.split("_")[1]&&e.extend(n,{type:"CPT"}),this.collection.fetch({data:e.param(n),success:function(){t.collection.length>0&&"none"!=t.collection.models[0].get("type")&&(t.ready=!0)}})},initialize:function(n){this.template=t.template(a),this.$el.html(this.template()),this.collection=n.collection,this.ready=0==this.collection.length?!1:!0,this.collection.on("add",function(){this.ready=!0},this),this.el=n.el,this.type=n.type,this.collection.on("sync",this.render,this);var s=this;e("#searchButton",this.$el)[0].onclick=function(){s.doSearch(s)},e("#zoom-in-button",this.$el)[0].on=function(){var t=i.toParams();e.extend(t,{search_param:e("#search_results").val()}),e.extend(t,{type:"snomed_zoom_in"}),s.collection.fetch({data:e.param(t)})},e("#zoom-out-button",this.$el)[0].onclick=function(){var t=i.toParams();e.extend(t,{search_param:e("#search_results").val()}),e.extend(t,{type:"snomed_zoom_out"}),s.collection.fetch({data:e.param(t)})},e("#Detail-Search-Box",this.$el)[0].onkeydown=function(e){13==e.keyCode&&s.doSearch(s)}},render:function(){e(".entries",this.$el).html("");var i=n.View.extend({template:t.template(s),render:function(){return this.model.get("route")||this.model.set("route",""),this.model.set("id",this.model.get("code")+this.model.get("route")),this.$el.html(this.template(this.model.toJSON())),this}});return t.each(this.collection.models,function(t){var n=new i({model:t});e(".entries",this.$el).append(n.render().el.innerHTML)},this),this}});return o}),define("text!templates/pathway/ListBox.html",[],function(){return'<div class = "widget-column col-sm-12">\n<select  class = "form-control" style ="text-align: center; height:100%" multiple class="selection-list">\n    <%=listEntries%>\n</select></div>\n'}),define("text!templates/pathway/groupResultRow.html",[],function(){return"<option value=<%=id%> term = '<%=term%>'><%=term%> (groupID: <%=id%>)</option>\n"}),define("pathway/internalViews/detailListBox",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/pathway/ListBox.html","text!templates/pathway/resultRow.html","text!templates/pathway/groupResultRow.html"],function(e,t,n,i,a,s,o){var l=n.View.extend({template:t.template(a),initialize:function(e){var n=this;this.collection=e.items,this.type=e.type,this.$el=e.el,"snomed_diagnosis"==this.type?n.lineTemplate=t.template(s):(this.type="groups")&&(n.lineTemplate=t.template(o)),n.collection.on("add",n.render,n),n.collection.on("remove",n.render,n),n.render()},render:function(){var e="",i=this;return t.each(this.collection.models,function(t){var a=n.View.extend({render:function(){return this.$el.html(i.lineTemplate(this.model.toJSON())),this}}),s=new a({model:t});e+=s.render().el.innerHTML},this),this.$el.html(this.template({listEntries:e})),this}});return l}),define("text!templates/pathway/multiSelectSearchPanel.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div id = "parentbox" style ="clear: both">\n    <div id="availselectorbox" style=" float:left; height: 100%; width: 40%">\n            <h3 style="clear:both; text-align:center">Select from This List</h3>\n                    <div class="col-lg-6" style = "width:100%">\n                    <div class="input-group">\n                        <input  class = "form-control search-input" >\n                      <span class="input-group-btn">\n                        <button class="btn btn-default search-button">Search</button>\n                      </span>\n                    </div>\n                    </div>\n            <div style = "clear:both; width:100%" class="available-items search-list loinc-list-box">The Available Items go Here</div>\n\n         </div>\n                <div style="float:left; width:3%"></div>\n\n        <div id ="buttonsbox" style = "text-align:center; float:left; width:15%">\n            <div style="height:100px; clear:both"></div>\n            <button class="btn btn-default add-item-button" style = "vertical-align: middle; width:70px">Add</button>\n            <button  class="btn btn-default remove-item-button" style = "vertical-align: middle;">Remove</button>\n\n        </div>\n                    <div style="float:left; width:3%"></div>\n\n        <div id = "selecteditemsbox" style = "float:left; width:40%; height:100%">\n             <h3 style="clear:both; text-align:center">Selected Items</h3>\n            <br>\n             <div style ="float: left; width:100%"class="selected-items search-list loinc-list-box">Currently Loaded Items go here</div>\n        </div>\n\n</div></div>\n'}),define("pathway/internalViews/multiSelectSearch",["jquery","underscore","backbone","globalmodels/contextModel","pathway/internalViews/detailListBox","text!templates/pathway/multiSelectSearchPanel.html"],function(e,t,n,i,a,s){var o=n.View.extend({template:t.template(s),removeSelected:function(){var n=e(".selected-items option:selected");t.each(n,function(e){e.value;t.each(this.selectedBox.collection.models,function(t){e.value==t.get("id")&&this.selected_items.remove(t)},this)},this)},addSelected:function(){var n=e(".available-items option:selected");t.each(n,function(e){e.value;t.each(this.availableBox.collection.models,function(t){e.value==t.get("id")&&this.selected_items.add(t)},this)},this)},initialize:function(t){this.$el.html(this.template());var n=this;this.type=t.type,this.avail=t.avail,this.selected_items=t.selected,this.el=t.el,this.avail.on("sync",this.render,this),"snomed_diagnosis"==this.type?(e(".search-button",this.$el)[0].onclick=function(){var t=i.toParams();e.extend(t,{search_param:e(".search-input",n.$el).val()}),e.extend(t,{type:n.type}),n.avail.fetch({data:e.param(t)})},e(".search-input",this.$el)[0].onkeypress=function(t){if(13==t.keyCode){var a=i.toParams();e.extend(a,{search_param:e(".search-input",n.$el).val()}),e.extend(a,{type:n.type}),n.avail.fetch({data:e.param(a)})}}):(e(".search-input").hide(),e(".search-button").hide()),this.render()},render:function(){return this.availableBox=new a({items:this.avail,type:this.type,el:e(".available-items",this.$el)}),this.selectedBox=new a({items:this.selected_items,type:this.type,el:e(".selected-items",this.$el)}),this},events:{"click .add-item-button":"addSelected","click .remove-item-button":"removeSelected"}});return o}),define("pathway/modalViews/detailEditor",["jquery","underscore","backbone","pathway/models/treeModel","pathway/internalViews/detailSearchBox","pathway/internalViews/multiSelectSearch"],function(e,t,n,i,a,s){var o=n.View.extend({initialize:function(o){this.group=o.group,this.model=o.model,this.newDetail=o.newDetail,this.$el=o.el,this.template=o.template,this.type=o.type,this.$el.html(this.template()),this.searchBoxes=[];var l=this,r=e(".search",this.$el);if(0!=r.length){var d=n.Collection.extend({url:"/search"}),c=new d;l.newDetail||c.add(l.model);var h=new a({collection:c,type:this.type,el:r});h.render(),this.searchBoxes.push(h)}var p=e(".multi-select-search",this.$el);e.each(p,function(e,t){var i,a=t.getAttribute("type");"snomed_diagnosis"==a?i=n.Collection.extend({url:"/search"}):"groups"==a&&(i=n.Collection.extend({url:"/groups"}));var o=new i;"groups"==a&&o.fetch();var r=new n.Collection;if(!l.newDetail)for(e in l.model.get(t.getAttribute("name"))){var d=l.model.get(t.getAttribute("name"))[e],c=l.model.get(t.getAttribute("name")+"term")[e];r.add(new n.Model({id:d,code:d,term:c,type:t.getAttribute("type")}))}new s({avail:o,type:t.getAttribute("type"),el:t,selected:r})});var u=e(".route-list",this.$el);e.each(u,function(e,t){new routeListBox({el:t})}),this.newDetail||this.fillTemplate(),this.$el.show();var m=this;e(".confirm-detail-button",this.$el)[0].onclick=function(){if(m.searchBoxes.length>0)for(var n in m.searchBoxes)if(!m.searchBoxes[n].ready)return void alert("Constraint is not complete, make sure you have a value selected in all search boxes");for(var a=e(".detail-input",m.$el),s=0;s<a.length;s++){var n=a[s];e(n).hasClass("hasTerm")&&t.each(n,function(e){e.selected&&t.each(e.attributes,function(e){m.model.set(e.name,e.value)})}),m.model.set(n.getAttribute("name"),n.value)}var o=e(".multi-select-search",this.$el);t.each(o,function(n){var i=e(".selected-items option",n),a=[],s=[];t.each(i,function(e){a.push(e.value),s.push(e.getAttribute("term"))}),m.model.set(n.getAttribute("name"),a),m.model.set(n.getAttribute("name")+"term",s)},this),m.newDetail?l.group.addDetail(m.model,m.type):i.trigger("propagate"),e("#detail-modal").modal("hide")},e(".cancel-edit-button",this.$el)[0].onclick=function(){e("#detail-modal").modal("hide")},e("#detail-modal").modal({show:"true"})},fillTemplate:function(){for(var t=e(".detail-input"),n=0;n<t.length;n++){var i=t[n];i.value=this.model.get(i.name)}}});return o}),define("text!templates/pathway/detailSection.html",[],function(){return'<div class="items">\n</div>'}),define("pathway/internalViews/detailGroup",["jquery","underscore","backbone","pathway/models/treeModel","pathway/modalViews/detailEditor","text!templates/pathway/detailSection.html"],function(e,t,n,i,a,s){var o=n.View.extend({template:t.template(s),initialize:function(e){this.lineTemplate=e.lineTemplate,this.list=e.list,this.type=e.type,this.group=e.group,this.el=e.el},render:function(){this.$el.html("");var i=this.type,s=n.View.extend({initialize:function(n){this.el=n.el,this.$el.html(n.text),this.group=n.group,this.detail=n.detail;var s=this;e(".detail-item",this.$el).off("click"),e(".detail-item",this.$el).on("click",function(){require(["text!/templates/pathway/details/"+i+"_editor.html"],function(n){var o=new a({group:s.group,model:s.detail,el:e("#detailed-trigger-modal"),template:t.template(n),type:i});o.render()})}),e(".remove-detail",this.$el).off("click"),e(".remove-detail",this.$el).on("click",function(){s.group.get("details").get(i).remove(s.detail)})}});return this.list.each(function(t){t.off("change"),t.on("change",this.render,this),this.$el.append("<div class = 'item-holder'></div>");var n={};for(var i in t.attributes){var a=t.attributes[i];n[i]=a.models?a.models:a}new s({group:this.group,el:e(".item-holder",this.$el).last(),text:this.lineTemplate(n),detail:t})},this),this}});return o}),define("Helpers",["jquery","underscore","backbone"],function(){var e={detailHeadings:{enc_pl_dx:"Encounter or Problem List Diagnosis",pl_dx:"Problem List Diagnosis",hist_dx:"Historical Diagnosis",lab:"Lab Results",enc_dx:"Encounter Diagnosis",hist_proc:"Historic Procedure",enc_proc:"(unusued) Encounter Procedure",ml_med:"Medication List",vitals:"Vital Signs",vitals_bp:"Disjunctive Blood Pressure Detail"},detailDescriptions:{enc_pl_dx:"Specify a constraint based on a diagnosis that can be found either in the current encounter or on the patientâs problem list. This would represent a fairly comprehensive set of acute and chronic diagnoses that are likely to be currently active for the patient.",pl_dx:"Specify a constraint based on a diagnosis in the patientâs problem list. The patient problem list is a patient-level section of the medical record that catalogs the most important diagnoses for the patient",hist_dx:"Specify a constraint based on a diagnosis in the patientâs diagnostic history",lab:"Specify a constraint based on the patient's lab results",enc_dx:"Specify a constraint based on any diagnosis currently associated with the encounter such as chief complaints, differential diagnoses, or symptoms that have been discretely documented and transmitted to Maven. ",hist_proc:"Specify a constraint based on procedures that the patient has undergone in the past",enc_proc:"(unusued) Encounter Procedure",ml_med:"Specify a constraint based on medications that the patient is currently taking according to the medical record",vitals:"Specify a constraint based on the patient's vitals",vitals_bp:"Specify a constraint based on the patient's blood pressure which allows for EITHER the systolic OR diastolic to be within a given range"},notDetail:["id","evidence","genders","minAge","maxAge","name","triggers","triggerType","sources","detID","conflicts","treeInfo"]};return e}),define("text!templates/pathway/disjoinedGroups.html",[],function(){return'<div id="group-<%=groupID%>" style="padding: 8px;  >\n<div  style = " font-size: 130%; margin-bottom: 8px; ">Show Alert if\n<input class="toggles" type="checkbox">\nof these are true\n<div class="group-delete" id="delete-<%=groupID%>" style="float:right"><a>&#10006</a></div>\n</div>\n\n\n<div style="font-size: 70%" class=\'detail-sections\'></div>\n\n</div>\n'}),define("text!templates/pathway/RuleWizard.html",[],function(){return'<div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" style="z-index: 1030">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal"><span\n                        aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                <h4 class="modal-title">Pathway Triggers</h4>\n            </div>\n\n            <div class="modal-body">\n\n                <div style = "clear:both" class="detail-sections"><div style="text-align: center;">All of the Following Groups of Requirements Must be Fulfilled in Order to Show the\n    Pathway\n                </div></div>\n\n                <br>\n<div style="margin-left: 15%; margin-right:15%; max-width: 60%" id="disjoinedGroups">\n\n\n</div>\n\n\n<br>\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id=\'enc_dx\'\n         title="Specify a constraint based on any diagnosis currently associated with the encounter such as chief complaints, differential diagnoses, or symptoms that have been discretely documented and transmitted to Maven."\n            >\n        Encounter Diagnosis\n    </div>\n</div>\n\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="hist_dx"\n         title="Specify a constraint based on a diagnosis in the patientâs diagnostic history"\n            >\n        Historic Diagnosis\n    </div>\n</div>\n\n\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="pl_dx"\n         title="Specify a constraint based on a diagnosis in the patientâs problem list"\n            >\n        Problem List Diagnosis\n    </div>\n</div>\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="all_dx"\n         title="Specify a constraint based on a diagnosis in the patientâs problem list"\n            >\n        All Diagnoses\n    </div>\n</div>\n<div style="float:left">\n    <div class=\'detailButton btn-default btn\'\n         id="membership"\n         title="Specify a constraint based on the receiving clinicians group memberships"\n            >\n        Clinician Groups\n    </div>\n</div>\n<button id="add-group-button" class="btn btn-default" >Add Group</button>\n\n\n\n            </div>\n            <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n                    <button id="back-to-editor" class="btn btn-primary">Confirm</button>\n                </div>\n        </div>\n    </div>\n</div>'}),define("pathway/modalViews/ruleWizard",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/layoutModel","pathway/modalViews/detailEditor","pathway/internalViews/detailGroup","pathway/models/treeModel","Helpers","text!templates/pathway/detailSection.html","text!templates/pathway/disjoinedGroups.html","text!templates/pathway/RuleWizard.html","bootstrapswitch"],function(e,t,n,i,a,s,o,l,r,d,c,h){var p=function(n,i,a){require(["text!/templates/pathway/details/"+n+"Detail.html"],function(n){return function(s){var l=i.get("details").get(n),r=t.template(s),c=t.template(d);a.append(c());var h=new o({group:i,el:e(".items").last(),lineTemplate:r,list:l,type:n});h.render()}}(n))},u=n.View.extend({el:"#modal-target",initialize:function(){this.template=t.template(h),this.$el.html(this.template()),e(".detailButton").draggable({revert:!0}),this.render()},render:function(){var i=this;l.once("sync",function(){i.render()}),e("#add-group-button").on("click",function(){l.get("triggers").addGroup("and")});var a=n.View.extend({template:t.template(c),initialize:function(a){this.group=a.group,this.$el.droppable({drop:function(a,o){console.log(this.group);var l=o.draggable[0].id;require(["text!templates/pathway/details/"+l+"_editor.html"],function(a){var o=new s({group:self.group,template:t.template(a),model:new n.Model,newDetail:!0,el:e("#detailed-trigger-modal"),triggerNode:i.triggerNode,type:l});o.render()})},activeClass:"activeDrop",hoverClass:"hoverDrop"})},render:function(){var t=this;this.$el.css({"border-style":"solid","border-width":"4px"});var n={relationship:this.group.get("relationship"),groupID:this.group.cid};this.$el.html(this.template(n)),e(".group-delete",this.$el).on("click",function(){l.get("triggers").remove(t.group)}),e(".toggles",this.$el).bootstrapSwitch(),e(".toggles",this.$el).bootstrapSwitch("onText","Any"),e(".toggles",this.$el).bootstrapSwitch("offText","All"),"and"==t.group.get("relationship")?e(".toggles",this.$el).bootstrapSwitch("state",!1,!1):e(".toggles",this.$el).bootstrapSwitch("state",!0,!1),e(".toggles",this.$el).on("switchChange.bootstrapSwitch",function(){0==e(".toggles",t.$el).bootstrapSwitch("state")?t.group.set("relationship","and"):t.group.set("relationship","or")});for(var i in this.group.get("details").attributes){var a=e(".detail-sections",this.$el);p(i,this.group,a)}return this}});for(var o in l.get("triggers").models){var r=new a({group:l.get("triggers").models[o]});e("#disjoinedGroups").append(r.$el),e("#disjoinedGroups").append("<div style='height:25px'></div>"),r.render()}e("#detail-modal").modal({show:"true"})}});return u}),define("text!templates/pathway/newPathwayFolder.html",[],function(){return'<div class="widget-column col-sm-6">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-body">\n                    <form>\n                        <div class="input-group input-group-sm" style="max-width:360px;">\n                            Folder Name:<input type="text" class="form-control pathwayFolderName" name="folderName" value="">\n                        </div>\n                    </form>\n                </div>\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary createPathwayFolder">Create</button>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/newPathwayFolder",["jquery","underscore","backbone","pathway/models/pathwayCollection","text!templates/pathway/newPathwayFolder.html"],function(e,t,n,i,a){var s,o=n.View.extend({template:t.template(a),parentList:[],parentFolder:null,events:{"click .createPathwayFolder":"handleCreateFolder"},initialize:function(t){s=require("pathway/singleRows/folderRow"),"undefined"!=typeof t.parentFolder&&(this.parentFolder=t.parentFolder),"undefined"!=typeof t.parentList&&(this.parentList=t.parentList),this.$el.html(this.template(this.attributes)),e("#detail-modal").modal({show:"true"})},handleCreateFolder:function(){e("#detail-modal").modal("hide");var t=e(".pathwayFolderName",this.$el).val(),i=new n.Model({name:t}),a=new s({model:i,parentList:this.parentList});null!==this.parentFolder?this.parentFolder.append(a.render().$el):e("#avail-paths-list").append(a.render().$el),e(document).ready(function(){e(a.el).removeClass("dd-collapsed")}),this.undelegateEvents(),delete this.$el,delete this.el}});return o}),define("text!templates/pathway/sendProtocol.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-body" style=\'margin-bottom: 20;\'>\n                    <div class="row">\n                    <div class="col-sm-6">\n                        <div class="row">\n                            <div class="search-box" style=\'width:10%;\'></div>\n                            <form class="search-box">\n                                <div class="input-group input-group-sm" style="max-width:360px;">\n                                      Send To:<input type="text" class="form-control" placeholder="Search Provider"\n                                         name="protocolRecipient" id="protocolRecipient" value="<%= typeof(defaultRecipient) !== \'undefined\' ? defaultRecipient : \'\' %>">\n                                    <input id="recipientUserName" type="hidden" value="<%= typeof(defaultRecipientName) !== \'undefined\' ? defaultRecipientName : \'\' %>">\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                    <div class="col-sm-6">\n                        <div class="row">\n                            Quick Note:<textarea size=10 id="sendProtocolNote" type="text" class="form-control"\n                                                 placeholder=""><%= typeof(defaultQuickNote) != \'undefined\' ? defaultQuickNote : \'\' %></textarea>\n                        </div>\n                    </div>\n                    </div>\n                </div>\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="sendProtocolButton">Send</button>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/sendProtocol",["jquery","underscore","backbone","pathway/models/nodeModel","globalmodels/contextModel","text!templates/pathway/sendProtocol.html"],function(e,t,n,i,a,s){var o=n.View.extend({template:t.template(s),el:e("#modal-target"),initialize:function(t){var n=this;this.parent=t,this.$el.html(this.template(n.attributes)),e("#detail-modal").modal({show:"true"}),e("#sendProtocolButton",this.$el).on("click",function(){e("#detail-modal").modal("hide");var t=e("#recipientUserName").val(),i=e("#sendProtocolNote").val()+"\r\n "+a.get("official_name")+" would like you to review this patient. \r\n"+window.location.protocol+"//"+window.location.host+"#/pathway/"+a.get("pathid")+"/node/"+n.parent.get("nodeID")+"/patient/"+a.get("patients")+"/"+(new Date).toISOString().substr(0,10)+"/login/"+t+"/"+a.get("customer")+"/\r\n";e.ajax({type:"POST",dataType:"json",url:"/send_message?"+e.param(a.toParams())+"&target_user="+t,data:JSON.stringify({subject:"Please review this patient - "+a.get("official_name"),message:i}),error:function(){alert("There was a problem sending the message.")}})}),e("#protocolRecipient").autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(a.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){t.preventDefault(),n.item&&(e(t.target).val(n.item.label),e("#recipientUserName").val(n.item.value))}})}});return o}),define("text!templates/pathway/NewNodeModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">\n                        <% if (name) { %>\n                        Editing : <%= name %>\n                        <% } else { %>\n                        New Node\n                        <% } %>\n                    </h4>\n                </div>\n\n                <div class="modal-body">\n                    <div class="form-group">\n                        <span class="headings">Node Name:</span>\n                        <input id="newNodeText" type="text" class="form-control" placeholder=""\n                        <% if (name) { %>\n                        value="<%= name %>"\n                        <% } %>\n                        >\n\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Node Tooltip (helping text):</span>\n                        <input id="newNodeTooltip" class="form-control" placeholder=""\n                        <% if (name) { %>\n                        value="<%= tooltip %>"\n                        <% } %>\n                        >\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Node Side Panel Text:</span>\n                        <textarea id="newNodeSideText" class="form-control" placeholder="">\n                            <% if (name) { %>\n                            <%= sidePanelText %>\n                            <% } %>\n                        </textarea>\n                    </div>\n\n                </div>\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="addNodeButton">\n                        <% if (name) { %>\n                            Save Changes\n                        <% } else { %>\n                        Confirm\n                        <% } %>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!templates/pathway/NewProtocolModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">New Protocol</h4>\n                </div>\n\n                <div class="modal-body">\n                    <div class="form-group">\n                        <span class="headings">Protocol:</span>\n                        <textarea id="ProtocolText" type="text" class="form-control" placeholder=""></textarea>\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Note to copy:</span>\n                        <textarea id="NoteToCopyText" class="form-control" placeholder=""></textarea>\n                    </div>\n\n                    <div class="form-group">\n                        <span class="headings">Send Defaults:</span><br/>\n                        <div class="row">\n                            <div class="col-sm-6">\n                                <div class="row">\n                                    <div class="search-box" style=\'width:10%;\'></div>\n                                    <form class="search-box">\n                                        <div class="input-group input-group-sm control-group" style="max-width:360px;">\n                                              Recipient:<input type="text" class="form-control" placeholder="Search Provider"\n                                                 name="protocolRecipient" id="defaultRecipient" >\n                                            <input id="defaultRecipientName" name="defaultRecipientName" type="hidden" value="">\n                                        </div>\n                                    </form>\n                                </div>\n                            </div>\n                            <div class="col-sm-6">\n                                <div class="row">\n                                    Quick Note:<textarea size=10 id="defaultQuickNote" type="text" class="form-control" placeholder=""></textarea>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="form-group" >\n                        <span class="glyphicon glyphicon-chevron-right show-advanced-settings"></span>\n                        <span class="headings">Advanced</span><br/>\n                    </div>\n\n                    <div class="form-group advanced-settings">\n                        <div class="row followup-header">\n                            <div class="col-sm-6">\n                                    <span class="headings">Timed Followup Plan</span>\n                            </div>\n                            <div class="col-sm-6">\n                                <div class="input-group input-group-sm" style="max-width:360px;">\n                                    Default Recipient:<input type="text" class="form-control" placeholder="Search Provider"\n                                                     name="defaultFollowupRecipient" id="defaultFollowupRecipient">\n                                                <input id="defaultFollowupRecipientName" name="defaultFollowupRecipientName" type="hidden" value="">\n                                    </div>\n                            </div>\n                        </div>\n                        <div class="row followup-header-columns" style="display:none;">\n                            <div class="col-sm-6">\n                                    <span class="headings">What</span>\n                            </div>\n                            <div class="col-sm-2">\n                                    <span class="headings">When</span>\n                            </div>\n                            <div class="col-sm-1">\n                                    <span class="headings">Who</span>\n                            </div>\n                            <div class="col-sm-1">\n                                &nbsp;\n                                <!-- <span class="headings">Repeat</span> -->\n                            </div>\n                        </div>\n                        <div id="followups">\n\n                        </div>\n                        <div class="row followup-footer">\n                            <div class="col-sm-12">\n                                <button type="button" id=\'add-new-followup\'  class="btn btn-default btn-xs">\n                                    <span class="glyphicon glyphicon-plus"></span>\n                                </button> New Followup\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="addNodeButton">Confirm</button>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>'
}),define("text!templates/reminderRow.html",[],function(){return'    <div class="row">\n        <div class="col-sm-1">\n            <span class="headings">Subject</span>\n        </div>\n        <div class="col-sm-5">\n            <input type="text" class="form-control reminderSubject" name="reminderSubject" value="<%= (typeof msg_subject !== \'undefined\') ? msg_subject : \'\' %>">\n        </div>\n        <div class="col-sm-2">\n            <div class="input-group input-group-sm" style="width:100%;">\n                <input type="text" class="form-control reminderTime datePickerTextBox" name="reminderTime" readonly="readonly"\n                       value="<%= (typeof due !== \'undefined\') ? due : \'\' %>">\n            </div>\n        </div>\n        <div class="col-sm-2">\n            <div class="input-group input-group-sm control-group" style="width:100%;">\n                <input type="text" class="form-control followupRecipient" placeholder="Search Provider"\n                       name="followupRecipient" value="<%= (typeof followupRecipient !== \'undefined\') ? followupRecipient : \'\' %>">\n                <input class="followupRecipientName" name="followupRecipientName" type="hidden"\n                       value="<%= (typeof followupRecipientName !== \'undefined\') ? followupRecipientName : \'\' %>">\n            </div>\n        </div>\n        <div class="col-sm-1">\n            <% if (typeof edit !== \'undefined\') { %>\n            <button type="button" class="btn btn-default btn-block deleteFollowup">\n                <span class="glyphicon glyphicon-remove"></span>\n            </button>\n            <% } %>\n        </div>\n    </div>\n\n    <div class="row ">\n        <div class="col-sm-1">\n            <span class="headings">Message</span>\n        </div>\n        <div class="col-sm-5">\n            <input type="text" class="form-control reminderText" name="reminderText" value="<%= (typeof msg_body !== \'undefined\') ? msg_body : \'\' %>">\n        </div>\n        <div class="col-sm-2">\n            &nbsp;\n            <!--<div class="input-group input-group-sm" style="max-width:360px;">\n                <select class="form-control reminderFrequency" name="reminderFrequency">\n                    <option value="Never">Never</option>\n                </select>\n            </div> -->\n        </div>\n        <div class="col-sm-3">\n            &nbsp;\n        </div><!--\n        <div class="col-sm-1">\n            <% if (typeof sendMode !== \'undefined\') { %>\n            <button type="button" class="btn btn-primary sendCurrentFollowup">Send</button>\n            <% } %>\n        </div> -->\n    </div>'}),define("singleRow/reminderRow",["jquery","underscore","backbone","text!templates/reminderRow.html","globalmodels/contextModel"],function(e,t,n,i,a){var s=n.View.extend({template:t.template(i),initialize:function(){this.render()},render:function(){return e(".followup-header-columns").show(),e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),that=this,e(document).ready(function(){e(".reminderTime",that.$el).datepicker(),e("#ui-datepicker-div").css("z-index","10000 !important"),e(".followupRecipient",that.$el).autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(a.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){t.preventDefault(),e(t.target).parent().removeClass("has-error"),e(".sendCurrentFollowup",this.$el).removeAttr("disabled"),n.item&&(e(t.target).val(n.item.label),e(".followupRecipientName",that.$el).val(n.item.value)),e(this).trigger("change")},change:function(t,n){e(t.target).parent().removeClass("has-error"),e(".sendCurrentFollowup",this.$el).removeAttr("disabled"),n.item||(e(".followupRecipientName",that.$el).val(""),""!==e(t.target).val()&&(e(t.target).parent().addClass("has-error"),e(".sendCurrentFollowup",this.$el).prop("disabled",!0)))},autoFocus:!0,focus:function(e){e.preventDefault()}})}),this},events:{"click .deleteFollowup":"removeFollowup","click .sendCurrentFollowup":"sendFollowup"},removeFollowup:function(){e(this.el).remove(),console.log("removing followup")},getCurrentParams:function(){var t=e(".reminderSubject",this.el).val(),n=e(".reminderText",this.el).val(),i=e(".reminderTime",this.el).val(),a=e(".followupRecipient",this.$el).val(),s=e(".followupRecipientName",this.$el).val();return""==t&&""==n&&""==i&&""==a&&""==s?{}:{msg_subject:t,msg_body:n,due:i,followupRecipient:a,followupRecipientName:s}},sendFollowup:function(){var t=e(".reminderSubject",this.$el).val(),n=e(".reminderText",this.$el).val(),i=e(".reminderTime",this.$el).val();""!=i&&(i+="T00:00:00.000Z");var s=e(".followupRecipientName",this.$el).val();""==t&&(t="Followup from "+(new Date).toISOString().substr(0,10)),""==s&&(s=e("#defaultFollowupRecipientName").val());var o="&userid="+a.get("userid");""!=s&&(o+="&target_user="+s),e.ajax({type:"POST",dataType:"json",url:"/add_task?"+e.param(a.toParams())+o,data:JSON.stringify({msg_subject:t,msg_body:n,delivery:"ehrinbox",due:i}),error:function(){alert("There was a problem sending this followup: "+t)},success:function(){}})}});return s}),define("pathway/modalViews/editNode",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeContext","pathway/models/treeModel","text!templates/pathway/NewNodeModal.html","text!templates/pathway/NewProtocolModal.html","singleRow/reminderRow"],function(e,t,n,i,a,s,o,l,r){var d,c=n.View.extend({el:e("#modal-target"),initialize:function(){that=this,a.get("selectedNode").attributes.isProtocol?(this.template=t.template(l),this.$el.html(this.template(a.get("selectedNode").attributes)),d=new Array,"undefined"!=typeof a.get("selectedNode").attributes.followups&&e(a.get("selectedNode").attributes.followups).each(function(){e("#followups",that.$el).append("<div class='followup'></div>"),el=e(".followup",e("#followups",that.$el)).last();var t=new r({model:new n.Model(this),el:el});d.push(t),t.$el.bind("remove",{followup:t},that.removeFollowup)}),e("#addNodeButton").length&&(e("#addNodeButton")[0].onclick=function(){var n=CKEDITOR.instances.ProtocolText.getData();a.get("selectedNode").set("protocol",n),a.get("selectedNode").set("noteToCopy",e("#NoteToCopyText",this.$el).val());var i=e("#defaultRecipient").val(),o=e("#defaultRecipientName").val(),l=e("#defaultQuickNote").val(),r=e("#defaultFollowupRecipient").val(),c=e("#defaultFollowupRecipientName").val(),h=[];e(d).each(function(){var e=this.getCurrentParams();t.isEmpty(e)||h.push(e)}),a.get("selectedNode").set("defaultRecipient",i),a.get("selectedNode").set("defaultRecipientName",o),a.get("selectedNode").set("defaultQuickNote",l),a.get("selectedNode").set("followups",h),a.get("selectedNode").set("defaultFollowupRecipient",r),a.get("selectedNode").set("defaultFollowupRecipientName",c),e("#detail-modal").modal("hide"),s.trigger("propagate")}),e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("ProtocolText"),CKEDITOR.instances.ProtocolText.setData(a.get("selectedNode").get("protocol"))}),e("#NoteToCopyText",this.$el).val(a.get("selectedNode").get("noteToCopy")),e(".show-advanced-settings",this.$el).off("click"),e(".show-advanced-settings",this.$el).on("click",function(t){e(".advanced-settings",that.$el).is(":visible")?(e(t.target).switchClass("glyphicon-chevron-down","glyphicon-chevron-right",0),e(".advanced-settings",that.$el).slideUp(200)):(e(t.target).switchClass("glyphicon-chevron-right","glyphicon-chevron-down",0),e(".advanced-settings").slideDown(200))}),e("#add-new-followup",this.$el).on("click",function(){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var t=new r({model:new n.Model({edit:!0}),el:el});d.push(t),t.$el.bind("remove",{followup:t},that.removeFollowup)}),e("#defaultRecipient, #defaultFollowupRecipient",this.$el).autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(i.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){if(t.preventDefault(),e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),n.item){e(t.target).val(n.item.label);var i="#"+t.target.id+"Name";e(i).val(n.item.value)}e(this).trigger("change")},change:function(t,n){if(e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),!n.item){var i="#"+t.target.id+"Name";e(i).val(""),""!==e(t.target).val()&&(e(t.target).parent().addClass("has-error"),e("#addNodeButton",this.$el).prop("disabled",!0))}},autoFocus:!0,focus:function(e){e.preventDefault()}})):(this.template=t.template(o),this.$el.html(this.template(a.get("selectedNode").attributes)),e("#addNodeButton")[0].onclick=function(){a.get("selectedNode").set("name",e("#newNodeText",this.$el).val()),a.get("selectedNode").set("tooltip",e("#newNodeTooltip",this.$el).val());var t=CKEDITOR.instances.newNodeSideText.getData();a.get("selectedNode").set("sidePanelText",t),e("#detail-modal").modal("hide"),s.trigger("propagate")},e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("newNodeSideText")}))},removeFollowup:function(e){d=t.without(d,e.data.followup)}});return c}),define("text!templates/pathway/sendFollowups.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-dialog-lg">\n            <div class="modal-content">\n                <div class="modal-body" style=\'margin-bottom: 20;\'>\n                        <div class="row followup-header">\n                            <div class="col-sm-6">\n                                    <span class="headings">Send Followups</span>\n                            </div>\n                            <div class="col-sm-6">\n                                <div class="input-group input-group-sm" style="max-width:360px;">\n                                    Default Recipient:<input type="text" class="form-control" placeholder="Search Provider" disabled\n                                                     name="defaultFollowupRecipient" id="defaultFollowupRecipient"\n                                                     value="<%= (typeof defaultFollowupRecipient !== \'undefined\') ? defaultFollowupRecipient : \'\' %>">\n                                                <input id="defaultFollowupRecipientName" name="defaultFollowupRecipientName" type="hidden"\n                                                       value="<%= (typeof defaultFollowupRecipientName !== \'undefined\') ? defaultFollowupRecipientName : \'\' %>">\n                                    </div>\n                            </div>\n                        </div>\n                        <div class="row followup-header-columns">\n                            <div class="col-sm-6">\n                                    <span class="headings">What</span>\n                            </div>\n                            <div class="col-sm-2">\n                                    <span class="headings">When</span>\n                            </div>\n                            <div class="col-sm-1">\n                                    <span class="headings">Who</span>\n                            </div>\n                            <div class="col-sm-1">\n                                &nbsp;\n                                <!-- <span class="headings">Repeat</span> -->\n                            </div>\n                        </div>\n                        <div id="followups">\n\n                        </div>\n                        <div class="row followup-footer">\n                            <div class="col-sm-12">\n                                <span id=\'add-new-followup\' class="glyphicon glyphicon-plus"></span>New Reminder\n                            </div>\n                        </div>\n                </div>\n\n                <div class="modal-footer">\n                    <div id="send-followups-message"></div>\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="sendFollowupsButton">Send All</button>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/sendFollowups",["jquery","underscore","backbone","pathway/models/nodeModel","globalmodels/contextModel","text!templates/pathway/sendFollowups.html","singleRow/reminderRow"],function(e,t,n,i,a,s,o){var l,r=n.View.extend({template:t.template(s),el:e("#modal-target"),initialize:function(t){var i=this;this.parent=t,this.$el.html(this.template(this.attributes)),e("#detail-modal").modal({show:"true"}),l=new Array;var a=!0;if("undefined"!=typeof this.attributes.followups&&e(this.attributes.followups).each(function(){a=!1,this.sendMode=!0,e("#followups",i.$el).append("<div class='followup'></div>"),el=e(".followup",e("#followups",i.$el)).last();var t=new o({model:new n.Model(this),el:el});l.push(t),t.$el.bind("remove",{followup:t},i.removeFollowup)}),a){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var s=new o({model:new n.Model({edit:!0}),el:el});l.push(s),s.$el.bind("remove",{followup:s},i.removeFollowup)}e("#add-new-followup",this.$el).on("click",function(){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var t=new o({model:new n.Model({edit:!0,sendMode:!0}),el:el});l.push(t),t.$el.bind("remove",{followup:t},i.removeFollowup)}),e("#sendFollowupsButton",this.$el).on("click",function(){e(l).each(function(){this.sendFollowup()}),alert("Followups Sent"),e("#detail-modal").modal("hide")})},removeFollowup:function(e){l=t.without(l,e.data.followup),console.log("Removing from send followups")}});return r}),define("pathway/Helpers",["jquery","underscore","backbone"],function(){var e={detailHeadings:{enc_pl_dx:"Encounter or Problem List Diagnosis",pl_dx:"Problem List Diagnosis",hist_dx:"Historical Diagnosis",all_dx:"Historical Diagnosis",lab:"Lab Results",enc_dx:"Encounter Diagnosis",hist_proc:"Historic Procedure",enc_proc:"(unusued) Encounter Procedure",ml_med:"Medication List",vitals:"Vital Signs",vitals_bp:"Disjunctive Blood Pressure Detail"},detailDescriptions:{enc_pl_dx:"Specify a constraint based on a diagnosis that can be found either in the current encounter or on the patientâs problem list. This would represent a fairly comprehensive set of acute and chronic diagnoses that are likely to be currently active for the patient.",pl_dx:"Specify a constraint based on a diagnosis in the patientâs problem list. The patient problem list is a patient-level section of the medical record that catalogs the most important diagnoses for the patient",hist_dx:"Specify a constraint based on a diagnosis in the patientâs diagnostic history",lab:"Specify a constraint based on the patient's lab results",enc_dx:"Specify a constraint based on any diagnosis currently associated with the encounter such as chief complaints, differential diagnoses, or symptoms that have been discretely documented and transmitted to Maven. ",hist_proc:"Specify a constraint based on procedures that the patient has undergone in the past",enc_proc:"(unusued) Encounter Procedure",ml_med:"Specify a constraint based on medications that the patient is currently taking according to the medical record",vitals:"Specify a constraint based on the patient's vitals",vitals_bp:"Specify a constraint based on the patient's blood pressure which allows for EITHER the systolic OR diastolic to be within a given range"},notDetail:["id","treeInfo","evidence","genders","minAge","maxAge","name","triggers","triggerType","sources","detID","conflicts"]};return e}),define("text!templates/pathway/triggerEditor.html",[],function(){return'<div id="detail-modal" class="modal fade"  role="dialog" aria-hidden="true" data-backdrop="static">\n    <div class="modal-dialog" style="width: 1000px">\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal"><span\n                        aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                <h4 class="modal-title">Protocol Triggering Diagnoses</h4>\n            </div>\n\n            <div class="modal-body">\n\n                <div class=\'detail-editor-heading\'>Create/Edit Assessment &amp; Plan Diagnosis Constraint</div>\n\n\n                <select id="existsField" class="detail-input form-control attn-text"\n                        name="exists">\n                    <option value="true" selected>Alert the clinician only if</option>\n                    <option value="false"> Do not alert the clinician if</option>\n                </select>\n\n                <p class="attn-text"> The patient\'s Assessment &amp; Plan contains any of the following diagnoses </p>\n\n                <div class="multi-select-search" type="snomed_diagnosis" name="code"></div>\n            </div>\n\n\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                <button type="button" class="btn btn-primary" id="confirmDetailButton">Confirm</button>\n            </div>\n\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/detailEditor_archaic",["jquery","underscore","backbone","pathway/Helpers","pathway/internalViews/detailSearchBox","pathway/internalViews/multiSelectSearch","text!templates/pathway/triggerEditor.html"],function(e,t,n,i,a,s,o){var l=n.View.extend({template:t.template(o),el:"#detailed-trigger-modal",initialize:function(i){this.triggerNode=i.triggerNode,this.$el.html(this.template());var a=e(".multi-select-search",this.$el),o=this;e.each(a,function(e,t){var i=n.Collection.extend({url:"/search"}),l=new n.Collection;o.searchBox=new s({avail:new i,type:t.getAttribute("type"),el:a,selected:l})}),e(".cancel-edit-button",this.$el).on("click",function(){e("#detail-modal").modal("hide")}),e("#confirmDetailButton",this.$el).on("click",function(){t.each(o.searchBox.selected_items.models,function(t){o.triggerNode.get("triggers")||o.triggerNode.set({triggers:new n.Collection},{silent:!0}),t.set("exists",e("#existsField").val()),o.triggerNode.get("triggers").get("enc_dx")||o.triggerNode.get("triggers").set("enc_dx",new n.Collection),o.triggerNode.get("triggers").get("enc_dx").add()}),e("#detail-modal").modal("hide")})},render:function(){e("#detail-modal").modal({show:"true"})}});return l}),define("pathway/modalViews/nodeEditor",["jquery","underscore","backbone","pathway/models/nodeModel","pathway/models/treeModel","pathway/models/treeContext","globalmodels/contextModel","text!templates/pathway/NewNodeModal.html"],function(e,t,n,i,a,s,o,l){var r=n.View.extend({template:t.template(l),el:e("#modal-target"),initialize:function(t,n){var o=this;this.$el.html(this.template()),e("#addNodeButton")[0].onclick=function(){t.unset("protocol",{silent:!0});var l=CKEDITOR.instances.newNodeSideText.getData(),r=new i({tooltip:e("#newNodeTooltip",o.$el).val(),name:e("#newNodeText",this.$el).val(),sidePanelText:l},a),d=t.get("children").length;n&&(d=t.get("children").indexOf(n),t.get("children").remove(n,{silent:!0}),r.get("children").add(n,{silent:!0}),r.showChildren(),a.trigger("propagate")),o.parent.get("children").models[0]&&(o.parent.get("children").models[0].get("children")||o.parent.get("children").reset()),o.parent.get("children").add(r,{at:d}),s.set("selectedNode",r,{silent:!0}),a.trigger("propagate"),e("#detail-modal").modal("hide")};var o=this;this.parent=t,e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("newNodeSideText")})}});return r}),define("text!templates/pathway/newPathway.html",[],function(){return'<div id="newpathwaymodal" class="modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div id="modal-wizard-container">\n                <div class="modal-header">\n                    <h4 class="modal-title">Enter Pathway Name:</h4>\n                </div>\n\n                <div class="modal-body">\n                    <form class="bootbox-form"><input id="newPathName"\n                                                      class="bootbox-input bootbox-input-text form-control" type="text">\n                    </form>\n\n                </div>\n            </div>\n\n            <div class="modal-footer wizard-actions">\n                <button class="btn btn-primary btn-sm" id="create-button">Create New Pathway</button>\n\n                <button class="btn btn-grey btn-sm pull-left" data-dismiss="modal">\n                    <i class="ace-icon fa fa-times"></i>\n                    Cancel\n                </button>\n            </div>\n        </div>\n    </div>\n</div><!-- PAGE CONTENT ENDS -->\n\n'}),define("pathway/modalViews/newPathway",["jquery","underscore","backbone","pathway/models/treeModel","text!templates/pathway/newPathway.html"],function(e,t,n,i,a){var s=n.View.extend({template:t.template(a),parentList:"",parentFolder:null,events:{"click #create-button":"handle_createPathway"},initialize:function(t){"undefined"!=typeof t.parentList&&(this.parentList=t.parentList.join("/")),"undefined"!=typeof t.parentFolder&&(this.parentFolder=t.parentFolder),this.$el.html(this.template()),e("#newpathwaymodal").modal({show:"true"})},handle_createPathway:function(){e("#newpathwaymodal").modal("hide"),i.loadNewPathway({name:e("#newPathName").val(),folder:this.parentList,parentFolder:this.parentFolder}),this.undelegateEvents(),delete this.$el,delete this.el}});return s}),define("text!templates/pathway/richTextEditor.html",[],function(){return'    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">New Node</h4>\n                </div>\n\n                <div class="modal-body">\n\n                    <div class="form-group">\n                        <textarea id="richText" class="form-control" placeholder=""></textarea>\n                    </div>\n\n\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                    <button type="button" class="btn btn-primary" id="confirmButton">Confirm</button>\n                </div>\n            </div>\n        </div>\n    </div>\n'}),define("pathway/modalViews/sidePanelEditor",["jquery","underscore","backbone","pathway/models/nodeModel","pathway/models/treeContext","globalmodels/contextModel","text!templates/pathway/richTextEditor.html"],function(e,t,n,i,a,s,o){var l=n.View.extend({template:t.template(o),el:e("#modal-target"),initialize:function(){this.$el.html(this.template()),e("#confirmButton")[0].onclick=function(){var t=CKEDITOR.instances.richText.getData();a.get("selectedNode").set("sidePanelText",t),e("#detail-modal").modal("hide")},e("#detail-modal").modal({show:"true"}),require(["ckeditor"],function(){CKEDITOR.replace("richText")})}});return l}),define("text!templates/pathway/deleteModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="detail-modal" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" data-dismiss="modal"><span\n                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                    <h4 class="modal-title">\n                        Delete Dialog\n                    </h4>\n                </div>\n\n                <div class="modal-body">\n                    Would you like to delete only this node, or this node and all of its children\n                    <br>\n                    <button class =\'btn btn-default\' id = "thisNode">The Selected Node</button>\n                    <button class = \'btn btn-default\' id = "allChildren">The Selected Node and All Children</button>\n                    <button class =\'btn btn-default\' id = "cancel">Cancel</button>\n\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("pathway/modalViews/DeleteDialog",["jquery","underscore","backbone","pathway/models/treeModel","pathway/models/treeContext","text!templates/pathway/deleteModal.html"],function(e,t,n,i,a,s){var o=n.View.extend({template:t.template(s),el:"#modal-target",initialize:function(){this.$el.html(this.template()),e("#detail-modal").modal("show"),e("#thisNode").on("click",function(){i.deleteNode(a.get("selectedNode"),!0),e("#detail-modal").modal("hide")}),e("#allChildren").on("click",function(){i.deleteNode(a.get("selectedNode"),!1),e("#detail-modal").modal("hide")}),e("#cancel").on("click",function(){e("#detail-modal").modal("hide")})}});return o}),define("pathway/modalViews/protocolEditor",["jquery","underscore","backbone","pathway/models/nodeModel","pathway/models/treeModel","globalmodels/contextModel","text!templates/pathway/NewProtocolModal.html","singleRow/reminderRow"],function(e,t,n,i,a,s,o,l){var r,d=n.View.extend({template:t.template(o),el:e("#modal-target"),initialize:function(i){this.$el.html(this.template()),require(["ckeditor"],function(){CKEDITOR.replace("ProtocolText")}),r=new Array;var o=this;this.parent=i,e("#detail-modal").modal({show:"true"}),e("#addNodeButton",this.$el).on("click",function(){var i=CKEDITOR.instances.ProtocolText.getData(),s=e("#NoteToCopyText").val(),l=e("#defaultRecipient").val(),d=e("#defaultRecipientName").val(),c=e("#defaultQuickNote").val(),h=e("#defaultFollowupRecipient").val(),p=e("#defaultFollowupRecipientName").val(),u=[];e(r).each(function(){curFollowup=this.getCurrentParams(),t.isEmpty(curFollowup)||u.push(curFollowup)});var m=a.getNextNodeID();o.parent.set("children",new n.Collection([new n.Model({isProtocol:!0,protocol:i,noteToCopy:s,defaultRecipient:l,defaultRecipientName:d,defaultQuickNote:c,followups:u,defaultFollowupRecipient:h,defaultFollowupRecipientName:p,nodeID:a.get("pathid")+":"+m})])),e("#detail-modal").modal("hide"),a.trigger("propagate")}),e(".show-advanced-settings",this.$el).off("click"),e(".show-advanced-settings",this.$el).on("click",function(t){e(".advanced-settings",o.$el).is(":visible")?(e(t.target).switchClass("glyphicon-chevron-down","glyphicon-chevron-right",0),e(".advanced-settings",o.$el).slideUp(200)):(e(t.target).switchClass("glyphicon-chevron-right","glyphicon-chevron-down",0),e(".advanced-settings",o.$el).slideDown(200))}),e("#add-new-followup",this.$el).on("click",function(){e("#followups").append("<div class='followup'></div>"),el=e(".followup",e("#followups")).last();var t=new l({model:new n.Model({edit:!0}),el:el});r.push(t),t.$el.bind("remove",{followup:t},o.removeFollowup)}),e("#defaultRecipient, #defaultFollowupRecipient",this.$el).autocomplete({source:function(t,n){e.ajax({url:"/users",term:t.term,dataType:"json",data:e.param(s.toParams())+"&target_user="+t.term+"&target_role=provider",success:function(e){n(e)}})},minLength:3,select:function(t,n){if(t.preventDefault(),e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),n.item){e(t.target).val(n.item.label);var i="#"+t.target.id+"Name";e(i).val(n.item.value)}e(this).trigger("change")},change:function(t,n){if(e(t.target).parent().removeClass("has-error"),e("#addNodeButton",this.$el).removeAttr("disabled"),!n.item){var i="#"+t.target.id+"Name";e(i).val(""),""!==e(t.target).val()&&(e(t.target).parent().addClass("has-error"),e("#addNodeButton",this.$el).prop("disabled",!0))}},autoFocus:!0,focus:function(e){e.preventDefault()}})},removeFollowup:function(e){r=t.without(r,e.data.followup)}});return d}),define("text!templates/pathway/detailChooserEntry.html",[],function(){return'<div class = "widget-column col-sm-12">\n<option title="<%=desc%>" value="<%=type%>"><%=type%></option>\n</div>\n'}),define("pathway/internalViews/detailSelector",["jquery","underscore","backbone","globalmodels/contextModel","pathway/Helpers","text!templates/pathway/detailChooserEntry.html"],function(e,t,n,i,a,s){var o=n.View.extend({initialize:function(e){this.el=e.el;var t=n.Collection.extend({url:"/details?"});this.searchedDetails=new t,i.on("change:auth",this.other,this)},other:function(){this.search("")},search:function(t){var n=this,a=i.toParams();a=e.extend(a,{search_param:t}),this.searchedDetails.fetch({data:e.param(a),success:function(){n.render()}})},render:function(){this.$el.html("");var e=t.template(s);for(var n in this.searchedDetails.models){var i=this.searchedDetails.models[n];this.$el.append(e({id:i.get("id"),desc:a.detailDescriptions[i.get("type")],type:a.detailHeadings[i.get("type")]}))}}});return o}),define("text!templates/pathway/protocolNode.html",[],function(){return'\n\n\n<div class = "protocolNode click-tracked" clickID = "TN-<%=pathID%>-<%=protocolNode.nodeID%>">\n    <span>\n        <strong>\n            PROTOCOL\n        </strong>\n        <span style="max-width: 350px;">\n            <%= protocolText %>\n        </span>\n\n    </span>\n\n\n    <br>\n     <% if (page == \'pathEditor\') { %>\n    <div class="btn-group btn-group-xs">\n        <button id=\'sendSetup-button\' type="button" class="btn btn-default btn-sm" style="float: right">\n        <span class="glyphicon glyphicon-envelope"></span>\n        </button>\n       <button id="removeProtocolButton" type="button" class="btn btn-default btn-sm removeProtocolButton" style="float: right">\n           Remove\n       </button>\n    </div>\n\n    <%} else if (page !== \'pathHistory\') {%>\n     <div class="btn-group btn-group-xs">\n         <button id=\'send-button\' type="button" class="btn btn-default btn-sm click-tracked" style="float: right" clickid="TN-<%=pathID%>-<%=protocolNode.nodeID%>" clickaction="send">\n        <span class="glyphicon glyphicon-envelope"></span>\n        </button>\n         <button id=\'followup-button\' type="button" class="btn btn-default btn-sm click-tracked" style="float: right" clickid="TN-<%=pathID%>-<%=protocolNode.nodeID%>" clickaction="followup">\n        <span class="glyphicon glyphicon-time"></span>\n        </button>\n	<% if (typeof(protocolNode.noteToCopy) != \'undefined\' && protocolNode.noteToCopy) { %>\n	<button id=\'copybutton\' type="button" class="btn btn-default btn-sm click-tracked" style="float: right" clickid="TN-<%=pathID%>-<%=protocolNode.nodeID%>" clickaction="copy">\n        <img src="../images/copy-icon.png" style="width: 20px; height: 20px;" title="Copy">\n	<% } %>\n	</button>\n     </div>\n    <% } %>\n</div>\n'}),define("pathway/internalViews/protocolNode",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext","pathway/modalViews/sendProtocol","pathway/modalViews/sendFollowups","text!templates/pathway/protocolNode.html"],function(e,t,n,i,a,s,o,l,r){var d=function(t){if("pathway"==i.get("page")&&!s.suppressClick&&i.get("patients")){var n=e(t.target).closest(".click-tracked");if(n.length){var a=n.attr("clickid"),o=n.attr("clickaction"),l=n.attr("clickextra");o||(o=n.is(":checkbox")?n.is(":checked")?"checked":"unchecked":"click");var r={patient_id:i.get("patients"),protocol_id:i.get("pathid"),node_state:a,datetime:(new Date).toISOString().replace("T"," "),action:o,details:l};
e.ajax({type:"POST",dataType:"json",url:"/activity?"+e.param(i.toParams()),data:JSON.stringify(r),success:function(){console.log("click tracked")}})}}},c=n.View.extend({nodeType:"protocol",template:t.template(r),events:{"click button#copybutton":"copyProtocol","click button#sendSetup-button":"sendSetup","click button#send-button":"send","click button#followup-button":"followup","click div.protocolNode":"setSelectedNode"},initialize:function(e){this.model=e.model,this.hidden=e.hidden},makeExit:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Bottom"});return t},makeEntrance:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Top"});return t},setSelectedNode:function(e){s.suppressClick||(d(e),this.getMyElement().off("click"),s.set("selectedNode",this.model,{silent:!0}),s.trigger("propagate"))},render:function(){var n=this;i.get("patients")&&!this.hidden&&e.ajax({type:"GET",dataType:"json",url:"/node_activity",data:decodeURIComponent(e.param({protocol:a.get("pathid"),patient:i.get("patients"),node_id:this.model.get("nodeID")})),success:function(i){e('input[type="checkbox"]',n.$el);t.map(i,function(t,i){i=i.replace(/\s/g,"").toLowerCase();var a=e('input[clickextra="'+i+'"]',n.$el);a&&a.prop("checked","checked"==t)})}});var o=this.model.get("protocol"),l=/\[\[([\s\S]*?)\|([\s\S]*?)\]\]/g,r={};return o=o.replace(l,function(e,t,i){return key=t.replace(/\s/g,"").toLowerCase(),i=i.split("<p>").join("").split("</p>").join(""),void 0!==r[key]?r[key]+=1:r[key]=0,'<input type="checkbox" value="'+i+'" class="copy-text-button click-tracked" clickextra="'+key+"|"+r[key]+'" clickid="TN-'+a.get("pathid")+"-"+n.model.get("nodeID")+'"/> '+t}),this.$el.html(this.template({pathID:a.get("pathid"),protocolNode:this.model.attributes,page:i.get("page"),protocolText:o})),e(".click-tracked input:checkbox",this.$el).click(function(e){d(e)}),e(".copy-text-button",this.$el).click(function(e){e.stopPropagation()}),this.model==s.get("selectedNode")&&e(".protocolNode",this.$el).addClass("selected"),this},copyProtocol:function(t){t.stopPropagation(),d(t),e("#copiedText").remove();var n=this.model.get("noteToCopy");e("input:checked",this.$el).each(function(e,t){n=n+"  \n\n"+t.value}),e("<div>"+n+"</div>").attr("id","copiedText").appendTo("body"),e("#toast").empty(),e('<span class="glyphicon glyphicon-ok"></span><span>Note-ready text added to clipboard</span>').appendTo("#toast"),e("#toast").css("top",e("#copybutton").offset().top+30),e("#toast").css("left",e("#copybutton").offset().left),e("#toast").css("visibility","visible"),setTimeout(function(){e("#toast").css("visibility","hidden")},1500)},send:function(e){e.stopPropagation(),d(e);new o(this.model)},followup:function(e){e.stopPropagation(),d(e);new l(this.model)},sendSetup:function(e){e.stopPropagation()},getMyElement:function(){return e(".protocolNode",this.$el).first()},childrenHidden:function(){return!1},hideChildren:function(){},showChildren:function(){}});return c.activityTrack=d,c}),define("text!templates/pathway/treeNode.html",[],function(){return'<div class="widget-column col-sm-12" style="background: transparent;">\n    <!--<div style="width:40px; float:left;"></div> <!-- spacing horizontal -->\n    <li style="float:left; width: auto">\n        <div  title="<%=node.tooltip%>" clickID = "TN-<%=pathid%>-<%=node.nodeID%>" <% if (childrenHidden){ %> style = "background-color: lightyellow" <%}%> class="treeNode click-tracked">\n            <span data-toggle="tooltip" > <%=node.name%></span>\n\n            <br>\n            <% if (page == \'pathEditor\'){ %>\n\n            <div style ="clear:both" class="btn-group btn-corner" role="toolbar">\n                    <% if (node.hasLeft ) { %>\n                        <button class = "btn btn-app btn-light btn-sm" id = "moveLeftButton">&lt;</button>\n                    <%}%>\n                    <button type="button" class="btn btn-app btn-light btn-sm" id="addChildButton"><img src="../images/temp/newChild.jpg" style="width: 25px; height: 25px"></button>\n                    <% if (node.children.length == 0){ %>\n                    <button type="button" class="btn btn-app btn-light btn-sm addProtocolButton" id="addProtocolButton"><img src="../images/temp/newProtocole.jpg" style="width: 25px; height: 25px"></button>\n                    <%}%>\n                <% if ("nodeType == standard" && (node.children.length > 0||node.protocol ))  { %>\n                    <button type="button" class="btn btn-app btn-light btn-sm collapseButton">\n                            <% if (childrenHidden){ %>\n                            <img src="../images/temp/expand.jpg" style="width: 25px; height: 25px">\n                            <%}else{ %>\n                            <img src="../images/temp/collapse.jpg" style="width: 25px; height: 25px">\n                        <%}%>\n                    </button>\n                <% } %>\n\n                <%if (node.hasRight) { %>\n                <button class = "btn btn-app btn-light btn-sm" id = "moveRightButton">&gt;</button>\n                 <%}%>\n\n\n            </div>\n             <%}%>\n             <div style = "clear: both"></div>\n        </div>\n        <!--<div style="clear: both; height:100px; width:10px;"></div> <!-- spacing, Vertical-->\n        <ul class=\'children2\'>\n                    <div style=\'padding-top: 25px; \' class=\'protocol\'></div>\n\n\n        </ul>\n\n    </li>\n</div>\n'}),define("pathway/internalViews/treeNode",["jquery","underscore","backbone","globalmodels/contextModel","pathway/internalViews/protocolNode","pathway/modalViews/nodeEditor","pathway/modalViews/protocolEditor","pathway/models/nodeModel","pathway/models/treeModel","pathway/models/treeContext","text!templates/pathway/treeNode.html"],function(e,t,n,i,a,s,o,l,r,d,c){var h=n.View.extend({nodeType:"standard",template:t.template(c),initialize:function(e){this.childEntrances=[],this.model=e.model,e.el&&(this.el=e.el),this.$el.css({"float":"left"});this.render()},makeExit:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Bottom"});return t},makeEntrance:function(e){var t=e.addEndpoint(this.getMyElement(),{anchor:"Top"});return t},setSelectedNode:function(){d.suppressClick||(this.getMyElement().off("click"),d.set("selectedNode",this.model,{silent:!0}),d.trigger("propagate"))},getMyElement:function(){return e(".treeNode",this.$el).first()},render:function(){this.$el.html(this.template({node:this.model.attributes,childrenHidden:this.model.childrenHidden(),page:i.get("page"),pathid:r.get("pathid")}));var n=this;return e(".collapseButton",this.$el).first().on("click",function(){d.suppressClick||"pathEditor"==i.get("page")&&(n.model.childrenHidden()?n.model.showChildren():r.collapse(n.model),r.getShareCode())}),e("#addChildButton",this.$el).first().on("click",function(){new s(n.model)}),e("#moveLeftButton",this.$el).on("click",function(){r.changeNodePosition(n.model,-1)}),e("#moveRightButton",this.$el).first().on("click",function(){d.unset("selectedNodeOffset"),r.changeNodePosition(n.model,1)}),e(".addProtocolButton",this.$el).first().on("click",function(){new o(n.model)}),this.getMyElement().on("click",function(t){if(!d.suppressClick){a.activityTrack(t);var s=e(t.currentTarget),o=s.offset();o.clickid=s.attr("clickid"),d.set({selectedNodeWidth:s.outerWidth(),selectedNodeOffset:o,selectedNode:n.model},{silent:!0}),"pathEditor"!=i.get("page")?(n.model.childrenHidden()?(r.hideSiblings(n.model),n.model.showChildren()):r.collapse(n.model),r.getShareCode()):d.trigger("propagate")}}),t.each(this.model.get("children").models,function(t){if(t.get("isProtocol"))n.addProtocol(t);else{e(".children2",this.$el).first().append("<div class='childSpot'></div>");var i=e(".childSpot",e(".children2",this.$el).first()).last();t.set("hasLeft",0!=this.model.get("children").indexOf(t)),t.set("hasRight",this.model.get("children").indexOf(t)<this.model.get("children").length-1);var a=new h({model:t,el:i}),s=!t.childrenHidden()||t==d.get("selectedNode");r.elPairs.push({source:this,target:a,bold:s})}},this),e(".children2",this.$el).first().css(this.model.childrenHidden()&&"standard"==this.nodeType?{display:"none"}:{display:"block"}),this.model==d.get("selectedNode")&&n.getMyElement().addClass("selected"),this},addProtocol:function(t){var n=this,i=new a({model:t,hidden:this.model.childrenHidden()});e(".protocol",n.$el).first().append(i.render().$el),r.elPairs.push({source:n,target:i,bold:!0}),e(".removeProtocolButton",n.$el).on("click",function(){r.deleteNode(t,!1)})}});return h}),define("text!templates/pathway/triggerNode.html",[],function(){return'<ul>\n    <li>\n        <div title="<%=node.tooltip%>" clickID = "TN-<%=node.id%>-<%=node.nodeID%>" style="text-align: center; border-style:solid;  width:auto;" class="treeNode expanded-path click-tracked">\n            <span data-toggle="tooltip" ><%=node.name%></span>\n            <br>\n            <% if (page == \'pathEditor\'){ %>\n            <div style ="clear:both" class="btn-group btn-corner" role="toolbar">\n                <button type="button" class="btn btn-app btn-light btn-sm" id="addChildButton"><img src="../images/temp/newChild.jpg" style="width: 25px; height: 25px"></button>\n                </div>\n            <%}%>\n\n        </div>\n\n        <!--<div style="clear: both; height:100px; width:10px;"></div>-->\n        <ul style="clear: both; width: 100%; text-align: center" class=\'children2\'></ul>\n\n        <div style=\'padding-top: 25px; \' class=\'protocol\'></div>\n        </div>\n    </li>\n</ul>\n'}),define("pathway/internalViews/triggerNode",["jquery","underscore","backbone","pathway/internalViews/treeNode","text!templates/pathway/triggerNode.html"],function(e,t,n,i,a){var s=i.extend({nodeType:"topLevel",template:t.template(a)});return s}),define("text!templates/pathway/treeNodeActionSet.html",[],function(){return'<li class="hover" id="editNode-button">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newPath.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Edit Selected Node\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n\n<li class="hover" id="deleteNodeButton">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newPath.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Delete Selected Node\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n\n\n<% if (page == \'pathEditor\') { %>\n\n<li class="hover" id="addChildButton">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newChild.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Add Child\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n\n\n<% if (treeNode.children && treeNode.children.length == 0){%>\n<li class="hover" id="addProtocolButton">\n    <a href="javascript:void(0)">\n        <i class="menu-icon">\n            <img src="../images/temp/newProtocole.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Add Protocol\n			 </span>\n\n    </a>\n    <b class="arrow"></b>\n</li>\n<%}%>\n<%}%>\n\n<% if (page == \'pathEditor\' && ((treeNode.children && treeNode.children.length > 0)||treeNode.protocol) ) {%>\n\n<li class="hover" id="collapseButton">\n    <a href="javascript:void(0)">\n        <% if (childrenHidden){%>\n        <i class="menu-icon">\n            <img src="../images/temp/expand.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Expand Node\n			 </span>\n        <%}else{%>\n        <i class="menu-icon">\n            <img src="../images/temp/collapse.jpg"\n                 style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Collapse Node\n			 </span>\n        <%}%>\n    </a>\n    <b class="arrow"></b>\n</li>\n\n\n<% } %>\n\n<%= (typeof sidePanelText !== \'undefined\') ? sidePanelText : \'\' %>\n\n\n\n'}),define("pathway/internalViews/treeNodeActionSet",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext","pathway/modalViews/editNode","pathway/modalViews/newPathway","pathway/modalViews/nodeEditor","pathway/modalViews/protocolEditor","pathway/modalViews/DeleteDialog","text!templates/pathway/treeNodeActionSet.html"],function(e,t,n,i,a,s,o,l,r,d,c,h){var p=n.View.extend({template:t.template(h),render:function(){if(null!=s.get("selectedNode").attributes){var t=s.get("selectedNode");this.$el.html(this.template({treeNode:t.attributes,childrenHidden:t.childrenHidden&&t.childrenHidden(),page:i.get("page")}))}e("#deleteNodeButton",this.$el)[0].onclick=this.deleteNode,e("#setNodeTitleButton",this.$el)[0].onclick=this.editNode;var n=e("#addChildButton",this.$el);n.length&&(n[0].onclick=this.addChild);var a=e("#addProtocolButton",this.$el)[0];a&&(a.onclick=this.addProtocol);var o=e("#collapseButton",this.$el)[0];return o&&(o.onclick=this.expandCollapse),this},addChild:function(){new r(s.get("selectedNode"))},addProtocol:function(){new d(s.get("selectedNode"))},expandCollapse:function(){s.get("selectedNode").childrenHidden()?s.get("selectedNode").showChildren():a.collapse(s.get("selectedNode")),a.getShareCode(),s.trigger("propagate")},editNode:function(){new o},deleteNode:function(){new c}});return p}),define("text!templates/pathway/pathwayListEntry.html",[],function(){return'<div id="<%=canonical%>" class="path-row dd-handle dd2-handle">\n        														<!--<i class="normal-icon ace-icon fa fa-signal orange bigger-130"></i>-->\n\n        <img class=\'normal-icon\' src="../images/temp/newPath.jpg" style="width: 20px; height: 20px"/>\n\n        <i class="drag-icon ace-icon fa fa-arrows bigger-125"></i>\n    </div>\n    <div class="dd2-content">\n        <a class=\'select-button\'><%=name%></a>\n        <div class="pull-right action-buttons">\n            <a>\n                <input class="ace ace-switch ace-switch-3 pathway-enable" type="checkbox"\n                <%= (enabled == 1) ? "checked" : "" %>/>\n                <span class="lbl"></span>\n            </a>\n            <a class="red delete-button" style="vertical-align: top;">\n                <i class="ace-icon fa fa-trash-o bigger-140"></i>\n            </a>\n\n        </div>\n    </div>\n        <ol class="pathway-history-section dd-list">\n\n            </ol>'}),define("globalmodels/scrollCollection",["jquery","underscore","backbone","globalmodels/contextModel"],function e(t,n,i,a){ScrollModel=i.Model;var e=i.Collection.extend({url:null,limit:10,offset:0,full:1,model:ScrollModel,extraData:{},lastRefresh:new Date,getLastRefresh:function(){return this.lastRefresh.toISOString().replace("T"," ").substr(0,19)},context:function(){},initialize:function(){if(this.offset=0,a.get("userAuth")&&this.url){var e={};t.extend(e,a.toParams(),this.extraData),this.active=1;var n=this;this.fetch({data:t.param(e),remove:!0,success:function(e,t){n.full=t.length<n.limit,n.active=0},error:function(){n.full=1,n.active=0}})}this.context()},more:function(){if(!this.full&&!this.active){var e={};t.extend(e,a.toParams(),this.extraData);var n=this;this.offset=this.models.length,this.active=1,this.fetch({data:t.param(e),remove:!1,success:function(e,t){n.active=0,n.full=t.length<n.limit},error:function(){n.full=1,n.active=0}})}},refresh:function(){this.fetch_refresh()},fetch_refresh:function(){if(a.get("userAuth")){var e={};t.extend(e,a.toParams(),this.extraData),this.offset=0,this.full=0,this.active=1;var n=this;this.fetch({data:t.param(e),remove:!0,success:function(e,t){n.full=t.length<n.limit,n.active=0},error:function(){n.full=1,n.active=0}})}}});return e}),define("pathway/models/historyCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){HistoryModel=n.Model;var s=a.extend({url:function(){return"/history"+this.offset+"-"+(this.offset+this.limit)},model:HistoryModel,refresh:function(){if(i.get("userAuth")){var t={};e.extend(t,i.toParams(),this.extraData),that=this,this.tried=0,this.offset=0,this.fetch({data:e.param(t),remove:!0,success:function(){that.trigger("reset")}})}}});return s}),define("text!templates/pathway/pathwayHistoryRow.html",[],function(){return'<div class="dd-handle dd2-handle" name="<%=name%>">\n    <i class="normal-icon ace-icon fa fa-book orange bigger-130"></i>\n</div>\n<div class="dd2-content" title="Author: <%=official_name%>\nDate: <%=creation_date%>">\n<span><a class=\'history-select-button\'><%=creation_date%></a></span>\n    <div class="pull-right action-buttons">\n        <a><span style="padding-right: 1px;"\n             class="glyphicon <%= (active == 1) ? \'glyphicon-check\' : \'glyphicon-unchecked\' %> history-checkbox"></span></a>\n        <a class="red delete-hist" href="#">\n		    <i class="ace-icon fa fa-trash-o bigger-130"></i>\n	    </a>\n    </div>\n</div>'}),define("pathway/singleRows/historyRow",["jquery","underscore","backbone","text!templates/pathway/pathwayHistoryRow.html","globalmodels/contextModel"],function(e,t,n,i,a){var s=n.View.extend({tagName:"li class='dd-item history-row'",template:t.template(i),events:{"click .history-checkbox":"handleCheck","click .history-select-button":"handleSelect"},render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this.model.url="/history/"+this.model.get("canonical")+"/"+this.model.get("pathid"),this},handleCheck:function(t){e(t.target).hasClass("check-disabled")||(e(this.el).parent().find(".history-checkbox").switchClass("glyphicon-check","glyphicon-unchecked"),e(".history-checkbox",this.$el).switchClass("glyphicon-unchecked","glyphicon-check"),this.model.save())},handleSelect:function(){"undefined"==a.get("code")&&a.get("canonical")!=this.model.get("canonical")&&a.set("code","undefined",{silent:!0}),a.set("pathid",String(this.model.get("pathid"))),a.set("canonical",String(this.model.get("canonical"))),e(".active-pathway").removeClass("active-pathway"),e(this.el).addClass("active-pathway")}});return s}),define("text!templates/pathway/historyScroll.html",[],function(){return'<div class="historylist history-scroll" style="clear:both; max-height: 200px; overflow-y:auto; overflow-x: hidden">\n    <div class="historyaccordion">\n    </div>\n</div>'}),define("widgets/pathway/historyList",["jquery","underscore","backbone","pathway/models/historyCollection","pathway/singleRows/historyRow","text!templates/pathway/historyScroll.html","pathway/models/treeModel","globalmodels/contextModel"],function(e,t,n,i,a,s,o){var l,r=n.View.extend({extraData:{},lastHeight:0,currentPath:0,first:!0,initialize:function(n){this.template=t.template("undefined"!=typeof n.template?n.template:s),"undefined"!=typeof n.extraData&&(this.extraData=n.extraData),"undefined"!=typeof n.currentPath&&(this.currentPath=n.currentPath),l=new(i.extend({extraData:this.extraData})),this.$el.html(this.template({height:e(window).height()-50+"px"})),l.bind("add",this.addHistory,this),l.bind("reset",this.render,this),o.bind("propagate",l.refresh,l)},events:{},render:function(){this.reset(),this.$el.html(this.template(this)),this.addAll()},addAll:function(){var t=!1;if(l.length)for(hist in l.models)this.addHistory(l.models[hist]),t=!0;if(t){var n=e(".history-scroll",this.$el);setTimeout(function(){var e=n.innerHeight();this.lastHeight!=e&&e<parseInt(n.css("max-height"))?(this.lastHeight=e,l.more()):n.scroll(function(){return n.scrollTop()+n.innerHeight()+100>=n[0].scrollHeight&&l.more(),!1})},500)}else e(".historyaccordion").html("No History")},addHistory:function(t){var n=new a({model:t});e(".historyaccordion",this.$el).append(n.render().el),e(n.el).bind("change",{activePath:n.model.get("pathid"),that:this},this.updateActivePathway)},updateActivePathway:function(t){t.data.that.currentPath=t.data.activePath,e(this.el).trigger("change")},reset:function(){e(this.$el).empty()}});return r}),define("pathway/singleRows/pathRow",["jquery","underscore","backbone","router","globalmodels/contextModel","pathway/models/pathwayCollection","text!templates/pathway/pathwayListEntry.html","../../widgets/pathway/historyList"],function(e,t,n,i,a,s,o,l){var r=n.View.extend({tagName:"li class='dd-item pathrow-item dd2-item dd-collapsed'",template:t.template(o),historyList:null,events:{"click .select-button":"handleSelect","click .show-hist":"handleHistory","click .delete-button":"handleRemove","click .pathway-checkbox":"handleCheck","click .pathway-switch-label":"handleToggle"},handleToggle:function(e){e.stopPropagation()},render:function(){e(this.el).html(this.template(this.model.toJSON())),this.model.url="/list/"+this.model.get("canonical");var t=this;return e(document).ready(function(){e(".pathway-enable",t.$el).on("switchChange.bootstrapSwitch",function(n,i){i?e(".history-checkbox",this.$el).removeClass("check-disabled",0):e(".history-checkbox",this.$el).addClass("check-disabled",0),t.model.save({active:i})})}),this},initialize:function(t){this.model=t.model,that=this,e(this.el).on("remove",function(){console.log("this pathway was removed")})},handleSelect:function(){"undefined"==a.get("code")&&a.get("canonical")!=this.model.get("canonical")&&a.set("code","undefined",{silent:!0}),a.set("canonical",String(this.model.get("canonical"))),a.set("pathid",String(this.model.get("id"))),e(".active-pathway").removeClass("active-pathway"),e(this.el).addClass("active-pathway"),a.unbind("change:pathid",this.updateCurPath),a.on("change:pathid",this.updateCurPath,{that:this})},updateCurPath:function(){a.get("canonical")==this.that.model.get("canonical")?this.that.model.set("id",a.get("pathid")):a.unbind("change:pathid",this.that.updateCurPath)},handleCheck:function(t){var n=!1;e(t.target).hasClass("glyphicon-check")?(e(t.target).switchClass("glyphicon-check","glyphicon-unchecked",0),e(".history-checkbox",this.$el.parent()).addClass("check-disabled",0)):(n=!0,e(t.target).switchClass("glyphicon-unchecked","glyphicon-check",0),e(".history-checkbox",this.$el.parent()).removeClass("check-disabled",0)),this.model.save({active:n})},handleHistory:function(){var t=e(".pathway-history-section",this.$el),n={canonical:this.model.get("canonical")};this.historyList=new l({el:t,currentPath:this.model.get("id"),extraData:n}),e(this.historyList.el).bind("change",{that:this},this.updateActivePathway)},updateActivePathway:function(e){e.data.model.set("id",e.data.that.historyList.currentPath)},handleRemove:function(){var t=confirm("Are you sure you want to delete this pathway?");t&&(this.model.destroy({success:function(){s.fetch()}}),this.undelegateEvents(),e(this.el).remove(),delete this.$el,delete this.el)}});return r}),define("globalmodels/summaryModel",["jquery","backbone","globalmodels/contextModel"],function(e,t,n){var i=Backbone.Model.extend({urlRoot:"/total_spend"}),a=new i;a.set({spending:"",savings:""},{silent:!0}),n.get("userAuth")&&a.fetch({data:e.param(n.toParams())});var s={};return n.on("change:patients change:userAuth change:encounter change:startdate change:enddate",function(t){var i=_.extend({},n.changed);_.isEqual(i,s)||(s=i,a.set({spending:"",savings:""},{silent:!0}),a.fetch({data:e.param(t.toParams())}))}),a}),define("globalmodels/patientModel",["jquery","backbone","globalmodels/contextModel"],function(e,t,n){var i=Backbone.Model.extend({url:"/patient_details"}),a=new i;return n.get("patients")&&n.get("userAuth")&&a.fetch({data:e.param(n.toParams())}),n.on("change:patients change:userAuth",function(t){t.get("patients")!=a.get("id")&&t.get("userAuth")&&(t.get("patients")?a.fetch({data:e.param(t.toParams())}):a.set({id:"",name:""}))}),a}),define("globalmodels/spendingModel",["underscore","backbone","globalmodels/contextModel"],function(e,t,n){var i=t.Model.extend({urlRoot:"/spending",clickType:function(e){this.set({typeFilter:e})},clickDate:function(e){var t=e.item.dataContext.date;t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),this.set({dateFilter:t})},getGathered:function(){var e={},t=this.get("dateFilter");for(var n in this.attributes)if(Date.parse(n)){var i=new Date(n);if(!t||i.getFullYear()==t.getFullYear()&&i.getMonth()==t.getMonth()&&i.getDate()==t.getDate()){var s=a.get(n);for(var o in s){var l=s[o];o in e&&(l+=e[o]),e[o]=l}}}return e}}),a=new i;return a.set({typeFilter:"",dateFilter:""}),n.get("userAuth")&&a.fetch({data:$.param(n.toParams())}),n.on("change:patients change:userAuth change:encounter change:startdate change:enddate",function(e){e.get("userAuth")&&a.fetch({data:$.param(e.toParams()),success:function(e,t){var n={typeFilter:a.get("typeFilter"),dateFilter:a.get("dateFilter")};a.clear({silent:!0}),a.set($.extend(n,t))}})}),a}),define("globalmodels/orderCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){return OrderModel=n.Model,orderCollection=new a,orderCollection.url=function(){return"/orders"+this.offset+"-"+(this.offset+this.limit)},orderCollection.model=OrderModel,orderCollection.limit=10,orderCollection.context=function(){i.on("change:patients change:encounter change:startdate change:enddate",function(t){t.get("userAuth")&&(t.get("patients")?(this.tried=0,this.offset=0,orderCollection.fetch({data:e.param(i.toParams()),remove:!0})):orderCollection.reset())},orderCollection)},orderCollection.initialize(),orderCollection}),define("globalmodels/customerCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){return CustomerModel=n.Model,customerCollection=new a,customerCollection.url=function(){return"/customers"+this.offset+"-"+(this.offset+this.limit)},customerCollection.model=CustomerModel,customerCollection.limit=10,customerCollection.initialize(),customerCollection}),define("globalmodels/auditCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){AuditModel=n.Model;var s=a.extend({url:function(){return"/audits"+this.offset+"-"+(this.offset+this.limit)},model:AuditModel,limit:5,context:function(){e(".auditlist").on("show",this.fetch_refresh,this)}});return s}),define("globalmodels/patientCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){var s=n.Model;return patientCollection=new a,patientCollection.url=function(){return"/patients"+this.offset+"-"+(this.offset+this.limit)},patientCollection.model=s,patientCollection.limit=10,patientCollection.context=function(){i.on("change:patients change:startdate change:enddate",function(t){t.get("userAuth")&&(this.tried=0,this.offset=0,patientCollection.fetch({data:e.param(i.toParams()),remove:!0}))},this)},patientCollection.initialize(),patientCollection}),define("globalmodels/userCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){UserModel=n.Model;var s=a.extend({url:function(){return"/users"+this.offset+"-"+(this.offset+this.limit)},model:UserModel,context:function(){i.on("change:startdate change:enddate",this.refresh)}});return s}),define("globalmodels/histogramModel",["jquery","backbone","globalmodels/contextModel"],function(e,t,n){var i=Backbone.Model.extend({urlRoot:"/hist_spending"}),a=new i;return n.get("userAuth")&&a.fetch({data:e.param(n.toParams())}),n.on("change:patients change:userAuth",function(){a.fetch({data:e.param(n.toParams())})}),a}),define("globalmodels/interactionCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){InteractionModel=n.Model;var s=a.extend({url:function(){return"/interactions"+this.offset+"-"+(this.offset+this.limit)},model:InteractionModel,limit:10,context:function(){e(".interactionlist").on("show",this.fetch_refresh,this)}});return s}),define("globalmodels/alertCollection",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/scrollCollection"],function(e,t,n,i,a){AlertModel=n.Model;var s=[];return alertCollection=new a,alertCollection.url=function(){return"/alerts"+this.offset+"-"+(this.offset+this.limit)},alertCollection.model=AlertModel,alertCollection.limit=5,alertCollection.extraData={categories:s},alertCollection.context=function(){i.on("change:patients change:encounter change:startdate change:enddate",function(t){if(t.get("userAuth")){var n={};e.extend(n,i.toParams(),alertCollection.extraData),this.tried=0,this.offset=0,alertCollection.fetch({data:e.param(n),remove:!0})}},this)},alertCollection.initialize(),alertCollection}),define("widgets/welcome",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.render(),this.showhide(),i.on("change:page",this.showhide,this),i.on("change:pathid",this.render,this)},render:function(){i.get("pathid")&&i.get("pathid")>0?this.$el.hide():(this.$el.html(this.template(i.attributes)),this.$el.show())},showhide:function(){"home"==i.get("page")?this.$el.show():this.$el.hide()}});return a}),define("jquery_autocomplete",["jquery","jquery_ui"],function(e){function t(t,n){var i=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(t){return i.test(e("<div>").html(t.label||t.value||t).text())})}var n=e.ui.autocomplete.prototype,i=n._initSource;e.extend(n,{_initSource:function(){this.options.html&&e.isArray(this.options.source)?this.source=function(e,n){n(t(this.options.source,e.term))}:i.call(this)},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>")[this.options.html?"html":"text"](n.label)).appendTo(t)}})}),define("widgets/patientSearch",["jquery","underscore","backbone","globalmodels/contextModel","jquery_autocomplete"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change:patients",this.update,this)},update:function(t){if(t.get("patients"));else{this.$el.html(this.template(i.attributes)),e("#srch-diagnosis").autocomplete({source:function(t,n){e.ajax({url:"/autocomplete_diagnosis",term:t.term,data:e.param(i.toParams())+"&diagnosis="+t.term,success:function(e){n(e)}})},minLength:4,select:function(t,n){n.item&&(e(t.target).val(n.item.value),e(t.target.form).submit())}});{new Array}e("#srch-patient").autocomplete({source:function(t,n){e.ajax({url:"/autocomplete_patient",term:t.term,patientname:e("#srch-patient").val(),data:e.param(i.toParams())+"&patientname="+t.term,success:function(e){n(e)}})},minLength:2,select:function(t,a){t.preventDefault(),a.item&&(e(t.target).val(a.item.label),i.set({patientName:a.item.label},{silent:!0}),n.history.navigate("patient/"+a.item.value,{trigger:!0}))}})}}});return a}),define("widgets/datepicker-calendar",["jquery","underscore","backbone","fullcalendar","globalmodels/contextModel","globalmodels/histogramModel"],function(e,t,n,i,a,s){var o=n.View.extend({initialize:function(n){this.template=t.template(n.template),this.$el.html(this.template({page:a.get("page")})),a.on("change:patients change:encounter change:enc_date",this.update,this),this.update(),e("#datepicker-modal").on("shown.bs.modal",function(){e("#calendar1").fullCalendar("render"),e("#calendar2").fullCalendar("render")})},events:{"click .btn":"showEncounters"},update:function(){var t=new Array,i=2,o=[];for(var l in s.attributes){var r=s.attributes[l],d=r.discharge;d||(d=(new Date).toISOString().substring(0,10)),o.push({id:r.encounterid,title:r.patientname+": "+r.diagnosis+" $"+r.spending,start:r.admission,end:d,className:"admission",allDay:!0,url:"#episode/"+r.encounterid+"/patient/"+r.patientid+"/"+r.admission})}for(var c=1;i>=c;c++){var h=new Date,p=a.get("enc_date")?new Date(a.get("enc_date")):new Date(h.getFullYear(),h.getMonth()-2,1),u=p.setMonth(p.getMonth()+c);
t[c]=e("#calendar"+c).fullCalendar({header:{left:1==c?"prev,next":"",center:"title",right:2==c?"today":""},defaultDate:u,selectable:!0,selectHelper:!0,select:function(t,i){a.get("patients")&&(a.set({enc:null,enc_date:null,startdate:t.format(),enddate:i.format()}),n.history.navigate("patient/"+a.get("patients"),!0),e("#datepicker-modal").modal("hide")),e("#calendar").fullCalendar("unselect")},eventClick:function(t){t.url&&(n.history.navigate(t.url,!0),e("#datepicker-modal").modal("hide"))},events:o})}e("#calendar1 .fc-button-prev").each(function(){e(this).click(function(){e("#calendar2").each(function(){e(this).fullCalendar("prev")})})}),e("#calendar1 .fc-button-next").each(function(){e(this).click(function(){e("#calendar2").each(function(){e(this).fullCalendar("next")})})}),e("#calendar2 .fc-button-today").each(function(){e(this).click(function(){e("#calendar1").each(function(){e(this).fullCalendar("today"),e(this).fullCalendar("prev")})})})},showEncounters:function(t){var i=t.target.id,s=new Date;s.setMonth(s.getMonth()-i),console.log(s.toLocaleDateString()),a.set({enc:null,enc_date:null,startdate:s.toLocaleDateString(),enddate:(new Date).toLocaleDateString()}),n.history.navigate("patient/"+a.get("patients"),!0),e("#datepicker-modal").modal("hide")}});return o}),define("text!templates/patientRow.html",[],function(){return"<td>\n    <a>\n        <%= name %>\n    </a>\n    </td>\n    <td>\n        <%= gender %>\n    </td>\n    <td>\n        <%= DOB %>\n    </td>\n    <td>\n        <%= diagnosis %>\n    </td>\n    <td>\n        $<%= cost %>\n    </td>"}),define("singleRow/patientRow",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/patientRow.html"],function(e,t,n,i,a){var s=n.View.extend({tagName:"tr",template:t.template(a),events:{click:"handleClick"},render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},handleClick:function(){var e=this.model.get("id");i.set({patientName:this.model.get("name")},{silent:!0}),n.history.navigate("patient/"+e,{trigger:!0})}});return s}),define("text!templates/patientList.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="row" style=\'width:90%;margin:0 auto 0 auto\'>\n        <h2 class="headings">\n          <%= display %>\'s Recent Patients\n        </h2>\n    <div class=\'patientlist\' style=" width:100%; padding:0; max-height:100px; overflow-y:auto;">\n    <table class="table table-condensed table-hover patienttable" style="width:100%; padding: 0;">\n        <col width="20%">\n        <col width="20%">\n        <col width="20%">\n        <col width="20%">\n        <col width="20%">\n        <thead>\n            <tr>\n                <th align="left" id="pat_name">Name</th>\n                <th align="left" id="pat_gender">Gender</th>\n                <th align="left" id="pat_dob">Date of Birth</th>\n                <th align="left" id="pat_diagnosis">Diagnosis</th>\n                <th align="left" id="pat_cost">Cost</th>\n            </tr>\n        </thead>\n        <tbody>\n        </tbody>\n    </table>\n    </div>\n</div>\n<div class="maven-padding"></div>\n<div class="row">\n    <hr>\n</div>\n</div>\n'}),define("widgets/patientList",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/patientCollection","singleRow/patientRow","text!templates/patientList.html"],function(e,t,n,i,a,s,o){var l=n.View.extend({template:function(){return""},initialize:function(){a.bind("add",this.addPatient,this),a.bind("reset",this.render,this),i.on("change",this.addAll,this),this.addAll();var t=e(".patientlist",this.$el);t.scrollTop(0),t.scroll(function(){t.scrollTop()+t.innerHeight()+100>=t[0].scrollHeight&&a.more()})},render:function(){return template=t.template(o,{display:i.get("display")}),this.$el.html(template),this},addPatient:function(t){var n=new s({model:t});e(".patienttable").append(n.render().el)},addAll:function(){if(i.get("patients"))this.$el[0].style.display="none";else{this.$el[0].style.display="",this.render();for(var t in a.models)this.addPatient(a.models[t])}var n=e(".patientlist",this.$el);setTimeout(function(){var e=n.innerHeight();e>0&&e<parseInt(n.css("max-height"))&&a.more()},500)}});return l}),define("widgets/customerCreation",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.render(),this.showhide(),i.on("change:page",this.showhide,this)},events:{"click .add-customer-button":"addCustomer"},showhide:function(){"customers"==i.get("page")?this.$el.show():this.$el.hide()},addCustomer:function(){var t=e("#customer-name-input").val(),n=e("#customer-abbr-input").val(),a=e("#customer-license-input").val(),s=e("#customer-config-input").val(),o=e("#customer-ituser-input").val(),l=new RegExp("^[0]*[1-9]+[0]*$");l.test(a)?""==n?e("#add-customer-message").html("Please fill out Customer Abbreviation"):""==t?e("#add-customer-message").html("Please fill out Customer Name"):""==o?e("#add-customer-message").html("Please fill out IT User"):(e("#add-customer-message").html("&nbsp;"),e.ajax({url:"/add_customer",data:e.param(i.toParams())+"&name="+t+"&abbr="+n+"&license="+a+"&ituser="+o+"&config="+s,success:function(t){e("#add-customer-message").html("Customer Added!"),e("#customer-name-input").val(""),e("#customer-abbr-input").val(""),e("#customer-license-input").val(""),e("#customer-ituser-input").val(""),e("#add-customer-message").html("Customer added.  "+t),alert(t)},error:function(){e("#add-customer-message").html("Sorry, an error occurred")}})):e("#add-customer-message").html("Please enter a valid number for # of licenses")},render:function(){return this.$el.html(this.template),this}});return a}),define("widgets/providerProfile",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/sidebarModel"],function(e,t,n,i,a){var s=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.render(),a.addOption("Profile"),this.showhide(),i.on("change:page",this.showhide,this)},events:{"keyup #official-name-input":"doentersave","keyup #display-name-input":"doentersave","keyup #new-password":"doenterchange","click #change-password":"dochangepassword","click #save-settings":"dosavesettings"},showhide:function(){"profile"==i.get("page")?this.$el.show():this.$el.hide()},render:function(){this.$el.html(this.template(i.attributes))},doentersave:function(t){e("#settings-save-status").empty(),13==t.keyCode&&this.dosavesettings(t)},dosavesettings:function(){var t=e("#official-name-input").val(),n=e("#display-name-input").val();e.ajax({url:"/save_user_settings",data:e.param(i.toParams())+"&official_name="+t+"&display_name="+n,success:function(){console.log("Settings saved"),e("#settings-save-status").html("Settings Saved!")},error:function(){console.log("Settings failed to save"),e("#settings-save-status").html("Sorry, an error occurred")}})},dochangepassword:function(){this.newPasswordChange()&&console.log("saving new password")},doenterchange:function(e){13==e.keyCode?this.dochangepassword():this.newPasswordChange()},newPasswordChange:function(){var t=e("#new-password").val(),n="<big><big><font color='#00b000'>&#x2714</font></big></big>",i="<big><font color='#ff0000'>&#x2718</font></big>",a=t.length<8,s=t.search(".*[a-z]")<0,o=t.search(".*[A-Z]")<0,l=t.search(".*[0-9]")<0,r=t==e("#current-password").val(),d=t!=e("#new-password2").val();return e("#pw-len-cb").html(a?i:n),e("#pw-low-cb").html(s?i:n),e("#pw-up-cb").html(o?i:n),e("#pw-num-cb").html(l?i:n),e("#pw-diff-cb").html(r?i:n),a||s||o||l||r||d?!1:!0}});return s}),define("text!templates/userRow.html",[],function(){return'<td>\n    <%= (ehr_state == \'active\') ? display_name : "<del>" + display_name + "</del>" %> <br/>\n    <%= profession %>\n</td>\n<td>\n    <% if (last_login) { print(last_login + \' GMT\'); } %> <br/>\n    <a class="audit-hover hover-link">\n        View Audits\n    </a>\n</td>\n<td>\n    <div width="100%">\n        <input type="checkbox" class="toggle-status" data-on-text="Active" data-off-text="InActive" data-size="small" style="width:100% !important;"\n            <%= (roles.indexOf("administrator")==-1 && ehr_state != \'active\') ? "disabled" : \'\' %>\n            <%= (state == \'active\' && ehr_state == \'active\') ? \'checked\' : \'\' %>>\n<!--\n        <button class="btn btn-xs btn-default btn-block btn-status" <%= (ehr_state != \'active\') ? "disabled" : \'\' %>\n                value="<%= (state==\'active\') ? \'deactivate\' : \'activate\' %>">\n            <span class="btn-label"><%= (state == \'active\' && ehr_state == \'active\') ? \'Active\' : \'Inactive\' %></span>\n            <span class="btn-hover"><%= (state == \'active\' && ehr_state == \'active\') ? \'De Activate\' : \'Activate\' %></span>\n        </button>-->\n    </div>\n    <% if (ehr_state == \'active\' || roles.indexOf("administrator")!=-1) { %>\n    <div width="100%">\n        <button class="btn btn-xs reset-user-password btn-default btn-block" value="">Reset Password</button>\n    </div>\n    <% } %>\n</td>\n<td>&nbsp;</td>\n<td>\n    Primary <br/>\n    Secondary\n</td>\n<td>\n    <% notifications = {\'desktop\': \'Desktop\', \'mobile\': \'Mobile\', \'ehrinbox\': \'EHR Inbox\', \'off\': \'Off\', \'\': \'Off\'} %>\n\n    <div class="btn-group" style="float:right; width:100%;">\n        <ul class="dropdown-menu dropdown-menu-right" role="menu" style=\'float:right;\'>\n          <li><a class="btn-msg-primary" value="desktop">Desktop</a></li>\n	      <li><a class="btn-msg-primary" value="mobile">Mobile</a></li>\n          <li><a class="btn-msg-primary" value="ehrinbox">EHR Inbox</a></li>\n          <li><a class="btn-msg-primary" value="off">Off</a></li>\n	    </ul>\n\n        <button type="button" class="btn btn-xs btn-default btn-block" data-toggle="dropdown">\n            <span class="msg-primary-label"><%= notifications[notify_primary.toLowerCase()] %></span>\n	        <span class="sr-only">Toggle Dropdown</span>\n        </button>\n\n    </div>\n\n    <div class="btn-group" style="float:right; width:100%;">\n        <ul class="dropdown-menu dropdown-menu-right" role="menu" style=\'float:right;\'>\n          <li><a class="btn-msg-secondary" value="desktop">Desktop</a></li>\n	      <li><a class="btn-msg-secondary" value="mobile">Mobile</a></li>\n          <li><a class="btn-msg-secondary" value="ehrinbox">EHR Inbox</a></li>\n          <li><a class="btn-msg-secondary" value="off">Off</a></li>\n	    </ul>\n\n        <button type="button" class="btn btn-xs btn-default btn-block msg-secondary-dropdown" data-toggle="dropdown">\n            <span class="msg-secondary-label"><%= notifications[notify_secondary.toLowerCase()] %></span>\n	        <span class="sr-only">Toggle Dropdown</span>\n        </button>\n\n    </div>\n\n</td>'}),define("text!templates/auditRow.html",[],function(){return'<td>\n    <%= date %> GMT\n</td>\n<td>\n    <%= (patient != "NOTVALIDYET") ? patient : ""%>\n</td>\n<td>\n    <%= action %>\n</td>\n<td>\n    <%= (target != "NOTVALIDYET") ? target: "" %>\n</td>\n<td>\n    <%= (device != "NOTVALIDYET") ? device: "" %>\n</td>\n<td>\n    <%= (details != "NOTVALIDYET") ? details: "" %>\n</td>\n\n'}),define("singleRow/auditRow",["jquery","underscore","backbone","text!templates/auditRow.html"],function(e,t,n,i){var a=n.View.extend({tagName:"tr class='audit-row'",template:t.template(i),render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this}});return a}),require(["jquery"],function(e){function t(){"undefined"==typeof this.timeout&&(this.timeout=null);var t=e(this),n=t.data("mousestop"),i=n.delay||e.mousestopDelay;t.bind("mousemove.mousestop",function(){clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.trigger("mousestop")},i)})}function n(){var t=e(this);t.unbind("mousemove.mousestop"),clearTimeout(this.timeout)}e.mousestopDelay=500,e.event.special.mousestop={setup:function(i){e(this).data("mousestop",{delay:i}).bind("mouseenter.mousestop",t).bind("mouseleave.mousestop",n)},teardown:function(){e(this).removeData("mousestop").unbind(".mousestop")}},e.fn.mousestop=function(e,t){return null==t&&(t=e,e=null),arguments.length>0?this.bind("mousestop",e,t):this.trigger("mousestop")}}),define("libs/jquery/jquery-mousestop-event",function(){}),function(e){if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(t){}var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},i=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},a=n.prototype,s=i.prototype,o=e.FileReaderSync,l=function(e){this.code=this[this.name=e]},r="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),d=r.length,c=e.URL||e.webkitURL||e,h=c.createObjectURL,p=c.revokeObjectURL,u=c,m=e.btoa,g=e.atob,f=e.ArrayBuffer,v=e.Uint8Array,b=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(i.fake=s.fake=!0;d--;)l.prototype[r[d]]=d+1;return c.createObjectURL||(u=e.URL=function(e){var t,n=document.createElementNS("http://www.w3.org/1999/xhtml","a");return n.href=e,"origin"in n||("data:"===n.protocol.toLowerCase()?n.origin=null:(t=e.match(b),n.origin=t&&t[1])),n}),u.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof i?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):m?t+";base64,"+m(e.data):t+","+encodeURIComponent(e.data)):h?h.call(c,e):void 0},u.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&p&&p.call(c,e)},a.append=function(e){var n=this.data;if(v&&(e instanceof f||e instanceof v)){for(var a="",s=new v(e),r=0,d=s.length;d>r;r++)a+=String.fromCharCode(s[r]);n.push(a)}else if("Blob"===t(e)||"File"===t(e)){if(!o)throw new l("NOT_READABLE_ERR");var c=new o;n.push(c.readAsBinaryString(e))}else e instanceof i?"base64"===e.encoding&&g?n.push(g(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},a.getBlob=function(e){return arguments.length||(e=null),new i(this.data.join(""),e,"raw")},a.toString=function(){return"[object BlobBuilder]"},s.slice=function(e,t,n){var a=arguments.length;return 3>a&&(n=null),new i(this.data.slice(e,a>1?t:this.data.length),n,this.encoding)},s.toString=function(){return"[object Blob]"},s.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,t){var i=t?t.type||"":"",a=new n;if(e)for(var s=0,o=e.length;o>s;s++)a.append(e[s]);return a.getBlob(i)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),define("libs/jquery/Blob",function(){});var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in n,a=function(n){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},s=e.webkitRequestFileSystem,o=e.requestFileSystem||s||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},r=0,d=function(t){var n=function(){"string"==typeof t?(e.URL||e.webkitURL||e).revokeObjectURL(t):t.remove()};e.chrome?n():setTimeout(n,10)},c=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var a=e["on"+t[i]];if("function"==typeof a)try{a.call(e,n||e)}catch(s){l(s)}}},h=function(t,l){var h,p,u,m=this,g=t.type,f=!1,v=function(){c(m,["writestart","progress","write","writeend"])},b=function(){(f||!h)&&(h=(e.URL||e.webkitURL||e).createObjectURL(t)),p?p.location.href=h:void 0==e.open(h,"_blank")&&"undefined"!=typeof safari&&(e.location.href=h),m.readyState=m.DONE,v(),d(h)},w=function(e){return function(){return m.readyState!==m.DONE?e.apply(this,arguments):void 0}},y={create:!0,exclusive:!1};m.readyState=m.INIT,l||(l="download"),i?(h=(e.URL||e.webkitURL||e).createObjectURL(t),n.href=h,n.download=l,a(n),m.readyState=m.DONE,v(),d(h)):(e.chrome&&g&&"application/octet-stream"!==g&&(u=t.slice||t.webkitSlice,t=u.call(t,0,t.size,"application/octet-stream"),f=!0),s&&"download"!==l&&(l+=".download"),("application/octet-stream"===g||s)&&(p=e),o?(r+=t.size,o(e.TEMPORARY,r,w(function(e){e.root.getDirectory("saved",y,w(function(e){var n=function(){e.getFile(l,y,w(function(e){e.createWriter(w(function(n){n.onwriteend=function(t){p.location.href=e.toURL(),m.readyState=m.DONE,c(m,"writeend",t),d(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&b()},["writestart","progress","write","abort"].forEach(function(e){n["on"+e]=m["on"+e]}),n.write(t),m.abort=function(){n.abort(),m.readyState=m.DONE},m.readyState=m.WRITING}),b)}),b)};e.getFile(l,{create:!1},w(function(e){e.remove(),n()}),w(function(e){e.code===e.NOT_FOUND_ERR?n():b()}))}),b)}),b)):b())},p=h.prototype;return p.abort=function(){this.readyState=this.DONE,c(this,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(e,t){return new h(e,t)}}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define("libs/jquery/FileSaver.min",[],function(){return saveAs}),define("widgets/auditList",["jquery","underscore","backbone","globalmodels/auditCollection","singleRow/auditRow","globalmodels/contextModel","libs/jquery/jquery-mousestop-event"],function(e,t,n,i,a,s){var o,l=["date","patient","action","target","device","details"],r=n.View.extend({extraData:{},lastHeight:0,first:!0,initialize:function(n){"undefined"!=typeof n.extraData&&(this.extraData=n.extraData),o=new(i.extend({extraData:this.extraData})),this.template=t.template(n.template),o.bind("add",this.addAudit,this),o.bind("reset",this.reset,this),this.render("Loading ...");var a=e(".audit-scroll",this.$el);e(a).on("show",function(){o.reset(),o.initialize()})},events:{"scroll .audit-scroll":"handleScroll","click .download-user-audits":"downloadAudits"},showhide:function(){"auditlist"==s.get("page")?this.$el.show():this.$el.hide()},downloadAudits:function(){that=this;var n={};e.extend(n,s.toParams(),this.extraData),e.ajax({url:"/audits",data:e.param(n),success:function(e){require(["libs/jquery/Blob","libs/jquery/FileSaver.min"],function(n,i){var a=[l.join(",")];t.each(e,function(e){a.push('"'+t.map(l,function(t){return e[t].replace(/"/g,"")}).join('","')+'"')});var s=new Blob([a.join("\n")],{type:"data:text/csv;charset=utf-8"});i(s,"audits.csv")})},error:function(){}})},render:function(t){this.$el.html(this.template(this));var n=e(".audit-scroll",this.$el);n.scroll(function(){return n.scrollTop()+n.innerHeight()+100>=n[0].scrollHeight&&o.more(),!1}),this.addAll(t)},addAll:function(t){t&&"string"==typeof t||(t="None available"),this.reset();var n=!1;if(o.length)for(audit in o.models)this.addAudit(o.models[audit]),n=!0;if(n){e(".audittable > thead",this.$el).show(),e(".audit-control-row",this.$el).show(),this.$el.show();var i=e(".audit-scroll",this.$el);setTimeout(function(){var e=i.innerHeight();this.lastHeight!=e&&e<parseInt(i.css("max-height"))&&(this.lastHeight=e,o.more())},500)}else e(".audittable > tbody",this.$el).html('<tr><td colspan="5">'+t+"</td></tr>"),e(".audittable > thead",this.$el).hide(),e(".audit-control-row",this.$el).hide(),this.$el.show()},addAudit:function(t){var n=new a({model:t});e(".audittable",this.$el).append(n.render().el),this.$el.show()},reset:function(){e(".audittable > tbody",this.$el).empty(),this.$el.hide()}});return r}),define("text!templates/auditScroll.html",[],function(){return'\n<div class = "widget-column">\n    <div class="auditlist audit-scroll" style="clear:both;">\n        <div class="auditaccordion">\n            <table class="table table-condensed table-hover audittable">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <thead >\n                <tr>\n                    <th align="left">Date</th>\n                    <th align="left">Patient</th>\n                    <th align="left">Action</th>\n                    <th align="left">User</th>\n                    <th align="left">Device</th>\n                    <th align="left">Details</th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n            </table>\n        </div>\n    </div>\n    <div class="audit-control-row">\n        <!--[if gte IE 10]><!-->\n            <button class="btn btn-default download-user-audits">Download Audits</button>\n        <!--<![endif]-->\n    </div>\n</div>\n'}),define("singleRow/userRow",["jquery","underscore","backbone","text!templates/userRow.html","globalmodels/contextModel","widgets/auditList","text!templates/auditScroll.html","libs/jquery/jquery-mousestop-event","bootstrapswitch"],function(e,t,n,i,a,s,o){var l=n.View.extend({tagName:"tr class='user-row'",template:t.template(i),render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this},updateNotificationPreferences:function(t,n){e.ajax({url:"/update_user_pref",data:e.param(a.toParams())+"&target_user="+this.model.get("user_name")+"&target_customer="+this.model.get("customer_id")+"&notify1="+t+"&notify2="+n,success:function(){e("#save-user-message").html("User Updated!")},error:function(){alert("Could not save user information."),e("#save-user-message").html("Could not save user information.")}})},events:function(){var t=this,n=null,i=!1,l="#mouse-target",r={desktop:"Desktop",mobile:"Mobile",ehrinbox:"EHR Inbox",off:"Off"},d=this.model.get("notify_primary").toLowerCase(),c=this.model.get("notify_secondary").toLowerCase();e(document).ready(function(){e(".toggle-status",t.$el).bootstrapSwitch(),e(t.el).find(".reset-user-password").click(function(){e("#save-user-message").html("&nbsp;"),e.ajax({url:"/reset_password",data:e.param(a.toParams())+"&target_user="+t.model.get("user_name")+"&target_customer="+t.model.get("customer_id")+"&ehr_state="+t.model.get("ehr_state"),success:function(t){""!=t&&alert(t),e("#save-user-message").html("Password Reset!")}})}),e(".toggle-status",t.$el).on("switchChange.bootstrapSwitch",function(n,i){var s="disabled";i&&(s="active"),e.ajax({url:"/update_user",data:e.param(a.toParams())+"&target_user="+t.model.get("user_name")+"&target_customer="+t.model.get("customer_id")+"&state="+s,success:function(t){"TRUE"!=t&&alert(t),e("#save-user-message").html("User Updated!")},error:function(){alert("Sorry, an error occurred. Please try again later"),e(n.target).bootstrapSwitch("toggleState",!0),e("#save-user-message").html("Sorry, an error occurred. Please try again later")}})}),e(".btn-msg-primary",t.$el).click(function(n){d=e(n.target).attr("value"),e(".msg-primary-label",t.$el).html(r[d]),"off"==d?(c="off",e(".msg-secondary-label",t.$el).html("Off"),e(".msg-secondary-dropdown").prop("disabled",!0)):(e(".msg-secondary-dropdown").prop("disabled",!1),d==c&&(c="off",e(".msg-secondary-label",t.$el).html("Off"))),t.updateNotificationPreferences(d,c)}),e(".btn-msg-secondary",t.$el).click(function(n){c=e(n.target).attr("value"),e(".msg-secondary-label",t.$el).html(r[c]),t.updateNotificationPreferences(d,c)}),e(t.el).unbind("click");var h;e(t.el).find(".user-state").click(function(){e("#save-user-message").empty()}),e(t.el).find(".audit-hover").mouseover(function(){n="audit"}),e(t.el).find(".audit-hover").mousestop(500,function(){if(n){e(l).hide();var i={target_customer:t.model.get("customer_id"),target_user:t.model.get("user_name")};auditList=new s({el:e(l),template:o,extraData:i}),auditList.$el[0].style.left=h.pageX+10+"px",auditList.$el[0].style.top=h.pageY-50+"px"}}),e(t.el).find(".audit-hover").mouseleave(function(){n=null,setTimeout(maybeHide,500)}),e(t.el).find(".audit-hover").mousemove(function(e){h=e}),e(l).mouseover(function(){i=!0}),e(l).mouseleave(function(){i=!1,setTimeout(maybeHide,500)}),maybeHide=function(){null!=n||i||(e(l).hide(),i=!1)}})}});return l}),define("text!templates/userScroll.html",[],function(){return'<div class = "widget-column col-sm-12" style="clear: both;">\n\n<div class="row userlist" style="margin: auto; width: 100%; ">\n    <div class="widget-header">\n    <span class="headings title" style="float:left;">Users</span>\n      <button type="button" class="btn btn-default btn-xs refreshButton" data-dismiss="modal" style="margin-left:10px; color: #46ECBD; font-size: 10px;">\n        <span class="glyphicon glyphicon-refresh"></span>\n      </button>\n    </div>\n    <table class="table-condensed table-hover usertable-header" style="width:100%; padding: 0; table-layout: fixed;">\n        <col width="25%">\n        <col width="25%">\n        <col width="14%">\n        <col width="*">\n        <col width="12%">\n        <col width="14%">\n        <thead>\n            <tr>\n                <th align="left">Display Name</th>\n                <!--<th align="left">Profession</th> -->\n                <th align="left">Last Login</th>\n                <th align="left">Status</th>\n                <th align="left">&nbsp;</th>\n                <th align="left">Notifications</th>\n                <th align="left"></th>\n            </tr>\n        </thead>\n    </table>\n    <div class="panel-group useraccordion" style="overflow-y:auto; max-height:500px; width:100%">\n        <table class="table table-condensed table-hover usertable" style="width:100%; padding: 0; table-layout: fixed;">\n            <col width="25%">\n            <col width="25%">\n            <col width="14%">\n            <col width="*">\n            <col width="12%">\n            <col width="14%">\n            <tbody>\n            </tbody>\n        </table>\n    </div>\n    <span id="save-user-message"></span>\n</div>\n\n</div>'}),define("widgets/userList",["jquery","underscore","backbone","globalmodels/userCollection","singleRow/userRow","globalmodels/contextModel","text!templates/userScroll.html"],function(e,t,n,i,a,s,o){var l,r=n.View.extend({extraData:{},initialize:function(n){this.template=t.template("undefined"!=typeof n.template?n.template:o),"undefined"!=typeof n.extraData&&(this.extraData=n.extraData),l=new(i.extend({extraData:this.extraData})),this.$el.html(this.template({height:e(window).height()-50+"px"})),l.bind("add",this.addUser,this),l.bind("reset",this.reset,this),l.bind("sync",this.addAll,this),this.render();var a=e(".useraccordion",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&l.more()}),e(".refreshButton",this.$el).click(function(){e(".usertable > tbody",this.$el).empty(),l.refresh()}),e(".refreshButton",this.$el).hover(function(t){e(t.target).attr("title","Last Refresh: "+l.getLastRefresh())})},events:{"click #save-user-changes":"saveChanges"},saveChanges:function(){},render:function(){this.$el.html(this.template(this)),this.addAll(),e(window).resize(function(){e(".usertable-header").width(e(".usertable",this.$el).width())})},addAll:function(){this.reset();var t=!1;if(l.length)for(user in l.models)this.addUser(l.models[user]),t=!0;l.lastRefresh=new Date;var n=e(".useraccordion",this.$el),i=e(".usertable",this.$el);e(document).ready(function(){setTimeout(function(){e(".usertable-header").width(i.width())},200)}),setTimeout(function(){var e=(n.innerWidth(),n.innerHeight());e>0&&e<parseInt(n.css("max-height"))&&l.more()},500)},addUser:function(t){var n=new a({model:t});e(".usertable").append(n.render().el),this.$el.show(),n.events()},reset:function(){e(".usertable > tbody",this.$el).empty()},refresh:function(){this.reset()}});return r}),define("widgets/encounterSummary",["jquery","underscore","backbone","globalmodels/summaryModel","globalmodels/patientModel","globalmodels/contextModel"],function(e,t,n,i,a,s){var o=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change",this.update,this),s.on("change:page change:patients change:encounter change:startdate change:enddate change:enc_date",this.update,this),a.on("change:name",this.update,this)},update:function(){var t="your patients",n="Through today";s.get("encounter")?(t="encounter",n="Encounter starting "+s.get("enc_date")):(a.get("name")&&(t=a.get("name")),s.get("startdate")&&(n=s.get("enddate")?s.get("startdate")+" to "+s.get("enddate"):"Since "+s.get("startdate"))),e("#datepicker-input").val(n),this.$el.html(this.template(e.extend({},i.attributes,{title:t,encounterdate:n,page:s.get("page")})))}});return o}),define("text!templates/orderRow.html",[],function(){return'<div class = "widget-column col-sm-12">\n    <div class="panel panel-default" style="margin-bottom:4px">\n      <div>\n        <a data-toggle="collapse" data-parent=".orderaccordion" data-target="#collapse<%= viewid %>" class="orderlink" id="order<%= viewid %>">\n          <h4 class="panel-title">\n            <i class="glyphicon glyphicon-chevron-right color-<%= ordertype.toLowerCase() %>">\n          <img title="<%= ordertype %>" src="images/<%= ordertype.toLowerCase() %>-55x55px.jpg" alt="<%= ordertype %>" height="40" width="40">\n          </i>\n              <span class="headings"><%= name %></span>\n              <span class="badge">$<%= cost %></span>\n          </h4>\n        </a>\n      </div>\n      <div id="collapse<%= viewid %>" class="panel-collapse collapse">\n        <div class="panel-body">\n          <div class="row">\n            <div class="col-sm-6">\n              <span class="blue">You Ordered:</span>\n            </div>\n            <div class="col-sm-6">\n              <%= name %> ($<%= cost %>) on <span style="white-space:nowrap"><%= date.substr(0,19) %></span>\n            </div>\n          </div>\n          <div class="row orderalerts" ></div>\n        </div>\n      </div>\n    </div>\n\n</div>\n'}),define("text!templates/alertRow.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="row">\n  <div class="col-sm-12">\n    <div class="alert-type" style="display:inline-block;">\n      <img src="images/<%= alerttype.toLowerCase().replace(\' \',\'-\') %>-29x37.png"><br>\n      <span class="headings title" style="float:left;"><%= alerttype %></span>\n	  <div class="btn-group" style="float:right;">\n        <ul class="dropdown-menu dropdown-menu-right" role="menu" style=\'float:right;\'>\n          <li><a class="dislike_info" value="incorrect">Disagree</a></li>\n	      <li><a class="dislike_info" value="irrelevant">Not Applicable</a></li>\n          <li><a class="dislike_info" value="notuseful">Not Useful</a></li>\n          <li><a class="dislike_info dislike_other" value="other">Other...</a></li>\n          <li style="display:none" class="dislike_text"><textarea class=\'dislike_text_form\' rows="2" cols="25"></textarea></li>\n	    </ul>\n\n        <button type="button" class="btn btn-default btn-sm dislike" data-dismiss="modal" data-toggle="dropdown" style="font-size: 8px;">\n            <span class="glyphicon glyphicon glyphicon-thumbs-down">\n                <%= ((dislikes+likes==0) ? "N/A" : ((dislikes/(likes+dislikes))*100).toFixed(0)+"%") %></span>\n	        <span class="sr-only">Toggle Dropdown</span>\n        </button>\n\n      </div>\n\n      <button type="button" class="btn btn-default btn-sm like" data-dismiss="modal" style="font-size: 8px; float:right;">\n        <span class="glyphicon glyphicon glyphicon-thumbs-up">\n                <%= ((dislikes+likes==0) ? "N/A" : ((likes/(likes+dislikes))*100).toFixed(0)+"%") %></span>\n      </button>\n    </div>\n    <p>\n      <b><%= name %></b>\n      <%= html %> \n      <% if(ruleid) { %>\n      <span>\n	<a style=\'white-space:nowrap\' href=\'javascript:showEvidence("<%= ruleid %>")\'>\n	  Show Evidence >\n	  </a>\n      </span>\n      <% } %>\n    </p>\n    <!--<span class="headings">Impact:</span>\n    <span class="impact">$16</span>-->\n    <hr>\n  </div>\n</div>\n</div>\n'
}),define("singleRow/alertRow",["jquery","underscore","backbone","widgets/evidence","text!templates/alertRow.html","globalmodels/contextModel"],function(e,t,n,i,a,s){showEvidence=function(t){new i({evi:t});e("#evidence-"+t).modal()};var o=n.View.extend({tagName:"div",template:t.template(a),events:{"click .like":"like","click .dislike":"dislike","click .dislike_info":"critique","click .dislike_text":"clickText","keyup .dislike_text":"doentercomment"},render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},like:function(){this.rate("like")},dislike:function(){e(this.el).find(".dislike_text").hide(),this.rate("dislike")},rate:function(t){that=this,e.ajax({url:"/rate_alert",data:e.param(s.toParams())+"&alert_id="+that.model.get("id")+"&category="+that.model.get("alerttype")+"&rule_id="+that.model.get("ruleid")+"&action="+t,success:function(e){console.log(e)}})},critique:function(t){that=this;var n=e(t.target).attr("value");"other"==n?(t.stopPropagation(),e(this.el).find(".dislike_text").is(":visible")?e(this.el).find(".dislike_text").hide():e(this.el).find(".dislike_text").show()):e.ajax({url:"/critique_alert",data:e.param(s.toParams())+"&alert_id="+that.model.get("id")+"&rule_id="+that.model.get("ruleid")+"&category="+that.model.get("alerttype")+"&action_comment="+n,success:function(e){console.log(e)}})},clickText:function(e){e.stopPropagation()},doentercomment:function(e){13==e.keyCode&&(e.preventDefault(),this.addComment())},addComment:function(){var t=e(this.el).find(".dislike_text_form").val();e(this.el).find(".dislike_text_form").val(""),e(this.el).find(".dislike_text").hide(),e(this.el).find(".dropdown-menu").trigger("click"),console.log("Comment: "+t),e.ajax({url:"/critique_alert",data:e.param(s.toParams())+"&rule_id="+that.model.get("ruleid")+"&category="+that.model.get("alerttype")+"&action_comment="+t,success:function(e){console.log(e)}})},clickEvidenceSpan:function(){jQuery.noConflict(),this.evidence=new i({evi:this.model.get("ruleid")})}});return o}),define("singleRow/orderRow",["jquery","underscore","backbone","text!templates/orderRow.html","globalmodels/contextModel","singleRow/alertRow"],function(e,t,n,i,a,s){var o=n.View.extend({tagName:"div",template:t.template(i),render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this},events:function(){var t=this;e(document).ready(function(){e(t.el).unbind("click"),e(t.el).on("click",function(){e(t.el).find(".orderalerts").is(":empty")&&e.ajax({url:"/alerts",data:e.param(a.toParams())+"&order_id="+t.model.get("id"),success:function(n){for(var i=0;i<n.length;i++){var a=new s({model:n[i]});a.render=function(){return e(this.el).html(this.template(this.model)),this},e(t.el).find(".orderalerts").append(a.render().el)}}})})})}});return o}),define("widgets/orderList",["jquery","underscore","backbone","globalmodels/orderCollection","singleRow/orderRow"],function(e,t,n,i,a){var s=n.View.extend({initialize:function(n){this.typeFilter=n.typeFilter,this.template=t.template(n.template),this.$el.html(this.template({height:e(window).height()-50+"px"})),i.bind("add",this.addOrder,this),i.bind("reset",this.reset,this),i.bind("sync",this.addAll,this),this.render();var a=e(".orderaccordion",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&i.more()})},render:function(){this.$el.html(this.template(this)),this.addAll()},addAll:function(){this.reset();var t=this.typeFilter,n=!1;if(i.length)for(order in i.models)t&&i.models[order].get("ordertype")!=t||(this.addOrder(i.models[order]),n=!0);n?this.$el.show():this.$el.hide();var a=e(".orderaccordion",this.$el);setTimeout(function(){var e=a.innerHeight();e>0&&e<parseInt(a.css("max-height"))&&i.more()},500)},addOrder:function(t){var n=new a({model:t});e(".orderaccordion",this.$el).append(n.render().el),this.$el.show(),n.events()},reset:function(){e(".orderaccordion",this.$el).empty(),this.$el.hide()}});return s}),define("widgets/costtable",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/spendingModel","globalmodels/summaryModel","widgets/orderList","libs/jquery/jquery-mousestop-event"],function(e,t,n,i,a,s,o){var l=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.$el.html(this.template({page:i.get("page")})),s.on("change",this.update,this),a.on("change",this.update,this),this.update()},events:{"click .progress-bar":"handleClick"},update:function(){var t=null;if(!("title"in a.changed)){"date"in a.changed&&(t=a.changed.date);var n=[],i=[],l=a.getGathered();for(var r in l)i.push({order:r,cost:l[r],color:findColor(r)}),n.push(findColor(r));e("#order-table-1").empty(),e("#order-table-2").empty(),e(".progress").empty();var d,c=null,h=!1,p=!0;i.forEach(function(t){var n=e("<img>").attr("src","../images/"+t.order.toLowerCase()+"-55x55px.jpg"),i=e('<span class="cost-num">$'+t.cost+"</span>"),a=e("<span>"+t.order+"</span>"),o=e("<div>").attr("class","row"),l=e("<div>").attr("class","col-sm-2");o.mouseover(function(){c=t.order}),o.mouseleave(function(){c=null,setTimeout(d,500)}),e("<div>").attr("class","col-sm-3").append(n).appendTo(o),e(l).append(e("<div>").attr("class","row").append(i)).appendTo(o),e(l).append(e("<div>").attr("class","row").append(a)).appendTo(o),p?(e("#order-table-1").append(o),p=!1):(e("#order-table-2").append(o),p=!0);var r=(t.cost/s.get("spending")*100).toFixed(2);e(".progress").append(e('<div id="'+t.order+'" class="progress-bar bgcolor-'+t.order.toLowerCase()+'">').attr("style","width: "+r+"%").append(Math.round(r)+"%"))});var u,m=new o({template:'<div class="panel-group orderaccordion"> </div>',el:e("#mouse-target"),typeFilter:"doesnotexist",title:null});d=function(){null!=c||h||(m.title=null,m.$el.hide(),m.typeFilter="does not exist",h=!1)},e(m.el).mouseover(function(){h=!0}),e(m.el).mouseleave(function(){h=!1,setTimeout(d,500)}),e(this.el).mousemove(function(e){u=e}),e(this.el).mousestop(1e3,function(){c&&(m.$el[0].style.left=u.pageX+10+"px",m.$el[0].style.top=u.pageY-50+"px",c!=m.title&&(m.slice=c,m.typeFilter=c,m.addAll()))})}},handleClick:function(t){var n=e(t.currentTarget);console.log(n.attr("id"))}});return l}),define("text!templates/customerRow.html",[],function(){return'<td>\n    <%= customer_id %>\n    <input class="customer-id-row" type="hidden" value="<%= customer_id %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= name %></div>\n    <input class="customer-name-row customer-row-edit" type="text" value="<%= (name.trim && name.trim()) || name %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= abbr %></div>\n    <input class="customer-abbr-row customer-row-edit" type="text" value="<%= abbr %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= license_exp %></div>\n    <input class="customer-license-exp-row customer-row-edit" type="text" value="<%= license_exp %>">\n</td>\n<td>\n    <div class="customer-row-val"><%= license_type %></div>\n    <input class="customer-license-num-row customer-row-edit" type="text" value="<%= license_type %>">\n</td>\n<td>\n    <a class="customer-info-click hover-link">\n        View Info\n    </a>\n</td>\n'}),define("text!templates/widgetModal.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="widget-modal" class="modal fade" role="dialog" aria-hidden="true">\n        <div class="modal-dialog modal-dialog-lg">\n            <div class="modal-content">\n            </div>\n        </div>\n    </div>\n</div>'}),define("widgets/widgetModal",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/widgetModal.html","widgets/userList"],function(e,t,n,i,a){var s=n.View.extend({el:e("#modal-target"),template:t.template(a),widgetList:[],extraData:{},initialize:function(e){this.widgetList=e.widgetList},events:{},render:function(t){this.$el.html(this.template()),e("#widget-modal").modal({show:"true"});for(var n=0;n<this.widgetList.length;n++){e("#widget-modal").find(".modal-content").append("<div class='row content-row'></div>");var i=e("#widget-modal").find(".row").last(),a={el:i};e.extend(a,t);{new this.widgetList[n](a)}}e(document).ready(function(){e("button",this.$el).click(function(e){e.stopPropagation()})})}});return s}),define("text!templates/adminSettings.html",[],function(){return'<div class="page-header">\n    <h1>\n        Admin Settings\n        <small>\n            <i class="ace-icon fa fa-angle-double-right"></i>\n            EHR Integration Settings\n        </small>\n    </h1>\n</div>\n\n\n<div class = "widget-column col-sm-12" style="clear: both;">\n    <span class="headings title">EHR Integration Settings</span>\n    <div class="panel-body admin-settings">\n        <div class="col-md-12">\n            <div class="row">\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Unity Server Address:</div>\n                        <div style=\'float:left\'>\n                            <% var disabled = "";\n			                   if (typeof EHRURL !== "undefined")\n                               {\n                                    disabled = "disabled";\n                                    DISP_URL = EHRURL.replace("http://","").replace("https://","");\n                               }\n                            %>\n                            <select id=\'httphttps\' class=\'form-control\' <%= disabled %>>\n                                <option class=\'form-control\'\n                                    value=\'https://\' <%= (typeof EHRURL !== \'undefined\') ? (EHRURL.indexOf("https://") > -1) ? \'selected\' : \'\' : \'\'%>>https://\n                                </option>\n                                <option class=\'form-control\'\n                                    value=\'http://\' <%= (typeof EHRURL !== \'undefined\') ? (EHRURL.indexOf("https://") == -1) ? \'selected\' : \'\' : \'\' %>>http://\n                                </option>\n                          </select>\n                        </div>\n                        <div style=\'float:left; margin-bottom:10px;\'>\n                            <input id="admin-ip-input" type="text" class=\'form-control\'  <%= disabled %>\n                            <%= (typeof DISP_URL !== \'undefined\') ? "value=\'"+DISP_URL+"\' disabled" : "value=\'192.237.182.238\'" %>\n                            title=\'This url typically ends in /UnityService.svc\'>\n                        </div>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">App Name:</div>\n                        <input id="admin-name-input" class=\'form-control\' type="text" <%= disabled %>\n                            <%= (typeof EHRAppName !== \'undefined\') ? "value=\'"+EHRAppName+"\'" : "value=\'MavenPathways.TestApp\'" %>>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Service User:</div>\n                        <input id="admin-username-input" class=\'form-control\' type="text" <%= disabled %>\n                            <%= (typeof EHRServiceUser !== \'undefined\') ? "value=\'"+EHRServiceUser+"\' disabled" : "value=\'MavenPathways\'" %>>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n		      <div class="col-sm-6">\n                <div class="span3">EHR Integration:</div>\n		      </div>\n		      <div class="col-sm-6">\n                  <div style="width:50%;">\n                    <input id="admin-ehr-disable" type="checkbox" data-on-text="On" data-off-text="Off" data-size="small" <%= disabled %>\n                        <%= (typeof EHRDisabled !== \'undefined\' && EHRDisabled) ? "" : "checked" %>>\n                  </div>\n			</div>\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row" style=\'margin-bottom:10px;\'>\n                        <div class="span3">App Password:</div>\n                        <input id="admin-pw-input" class=\'form-control\' type="password" <%= disabled %>>\n                    </div>\n                </div>\n                <br/>\n            </div>\n            <div class="row">\n                <div class="col-sm-6">\n                    <div id="admin-setup-message" class="span3">&nbsp;</div>\n                </div>\n                <div class="col-sm-6">\n                    <div style=\'float:right\'>\n                        <button class="btn btn-default btn-xs unlock-admin-button">Edit EHR Settings</button>\n                        <button class="btn btn-default btn-xs lock-admin-button" style="display: none;">Lock EHR Settings</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <span class="headings title">Connection Settings</span>\n    <div class="panel-body admin-settings">\n        <div class="col-md-12">\n            <div class="row">\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Polling Interval (seconds):</div>\n                        <input id="admin-polling-input" class=\'time-input form-control\' type="text"\n                               value="<%= (typeof EHRPolling !== \'undefined\') ? EHRPolling : \'30\'%>">\n                    </div>\n                </div>\n                <div class="col-sm-6">\n                    <div class="row">\n                        <div class="span3">Login Inactivity Timeout (minutes):</div>\n                        <input id="admin-timeout-input" class=\'time-input form-control\' type="text"\n                               value="<%= (typeof UserTimeout !== \'undefined\') ? UserTimeout : \'120\'%>">\n                    </div>\n                </div>\n            </div>\n            <div class="save-settings-row row">\n                <div class="col-sm-6">\n                    <div id="save-admin-message" class="span3" >&nbsp;</div>\n                </div>\n                <div class="col-sm-6">\n                    <div style=\'float:right\'>\n                        <button class="btn btn-default setup-admin-button">Save Changes</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("widgets/adminSettings",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/userCollection","text!templates/adminSettings.html","bootstrapswitch"],function(e,t,n,i,a,s){var o=n.Model.extend({url:"/customer_info"}),l=n.View.extend({model:null,extraData:{},initialize:function(n){this.model=new o,this.template=t.template("undefined"!=typeof n.template?n.template:s),"undefined"!=typeof n.extraData&&(this.extraData=n.extraData);var a={};e.extend(a,i.toParams(),this.extraData),this.model.fetch({data:e.param(a)}),this.model.on("change",this.render,this)},events:{"click .setup-admin-button":"adminSetup","click .unlock-admin-button":"unlockSettings","click .lock-admin-button":"lockSettings","change #httphttps":"httphttps"},httphttps:function(){"http://"==e("#httphttps").find(":selected").text()&&alert("Http connections are inherently insecure and must not be used with operational systems.  This option is only for test, or demo systems without any ePHI only.")},activateEHR:function(){e("#admin-ehr-disable").bootstrapSwitch("state",!0,!0)},unlockSettings:function(){e("#admin-ip-input").prop("disabled",!1),e("#admin-name-input").prop("disabled",!1),e("#admin-username-input").prop("disabled",!1),e("#admin-pw-input").prop("disabled",!1),e("#httphttps").prop("disabled",!1),e("#admin-ehr-disable").bootstrapSwitch("toggleDisabled"),e("#admin-pw-input").val(""),e(".lock-admin-button").show(),e(".unlock-admin-button").hide()},lockSettings:function(){e("#admin-ip-input").prop("disabled",!0),e("#admin-name-input").prop("disabled",!0),e("#admin-username-input").prop("disabled",!0),e("#admin-pw-input").prop("disabled",!0),e("#httphttps").prop("disabled",!0),e("#admin-ehr-disable").bootstrapSwitch("toggleDisabled"),e("#admin-pw-input").val("password"),e(".lock-admin-button").hide(),e(".unlock-admin-button").show()},adminSetup:function(){var n=e("#admin-ip-input").val(),s=e("#admin-name-input").val(),o=e("#admin-pw-input").val(),l=e("#admin-polling-input").val(),r=e("#admin-timeout-input").val(),d=e("#admin-username-input").val(),c=!e("#admin-ehr-disable").is(":checked"),h=e(".lock-admin-button").is(":visible"),p=new RegExp("^[0]*[1-9]+[0]*$");if(p.test(l))if(p.test(r))if(h&&""==n)e("#save-admin-message").html("Please enter a Unity URL");else if(h&&""==o)e("#save-admin-message").html("Please enter the password");else{var u,m=e("#httphttps").find(":selected").text();h||!this.model.attributes.settings?(console.log("loading from fields"),u={EHRURL:e.trim(m)+e.trim(n),EHRAppName:s,EHRPassword:o,EHRServiceUser:d,EHRPolling:l,UserTimeout:r,EHRDisabled:c}):(console.log("loading from ",this.model.attributes.settings),u=t.clone(this.model.attributes.settings),t.extend(u,{EHRPolling:l,UserTimeout:r,locked:"locked"}));var g={};e.extend(g,i.toParams(),this.extraData),that=this,e.ajax({type:"POST",dataType:"json",url:"/setup_customer?"+e.param(g),data:JSON.stringify(u),success:function(){e("#save-admin-message").html("Settings saved!"),alert(h||!that.model.attributes.settings?"Success! Connection to EHR established.":"Connection settings saved!"),a.refresh(),setTimeout(a.refresh,7e3)},error:function(t){alert("The server could NOT successfully connect using this configuration.  "+t.responseJSON),e("#save-admin-message").html("&nbsp;")}})}else e("#save-admin-message").html("Please enter a valid number for the timeout");else e("#save-admin-message").html("Please enter a valid number for the polling interval")},render:function(){if(this.model.attributes.settings||(this.model.attributes.settings={}),"undefined"!==this.extraData.target_customer){if(0==this.extraData.target_customer)return void this.$el.hide();this.model.attributes.settings.target_customer=this.extraData.target_customer}return this.$el.html(this.template(this.model.attributes.settings)),e(document).ready(function(){e("#admin-ehr-disable",this.$el).bootstrapSwitch()}),this}});return l}),define("singleRow/customerRow",["jquery","underscore","backbone","globalmodels/contextModel","text!templates/customerRow.html","widgets/widgetModal","widgets/userList","widgets/adminSettings"],function(e,t,n,i,a,s,o,l){var r=n.View.extend({tagName:"tr class='customer-row'",template:t.template(a),render:function(){return e(this.el).html(this.template(this.model.toJSON())),this},events:function(){var t=this;e(document).ready(function(){e(t.el).unbind("click"),e(t.el).on("click",function(n){if(e(".customer-row > td").each(function(){e(this).find(".customer-row-val").html(e(this).find(".customer-row-edit").val())}),e(".customer-row-edit").hide(),e(".customer-row-val").show(),e(".customer-info-click",this.$el).is(n.target)||0!==e(".customer-info-click",this.$el).has(n.target).length){var i=new s({widgetList:[l,o]});i.render({extraData:{target_customer:t.model.attributes.customer_id}})}else e(t.el).find(".customer-row-val").hide(),e(t.el).find(".customer-row-edit").each(function(){e(this).width(e(this).parent().width()-5),e(this).show()})})})}});return r}),define("widgets/customerList",["jquery","underscore","backbone","globalmodels/customerCollection","singleRow/customerRow","globalmodels/contextModel","globalmodels/sidebarModel"],function(e,t,n,i,a,s,o){var l=n.View.extend({initialize:function(n){this.typeFilter=n.typeFilter,this.template=t.template(n.template),this.$el.html(this.template({height:e(window).height()-50+"px"})),i.bind("add",this.addCustomer,this),i.bind("reset",this.reset,this),i.bind("sync",this.addAll,this),this.render();var a=e(".customeraccordion",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&i.more()}),e(document).click(function(t){var n=e(this).find("tbody");n.is(t.target)||0!==n.has(t.target).length||e(".customer-row > td").each(function(){e(this).find(".customer-row-val").html(e(this).find(".customer-row-edit").val()),e(".customer-row-edit").hide(),e(".customer-row-val").show()})}),e(".refreshButton",this.$el).click(function(){e(".customertable > tbody",this.$el).empty(),i.refresh()}),e(".refreshButton",this.$el).hover(function(t){e(t.target).attr("title","Last Refresh: "+i.getLastRefresh())}),o.addOption("Customers"),this.showhide(),s.on("change:page",this.showhide,this)},events:{"click #save-customer-changes":"saveChanges","click document":"hideEdits"},showhide:function(){"customers"==s.get("page")?this.$el.show():this.$el.hide()},hideEdits:function(){},saveChanges:function(){that=this,e(".customer-row").each(function(){var t=e(this).find(".customer-id-row").val(),n=e(this).find(".customer-name-row").val(),i=e(this).find(".customer-abbr-row").val(),a=e(this).find(".customer-license-exp-row").val(),o=e(this).find(".customer-license-num-row").val();e.ajax({url:"/update_customer",data:e.param(s.toParams())+"&target_customer="+t+"&name="+n+"&abbr="+i+"&license="+o+"&license_exp="+a,success:function(){}}),e("#save-customer-message").html("Customer settings saved!")})},render:function(){this.$el.html(this.template(this)),this.addAll()},addAll:function(){this.reset();var t=(this.typeFilter,!1);if(i.length)for(customer in i.models)this.addCustomer(i.models[customer]),t=!0;t?this.$el.show():this.$el.hide(),i.lastRefresh=new Date;var n=e(".customeraccordion",this.$el);setTimeout(function(){var e=n.innerHeight();e>0&&e<parseInt(n.css("max-height"))&&i.more()},500)},addCustomer:function(t){var n=new a({model:t});e(".customertable").append(n.render().el),this.$el.show(),n.events()},reset:function(){e(".customertable > tbody",this.$el).empty(),this.$el.hide()}});return l}),define("widgets/costdonut",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/spendingModel","widgets/orderList","libs/jquery/jquery-mousestop-event"],function(e,t,n,i,a,s){var o=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.$el.html(this.template({page:i.get("page")})),a.on("change",this.update,this),this.update()},update:function(){var t=null;if(!("typeFilter"in a.changed)){"dateFilter"in a.changed?(t=a.changed.dateFilter,e("#costbd-restriction")[0].innerHTML="Only spending on <i><b>"+t.toDateString()+"</b></i>"):e("#costbd-restriction")[0].innerHTML="";var n=[],i=[],o=a.getGathered();for(var l in o)i.push({order:l,cost:o[l]}),n.push(findColor(l));var r=AmCharts.makeChart("cost-bd",{type:"pie",colors:n,dataProvider:i,titleField:"order",valueField:"cost",labelRadius:5,pullOutOnlyOne:!0,radius:"25%",innerRadius:"60%",labelText:"[[title]]: $[[value]]",balloonText:"[[title]]<br>$[[value]]<br>[[percents]]%"});r.addListener("pullOutSlice",function(e){a.clickType(e.dataItem.title)},a),r.addListener("pullInSlice",function(){a.clickType("")},a);var d,c=null,h=!1,p=new s({template:'<div class="panel-group orderaccordion"> </div>',el:e("#mouse-target"),typeFilter:"doesnotexist",slice:null}),u=function(){null!=c||h||(p.slice=null,p.$el.hide(),p.typeFilter="does not exist",h=!1)};r.addListener("rollOverSlice",function(e){c=e.dataItem}),r.addListener("rollOutSlice",function(){c=null,setTimeout(u,500)}),e(p.el).mouseover(function(){h=!0}),e(p.el).mouseleave(function(){h=!1,setTimeout(u,500)}),e(this.el).mousemove(function(e){d=e}),e(this.el).mousestop(1e3,function(){c&&(p.$el[0].style.left=d.pageX+10+"px",p.$el[0].style.top=d.pageY-50+"px",c!=p.slice&&(p.slice=c,p.typeFilter=c.title,p.addAll()))}),r.invalidateSize()}}});return o}),define("widgets/patientInfo",["jquery","underscore","backbone","globalmodels/patientModel","globalmodels/contextModel"],function(e,t,n,i,a){var s=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change",this.update,this),a.on("change:page",function(){"pathway"==a.get("page")?this.update(i):this.$el.hide()},this)},update:function(){i.get("id")&&"pathway"==a.get("page")?(this.$el.html(this.template(i.attributes)),this.$el.show()):this.$el.hide()}});return s}),define("widgets/alertList",["jquery","underscore","backbone","globalmodels/alertCollection","singleRow/alertRow"],function(e,t,n,i,a){var s=n.View.extend({initialize:function(n){this.template=t.template(n.template),this.$el.html(this.template({height:e(window).height()-50+"px"})),i.bind("add",this.addAlert,this),i.bind("reset",this.reset,this),i.bind("sync",this.addAll,this),this.addAll();var a=e(".alertlist",this.$el);a.scrollTop(0),a.scroll(function(){a.scrollTop()+a.innerHeight()+100>=a[0].scrollHeight&&i.more()})},addAlert:function(t){var n=new a({model:t});e("#alertaccordion").append(n.render().el)},addAll:function(){this.reset();for(alert in i.models)this.addAlert(i.models[alert]);var t=e(".alertlist",this.$el);setTimeout(function(){var e=t.innerHeight();e>0&&e<parseInt(t.css("max-height"))&&i.more()},500)},reset:function(){e("#alertaccordion").empty()}});return s}),define("widgets/spend_histogram",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/histogramModel","amchartsserial"],function(e,t,n,i,a){var s=["diagnosis","admission","discharge","spending"],o=n.View.extend({initialize:function(e){this.template=t.template(e.template),a.on("change",this.update,this),i.on("change:page",this.update,this),this.update()},events:{"click #histogram-download":"downloadhist"},downloadhist:function(){var e=["data:text/csv;charset=utf-8,"+s.join(",")];t.each(a.attributes,function(n){e.push('"'+t.map(s,function(e){return n[e]}).join('","')+'"')}),window.open(encodeURI(e.join("\n")))},update:function(){if(a.get(0)&&"home"==i.get("page")){this.$el.html(this.template(i.attributes));var e=t.pluck(a.attributes,"spending"),n=t.max(e),s=t.min(e);this.binwidth||(this.binwidth=100*Math.floor((n-s)/1e3),this.binwidth||(this.binwidth=1e3));for(var o=this.binwidth,l=o*Math.floor(s/o),r=[],d=Math.floor((n-s)/o);d>=0;d--)r[d]=0;t.each(e,function(e){var t=Math.floor((e-l)/o);r[t]++}),r=t.map(r,function(e,t){var n=l+o*t;return{center:n+"-"+(n+o),value:e}});var c=AmCharts.makeChart("spend-histogram",{type:"serial",categoryField:"center",autoMarginOffset:40,marginRight:60,marginTop:60,startDuration:1,fontSize:13,theme:"light",categoryAxis:{gridPosition:"start",labelRotation:45},graphs:[{type:"column",valueField:"value",fillAlphas:1,id:"AmGraph-1",labelText:"",title:"graph 1"}],valueAxes:[{id:"ValueAxis-1",title:"Encounters",integersOnly:!0}],dataProvider:r});this.$el.show(),c.invalidateSize()}else this.$el.hide()}});return o}),define("widgets/maveninfo",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext"],function(e,t,n,i,a,s){var o=n.View.extend({initialize:function(e){this.template=t.template(e.template),s.on("propagate",this.render,this),i.on("change:page change:pathid",this.hidePopup,this)},showhide:function(){this.$el.show()},events:{"click button.close":"hidePopup"},render:function(){if(!s.get("selectedNode"))return void this.hidePopup();if(s.get("selectedNode")!=this.selectedNode)if("undefined"!=typeof s.get("selectedNode")){s.get("selectedNode").attributes.sidePanelText&&!s.get("selectedNode").attributes.isProtocol?(this.hidePopup(),this.selectedNode=s.get("selectedNode"),this.$el.html(this.template(s.get("selectedNode").attributes)),this.showPopup()):this.hidePopup()}else this.hidePopup()},hidePopup:function(){this.$el.hide(),this.selectedNode=s.get("selectedNode")},showPopup:function(){e("#side-popup").css("top","none"),e("#side-popup").css("left","none"),e("#side-popup").css("bottom",5),e("#side-popup").css("right",11),this.$el.show(1e3)}});return o}),define("widgets/pathway",["jquery","underscore","backbone","jsplumb","globalmodels/contextModel","globalmodels/sidebarModel"],function(e,t,n,i,a,s){var o=n.View.extend({initialize:function(n){t.bindAll(this,"render","drawTree","showFirstchild","expandAll","suggested"),this.template=t.template(n.template),this.$el.html(this.template()),console.log("pathway ini"),s.addOption("Pathways"),this.showhide(),a.on("change:page",this.showhide,this),setTimeout(t.bind(this.showFirstchild,this),1e3),e('span[data-toggle="tooltip"]').tooltip({animated:"fade",placement:"left",container:"body"}),i.importDefaults({container:"#pathway-container",MaxConnections:-1,Endpoint:"Blank",PaintStyle:{lineWidth:2,strokeStyle:"#ccc"},HoverPaintStyle:{lineWidth:3,strokeStyle:"#61B7CF"},DragOptions:{cursor:"crosshair"},Endpoints:[["Dot",{radius:1}],["Dot",{radius:1}]],EndpointStyles:[{fillStyle:"#ccc"},{fillStyle:"#ccc"}],Connector:["Flowchart",{cornerRadius:3}],Anchors:["Bottom","Top"]}),e("#pathway-container").draggable(),e("#pathway-container").on("wheel",function(t){t.preventDefault();var n=/scale\((.*)\)/,i=e("#pathway-container")[0].style.transform,a=n.exec(i);if(console.log(a),t.originalEvent.deltaY>0)var s=a[1]-.05;else var s=a[1]-0+.05;var o="scale("+s+")";e("#pathway-container").css({transform:o})})},events:{"click button#copybutton":"copyIndex","click .qualifier":"toggleChildren","click button#expandAll":"expandAll","click button#sugPath":"suggested"},showhide:function(){"pathways"==a.get("page")?this.$el.show():this.$el.hide()},render:function(){},copyIndex:function(){e("<div>").attr("id","copiedText").appendTo("body"),e("#copiedText").text("In summary, the patient is a 54-year-old man with symptomatic mCRPC and good performance status (ECOG 0-1) who has not received prior docetaxel therapy. \r\n   - This is evidenced by rising PSA in the setting of castrate testosterone levels.\r\n   - Prior radiographic imaging has confirmed metastasis.\r\n   - Symptoms that are attributable to the metastatic diseaseburden include:\r\n    [[[SYMPTOMS]]]\r\nManagement Plan:\r\nPer AUA guidelines*, The patient will receive\r\n   - Docetaxel therapy\r\n   - Abiraterone + prednisone\r\n   [[[OR Since the patient cannot receive the standardtretatment, he was offered ketoconazole + steroid,mitoxantrone or radionuclide therapy]]]\r\n \r\n*Index Patient 3 - http://www.auanet.org/education/guidelines/castration-resistant-prostate-cancer.cfm"),e("#toast").css("visibility","visible"),setTimeout(function(){e("#toast").fadeOut("slow",function(){})},2e3)},toggleChildren:function(t){var n=t.currentTarget.parentNode;e(".children",n).first().toggle(),this.drawTree()},drawTree:function(){i.reset();var t=e(".qualifier");if(e.each(t,function(t,n){var a=i.addEndpoint(n,{anchor:"Bottom"}),s=n.parentNode,o=e(".children",s).first();if(o[0]){var l=o[0].children;e.each(l,function(t,s){var o=e(".qualifier",s).first(),l=i.addEndpoint(o,{anchor:"Top"});e(n).is(":visible")&&e(o).is(":visible")&&i.connect({source:a,target:l})})}}),e("#gp").is(":visible")&&e("#i3").is(":visible")){var n=i.addEndpoint(e("#gp"),{anchor:"Bottom"}),a=i.addEndpoint(e("#i3"),{anchor:"Top"});i.connect({source:n,target:a})}},showFirstchild:function(){e("#n1").click()},suggested:function(){console.log("suggested"),e(".suggested").css({border:"2px solid orange"})},expandAll:function(){console.log("expandAll"),e("#n1").click(),e(".children").toggle(),this.drawTree(),e(".suggested").css({border:"2px solid #46bdec"}),e("#pathway-container").css({"-webkit-transform":"scale(0.75)","-moz-transform":"scale(0.75)","-ms-transform":"scale(0.75)","-o-transform":"scale(0.75)",transform:"scale(0.75)"})}});return o}),define("widgets/datepicker-chart",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/histogramModel"],function(e,t,n,i,a){var s=n.View.extend({initialize:function(e){this.template=t.template(e.template),a.on("change",this.update,this),i.on("change page",this.update,this),this.$el.html(this.template(this)),this.update()},update:function(){var t=[];
for(var i in a.attributes){var s=a.attributes[i];t.push(s)}var o=AmCharts.makeChart("datepicker-chart",{type:"serial",theme:"light",dataDateFormat:"YYYY-MM-DD",pathToImages:"http://cdn.amcharts.com/lib/3/images/",categoryField:"admission",startDuration:1,categoryAxis:{gridPosition:"start"},chartCursor:{},chartScrollbar:{},trendLines:[],graphs:[{fillAlphas:1,id:"AmGraph-1",title:"graph 1",type:"column",valueField:"spending",balloonText:"[[diagnosis]] <br /><b>$[[value]]</b>"}],guides:[],valueAxes:[{id:"ValueAxis-1",title:"Spending"}],allLabels:[],balloon:{},chartScrollbar:{graph:"AmGraph-1",scrollbarHeight:20},dataProvider:t,periodSelector:{position:"left",periods:[{period:"MM",selected:!0,count:1,label:"1 month"},{period:"YYYY",count:1,label:"1 year"},{period:"YTD",label:"YTD"},{period:"MAX",label:"MAX"}]}});o.addListener("clickGraphItem",function(t){var i,a=t.item.dataContext;i="episode/"+a.encounterid+"/",i+="patient/"+a.patientid+"/",i+=a.admission,n.history.navigate(i,!0),e("#datepicker-modal").modal("hide")}),e("#datepicker-modal").on("shown.bs.modal",function(){o.invalidateSize()})}});return s}),define("widgets/topBanner",["jquery","underscore","backbone","globalmodels/contextModel"],function(e,t,n,i){var a=n.View.extend({initialize:function(e){this.template=t.template(e.template),this.update(i),i.on("change:display change:page",this.update,this)},update:function(){this.$el.html(this.template(i.attributes))},events:{"click #settings_button":"handle_settings","click #profile_button":"handle_profile","click #pathway_button":"handel_pathway","click #pathwayEditor_button":"handel_pathwayEditor"},handel_pathway:function(){e("#pathwayName").html(""),n.history.navigate("pathway/"+i.get("pathid")+"/node/"+i.get("code"),{trigger:!0})},handel_pathwayEditor:function(){n.history.navigate("pathwayeditor/"+i.get("pathid")+"/node/"+i.get("code"),!0)},handle_profile:function(){e("#profile-modal").modal({show:"true"})},handle_settings:function(){e("#settings-modal").modal({show:"true"})}});return a}),define("text!templates/pathway/toolbar.html",[],function(){return'<ul id=\'toolbar\' class="nav nav-list">\n    <li class="hover" id="newpath-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  New Pathway\n			 </span>\n        </a>\n        <b class="arrow"></b>\n    </li>\n    <li class="hover" id="exportpath-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Export Pathway\n			 </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n\n\n    <li class="hover" id="copypath-button">\n        <a href="javascript:void(0)" class="disabled">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Copy Pathway\n			 </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <% if (treeNode) { %>\n\n    <li class="hover" id="trigger-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n			 <span class="menu-text">\n			  Edit Triggers\n			 </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <li class="hover" id="editNode-button">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Edit Selected Node\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n    <li class="hover" id="deleteNodeButton">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newPath.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Delete Selected Node\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n     <li class="hover" id="addChildButton">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newChild.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Add Child\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n    </li>\n\n        <% if (treeNode.children && treeNode.children.length == 0){%>\n             <li class="hover" id="addProtocolButton">\n        <a href="javascript:void(0)">\n            <i class="menu-icon">\n                <img src="../images/temp/newProtocole.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Add Protocol\n             </span>\n\n        </a>\n        <b class="arrow"></b>\n        </li>\n        <% } %>\n\n          <% if ((treeNode.children && treeNode.children.length > 0)||treeNode.protocol) {%>\n<li class="hover" id="collapseButton">\n        <a href="javascript:void(0)">\n            <% if (childrenHidden){%>\n            <i class="menu-icon">\n                <img src="../images/temp/expand.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Expand Node\n             </span>\n            <%}else{%>\n            <i class="menu-icon">\n                <img src="../images/temp/collapse.jpg"\n                     style="width: 30px; height: 25px"></i>\n             <span class="menu-text">\n              Collapse Node\n             </span>\n            <%}%>\n        </a>\n        <b class="arrow"></b>\n    </li>\n        <% } %>\n\n    <% } %>\n</ul>\n\n\n\n\n\n\n\n\n'}),define("widgets/pathway/toolbar",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/pathwayCollection","pathway/models/treeModel","pathway/models/treeContext","pathway/modalViews/newPathway","pathway/modalViews/editNode","pathway/modalViews/nodeEditor","pathway/modalViews/protocolEditor","pathway/modalViews/DeleteDialog","pathway/modalViews/ruleWizard","pathway/singleRows/pathRow","pathway/internalViews/treeNodeActionSet","text!templates/pathway/pathwayListEntry.html","text!templates/pathway/toolbar.html"],function(e,t,n,i,s,o,l,r,d,c,h,p,u,m,g,f,v){var b=function(e,t,n){require(["libs/jquery/Blob","libs/jquery/FileSaver.min"],function(i,a){var s=new Blob([e],{type:n});a(s,t)})},w=n.View.extend({template:t.template(v),events:{"click #newpath-button":"handle_newPath","click #trigger-button":"addTrigger","click #exportpath-button":"exportPath","click #copypath-button":"handle_copyPath","click #editNode-button":"editNode","click #deleteNodeButton":"deleteNode","click #addChildButton":"addChild","click #addProtocolButton":"addProtocol","click #collapseButton":"expandCollapse","click #testButton":"handleTest"},handleTest:function(){o.changeNodePosition(l.get("selectedNode"),-1)},initialize:function(){if(l.get("selectedNode")){var e=l.get("selectedNode");this.$el.html(this.template({treeNode:e.attributes,childrenHidden:e.childrenHidden&&e.childrenHidden(),page:i.get("page")}))}else this.$el.html(this.template({treeNode:null,childrenHidden:null,page:i.get("page")}));i.on("change:page",this.showhide,this),this.showhide(),l.on("propagate",this.renderActions,this),this.renderActions()},showhide:function(){"pathEditor"==i.get("page")?(this.$el.show(),e("#toolbar").show(),e("#widget-toolbox").addClass("grid")):(this.$el.hide(),e("#toolbar").hide(),e("#widget-toolbox").removeClass("grid"))},addTrigger:function(){e("#modal-target").empty(),e("#detailed-trigger-modal").empty(),a=new u({el:"#modal-target"})},renderActions:function(){if(l.get("selectedNode")){var e=l.get("selectedNode");this.$el.html(this.template({treeNode:e.attributes,childrenHidden:e.childrenHidden&&e.childrenHidden(),page:i.get("page")}))}},renderPathList:function(){e("#avail-paths").html(""),t.each(s.models,function(t){var n=new m({model:t});e("#avail-paths").append(n.render().$el)},this)},handle_newPath:function(e){e.preventDefault(),a=new r({el:"#modal-target"})},handle_copyPath:function(){e.ajax({type:"GET",url:"/pathway_version?"+e.param(i.toParams()),dataType:"json",success:function(){s.addNewPath()}})},exportPath:function(){b(JSON.stringify(o.toJSON({toExport:!0})),o.get("name")+".pathway","text/plain")},addChild:function(){new c(l.get("selectedNode"))},addProtocol:function(){new h(l.get("selectedNode"))},expandCollapse:function(){l.get("selectedNode").childrenHidden()?l.get("selectedNode").showChildren():o.collapse(l.get("selectedNode")),o.getShareCode(),l.trigger("propagate")},editNode:function(){new d},deleteNode:function(){new p}});return w}),define("text!templates/pathway/treeTemplate.html",[],function(){return'<hr/>\n<div class="col-xs-12 col-sm-12 widget-container-col">\n    <!-- #section:custom/widget-box -->\n    <div class="widget-box">\n        <div class="widget-header widget-header-large">\n            <h4 class="widget-title">Pathway Editor</h4>\n            <!-- #section:custom/widget-box.toolbar -->\n            <div class="widget-toolbar">\n                <div class="widget-menu">\n                    <a href="#" data-action="fullscreen" class="orange2">\n                        <i class="ace-icon fa fa-expand"></i>\n                    </a>\n                    <a href="#" data-action="collapse">\n                        <i class="ace-icon fa fa-chevron-up"></i>\n                    </a>\n                </div>\n            </div>\n            <!-- /section:custom/widget-box.toolbar -->\n        </div>\n        <div class="widget-body">\n            <div id=\'widget-toolbox\' class="widget-toolbox">\n                 <div id=\'pathway-toolbox\' class=\'sidebar  h-sidebar navbar-collapse collapse\'></div>\n\n            <div class="widget-main" style="overflow:hidden">\n                <div style="width:10000px; text-align:center; clear:both; height: auto; min-height:600px; transform: scale(1.0);"\n                     class="pathtree container-fluid">\n                </div>\n                <div style="width:auto; clear:both"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!templates/pathway/insertDiv.html",[],function(){return'<div id="insertButton" style="background-color: white; font-size: 200%; border-style: solid">+</div>'}),define("widgets/pathway/TreeView.js",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeModel","pathway/models/treeContext","widgets/pathway/toolbar","pathway/internalViews/triggerNode","pathway/modalViews/nodeEditor","pathway/Helpers","pathway/models/pathwayCollection","text!templates/pathway/treeTemplate.html","text!templates/pathway/insertDiv.html","jsplumb"],function(e,t,n,i,a,s,o,l,r,d,c,h){var p=n.View.extend({template:t.template(h),initialize:function(){this.$el.html(this.template()),this.toolbar=new o({el:this.$("#pathway-toolbox")}),e(".widget-title",this.$el).html("pathway"==i.get("page")?"Pathway":"Pathway Editor"),i.on("change:page",function(){"pathEditor"==i.get("page")||"pathway"==i.get("page")?(e(".widget-title",this.$el).html("pathway"==i.get("page")?"Pathway":"Pathway Editor"),this.$el.show()):this.$el.hide()},this),this.plumb=jsPlumb.getInstance({MaxConnections:-1,Connector:["Flowchart",{cornerRadius:3}],Endpoint:"Blank",PaintStyle:{lineWidth:2,strokeStyle:"#ccc"},HoverPaintStyle:{lineWidth:2,strokeStyle:"#61B7CF"}});var t=this;setTimeout(function(){t.reset=!0,t.render()},200),this.treeEl=e(".pathtree",this.$el),t.treeEl.css({opacity:0}),this.treeEl.draggable({start:function(){s.suppressClick=!0},stop:function(t){setTimeout(function(){s.suppressClick=!1},100),e(t.toElement).one("click",function(e){e.stopImmediatePropagation()})}});var t=this;this.plumb.setContainer(this.treeEl[0]),this.$el.on("wheel",function(e){var n=e.originalEvent.pageX,i=e.originalEvent.pageY,a=t.treeEl.offset().left,s=t.treeEl.offset().top;e.preventDefault();var o=/scale\((.*)\)/,l=t.treeEl[0].style.transform,r="transform";if(l||(l=t.treeEl[0].style.msTransform,r="msTransform"),l){var d=o.exec(l)[1];if(e.originalEvent.deltaY>0)var c=d-.05;else var c=d-0+.05;var h=i-(i-s)*c/d,p=n-(n-a)*c/d;if(c>5||.25>=c)return;var u="scale("+c+")";t.treeEl.css("transform"==r?{transform:u}:{msTransform:u}),t.treeEl.offset({left:p,top:h}),t.setDraggableBox(c)}});var n;window.onresize=function(){window.clearTimeout(n),n=window.setTimeout(function(){t.render()},100)},s.on("propagate sync",function(){this.render()},this),i.on("change:pathid",function(){s.set({selectedNodeOffset:null,selectedNode:null},{silent:!0}),t.treeEl.css({opacity:0}),t.reset=!0,t.treeEl.css(t.treeEl[0].style.transform?{left:"",top:"",transform:"scale(1)"}:{left:"",top:"",msTransform:"scale(1)"})}),this.render()},render:function(){var t=this;if("pathEditor"==i.get("page")||"pathway"==i.get("page")){this.$el.show(),this.toolbar.showhide(),t.treeEl.css({cursor:"wait"});var n=i.get("pathid");n&&"0"!=n?this.$el.show():this.$el.hide(),a.elPairs=[],this.plumb.deleteEveryEndpoint(),this.treeEl.html(""),e(".pathtree",t.$el).append("<div style= 'width:auto; height: auto' class='nodeEl'></div>"),e(".pathtree",t.$el).append("<div style='height:100px'></div>");{new l({el:e(".nodeEl",this.$el).last(),model:a})}e("#pathwayName").html("pathEditor"==i.get("page")?"Now Editing Pathway: "+a.attributes.name:"pathHistory"==i.get("page")?"Now Viewing History for Pathway: "+a.attributes.name:""),this.renderJSPlumb(),this.adjustWidth(),this.setDraggableBox()}},adjustWidth:function(){if(this.reset){this.reset=!1;var t=e(".nodeEl",this.$el).width(),n=(this.$el.width()-t)/2;if(n>0){var i=this.treeEl.offset();i.left=this.$el.offset().left+n,this.treeEl.offset(i)}this.treeEl.css({opacity:1})}},setDraggableBox:function(t){t||(t=1);var n=e(".nodeEl",this.$el),i=n.width(),a=n.height(),s=this.$el.offset().left,o=this.$el.offset().top,l=this.$el.width(),r=this.$el.height(),d=[s+(100-i)*t,o+(50-a)*t,s+l-100*t,o+r-100*t];this.treeEl.draggable("option","containment",d)},renderJSPlumb:function(){var t=this,o=n.View.extend({initialize:function(e){this.$el.html("<div style='float: left; background-color: white; height: 15px'>+</div>"),this.parentNode=e.source,this.childNode=e.target;var t=this;this.$el.on("click",function(){new r(t.parentNode,t.childNode)})}});for(var l in a.elPairs){var d=a.elPairs[l];if(d.source.$el.is(":visible")&&d.target.$el.is(":visible")){var c=d.source.makeExit(t.plumb),h=d.target.makeEntrance(t.plumb);t.plumb.connect(d.bold?{source:c,target:h,overlays:[["Custom",{create:function(){var t=new o({source:d.source.model,target:d.target.model});return"pathEditor"==i.get("page")?t.$el:e("<div></div>")},location:-10,id:"customOverlay"}]],paintStyle:{lineWidth:4,strokeStyle:"#46bdec"}}:{overlays:[["Custom",{create:function(){var t=new o({source:d.source.model,target:d.target.model});return"pathEditor"==i.get("page")?t.$el:e("<div></div>")},location:-10,id:"customOverlay"}]],source:c,target:h})}}var p=e(".selected.treeNode"),u=s.get("selectedNodeOffset");if(u&&p.length&&p.is(":visible")&&u.clickid==p.attr("clickid")){var m=this.treeEl.offset(),d=p.offset();this.treeEl.offset({left:m.left-d.left+u.left,top:m.top-d.top+u.top})}i.trigger("rendered"),t.treeEl.css({cursor:"default"})},showExtraInfo:function(){},drawNodes:function(){}});return p}),define("text!templates/pathway/pathwaysList.html",[],function(){return'<div class="page-header">\n    <h1>\n        Pathways\n        <small>\n            <i class="ace-icon fa fa-angle-double-right"></i>\n            Pathway Management &amp; Editing\n        </small>\n    </h1>\n</div>\n<div class="row">\n    <div class="col-xs-12 col-sm-6 widget-container-col">\n        <!-- #section:custom/widget-box -->\n        <div class="widget-box">\n            <div class="widget-header widget-header-large">\n                <h4 class="widget-title">Library</h4>\n                <!-- #section:custom/widget-box.toolbar -->\n                <div class="widget-toolbar">\n                    <div class="widget-menu">\n                        <a href="#" data-action="fullscreen" class="orange2">\n                            <i class="ace-icon fa fa-expand"></i>\n                        </a>\n                        <a href="#" data-action="collapse">\n                            <i class="ace-icon fa fa-chevron-up"></i>\n                        </a>\n                    </div>\n                </div>\n                <!-- /section:custom/widget-box.toolbar -->\n            </div>\n            <div class="widget-body">\n                <div class="widget-main">\n                    <div class="row">\n                        <div class="col-sm-12 widget-container-col">\n                            <div class="widget-box transparent">\n                                <div class="widget-header">\n                                    <h5 class="widget-title lighter">Folder &amp; Documents</h5>\n\n                                    <div class="widget-toolbar">\n                                        <div class="widget-menu">\n                                            <button class="btn btn-white btn-primary btn-xs dropdown-toggle" data-action="settings" data-toggle="dropdown">New<span class="ace-icon fa fa-caret-down icon-on-right"></span>\n                                            </button>\n                                            <ul class="dropdown-menu dropdown-menu-right dropdown-light-blue dropdown-caret dropdown-closer">\n                                                <li>\n                                                    <a id=\'paths-list-add-folder\' class="blue">\n                                                        New Folder\n                                                    </a>\n                                                </li>\n                                                <li>\n                                                    <a id=\'add-base-pathway\' class="blue">\n                                                        New Pathway\n                                                    </a>\n                                                </li>\n                                            </ul>\n                                        </div>\n                                        <div class="widget-menu">\n                                            <button class="btn btn-white btn-primary btn-xs dz-clickable path" id="mvn-importpath-btn"><span class="ace-icon fa fa-cloud-upload light-blue"></span>Import\n                                                <input id="browser" type="file" accept=".pathway" class="mvn-importpath">\n                                            </button>\n                                        </div>\n                                    </div>\n                                </div>\n                                <div class="widget-body">\n                                    <div class="widget-main">\n                                        <div class="dd" id="nestable" style="max-width: NONE; width:100%">\n                                            <ol class="dd-list" id="avail-paths-list">\n\n                                            </ol>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'}),define("text!templates/pathway/pathwayFolderEntry.html",[],function(){return'<div class="pathway-folder-title dd-handle dd2-handle" name="<%=name%>">\n    <!--<span title="New Folder" class="glyphicon glyphicon-folder-close"></span>\n    <span title="New Folder" class="glyphicon glyphicon-folder-open"></span> -->\n    <i class="normal-icon ace-icon fa fa-folder orange bigger-130"></i>\n\n    <i class="drag-icon ace-icon fa fa-arrows bigger-125"></i>\n\n</div>\n<div class="dd2-content">\n    <%=name%>\n    <div class="pull-right action-buttons">\n            <div class="btn-group">\n                <button class="btn btn-white btn-primary btn-xs dropdown-toggle" data-toggle="dropdown">New<span class="ace-icon fa fa-caret-down icon-on-right"></span>\n                </button>\n                <ul class="dropdown-menu dropdown-menu-right dropdown-caret">\n                    <li>\n                        <a class="add-sub-folder">Sub-Folder</a>\n                    </li>\n                    <li>\n                        <a class="add-sub-pathway">Pathway</a>\n                    </li>\n                </ul>\n            </div>\n        <a class="red delete-folder">\n            <i class="ace-icon fa fa-trash-o bigger-140"></i>\n        </a>\n    </div>\n</div>\n<ol class="sub-folder-contents dd-list"></ol>\n'}),define("pathway/singleRows/folderRow",["jquery","underscore","backbone","router","globalmodels/contextModel","text!templates/pathway/pathwayFolderEntry.html","pathway/modalViews/newPathway","pathway/modalViews/newPathwayFolder"],function(e,t,n,i,a,s,o,l){var r=n.View.extend({tagName:"li class='sub-folder dd-item dd2-item dd-collapsed'",template:t.template(s),parentList:[],events:{"click .glyphicon-folder-open":"closeFolder","click .glyphicon-folder-close":"openFolder","click .add-sub-pathway":"handleNewPathway","click .add-sub-folder":"handleNewSubFolder","click .delete-folder":"handleDeleteFolder"},openFolder:function(t){e(t.target).closest(".sub-folder").switchClass("dd-collapsed","dd-expanded",0)},closeFolder:function(t){e(t.target).closest(".sub-folder").switchClass("dd-expanded","dd-collapsed",0),e(t.target).closest(".sub-folder").find(".sub-folder").switchClass("dd-expanded","dd-collapsed",0)},setParents:function(){for(var t=[e(this.el).children(".pathway-folder-title").attr("name")],n=e(this.el).parent().closest(".sub-folder");n.length&&(parentName=n.children(".pathway-folder-title").attr("name"),"undefined"!=typeof parentName&&""!=parentName);)t.push(parentName),n=e(n).parent().closest(".sub-folder");return t.reverse(),this.parentList=t,t},handleNewPathway:function(e){e.stopPropagation(),new o({el:"#modal-target",parentList:this.setParents()})},handleDeleteFolder:function(t){if(t.stopPropagation(),e(".path-row",this.$el).length){var n=confirm("WARNING: This will delete all contained pathways. Are you sure you want to do this?");if(!n)return}this.deleteFolderAndPathways(e(this.el),this)},deleteFolderAndPathways:function(t,n){e(t).children(".sub-folder-contents").children().each(function(){if(e(this).hasClass("pathrow-item")){var t=e(this).children(".path-row").attr("id");e.ajax({type:"DELETE",dataType:"json",url:"/list/"+t,error:function(){alert("Could not delete pathway")}})}else n.deleteFolderAndPathways(this,n)}),this.undelegateEvents(),e(this.el).remove(),delete this.$el,delete this.el},handleNewSubFolder:function(t){t.stopPropagation(),this.setParents(),new l({el:"#modal-target",parentFolder:e(this.el).children("ol").first(),parentList:this.parentList})},handleMove:function(t,n,i){var a=0;e(t).children("ol").children().each(function(){if(e(this).hasClass("pathrow-item")){a++;var t={location:n,position:a},s=e(".path-row",e(this)).attr("id");i.handleMovedPath(s,t)}else{var o=n+"/"+e(".pathway-folder-title",e(this)).first().attr("name");i.handleMove(this,o,i)}})},handleMovedPath:function(t,n){var i={canonical:t,customer_id:a.get("customer_id"),userid:a.get("userid")};e.extend(i,a.toParams(),i),e.ajax({type:"POST",dataType:"json",url:"/update_pathway_location?"+e.param(i),data:JSON.stringify(n),success:function(){console.log("pathway location updated")}})},render:function(){var t=this;return e(this.el).html(this.template(this.model.toJSON())),e(this.el).on("change",function(n){n.stopPropagation(),t.handleMove(e(t.el),t.setParents().join("/"),t)}),this},initialize:function(e){this.model=e.model,this.parentList=e.parentList,this.parentList.push(this.model.attributes.name)}});return r}),function(e,t,n,i){function a(n,i){this.w=e(t),this.el=e(n),this.options=e.extend({},d,i),this.init()}var s=("ontouchstart"in n.documentElement,function(){var e=n.createElement("div"),i=n.documentElement;if(!("pointerEvents"in e.style))return!1;e.style.pointerEvents="auto",e.style.pointerEvents="x",i.appendChild(e);var a=t.getComputedStyle&&"auto"===t.getComputedStyle(e,"").pointerEvents;return i.removeChild(e),!!a}()),o="mousedown touchstart MSPointerDown pointerdown",l="mousemove touchmove MSPointerMove pointermove",r="mouseup touchend touchcancel MSPointerUp MSPointerCancel pointerup pointercancel",d={listNodeName:"ol",itemNodeName:"li:not(.history-row)",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",emptyClass:"dd-empty",expandBtnHTML:'<button data-action="expand" title="Expand" class="show-hist">expand</button>',collapseBtnHTML:'<button data-action="collapse" title="Collapse">collapse</button>',group:0,maxDepth:5,threshold:20};a.prototype={init:function(){var t=this;t.reset(),t.el.data("nestable-group",this.options.group),t.placeEl=e('<div class="'+t.options.placeClass+'"/>'),e.each(this.el.find(t.options.itemNodeName),function(n,i){t.setParent(e(i))}),t.el.on("click","button",function(n){if(!(t.dragEl||"button"in n&&0!==n.button)){var i=e(n.currentTarget),a=i.data("action"),s=i.parent(t.options.itemNodeName);"collapse"===a&&t.collapseItem(s),"expand"===a&&t.expandItem(s)}});var n=function(n){n=n.originalEvent;var i=e(n.target);if(!i.hasClass(t.options.handleClass)){if(i.closest("."+t.options.noDragClass).length)return;i=i.closest("."+t.options.handleClass)}!i.length||t.dragEl||"button"in n&&0!==n.button||"touches"in n&&1!==n.touches.length||(n.preventDefault(),t.dragStart("touches"in n?n.touches[0]:n))},i=function(e){t.dragEl&&(e=e.originalEvent,e.preventDefault(),t.dragMove("touches"in e?e.touches[0]:e))},a=function(e){t.dragEl&&(e=e.originalEvent,e.preventDefault(),t.dragStop("touches"in e?e.touches[0]:e))};t.el.on(o,n),t.w.on(l,i),t.w.on(r,a)},serialize:function(){var t,n=0,i=this;return step=function(t,n){var a=[],s=t.children(i.options.itemNodeName);return s.each(function(){var t=e(this),s=e.extend({},t.data()),o=t.children(i.options.listNodeName);o.length&&(s.children=step(o,n+1)),a.push(s)}),a},t=step(i.el.find(i.options.listNodeName).first(),n)},serialise:function(){return this.serialize()},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(e){e.removeClass(this.options.collapsedClass),e.children('[data-action="expand"]').hide(),e.children('[data-action="collapse"]').show(),e.children(this.options.listNodeName).show()},collapseItem:function(e){var t=e.children(this.options.listNodeName);t.length&&(e.addClass(this.options.collapsedClass),e.children('[data-action="collapse"]').hide(),e.children('[data-action="expand"]').show(),e.children(this.options.listNodeName).hide())},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(e(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(e(this))})},setParent:function(t){t.children(this.options.listNodeName).length&&(t.prepend(e(this.options.expandBtnHTML)),t.prepend(e(this.options.collapseBtnHTML))),t.children('[data-action="collapse"]').hide()},unsetParent:function(e){e.removeClass(this.options.collapsedClass),e.children("[data-action]").remove(),e.children(this.options.listNodeName).remove()},dragStart:function(t){var a=this.mouse,s=e(t.target),o=s.closest(this.options.itemNodeName);this.placeEl.css("height",o.height()),a.offsetX=t.offsetX!==i?t.offsetX:t.pageX-s.offset().left,a.offsetY=t.offsetY!==i?t.offsetY:t.pageY-s.offset().top,a.startX=a.lastX=t.pageX,a.startY=a.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=e(n.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",o.width()),o.after(this.placeEl),o[0].parentNode.removeChild(o[0]),o.appendTo(this.dragEl),e(n.body).append(this.dragEl),this.dragEl.css({left:t.pageX-a.offsetX,top:t.pageY-a.offsetY});var l,r,d=this.dragEl.find(this.options.itemNodeName);for(l=0;l<d.length;l++)r=e(d[l]).parents(this.options.listNodeName).length,r>this.dragDepth&&(this.dragDepth=r)},dragStop:function(){var e=this.dragEl.children(this.options.itemNodeName).first();e[0].parentNode.removeChild(e[0]),this.placeEl.replaceWith(e),this.dragEl.remove(),this.el.trigger("change"),this.hasNewRoot&&this.dragRootEl.trigger("change"),e.trigger("change"),this.reset()},dragMove:function(i){var a,o,l,r,d,c=this.options,h=this.mouse;this.dragEl.css({left:i.pageX-h.offsetX,top:i.pageY-h.offsetY}),h.lastX=h.nowX,h.lastY=h.nowY,h.nowX=i.pageX,h.nowY=i.pageY,h.distX=h.nowX-h.lastX,h.distY=h.nowY-h.lastY,h.lastDirX=h.dirX,h.lastDirY=h.dirY,h.dirX=0===h.distX?0:h.distX>0?1:-1,h.dirY=0===h.distY?0:h.distY>0?1:-1;var p=Math.abs(h.distX)>Math.abs(h.distY)?1:0;if(!h.moving)return h.dirAx=p,void(h.moving=!0);h.dirAx!==p?(h.distAxX=0,h.distAxY=0):(h.distAxX+=Math.abs(h.distX),0!==h.dirX&&h.dirX!==h.lastDirX&&(h.distAxX=0),h.distAxY+=Math.abs(h.distY),0!==h.dirY&&h.dirY!==h.lastDirY&&(h.distAxY=0)),h.dirAx=p,h.dirAx&&h.distAxX>=c.threshold&&(h.distAxX=0,l=this.placeEl.prev(c.itemNodeName),h.distX>0&&l.length&&!l.hasClass(c.collapsedClass)&&(a=l.find(c.listNodeName).last(),d=this.placeEl.parents(c.listNodeName).length,d+this.dragDepth<=c.maxDepth&&(a.length?(a=l.children(c.listNodeName).last(),a.append(this.placeEl)):(a=e("<"+c.listNodeName+"/>").addClass(c.listClass),a.append(this.placeEl),l.append(a),this.setParent(l)))),h.distX<0&&(r=this.placeEl.next(c.itemNodeName),r.length||(o=this.placeEl.parent(),this.placeEl.closest(c.itemNodeName).after(this.placeEl),o.children().length||this.unsetParent(o.parent()))));var u=!1;if(s||(this.dragEl[0].style.visibility="hidden"),this.pointEl=e(n.elementFromPoint(i.pageX-n.body.scrollLeft,i.pageY-(t.pageYOffset||n.documentElement.scrollTop))),s||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(c.handleClass)&&(this.pointEl=this.pointEl.parent(c.itemNodeName)),this.pointEl.hasClass(c.emptyClass))u=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(c.itemClass))return;var m=this.pointEl.closest("."+c.rootClass),g=this.dragRootEl.data("nestable-id")!==m.data("nestable-id");if(!h.dirAx||g||u){if(g&&c.group!==m.data("nestable-group"))return;if(d=this.dragDepth-1+this.pointEl.parents(c.listNodeName).length,d>c.maxDepth)return;var f=i.pageY<this.pointEl.offset().top+this.pointEl.height()/2;o=this.placeEl.parent(),u?(a=e(n.createElement(c.listNodeName)).addClass(c.listClass),a.append(this.placeEl),this.pointEl.replaceWith(a)):f?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),o.children().length||this.unsetParent(o.parent()),this.dragRootEl.find(c.itemNodeName).length||this.dragRootEl.append('<div class="'+c.emptyClass+'"/>'),g&&(this.dragRootEl=m,this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}}},e.fn.nestable=function(t){var n=this,i=this;return n.each(function(){var n=e(this).data("nestable");n?"string"==typeof t&&"function"==typeof n[t]&&(i=n[t]()):(e(this).data("nestable",new a(this,t)),e(this).data("nestable-id",(new Date).getTime()))}),i||n}}(window.jQuery||window.Zepto,window,document),define("nestable",["jquery","jquery_ui","bootstrap"],function(){}),function(e){"function"==typeof define&&define.amd?define("nestedSortable",["jquery","jquery_ui"],e):e(jQuery)
}(function(e){function t(e,t,n){return e>t&&t+n>e}e.widget("mjs.nestedSortable",e.extend({},e.ui.sortable.prototype,{options:{disableParentChange:!1,doNotClear:!1,expandOnHover:700,isAllowed:function(){return!0},isTree:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,startCollapsed:!1,tabSize:20,branchClass:"mjs-nestedSortable-branch",collapsedClass:"mjs-nestedSortable-collapsed",disableNestingClass:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",expandedClass:"mjs-nestedSortable-expanded",hoveringClass:"mjs-nestedSortable-hovering",leafClass:"mjs-nestedSortable-leaf",disabledClass:"mjs-nestedSortable-disabled"},_create:function(){if(this.element.data("ui-sortable",this.element.data("mjs-nestedSortable")),!this.element.is(this.options.listType))throw new Error("nestedSortable: Please check that the listType option is set to your actual list type");if(this.options.isTree&&this.options.expandOnHover&&(this.options.tolerance="intersect"),e.ui.sortable.prototype._create.apply(this,arguments),this.options.isTree){var t=this;e(this.items).each(function(){var e=this.item;e.children(t.options.listType).length||e.hasClass("sub-folder")?(e.addClass(t.options.branchClass),e.hasClass(t.options.collapsedClass)||e.hasClass(t.options.expandedClass)||e.addClass(t.options.startCollapsed?t.options.collapsedClass:t.options.expandedClass)):e.addClass(t.options.leafClass)})}},_destroy:function(){return this.element.removeData("mjs-nestedSortable").removeData("ui-sortable"),e.ui.sortable.prototype._destroy.apply(this,arguments)},_mouseDrag:function(t){var n,i,a,s,o=this.options,l=!1;this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=l=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=l=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=l=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=l=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?l=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(l=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?l=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(l=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),l!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute");var r=this.placeholder.offset().top;this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),this.hovering=this.hovering?this.hovering:null,this.mouseentered=this.mouseentered?this.mouseentered:!1;var d=this.placeholder[0].parentNode.parentNode&&e(this.placeholder[0].parentNode.parentNode).closest(".ui-sortable").length?e(this.placeholder[0].parentNode.parentNode):null,c=this._getLevel(this.placeholder),h=this._getChildLevels(this.helper),p=document.createElement(o.listType);for(n=this.items.length-1;n>=0;n--)if(i=this.items[n],a=i.item[0],s=this._intersectsWithPointer(i),s&&i.instance===this.currentContainer){if(-1!==a.className.indexOf(o.disabledClass))if(2===s){var u=this.items[n+1];if(u&&-1!==u.item[0].className.indexOf(o.disabledClass))continue}else if(1===s){var m=this.items[n-1];if(m&&-1!==m.item[0].className.indexOf(o.disabledClass))continue}if(a!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==a&&!e.contains(this.placeholder[0],a)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],a):!0)){if(this.mouseentered||(e(a).mouseenter(),this.mouseentered=!0),o.isTree&&e(a).hasClass(o.collapsedClass)&&o.expandOnHover&&!this.hovering){e(a).addClass(o.hoveringClass);var g=this;this.hovering=window.setTimeout(function(){e(a).removeClass(o.collapsedClass).addClass(o.expandedClass),g.refreshPositions(),g._trigger("expand",t,g._uiHash())},o.expandOnHover)}if(this.direction=1==s?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(i))break;if(e(a).mouseleave(),this.mouseentered=!1,e(a).removeClass(o.hoveringClass),this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,!o.protectRoot||this.currentItem[0].parentNode==this.element[0]&&a.parentNode!=this.element[0])o.protectRoot||this._rearrange(t,i);else if(this.currentItem[0].parentNode!=this.element[0]&&a.parentNode==this.element[0]){e(a).children(o.listType).length||(a.appendChild(p),o.isTree&&e(a).removeClass(o.leafClass).addClass(o.branchClass+" "+o.expandedClass));var f="down"===this.direction?e(a).prev().children(o.listType):e(a).children(o.listType);void 0!==f[0]&&this._rearrange(t,null,f)}else this._rearrange(t,i);this._clearEmpty(a),this._trigger("change",t,this._uiHash());break}}var v=this.placeholder[0].previousSibling?e(this.placeholder[0].previousSibling):null;if(null!=v)for(;"li"!=v[0].nodeName.toLowerCase()||-1!==v[0].className.indexOf(o.disabledClass)||v[0]==this.currentItem[0]||v[0]==this.helper[0];){if(!v[0].previousSibling){v=null;break}v=e(v[0].previousSibling)}var b=this.placeholder[0].nextSibling?e(this.placeholder[0].nextSibling):null;if(null!=b)for(;"li"!=b[0].nodeName.toLowerCase()||-1!==b[0].className.indexOf(o.disabledClass)||b[0]==this.currentItem[0]||b[0]==this.helper[0];){if(!b[0].nextSibling){b=null;break}b=e(b[0].nextSibling)}return this.beyondMaxLevels=0,null==d||null!=b||o.protectRoot&&d[0].parentNode==this.element[0]||!(o.rtl&&this.positionAbs.left+this.helper.outerWidth()>d.offset().left+d.outerWidth()||!o.rtl&&this.positionAbs.left<d.offset().left)?null==v||v.hasClass(o.disableNestingClass)||!(v.children(o.listType).length&&v.children(o.listType).is(":visible")||!v.children(o.listType).length)||o.protectRoot&&this.currentItem[0].parentNode==this.element[0]||!(o.rtl&&this.positionAbs.left+this.helper.outerWidth()<v.offset().left+v.outerWidth()-o.tabSize||!o.rtl&&this.positionAbs.left>v.offset().left+o.tabSize)?this._isAllowed(d,c,c+h):(this._isAllowed(v,c,c+h+1),(!v.children(o.listType).length||v.hasClass("sub-folder"))&&(v[0].appendChild(p),o.isTree&&v.removeClass(o.leafClass).addClass(o.branchClass+" "+o.expandedClass)),r&&r<=v.offset().top?v.children(o.listType).prepend(this.placeholder):v.children(o.listType)[0].appendChild(this.placeholder[0]),this._trigger("change",t,this._uiHash())):(d.after(this.placeholder[0]),o.isTree&&d.children(o.listItem).children("li:visible:not(.ui-sortable-helper)").length<1&&!d.hasClass("sub-folder")&&d.removeClass(this.options.branchClass+" "+this.options.expandedClass).addClass(this.options.leafClass),this._clearEmpty(d[0]),this._trigger("change",t,this._uiHash())),this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?e(this.domPosition.prev).after(this.placeholder):e(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",t,this._uiHash())),e("."+this.options.hoveringClass).mouseleave().removeClass(this.options.hoveringClass),this.mouseentered=!1,this.hovering&&window.clearTimeout(this.hovering),this.hovering=null,e.ui.sortable.prototype._mouseStop.apply(this,arguments);var n=e(this.domPosition.parent).parent().attr("id"),i=this.domPosition.prev?e(this.domPosition.prev).next().index():0;(n!=this._uiHash().item.parent().parent().attr("id")||i!=this._uiHash().item.index())&&this._trigger("relocate",t,this._uiHash())},_intersectsWithSides:function(e){var n=this.options.isTree?.8:.5,i=t(this.positionAbs.top+this.offset.click.top,e.top+e.height*n,e.height),a=t(this.positionAbs.top+this.offset.click.top,e.top-e.height*n,e.height),s=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),o=this._getDragVerticalDirection(),l=this._getDragHorizontalDirection();return this.floating&&l?"right"==l&&s||"left"==l&&!s:o&&("down"==o&&i||"up"==o&&a)},_contactContainers:function(){this.options.protectRoot&&this.currentItem[0].parentNode==this.element[0]||e.ui.sortable.prototype._contactContainers.apply(this,arguments)},_clear:function(){e.ui.sortable.prototype._clear.apply(this,arguments);for(var t=this.items.length-1;t>=0;t--){var n=this.items[t].item[0];this._clearEmpty(n)}},serialize:function(t){var n=e.extend({},this.options,t),i=this._getItemsAsjQuery(n&&n.connected),a=[];return e(i).each(function(){var t=(e(n.item||this).attr(n.attribute||"id")||"").match(n.expression||/(.+)[-=_](.+)/),i=(e(n.item||this).parent(n.listType).parent(n.items).attr(n.attribute||"id")||"").match(n.expression||/(.+)[-=_](.+)/);t&&a.push((n.key||t[1])+"["+(n.key&&n.expression?t[1]:t[2])+"]="+(i?n.key&&n.expression?i[1]:i[2]:n.rootID))}),!a.length&&n.key&&a.push(n.key+"="),a.join("&")},toHierarchy:function(t){function n(t){var a=(e(t).attr(i.attribute||"id")||"").match(i.expression||/(.+)[-=_](.+)/);if(a){var s={id:a[2]};return e(t).children(i.listType).children(i.items).length>0&&(s.children=[],e(t).children(i.listType).children(i.items).each(function(){var e=n(this);s.children.push(e)})),s}}var i=e.extend({},this.options,t),a=(i.startDepthCount||0,[]);return e(this.element).children(i.items).each(function(){var e=n(this);a.push(e)}),a},toArray:function(t){function n(t,o,l){var r,d,c=l+1;if(e(t).children(i.listType).children(i.items).length>0&&(o++,e(t).children(i.listType).children(i.items).each(function(){c=n(e(this),o,c)}),o--),r=e(t).attr(i.attribute||"id").match(i.expression||/(.+)[-=_](.+)/),o===a+1)d=i.rootID;else{var h=e(t).parent(i.listType).parent(i.items).attr(i.attribute||"id").match(i.expression||/(.+)[-=_](.+)/);d=h[2]}return r&&s.push({item_id:r[2],parent_id:d,depth:o,left:l,right:c}),l=c+1}var i=e.extend({},this.options,t),a=i.startDepthCount||0,s=[],o=1;return i.excludeRoot||(s.push({item_id:i.rootID,parent_id:null,depth:a,left:o,right:2*(e(i.items,this.element).length+1)}),o++),e(this.element).children(i.items).each(function(){o=n(this,a+1,o)}),s=s.sort(function(e,t){return e.left-t.left})},_clearEmpty:function(t){var n=this.options,i=e(t).children(n.listType);!i.length||i.children().length||n.doNotClear||e(t).hasClass("sub-folder")?n.isTree&&i.length&&i.children().length&&i.is(":visible")?e(t).removeClass(n.leafClass).addClass(n.branchClass+" "+n.expandedClass):n.isTree&&i.length&&i.children().length&&!i.is(":visible")?e(t).removeClass(n.leafClass).addClass(n.branchClass+" "+n.collapsedClass):n.isTree&&e(t).hasClass("sub-folder")&&e(t).removeClass(n.leafClass).addClass(n.branchClass+" "+n.collapsedClass):(n.isTree&&e(t).removeClass(n.branchClass+" "+n.expandedClass).addClass(n.leafClass),i.remove())},_getLevel:function(e){var t=1;if(this.options.listType)for(var n=e.closest(this.options.listType);n&&n.length>0&&!n.is(".ui-sortable");)t++,n=n.parent().closest(this.options.listType);return t},_getChildLevels:function(t,n){var i=this,a=this.options,s=0;return n=n||0,e(t).children(a.listType).children(a.items).each(function(e,t){s=Math.max(i._getChildLevels(t,n+1),s)}),n?s+1:s},_isAllowed:function(e,t,n){var i=this.options,a=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels"),s=this.currentItem.parent().parent(),o=i.disableParentChange&&(null!==e&&!s.is(e)||null===e&&s.is("li"));o||!i.isAllowed(this.placeholder,e,this.currentItem)?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=n>a&&0!=a?n-a:1):n>a&&0!=a?(this.placeholder.addClass(i.errorClass),this.beyondMaxLevels=n-a):(this.placeholder.removeClass(i.errorClass),this.beyondMaxLevels=0)}})),e.mjs.nestedSortable.prototype.options=e.extend({},e.ui.sortable.prototype.options,e.mjs.nestedSortable.prototype.options)}),define("widgets/pathway/pathwaysList.js",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/pathwayCollection","pathway/models/treeModel","pathway/modalViews/newPathway","pathway/singleRows/pathRow","text!templates/pathway/pathwaysList.html","pathway/modalViews/newPathwayFolder","pathway/singleRows/folderRow","globalmodels/sidebarModel","nestable","nestedSortable"],function(e,t,n,i,s,o,l,r,d,c,h,p){var u=n.View.extend({template:t.template(d),events:{"click #add-base-pathway":"handle_newPath","click #save-button":"handle_save","click #paths-list-add-folder":"handle_new_folder","change .mvn-importpath":"importPathway"},initialize:function(){i.on("change:page",function(){"pathEditor"!=i.get("page")?this.$el.hide():this.$el.show()},this),p.addOption("Pathway Mgmt"),s.bind("add",this.addNewPathway,this),this.render()},renderFolder:function(t,i,a,s){var o=new n.Model({name:t}),l=new h({model:o});a.append(l.render().$el),e.each(i,function(e,t){s.renderFolder(e,t,l.$el,s)})},addNewPathway:function(e){this.insertPathway(e,!0)},importPathway:function(){var t=e(".mvn-importpath");if(file=t.get(0).files[0]){var n=new FileReader;n.readAsText(file,"UTF-8"),n.onload=function(e){try{var t=JSON.parse(e.target.result);o.loadNewPathway(t,{toImport:!0})}catch(n){alert("The format of the file doesn't match Pathway format. Please try another file")}},n.onerror=function(){alert("error reading file")},t.wrap("<form>").closest("form").get(0).reset(),t.unwrap()}},insertPathway:function(t,i){var a=e("#avail-paths-list"),s=t.get("folder");if(null!=s&&""!=s)for(var o=s.split("/"),l=0;l<o.length;l++){var d=!1;if(e.each(a.children("li"),function(){var t=e(this).children(".pathway-folder-title").attr("name");return t&&t==o[l]?(a=e(this).children("ol"),d=!0,!1):void 0}),!d){var c=new n.Model({name:o[l]}),p=new h({model:c,parentList:o.slice(0,l)}),u=a.children(".sub-folder").last();u.length?e(p.render().$el).insertAfter(u):a.prepend(p.render().$el),a=e(p.el).children("ol")}}var c=new n.Model({id:t.get("pathid"),name:t.get("name"),canonical:t.get("canonical"),enabled:t.get("enabled")}),m=new r({model:c});e(a).append(m.render().$el),i&&(m.handleSelect(),e(a).closest("li").switchClass("mjs-nestedSortable-collapsed","mjs-nestedSortable-expanded"))},render:function(){var n=this;this.$el.html(this.template()),"pathEditor"!=i.get("page")&&this.$el.hide();e("#avail-paths-list",this.$el);t.each(s.models,function(e){n.insertPathway(e,!1)},this),s.makeSortable(),e(this.el).on("change",function(t){t.stopPropagation(),n.handleChange(e("#avail-paths-list"),"",n)})},handle_new_folder:function(){a=new c({el:"#modal-target"})},handle_newPath:function(){a=new l({el:"#modal-target"})},handle_save:function(){o.save()},handleMovedPath:function(t,n){var a={canonical:t,customer_id:i.get("customer_id"),userid:i.get("userid")};e.extend(a,i.toParams(),a),e.ajax({type:"POST",dataType:"json",url:"/update_pathway_location?"+e.param(a),data:JSON.stringify(n),success:function(){console.log("pathway location updated")}})},handleChange:function(t,n,i){var a=0;e(t).children().each(function(){if(e(this).hasClass("pathrow-item")){a++;var t={location:n,position:a},s=e(".path-row",e(this)).attr("id");i.handleMovedPath(s,t)}})}});return u}),define("widgets/pathway/triggerEditor.js",["jquery","underscore","backbone","globalmodels/contextModel","globalmodels/layoutModel","pathway/modalViews/detailEditor","pathway/internalViews/detailGroup","pathway/models/treeModel","Helpers","text!templates/pathway/detailSection.html","text!templates/pathway/disjoinedGroups.html","bootstrapswitch"],function(e,t,n,i,a,s,o,l,r,d,c){var h=function(n,i,a){require(["text!/templates/pathway/details/"+n+"Detail.html"],function(n){return function(s){var l=i.get("details").get(n),r=t.template(s),c=t.template(d);a.append(c());var h=new o({group:i,el:e(".items").last(),lineTemplate:r,list:l,type:n});h.render()}}(n))},p=n.View.extend({el:"#modal-target",initialize:function(e){this.template=t.template(e.template);i.on("change:page",function(){"triggerEditor"==i.get("page")?(this.$el.show(),this.render(),a.set("fluidContent",!1)):this.$el.hide()},this),"triggerEditor"==i.get("page")?(this.$el.show(),a.set("fluidContent",!1)):this.$el.hide(),this.render()},render:function(){var a=this;l.once("sync",function(){a.render()}),this.$el.html(this.template()),e("#back-to-editor").on("click",function(){n.history.navigate("pathwayeditor/"+i.get("pathid")+"/node/"+i.get("code"),{trigger:!0})}),e(".createButton").draggable({revert:!0}),e("#add-group-button").on("click",function(){l.get("triggers").addGroup("and")});var o=n.View.extend({template:t.template(c),initialize:function(e){this.group=e.group},render:function(){var i=this;this.$el.css({"border-style":"solid","border-width":"4px"}),this.$el.droppable({drop:function(o,l){var r=l.draggable[0].id;require(["text!templates/pathway/details/"+r+"_editor.html"],function(o){var l=new s({group:i.group,template:t.template(o),model:new n.Model,newDetail:!0,el:e("#detailed-trigger-modal"),triggerNode:a.triggerNode,type:r});l.render()})},activeClass:"activeDrop",hoverClass:"hoverDrop"});var o={relationship:this.group.get("relationship"),groupID:this.group.cid};this.$el.html(this.template(o)),e(".group-delete",this.$el).on("click",function(){l.get("triggers").remove(i.group)}),e(".toggles",this.$el).bootstrapSwitch(),e(".toggles",this.$el).bootstrapSwitch("onText","Any"),e(".toggles",this.$el).bootstrapSwitch("offText","All"),"and"==i.group.get("relationship")?e(".toggles",this.$el).bootstrapSwitch("state",!1,!1):e(".toggles",this.$el).bootstrapSwitch("state",!0,!1),e(".toggles",this.$el).on("switchChange.bootstrapSwitch",function(){0==e(".toggles",i.$el).bootstrapSwitch("state")?i.group.set("relationship","and"):i.group.set("relationship","or")});for(var r in this.group.get("details").attributes){var d=e(".detail-sections",this.$el);h(r,this.group,d)}return this}});for(var r in l.get("triggers").models){var d=new o({group:l.get("triggers").models[r]});e("#disjoinedGroups").append(d.$el),e("#disjoinedGroups").append("<div style='height:25px'></div>"),d.render()}}});return p}),define("text!templates/interactionRow.html",[],function(){return"<td>\n    <%= providername %>\n</td>\n<td>\n    <%= patientname %>\n</td>\n<td>\n    <%= protocolname %>\n</td>\n<td>\n  <%= eventcount %>\n</td>\n<td>\n    <%= date %>\n</td>\n\n"}),define("singleRow/interactionRow",["jquery","underscore","backbone","globalmodels/contextModel","pathway/models/treeContext","text!templates/interactionRow.html"],function(e,t,n,i,a,s){var o=n.View.extend({tagName:"tr class='interaction-row'",template:t.template(s),initialize:function(){i.on("change:nextflips change:page",function(){i.get("nextflips")&&"pathway"==i.get("page")?this.$el.hide():this.$el.show()},this)},render:function(){return e(this.el).html(this.template(e.extend({viewid:this.cid},this.model.toJSON()))),this},events:{click:"handleClick"},handleClick:function(){var t=this;e.ajax({url:"/interaction_details",data:t.model.toJSON(),success:function(e){a.suppressClick=!0,i.set({history:e,historydetails:t.model,historyposition:0})},error:function(){console.log("error",arguments)},dataType:"json",method:"GET"})}});return o}),define("widgets/interactionList.js",["jquery","underscore","backbone","globalmodels/interactionCollection","singleRow/interactionRow","globalmodels/contextModel","pathway/models/treeContext"],function(e,t,n,i,a,s,o){var l,r=function(){var e=s.get("historyposition");"undefined"!=typeof e&&s.set("historyposition",e+1)},d=function(e){(13==e.keyCode||39==e.keyCode)&&(e.preventDefault(),r())};e(document).keydown(function(e){d(e)});var c=n.View.extend({extraData:{},lastHeight:0,first:!0,initialize:function(e){"undefined"!=typeof e.extraData&&(this.extraData=e.extraData),l=new(i.extend({extraData:this.extraData})),this.template=t.template(e.template),this.$el.html(this.template()),l.bind("add",this.addInteraction,this),l.bind("reset",this.reset,this),this.render("Loading ..."),s.on("change:page change:history",function(){this.showhide()},this),s.on("change:history change:historyposition change:historydetails",function(){this.updatehistory()},this)},updatehistory:function(){var t=s.get("history"),i=s.get("historyposition"),a=s.get("historydetails");if(null==t||null==i||null==a)return o.suppressClick=!1,void n.history.navigate("",!0);o.suppressClick=!0;var l=i+1;if(l>t.length)s.set({history:null,historyposition:null,historydetails:null});else{var r="pathway/"+a.get("protocol")+"/node/-"+t[i].node_id;n.history.navigate(r,!0),e("#historyheader").text(a.get("protocolname")+" pathway interaction replay: "+a.get("providername")+" with "+a.get("patientname")+" on "+t[i].datetime),e(".progress-bar",this.$el).width(100*l/t.length+"%");var d=t[i].action;e("#historydetails").text("click"==d?"traversing the tree":"send"==d?"forwarding the chart":"copy"==d?"copying protocol text to the clipboard":"followup"==d?"scheduling a follow-up message":"checked"==d?"checking an optional item "+t[i].details:"unchecked"==d?"unchecking an optional item "+t[i].details:""),e("#nextinteraction").html(l==t.length?"Finish":"Next")}},showhide:function(){var t=s.get("page");"home"==t?(this.$el.show(),e(this.interactioncontrols).hide(),e(this.interactionlist).show()):"pathway"==t&&s.get("history")?(this.$el.show(),e(this.interactionlist).hide(),e(this.interactioncontrols).show()):this.$el.hide()},render:function(){this.$el.html(this.template()),l.length,this.addAll(),this.interactionlist=e("#listinteractions",this.$el);var t=e(".interaction-scroll",this.$el);t.scroll(function(){return t.scrollTop()+t.innerHeight()+100>=t[0].scrollHeight&&l.more(),!1}),this.interactioncontrols=e("#interactioncontrols",this.$el),e("#nextinteraction",this.$el).click(function(){r()}),e(this.interactionlist).on("show",function(){l.reset(),l.initialize()}),e(".refreshButton",this.$el).click(function(){e(".interactiontable > tbody",this.$el).empty(),l.refresh()}),e(".refreshButton",this.$el).hover(function(t){e(t.target).attr("title","Last Refresh: "+l.getLastRefresh())}),this.showhide()},addAll:function(){this.reset();var t=!1;if(l.length)for(interaction in l.models)this.addInteraction(l.models[interaction]),t=!0;else{e(".interactiontable > thead",this.$el).show(),e(".interaction-control-row",this.$el).show(),this.showhide();var n=e(".interaction-scroll",this.$el);setTimeout(function(){var e=n.innerHeight();this.lastHeight!=e&&e<parseInt(n.css("max-height"))&&(this.lastHeight=e,l.more())},500)}},addInteraction:function(t){var n=new a({model:t});e(".interactiontable",this.$el).append(n.render().el),this.showhide()},reset:function(){e(".interactiontable > tbody",this.$el).empty(),this.$el.hide()}});return c}),define("jquery-stub",[],function(){return jQuery}),define("text!../templates/settings.html",[],function(){return'<div class = "widget-column col-sm-12">\n<div class="modal-dialog modal-lg" id="settings" xmlns="http://www.w3.org/1999/html">\n    <div class="modal-content">\n        <div class="modal-body">\n            <h3><b>User Settings</b></h3>\n            <div class="container col-md-12">\n                <p>Official Name: <input id="official-name-input" type="text" value="<%=official_name %>" autofocus> </p>\n                <p>Display Name: <input id="display-name-input" type="text" value="<%= display %>" > </p>\n                <div>\n                        <button id="save-settings">Save</button>\n                        <button id="cancel-settings">Cancel</button>\n                </div>\n            </div>\n            <div style="clear:both; overflow: auto;">\n                <h5><b>Change Password</b></h5>\n\n                <div style="width:49%; float:left;">\n                <p><b>Old</b> Password: <input id="login-password" type="password" placeholder="password" name="password"></p>\n                <p><b>New</b> Password: <input id="login-new-password" type="password" name="password" placeholder="password"></p>\n                <p><b>Confirm New</b> Password: <input id="login-new-password2" type="password" name="password" placeholder="password"></p>\n                </div>\n\n                <div style="width:49%; float:left;">\n                    <div> New passwords must contain:</div>\n                    <ul>\n                        <li>At least 8 characters <i id=\'pw-len-cb\'></i></li>\n                        <li>A lower-case character <i id=\'pw-low-cb\'></i></li>\n                        <li>An upper-case character <i id=\'pw-up-cb\'></i></li>\n                        <li>A number<i id=\'pw-num-cb\'></i></li>\n                    </ul>\n                    <div> And it must be different from the old password <i id="pw-diff-cb"></i></div>\n                    <div>\n                        <button id="update-password">Update Password</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n</div>\n'}),define("text!../templates/auditScroll.html",[],function(){return'\n<div class = "widget-column">\n    <div class="auditlist audit-scroll" style="clear:both;">\n        <div class="auditaccordion">\n            <table class="table table-condensed table-hover audittable">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <col width="20%">\n            <thead >\n                <tr>\n                    <th align="left">Date</th>\n                    <th align="left">Patient</th>\n                    <th align="left">Action</th>\n                    <th align="left">User</th>\n                    <th align="left">Device</th>\n                    <th align="left">Details</th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n            </table>\n        </div>\n    </div>\n    <div class="audit-control-row">\n        <!--[if gte IE 10]><!-->\n            <button class="btn btn-default download-user-audits">Download Audits</button>\n        <!--<![endif]-->\n    </div>\n</div>\n'}),define("text!../templates/customerList.html",[],function(){return'<div class = "widget-column col-sm-12" style="clear: both;">\n\n<div class="row customerlist" style="margin: auto; width: 100%;">\n    <div class="widget-header">\n    <span class="headings title">Customers</span>\n        <button type="button" class="btn btn-default btn-xs refreshButton" data-dismiss="modal" style="margin-left:10px; color: #46ECBD; font-size: 10px;">\n            <span class="glyphicon glyphicon-refresh"></span>\n        </button>\n    </div>\n    <div class="customeraccordion" style="overflow-y:auto; max-height:500px; width:100%">\n        <table class="table table-condensed table-hover customertable" style="width:100%; padding: 0;">\n        <col width="5%">\n        <col width="43%">\n        <col width="13%">\n        <col width="17%">\n        <col width="11%">\n        <col width="*">\n        <thead>\n            <tr>\n                <th align="left" id="cus_id">ID</th>\n                <th align="left" id="cus_name">Name</th>\n                <th align="left" id="cus_abbr">Abbreviation</th>\n                <th align="left" id="cus_license_exp">License Exp</th>\n                <th align="left" id="cus_license_typ"># Licenses</th>\n                <th align="left"></th>\n            </tr>\n        </thead>\n        <tbody>\n        </tbody>\n        </table>\n    </div>\n    <div class="save-settings-row row">\n        <span id="save-customer-message" class="setting-option option-left">&nbsp;</span>\n        <div class="setting-option option-right"><button id="save-customer-changes" class="btn btn-default">Save Changes</button></div>\n    </div>\n</div>\n\n</div>'}),define("text!../templates/welcome.html",[],function(){return'        <div class="modal-header">\n            <h4 class="modal-title">Welcome <%= display %></h4>\n        </div>\n\n        <div class="modal-body">\n            <span class="headings title">Navigating Interactive Clinical Pathways</span>\n\n            <div>\n                <p>\n                    Navigating starts by clicking on a node, and working down the decision tree. The tree path changes\n\n                    from gray to providing a visual cue of the selected path. Your active node, or most recent click is\n\n                    outlined in purple, and a yellow shaded box indicates a collapsed node. A care protocol is the final\n                    node\n\n                    for a branch, and is indicated by the green outline. This protocol can be copied and pasted to your\n                    EHR\n\n                    by clicking the copy icon.\n                </p>\n                <img src="../images/temp/Pathway_at_protocal_screenshot.png" style="display: block; width: 50%; height: 50%; margin-left: auto;\n    margin-right: auto">\n            </div>\n\n        </div>\n\n'}),define("text!../templates/interactionScroll.html",[],function(){return'<div class = "widget-column">\n  <div id=\'listinteractions\'>\n    <span class="headings title">Pathway Interactions</span>\n    <button type="button" class="btn btn-default btn-xs refreshButton" data-dismiss="modal" style="margin-left:10px; color: #46ECBD; font-size: 10px;">\n      <span class="glyphicon glyphicon-refresh"></span>\n    </button>\n    <div class="interactionlist interaction-scroll" style="clear:both;">\n      <div class="interactionaccordion">\n        <table class="table table-condensed table-hover interactiontable">\n          <col width="20%">\n          <col width="20%">\n          <col width="20%">\n          <col width="20%">\n          <thead >\n            <tr>\n              <th align="left">User</th>\n              <th align="left">Patient</th>\n              <th align="left">Pathway</th>\n              <th align="left">Interaction Count</th>\n              <th align="left">Time</th>\n            </tr>\n          </thead>\n          <tbody>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n  <div id=\'interactioncontrols\'>\n    <span id=\'historyheader\' class="headings title">Pathway Interaction Replay:</span>\n    <div class="progress">\n      <div class="progress-bar" role="progressbar" style="width: <%= (typeof width !== \'undefined\' && width) || 0 %>%;">\n      </div>\n    </div>\n    <div id=\'historydetails\'></div>\n    <button id=\'nextinteraction\' type=\'button\' class=\'btn btn-default\'>Next</button>\n  </div>\n</div>\n'}),define("text!../templates/patientInfo.html",[],function(){return'<div class = "widget-column col-sm-12">\n  <div class="pat-nav">\n    <nav class="navbar navbar-default navbar-fixed-top navbar-lower" role="navigation">\n      <div class="container" style="display:table">\n	<div class="col-sm-12 pat-info">\n          <div class="row pat-title">\n            Patient Name:\n	  </div>\n	  <div class="row">\n            <span id="pat-name"><b><%= name %></b></span> \n	    <span style="white-space:nowrap">(<%= gender %>, <%= DOB %>)</span>\n	  </div>\n	</div>\n      </div>\n    </nav>\n  </div>\n  <!-- /Patient Header -->\n</div>\n'}),define("text!../templates/topBanner.html",[],function(){return'<!-- #section:basics/sidebar.mobile.toggle -->\n <button data-target="#sidebar"   data-toggle="collapse" type="button" class="navbar-toggle menu-toggler pull-left fixed display" id="menu-toggler">\n   <span class="sr-only">Toggle sidebar</span>\n  <i class="ace-icon fa fa-bars white bigger-125"></i>\n </button>\n\n  <!-- TODO: need to have it within a page condition statement -->\n  <button data-target="#fixed-topB" data-toggle="collapse" type="button" class="pull-left navbar-toggle collapsed">\n	<span class="sr-only">Toggle sidebar</span>\n	<i class="ace-icon fa fa-gear white bigger-125"></i>\n </button>\n\n\n    <div class="navbar-header pull-left">\n     <a href="#" class="navbar-brand">\n                        <small>\n                            <i class="fa fa"></i>\n                            maven\n                        </small>\n                    </a>\n    </div><!-- /.navbar-header -->\n\n\n    <div class="navbar-buttons navbar-header pull-right">\n      <ul class="nav ace-nav">\n        <!-- user buttons such as messages, notifications and user menu -->\n\n           <!-- #section:basics/navbar.user_menu -->\n                        <li class="light-blue">\n                            <a data-toggle="dropdown" href="#" class="dropdown-toggle">\n                                <!--<img class="nav-user-photo" src="ace/assets/avatars/user.jpg" alt="Jason\'s Photo" />-->\n                                <i class="glyphicon glyphicon-user" style="color: whitesmoke;"></i>\n                                <span class="user-info">\n                                    <small>Welcome,</small>\n                                    <%= display %>\n                                </span>\n\n                                <i class="ace-icon fa fa-caret-down"></i>\n                            </a>\n\n                            <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">\n                                <li id="profile_button">\n                                    <a href="#">\n                                        <i class="ace-icon fa fa-user"></i>\n                                        Profile\n                                    </a>\n                                </li>\n\n                                <li class="divider"></li>\n\n                                <li>\n                                    <a href="#logout">\n                                        <i class="ace-icon fa fa-power-off"></i>\n                                        Logout\n                                    </a>\n                                </li>\n                            </ul>\n                        </li>\n\n                        <!-- /section:basics/navbar.user_menu -->\n      </ul>\n    </div><!-- /.navbar-buttons -->\n\n\n    <nav class="navbar-menu pull-left">\n      <!-- optional menu & form inside navbar -->\n    </nav><!-- /.navbar-menu -->\n\n\n'
}),define("text!../templates/maveninfo.html",[],function(){return'<div class="widget-column col-sm-12">\n    <div id="mavenInfo-header" class="row heading">\n\n        <button type="button" class="close">\n            <span class="glyphicon glyphicon-remove" style="font-size: 13px; color: #ffffff;"></span>\n        </button>\n\n         <span id="mavenInfo-title" class="headings title">\n             <%=name%>\n         </span>\n\n    </div>\n    <div class="row nodeInfo">\n        <span>\n            <%= (typeof sidePanelText !== \'undefined\') ? sidePanelText : \'\' %>\n        </span>\n    </div>\n</div>\n'}),define("text!../templates/providerProfile.html",[],function(){return'<div class="modal-dialog modal-lg" id="profile" xmlns="http://www.w3.org/1999/html">\n<div class="modal-content">\n\n<div class="tabbable">\n<ul id="profile-tabs" class="nav nav-tabs ">\n<!--    <li class="active">\n        <a href="#pane1" role="tab" data-toggle="tab" class="headings">\n            <span class="glyphicon glyphicon-user"></span>\n            About me\n        </a>\n    </li>\n    <li>\n        <a href="#pane2" role="tab" data-toggle="tab" class="headings">\n            <span class="glyphicon glyphicon-star"></span>\n            My Favorite\n        </a></li>\n    <li>\n        <a href="#pane3" role="tab" data-toggle="tab" class="headings">\n            <span class="glyphicon glyphicon-thumbs-up"></span>/\n            <span class="glyphicon glyphicon-thumbs-down"></span>\n            Liked / disliked\n        </a></li>\n    <li>\n        <a href="#pane4" role="tab" data-toggle="tab" class="headings">\n            <span class="glyphicon glyphicon-tasks"></span>\n            My Actions\n        </a></li>-->\n    <li class="active"> <!-- Active tab is the first tab shown -->\n        <a href="#pane5" role="tab" data-toggle="tab" class="headings">\n            <span class="glyphicon glyphicon-tasks"></span>\n            My Audits\n        </a></li>\n    <li>\n        <a href="#pane6" role="tab" data-toggle="tab" class="headings">\n            <span class="glyphicon glyphicon-cog"></span>\n            Settings\n        </a></li>\n</ul>\n\n<div class="tab-content">\n<!--    <div id="pane1" class="tab-pane active pane-content">\n        <div class="panel panel-default">\n            <div class="panel-body">\n\n                <div class="row">\n                    <h2 class="headings">Dr.Maven</h2>\n                </div>\n                <div class="row">\n                    <div class="col-md-8">\n\n\n                        <span class="headings title alerts">Speciality:</span>\n\n                        <p> Pediatrics</p>\n\n                        <span class="headings title alerts"> Departments:</span>\n\n                        <p> Blah, Blah Blah</p>\n\n                    </div>\n                    <div class="col-md-3">\n                        <span class="headings title alerts"> Facts About Me:</span>\n\n                         <p>\n                            <span class="glyphicon glyphicon glyphicon-chevron-right"></span>\n                            20 Years of Experience</p>\n\n                        <p>\n                            <span class="glyphicon glyphicon glyphicon-chevron-right"></span>\n                            250 Patients</p>\n\n                        <p>\n                            <span class="glyphicon glyphicon glyphicon-chevron-right"></span>\n                            50 Procedures</p>\n\n                        <p><span class="glyphicon glyphicon glyphicon-chevron-right"></span>\n                            120k Orders</p>\n\n                        <p><span class="glyphicon glyphicon glyphicon-chevron-right"></span>\n                            30 Alerts</p>\n\n\n                    </div>\n                </div>\n            </div>\n        </div>\n\n\n    </div>\n    <div id="pane2" class="tab-pane pane-content">\n\n        <div class="panel panel-default">\n            <div class="panel-heading rule">\n                <h3 class="panel-title">Rule 1</h3>\n            </div>\n            <div class="panel-body">\n                <div class="panel panel-default">\n                    <div class="panel-heading">Evidence 1\n                                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span></div>\n\n                    <div class="panel-body">\n                        Panel content\n                    </div>\n                </div>\n\n                <div class="panel panel-default">\n                    <div class="panel-heading">Evidence 2\n                                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span></div>\n\n                    <div class="panel-body">\n                        Panel content\n                    </div>\n                </div>\n\n                <div class="panel panel-default">\n                    <div class="panel-heading">Evidence 3\n                                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span></div>\n\n                    <div class="panel-body">\n                        Panel content\n                    </div>\n                </div>\n\n\n            </div>\n        </div>\n\n        <div class="panel panel-default">\n            <div class="panel-heading rule">\n                <h3 class="panel-title">Rule 2</h3>\n            </div>\n            <div class="panel-body">\n                <div class="panel panel-default">\n                    <div class="panel-heading">Evidence 1\n                                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span></div>\n\n                    <div class="panel-body">\n                        Panel content\n                    </div>\n                </div>\n\n                <div class="panel panel-default">\n                    <div class="panel-heading">Evidence 2\n                                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span></div>\n\n                    <div class="panel-body">\n                        Panel content\n                    </div>\n                </div>\n\n                <div class="panel panel-default">\n                    <div class="panel-heading">Evidence 3\n                                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                    </div>\n\n                    <div class="panel-body">\n                        Panel content\n                    </div>\n                </div>\n\n\n            </div>\n        </div>\n\n\n    </div>\n    <div id="pane3" class="tab-pane pane-content">\n        <div class="panel panel-default">\n            <div class="panel-heading">Rule 1</div>\n            <div class="panel-body">\n                <p>Info about rule</p>\n            </div>\n\n            <ul class="list-group">\n                <li class="list-group-item">Evidence 1\n                 <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 2\n                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 3\n                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 4\n                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 5<span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n            </ul>\n        </div>\n<div class="panel panel-default">\n            <div class="panel-heading">Rule 2</div>\n            <div class="panel-body">\n                <p>Info about rule</p>\n            </div>\n\n            <ul class="list-group">\n                <li class="list-group-item">Evidence 1\n                 <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 2\n                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 3\n                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 4\n                <span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n                <li class="list-group-item">Evidence 5<span class="badge">\n                                    <span class="glyphicon glyphicon-star"></span>\n                                    <span class="glyphicon glyphicon-thumbs-up">85%</span>\n                                    <span class="glyphicon glyphicon-thumbs-down">15%</span>\n                                    <span class="glyphicon glyphicon-comment">5</span>\n                                </span>\n                </li>\n            </ul>\n        </div>\n\n    </div>\n    <div id="pane4" class="tab-pane pane-content">\n        <h4>Pane 4 Content</h4>\n    </div>-->\n    <div id="pane5" class="tab-pane active pane-content audit-panel">\n        <div class="panel panel-default" id="pane5-content">\n        </div>\n    </div>\n    <div id="pane6" class="tab-pane pane-content">\n        <div class="panel panel-default">\n            <div class="panel-heading rule">\n                <h3 class="panel-title">Profile Settings</h3>\n            </div>\n            <div class="panel-body">\n                <div class="row">\n                    <div class="col-md-6">\n                        <div class="setting-row">Official Name: <input id="official-name-input" type="text" value="<%=official_name %>" autofocus> </div>\n                        <div class="setting-row">Display Name: <input id="display-name-input" type="text" value="<%= display %>" > </div>\n                        <div class="setting-footer">\n                            <button id="save-settings" class="btn btn-default">Save</button>\n                            <button id="cancel-settings" class="btn btn-default" data-dismiss="modal">Cancel</button>\n                            <div id=\'settings-save-status\' class="save-status"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <!--\n        <div class="panel panel-default">\n\n            <div class="panel-heading rule">\n                <h3 class="panel-title">Change Password</h3>\n            </div>\n            <div class="panel-body">\n                <div class="row">\n\n                    <div class="col-md-6">\n                        <div class="setting-row">Old Password: <input id="current-password" type="password" placeholder="password" name="password"></div>\n                        <div class="setting-row">New Password: <input id="new-password" type="password" name="password" placeholder="password"></div>\n                        <div class="setting-row">Confirm New Password: <input id="new-password2" type="password" name="password" placeholder="password"></div>\n\n                        <div class="setting-footer">\n                            <button id="change-password" class="btn btn-default">Update Password</button>\n                        </div>\n                    </div>\n\n                    <div class="col-md-5">\n                        <div> New passwords must contain:</div>\n                        <ul>\n                            <li>At least 8 characters <i id=\'pw-len-cb\'></i></li>\n                            <li>A lower-case character <i id=\'pw-low-cb\'></i></li>\n                            <li>An upper-case character <i id=\'pw-up-cb\'></i></li>\n                            <li>A number<i id=\'pw-num-cb\'></i></li>\n                        </ul>\n                        <div> And it must be different from the old password <i id="pw-diff-cb"></i></div>\n                    </div>\n                </div>\n            </div>\n        </div> -->\n    </div>\n</div>\n<!-- /.tab-content -->\n</div>\n<!-- /.tabbable -->\n\n<div class="modal-footer" style="padding: 5px 20px 5px;">\n    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n</div>\n</div>\n\n</div>\n'}),define("text!../templates/sidebar.html",[],function(){return'<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse" data-target="#sidebar">\n    <i class="ace-icon fa fa-angle-double-right" data-icon1="ace-icon fa fa-angle-double-left"\n       data-icon2="ace-icon fa fa-angle-double-right"></i>\n</div>\n<ul class="nav nav-list" id="sidebar-list">\n\n</ul>\n\n\n'}),require(["text!../templates/settings.html","text!../templates/auditScroll.html","text!../templates/customerList.html","text!../templates/welcome.html","text!../templates/interactionScroll.html","text!../templates/patientInfo.html","text!../templates/topBanner.html","text!../templates/maveninfo.html","text!../templates/providerProfile.html","text!../templates/sidebar.html"],function(){}),define("textstub",function(){});
//# sourceMappingURL=min.js.map